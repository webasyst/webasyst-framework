var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var e=a.length,d=0;d<e;d++){var f=a[d];if(b.call(c,f,d,a))return{i:d,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,e){if(b){c=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var d=a[e];d in c||(c[d]={});c=c[d]}a=a[a.length-1];e=c[a];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");var NO_JQUERY={};
(function(a,b,c){if(!("console"in a)){var e=a.console={};e.log=e.warn=e.error=e.debug=function(){}}b===NO_JQUERY&&(b={fn:{},extend:function(){for(var a=arguments[0],b=1,d=arguments.length;b<d;b++){var c=arguments[b],g;for(g in c)a[g]=c[g]}return a}});b.fn.pm=function(){console.log("usage: \nto send: $.pm(options)\nto receive: $.pm.bind(type, fn, [origin])");return this};b.pm=a.pm=function(a){d.send(a)};b.pm.bind=a.pm.bind=function(a,b,c,e,g){d.bind(a,b,c,e,!0===g)};b.pm.unbind=a.pm.unbind=function(a,
b){d.unbind(a,b)};b.pm.origin=a.pm.origin=null;b.pm.poll=a.pm.poll=200;var d={send:function(a){a=b.extend({},d.defaults,a);var f=a.target;if(a.target)if(a.type){var c={data:a.data,type:a.type};a.success&&(c.callback=d._callback(a.success));a.error&&(c.errback=d._callback(a.error));"postMessage"in f&&!a.hash?(d._bind(),f.postMessage(JSON.stringify(c),a.origin||"*")):(d.hash._bind(),d.hash.send(a,c))}else console.warn("postmessage type required");else console.warn("postmessage target window required")},
bind:function(a,b,c,e,g){d._replyBind(a,b,c,e,g)},_replyBind:function(f,c,e,m,g){"postMessage"in a&&!m?d._bind():d.hash._bind();m=d.data("listeners.postmessage");m||(m={},d.data("listeners.postmessage",m));var h=m[f];h||(h=[],m[f]=h);h.push({fn:c,callback:g,origin:e||b.pm.origin})},unbind:function(a,b){var f=d.data("listeners.postmessage");if(f)if(a)if(b){var c=f[a];if(c){for(var g=[],h=0,e=c.length;h<e;h++){var l=c[h];l.fn!==b&&g.push(l)}f[a]=g}}else delete f[a];else for(h in f)delete f[h]},data:function(a,
b){return b===c?d._data[a]:d._data[a]=b},_data:{},_CHARS:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),_random:function(){for(var a=[],b=0;32>b;b++)a[b]=d._CHARS[0|32*Math.random()];return a.join("")},_callback:function(a){var b=d.data("callbacks.postmessage");b||(b={},d.data("callbacks.postmessage",b));var c=d._random();b[c]=a;return c},_bind:function(){d.data("listening.postmessage")||(a.addEventListener?a.addEventListener("message",d._dispatch,!1):a.attachEvent&&a.attachEvent("onmessage",
d._dispatch),d.data("listening.postmessage",1))},_dispatch:function(a){try{var b=JSON.parse(a.data)}catch(p){console.warn("postmessage data invalid json: ",p);return}if(b.type){var c=(d.data("callbacks.postmessage")||{})[b.type];if(c)c(b.data);else{c=(d.data("listeners.postmessage")||{})[b.type]||[];for(var e=0,g=c.length;e<g;e++){var h=function(g){b.callback&&d.send({target:a.source,data:g,type:b.callback})},f=c[e];if(f.origin&&"*"!==f.origin&&a.origin!==f.origin)console.warn("postmessage message origin mismatch",
a.origin,f.origin),b.errback&&d.send({target:a.source,data:{message:"postmessage origin mismatch",origin:[a.origin,f.origin]},type:b.errback});else try{f.callback?f.fn(b.data,h,a):h(f.fn(b.data,a))}catch(p){if(b.errback)d.send({target:a.source,data:p,type:b.errback});else throw p;}}}}else console.warn("postmessage message type required")},hash:{send:function(b,c){var e=b.target;if(b=b.url){b=d.hash._url(b);var f=d.hash._url(a.location.href);if(a==e.parent)var g="parent";else try{for(var h=0,w=parent.frames.length;h<
w;h++)if(parent.frames[h]==a){g=h;break}}catch(p){g=a.name}null==g?console.warn("postmessage windows must be direct parent/child windows and the child must be available through the parent window.frames list"):(c={"x-requested-with":"postmessage",source:{name:g,url:f},postmessage:c},g="#x-postmessage-id="+d._random(),e.location=b+g+encodeURIComponent(JSON.stringify(c)))}else console.warn("postmessage target window url is required")},_regex:/^#x\-postmessage\-id=(\w{32})/,_regex_len:50,_bind:function(){d.data("polling.postmessage")||
(setInterval(function(){var b=""+a.location.hash,c=d.hash._regex.exec(b);c&&(c=c[1],d.hash._last!==c&&(d.hash._last=c,d.hash._dispatch(b.substring(d.hash._regex_len))))},b.pm.poll||200),d.data("polling.postmessage",1))},_dispatch:function(b){if(b){try{if(b=JSON.parse(decodeURIComponent(b)),!("postmessage"===b["x-requested-with"]&&b.source&&null!=b.source.name&&b.source.url&&b.postmessage))return}catch(r){return}var c=b.postmessage,e=(d.data("callbacks.postmessage")||{})[c.type];if(e)e(c.data);else{var f=
"parent"===b.source.name?a.parent:a.frames[b.source.name];e=(d.data("listeners.postmessage")||{})[c.type]||[];for(var g=0,h=e.length;g<h;g++){var w=function(a){c.callback&&d.send({target:f,data:a,type:c.callback,hash:!0,url:b.source.url})},p=e[g];if(p.origin){var z=/https?:\/\/[^\/]*/.exec(b.source.url)[0];if("*"!==p.origin&&z!==p.origin){console.warn("postmessage message origin mismatch",z,p.origin);c.errback&&d.send({target:f,data:{message:"postmessage origin mismatch",origin:[z,p.origin]},type:c.errback,
hash:!0,url:b.source.url});continue}}try{p.callback?p.fn(c.data,w):w(p.fn(c.data))}catch(r){if(c.errback)d.send({target:f,data:r,type:c.errback,hash:!0,url:b.source.url});else throw r;}}}}},_url:function(a){return(""+a).replace(/#.*$/,"")}}};b.extend(d,{defaults:{target:null,url:null,type:null,data:null,success:null,error:null,origin:"*",hash:!1}})})(this,"undefined"===typeof jQuery?NO_JQUERY:jQuery);"JSON"in window&&window.JSON||(JSON={});
(function(){function a(a){return 10>a?"0"+a:a}function b(a){d.lastIndex=0;return d.test(a)?'"'+a.replace(d,function(a){var b=n[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function c(a,e){var g=f,d=e[a];d&&"object"===typeof d&&"function"===typeof d.toJSON&&(d=d.toJSON(a));"function"===typeof m&&(d=m.call(e,a,d));switch(typeof d){case "string":return b(d);case "number":return isFinite(d)?String(d):"null";case "boolean":case "null":return String(d);
case "object":if(!d)return"null";f+=l;var h=[];if("[object Array]"===Object.prototype.toString.apply(d)){var r=d.length;for(a=0;a<r;a+=1)h[a]=c(a,d)||"null";e=0===h.length?"[]":f?"[\n"+f+h.join(",\n"+f)+"\n"+g+"]":"["+h.join(",")+"]";f=g;return e}if(m&&"object"===typeof m)for(r=m.length,a=0;a<r;a+=1){var t=m[a];"string"===typeof t&&(e=c(t,d))&&h.push(b(t)+(f?": ":":")+e)}else for(t in d)Object.hasOwnProperty.call(d,t)&&(e=c(t,d))&&h.push(b(t)+(f?": ":":")+e);e=0===h.length?"{}":f?"{\n"+f+h.join(",\n"+
f)+"\n"+g+"}":"{"+h.join(",")+"}";f=g;return e}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(b){return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z"},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
d=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,l,n={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},m;"function"!==typeof JSON.stringify&&(JSON.stringify=function(a,b,d){var g;l=f="";if("number"===typeof d)for(g=0;g<d;g+=1)l+=" ";else"string"===typeof d&&(l=d);if((m=b)&&"function"!==typeof b&&("object"!==typeof b||"number"!==typeof b.length))throw Error("JSON.stringify");return c("",{"":a})});
"function"!==typeof JSON.parse&&(JSON.parse=function(a,b){function c(a,d){var g,e=a[d];if(e&&"object"===typeof e)for(g in e)if(Object.hasOwnProperty.call(e,g)){var h=c(e,g);void 0!==h?e[g]=h:delete e[g]}return b.call(a,d,e)}e.lastIndex=0;e.test(a)&&(a=a.replace(e,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,
"")))return a=eval("("+a+")"),"function"===typeof b?c({"":a},""):a;throw new SyntaxError("JSON.parse");})})();(function(a){a.wa_blog.editor={options:{blogs:{},content_id:"post_text",current_blog_id:null,dateMonthCount:2,dateShowWeek:!1,cut_link_label_default:"",version:"1.0"},transliterated:!1,blog_statuses:{"private":"private","public":"public"},init:function(b){function c(b){a(this).show();a(this).parent().find(".datetime").hide();b&&a("#current-time").text(b);a("#current-time").show()}function e(a){var b=a.siblings(".hint:first");0>=b.length&&(b=a.parent().siblings(".hint:first"));return b}function d(a){a.parent().find("input[type=text]").removeClass("error");
e(a).removeClass("errormsg")}function f(a){a.parent().find("input[type=text]").addClass("error");e(a).addClass("errormsg")}function l(){return a.datepicker._defaults.dateFormat.toUpperCase().replace("YY","YYYY")}var n=this;n.options=a.extend(n.options,b);n.postUrlWidget=function(){function b(b,c,d,e){var g=null,h={post_title:d,post_id:c,blog_id:b},f=[b,c].join("&");!m[f]||!l&&d?(l&&(h.slug=l),a.ajax({url:"?module=post&action=getPostUrl",data:h,dataType:"json",type:"post",async:!1,success:function(b){g=
b.data;m[f]=g;a.wa_blog.editor.transliterated=!0;e(g)}})):e(m[f])}function c(b){var c=b.link+b.slug+"/";a("#url-link").text(c);a("#url-link").attr("href",b.preview_hash?c+"?preview="+b.preview_hash:c);a("#pure-url").text(b.link);a("#preview-url").data("preview-url",b.preview_link);b.slug&&!l?(a("#post-url").val(b.slug),l=b.slug):a("#post-url").val(l);var d=b.is_adding?"small":b.is_published?"small":"hint",e=a("#post-url-field span:first").contents().filter(function(){return 3==this.nodeType}).get(0).nodeValue;
if(b.other_links&&b.other_links instanceof Array){c=[];for(k in b.other_links)c.push({previewText:e,className:d,slug:l,link:b.other_links[k],preview_link:b.other_preview_links[k],href:b.preview_hash?b.other_links[k]+l+"/?preview="+b.preview_hash:b.other_links[k]+l+"/"});b=b.is_adding?'<span class="${className}">${previewText}${link}<span class="slug">{{if slug}}${slug}/{{/if}}</span></span><br>':'<span class="${className}">${previewText}<a target="_blank" href="${href}" data-preview-url="${preview_link}">${link}<span class="slug">{{if slug}}${slug}/{{/if}}</span></a></span><br>';
d=a("#post-url-field").children(":first");d.is(".icon10")&&(b='<i class="'+d.attr("class")+'"></i> '+b);a("#other-urls").html(a.tmpl(b,c))}}function d(b){b=b||"hidden";"empty"==b?a("#post-url-field-no-settlements").show("fast"):a("#post-url-field-no-settlements").hide("fast");l=null;a("#post-url").val("");a("#post-url-field").hide("fast").trigger(a.Event("change",{status:b}))}function e(b,c){b&&(l=b);a(".slug").each(function(){if(l){var b=a(this).text(l+"/").parents("a:first");b.attr("href",b.text()+
(c?"?preview="+c:""))}else a(this).text("")})}function f(){a("#url-editable").hide();a("#url-edit").show();a("#post-url").focus()}var l=null,m={},n=function(){},q={};(function(){var g=n=function(){if(a("#post-url-field").length){var e=a("#post-title").val(),g=a("input[name=blog_id]").val();if(q[g]&&q[g].no_frontend)e?d("empty"):d("hidden_empty");else{e||d("hidden");var h=a("input[name=post_id]").val();b(g,h,e,function(b){b&&(q[g]||(q[g]={id:g,no_frontend:b.is_private_blog||!b.link}),q[g].no_frontend?
e?d("empty"):d("hidden_empty"):e?(a("#post-url-field-no-settlements").hide("fast"),b&&c(b),a("#post-url-field").show("fast").trigger(a.Event("change",{status:"visible"}))):(c(b),d("hidden")))})}}else d("empty")};a("#post-title").blur(g);a("#post-form").find("input[name=post_id]").val()&&g();a("#url-edit-link").click(f);a("#post-url").keyup(function(a){9!=a.keyCode&&this.value!=l&&e(this.value)})})();return{setEditReady:f,resetEditReady:function(){a("#url-editable").show();a("#url-edit").hide()},updateSlugs:e,
changeBlog:n}}();n.inlineSaveController=function(b){function c(){!1!==m()&&d(n)}function d(b){var c=a.wa_blog.editor.wysiwygToHtml(a("#post_text","#post-form").val());a("#post_text","#post-form").val(c);c=a("#post-form").serialize()+"&"+g+"=1";c+=l?"&inline=1":"";c+=a.wa_blog.editor.transliterated?"":"&transliterate=1";b=b||function(){};e("loading");a.ajax({url:"?module=post&action=save",data:c,dataType:"json",type:"post",success:function(c){if("fail"==c.status){c.errors.datetime||a.wa_blog.editor.closeCurrentDialog();
var d=c.errors;if(d.url){a("#post-url-field").show();var h=a("#post-url"),m=d.url,p="#message-"+h.attr("id");h.addClass("error");a(p).addClass("errormsg").text(m)}d.datetime&&(d=a(".datepicker:not(:disabled)"),d.length&&f(d));c.errors.datetime||"deadline"!=g||((c=a("#deadline-dialog .datepicker").val())?a("#publication-deadline-changable-part").html(a.tmpl("publication-deadline-setted",{date:c})):a("#publication-deadline-changable-part").html(a.tmpl("publication-deadline-setted")),a("#b-post-save-draft-button").attr("name",
"deadline"))}else c.data.redirect?location.href=c.data.redirect:(b(c.data),c.data.id&&a("#post-id").val(c.data.id),e("saved"));l=!1;e("")},error:function(a,b,c){}})}function e(b,c){b?(a("#form-status span").hide(),a("#form-status #"+b+"-status").show(),a("#form-status").show()):a("#form-status").fadeOut(c&&"function"==typeof c?c:function(){})}b=b||{};var g="",l=!1,m=b.beforeSave||function(){},n=b.afterSave||function(){};(function(){a("input[type=submit], input[type=button], a.js-submit").click(function(){if(a(this).hasClass("dialog-edit"))return!1;
if(a(this).hasClass("js-submit")){var b=a(this).attr("title")||a(this).text()||"Are you sure?";if(!confirm(b))return!1}!a("#post-id").val()||"b-post-save-button"!=this.id&&"b-post-save-draft-button"!=this.id&&"b-post-save-custom-params"!=this.id||(l=!0);g=this.name;"deadline"!=g&&"schedule"!=g||a("#"+this.name+"-dialog").find("input[name^=datetime]").attr("disabled",!1);c();return!1});a("#post-url").focus(function(){})})();return{save:c,setAction:function(a){g=a},getAction:function(){return g}}}({beforeSave:function(){var b=
a(".datepicker:not(:disabled)"),c=!0;if(0<b.length){var d=b.parent(".datetime").find(".time");if(0<d.length){var e;if(e=d.get(0))e=d.eq(0).val(),e=!(0<=e&&24>=e);e&&(c=!1);if(e=d.get(1))d=d.eq(1).val(),e=!(0<=d&&60>=d);e&&(c=!1)}c||f(b)}if(!c)return!1;a.wa_blog.editor.onSubmit()},afterSave:function(b){a("#b-post-save-button").removeClass("yellow").addClass("green");a("#postpublish-edit").removeClass("yellow").addClass("green");n.postUrlWidget.resetEditReady();n.postUrlWidget.updateSlugs(b.url,b.preview_hash||
!1);c.call(a("#inline-edit-datetime").get(0),b.formatted_datetime);"draft"==n.inlineSaveController.getAction()&&a("#post-url-field .small").removeClass("small").addClass("hint");b=a("#b-post-edit-custom-params-dialog");if(!b.is(":hidden")){var d=b.find(":input[name=meta_title]").val(),e=b.find(":input[name=meta_keywords]").val(),g=b.find(":input[name=meta_description]").val(),f=b.find(":input[name=params]").val();d?a("#b-post-edit-meta-title").show().find(".val").text(d):a("#b-post-edit-meta-title").hide();
e?a("#b-post-edit-meta-keywords").show().find(".val").text(e):a("#b-post-edit-meta-keywords").hide();g?a("#b-post-edit-meta-description").show().find(".val").text(g):a("#b-post-edit-meta-description").hide();f?a("#b-post-edit-custom-params").show().html(f.trim().split("\n").join("<br>")+"<br>"):a("#b-post-edit-custom-params").hide();d||e||g||f?a("#b-post-edit-no-meta").hide():a("#b-post-edit-no-meta").show();b.trigger("close")}}});(function(){function b(){var b="#"+this.id+"-on-label",c="#"+this.id+
"-off-label";this.checked?(a(b).removeClass("b-unselected"),a(c).addClass("b-unselected")):(a(b).addClass("b-unselected"),a(c).removeClass("b-unselected"))}var c=a("#allow-comment-switcher");b.call(c.get(0));c.iButton({labelOn:"",labelOff:"",className:"mini"}).change(b)})();(function(b){b={changeMonth:!0,changeYear:!0,shortYearCutoff:2,showOtherMonths:2>b.dateMonthCount,selectOtherMonths:2>b.dateMonthCount,stepMonths:b.dateMonthCount,numberOfMonths:b.dateMonthCount,showWeek:b.dateShowWeek,gotoCurrent:!0,
constrainInput:!1,beforeShow:function(){setTimeout(function(){10>a("#ui-datepicker-div").css("z-index")&&a("#ui-datepicker-div").css("z-index",10)},0)}};a(".datepicker").datepicker(b).filter("input[name^=schedule_datetime]").datepicker("option","minDate",new Date);a("#ui-datepicker-div").hide();a(".datepicker").focus(function(){d(a(this))})})(n.options);(function(){function b(){var b=a(this).attr("id").replace(/-.*$/,"");a.wa_blog.editor.currentDialog=a("#"+b+"-dialog").waDialog({disableButtonsOnSubmit:!0,
onLoad:function(){a(this).find("input,select").removeAttr("disabled");a(".user-date-format").text(l())},onSubmit:function(){return!1},onCancel:function(b){a(this).find("input:text,select").each(function(b){a(this).value=a(this).defaultValue;a(this).attr("disabled","disabled")})}});return!1}a(".dialog-edit").each(function(){a(this).click(function(a){a.preventDefault();return b.call(a.target)})})})();b=null;try{b=a.storage.get("blog/editor")||"redactor"}catch(g){this.log("Exception: "+g.message+"\nline: "+
g.fileName+":"+g.lineNumber)}if(!b||!this.editors[b])for(b in this.editors)break;if(!this.selectEditor(b,!0))for(b in this.editors)if(this.selectEditor(b,!0))break;a("#post-form").find("input[name=post_id]").val()||a("#post-title").focus();a.wa.dropdownsCloseEnable();a(".change-blog").click(a.wa_blog.editor.changeBlogHandler);a('#postpublish-dialog input[name="publish_blog_id"]').change(a.wa_blog.editor.changePublishBlogHandler);a("#post-title").keyup(function(){var b=a(this),c=b.next(".maxlength"),
d=parseInt(b.attr("maxlength"));d&&b.val().length>=d&&!c.length?b.after('<em class="hint maxlength">'+$_("input_maxlength").replace(/%d/,d)+"</em>"):(!d||b.val().length<d)&&c.length&&c.remove()});a("#inline-edit-datetime").click(function(){a(this).hide();a(this).parent().find(".datetime").show();a("#current-time").hide();a(".user-date-format").text(l())});a(".b-post-editor-toggle li a").click(this.editorTooggle);a(document).keydown(function(a){if(a.ctrlKey&&83==a.keyCode)n.onSaveHotkey(a)});a(".time").focus(function(){d(a(this).parent().find(".datepicker"))});
a("#post-form").submit(function(){return!1});a("#b-post-edit-custom-params-link").click(function(){a("#b-post-edit-custom-params-dialog").waDialog({onSubmit:function(){return!1}});return!1});var m=a(window);a("#buttons-bar").sticky&&a("#buttons-bar").sticky({fixed_class:"b-fixed-button-bar",isStaticVisible:function(a,b){return m.scrollTop()+m.height()>=a.element.offset().top+a.element.outerHeight()}});(function(){function b(b){a.pm({target:n[0].contentWindow,type:"update_title",data:b})}function c(){var a=
e();a&&a!=n.attr("src")&&(n.attr("src",a),n.one("load",function(){}))}function d(a){return a.data("preview-url")||""}function e(){var b=null;a("#post-url-field a").each(function(){var c=d(a(this));if(c&&"javascript:"!=c.substr(0,11)){if(n.attr("src")==c)return b=null,!1;b=c}});b||(b=n.attr("src"),"about:blank"==b&&(b=null));b&&(b+=0<=b.indexOf("?")?"&":"?",b+="parent_url="+encodeURIComponent(location.origin));return b}function f(){!a("#post-url-field-no-settlements").is(":visible")&&e()?(n.show(),
x.hide(),u=!0,c()):(n.hide(),x.show(),u=!1);E.val("1");v=!0;var b=a.storage.get("blog/editor/preview_sidebar_width")||600,d=a(".sidebar").hide().first().width()-0;m.closest(".content").animate({marginLeft:0},400);y.css({"min-width":0,right:d+16+"px"}).animate({left:"15px",right:b-0+15+"px"},400);m.find(".content").animate({marginRight:b+"px"},400);q.css("width",0).show().animate({width:b+"px"},400);D.slideUp(400);setTimeout(function(){v=!1;a(window).resize().scroll()},410)}function l(){E.val("");
var b=a(".sidebar"),c=b.first().width()-0;v=!0;var d=m.closest(".content").animate({marginLeft:c+"px"},400),e=m.find(".content").animate({marginRight:c+"px"},400);q.hide();D.slideDown(400);y.animate({left:c+15+"px",right:c+16+"px"},400);setTimeout(function(){b.show();q.hide();v=!1;d.css("marginLeft","");e.css("marginRight","");y.css({left:"",right:""});a(window).resize().scroll()},410)}var m=a("#post-form"),n=a("#realtime-preview-iframe"),q=n.closest(".sidebar"),v=!1,C=a("<textarea>").hide().appendTo(q),
A=a("#post-title"),x=a("#not-available-message"),D=a("#wa-header"),y=a(".b-fixed-button-bar"),F=a('#blog-photo_bridge-editor [name="album_id"]'),E=q.find('[name="realtime_on"]'),u=!1,B=!1;n.one("load",function(){B=!0});a.pm.bind("updater_loaded",function(a){B=!0});a.widget("ui.blog_draghandler",a.ui.mouse,{_init:function(){this._mouseInit();this.$content=m.find(".content")},_mouseStart:function(b){this.xStart=b.pageX;this.sidebar_width=q.width();this.window_width=a(window).width();u&&n.hide()},_mouseDrag:function(b){this.sidebar_width+=
this.xStart-b.pageX;this.xStart=b.pageX;320>this.sidebar_width?this.sidebar_width=320:380>this.window_width-this.sidebar_width&&(this.sidebar_width=this.window_width-380);q.width(this.sidebar_width);this.$content.css({marginRight:this.sidebar_width+"px"});y.css("right",this.sidebar_width+16+"px");a(window).resize()},_mouseStop:function(){u&&n.show();a.storage.set("blog/editor/preview_sidebar_width",this.sidebar_width)}});q.find(".column-resize-handler:first").blog_draghandler();a("#realtime-preview-toggle").click(function(){v||
(m.hasClass("realtime-edit-mode")?(m.removeClass("realtime-edit-mode"),a(this).removeClass("b-close-live-editor"),l()):(m.addClass("realtime-edit-mode"),a(this).addClass("b-close-live-editor"),f()))});A.keyup(function(){b(A.val())});setInterval(function(){if(B&&m.hasClass("realtime-edit-mode")){var c;(c=a("#post-form .b-post-editor-toggle li.selected a").attr("id"))&&a.wa_blog.editor.editors[c]&&a.wa_blog.editor.editors[c].update(C);b(A.val());c=C.val();F.val()&&(c=c+'<p class="attached-album-description"><em>'+
$_("Photos from the attached album will be displayed here."),c+="</em></p>");a.pm({target:n[0].contentWindow,type:"update_text",data:c})}},500);a("#post-url-field").on("click","a",function(){if(m.hasClass("realtime-edit-mode")){var b=d(a(this));b!=n.attr("src")&&(n.attr("src",b),n.one("load",function(){}));return!1}});a("#post-url-field").change(function(a){m.hasClass("realtime-edit-mode")&&("empty"!=a.status&&"hidden_empty"!=a.status?(n.show(),x.hide(),u=!0,c()):(n.hide(),x.show(),u=!1))});a(window).resize(function(){n.height(a(window).height()-
30);n.width(q.width()-10)})})()},cloneTextarea:function(b,c,e){var d="editor_container_"+e;a(c).append(b.clone(!0).attr({id:d,name:"text_"+e,disabled:!0}));b.hide();return d},cut_hr:'<span class="b-elrte-wa-split-vertical elrte-wa_post_cut">%text%</span>',cut_str:"\x3c!-- more %text%--\x3e",htmlToWysiwyg:function(b){return b.replace(/\x3c!--[\s]*?more[\s]*?(text[\s]*?=[\s]*?['"]([\s\S]*?)['"])*[\s]*?--\x3e/g,function(b,e,d){return d?a.wa_blog.editor.cut_hr.replace("%text%",d):a.wa_blog.editor.cut_hr.replace("%text%",
a.wa_blog.editor.options.cut_link_label_default)})},wysiwygToHtml:function(b){var c=a("<p></p>").html(b),e=c.find(".elrte-wa_post_cut");return e.length?((b=e.html())&&"<br>"!==b&&b!==a.wa_blog.editor.options.cut_link_label_default?e.replaceWith(a.wa_blog.editor.cut_str.replace("%text%",'text="'+b+'" ')):e.replaceWith(a.wa_blog.editor.cut_str.replace("%text%","")),c.html().replace("<span></span>","")):b},editors:{ace:{editor:null,container:null,inited:!1,init:function(b){if(!this.inited){this.inited=
!0;this.container=a('<div id="blog-ace-editor"></div>').appendTo("#post_text_wrapper");this.container.wrap('<div class="ace"></div>');this.editor=ace.edit("blog-ace-editor");ace.config.set("basePath",wa_url+"wa-content/js/ace/");this.editor.setTheme("ace/theme/eclipse");var c=this.editor.getSession();c.setMode("ace/mode/javascript");c.setMode("ace/mode/css");c.setMode("ace/mode/html");c.setMode("ace/mode/smarty");c.setUseWrapMode(!0);this.editor.$blockScrolling=Infinity;this.editor.renderer.setShowGutter(!1);
this.editor.setShowPrintMargin(!1);this.editor.setFontSize(13);a(".ace_editor").css("fontFamily","");c.setValue(b.hide().val());this.editor.moveCursorTo(0,0);-1!=navigator.appVersion.indexOf("Mac")?this.editor.setFontSize(13):-1!=navigator.appVersion.indexOf("Linux")?this.editor.setFontSize(16):this.editor.setFontSize(14);this.editor.commands.addCommand({name:"unfind",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:function(a,b){return!1},readOnly:!0});var e=a("#post-form .sidebar .b-edit-options:first").height(),
d=function(b,c){var d=b.getSession().getScreenLength()*b.renderer.lineHeight+b.renderer.scrollBar.getWidth();d*=1.02;var f=e-163;d<f&&(d=f);a("#"+c).height(d.toString()+"px");b.resize()},f=this,l=a(window);c.on("change",function(){d(f.editor,"blog-ace-editor");l.scroll()});setTimeout(function(){d(f.editor,"blog-ace-editor")},50);l.resize(function(){f.editor.resize();d(f.editor,"blog-ace-editor")});this.container.on("keydown",a.wa_blog.editor.editorKeyCallback());this.container.on("keypress",a.wa_blog.editor.editorKeyCallback(!0))}return!0},
show:function(b){this.container.show();this.container.parent().show();if(this.editor){b=b.val();b=a.wa_blog.editor.wysiwygToHtml(b);var c=this.editor.getCursorPosition();this.editor.setValue(b);a("#post-title").is(":focus")||this.editor.focus();this.editor.navigateTo(c.row,c.column)}else"object"==typeof console&&console.log("wait for ace editor init"),this.show(b)},hide:function(){this.container.hide();this.container.parent().hide()},update:function(a){this.inited&&a.val(this.editor.getValue())},
correctEditorHeight:function(b){return Math.max(b,a.wa_blog.editor.getMinEditorHeight())+a.wa_blog.editor.getExtHeightShift()}},redactor:{options:{},inited:!1,callback:!1,editor:null,init:function(b){if(!this.inited){var c=a(window),e=a("#b-post-save-button"),d=a("#postpublish-edit");a("#post-form .sidebar .b-edit-options:first").height();var f=a.extend({focus:!0,deniedTags:!1,minHeight:300,linkify:!1,source:!1,paragraphy:!1,replaceDivs:!1,toolbarFixed:!0,replaceTags:{b:"strong",i:"em",strike:"del"},
removeNewlines:!1,removeComments:!1,imagePosition:!0,imageResizable:!0,imageFloatMargin:"1.5em",buttons:"format bold italic underline deleted lists image video file table link alignment fontcolor fontsize fontfamily".split(" "),plugins:"fontcolor fontfamily alignment fontsize table video cut".split(" "),lang:wa_lang,imageUpload:"?action=upload&r=2&absolute=1",imageUploadFields:b.data("uploadFields"),callbacks:{change:function(){d.is(":visible")&&d.removeClass("green").addClass("yellow");e.is(":visible")&&
e.removeClass("green").addClass("yellow");c.scroll()}}},f||{});f.callbacks=a.extend({imageUploadError:function(a){console.log("imageUploadError",a);alert(a.error)},syncClean:function(a){return a.replace(/\{[a-z\$'"_\(!+\-][^\}]*\}/gi,function(a){return a.replace(/-&gt;/g,"->")})},syncBefore:function(a){return a=a.replace(/{[a-z$][^}]*}/gi,function(a,b,c){var d=c.indexOf("\x3c/script",b+a.length);b=c.indexOf("<script",b+a.length);if(-1==d||-1!=b&&b<d)a=a.replace(/&gt;/g,">"),a=a.replace(/&lt;/g,"<"),
a=a.replace(/&amp;/g,"&"),a=a.replace(/&quot;/g,'"');return a})}},f.callbacks||{});a.wa_blog_options.photos_bridge_available&&(f.callbacks.modalOpened=function(b,c){if("image"==b){var d=this;this.modal.width=1100;b=this.modal.getModal();var e=a('<div id="photos-image-selector-wrapper">'),f=a('<div class="redactor-modal-tab redactor-tab1" data-title="'+$_("Select from Photos app")+'">').hide().append(e).append('<div class="clear-both">'),l=f.find(".total-photos-selected");b.append(f);this.modal.buildTabber();
(function(){function b(){e.find("input:checkbox").each(function(){g[this.value]&&a(this).prop("checked",!0).change()});a(window).resize()}var c=0,g={},h=a('<button id="redactor-modal-button-action" style="margin-top: 16px;">'+d.lang.get("insert")+"</button>").hide();f.append(h);var m=a('<button id="redactor-modal-button-cancel" style="margin-top: 16px;">'+d.lang.get("cancel")+"</button>").hide();f.append(m);a('#redactor-modal-tabber a[rel="1"]').on("click",function(){h.is(":visible")||(h.show(),m.show(),
e.html('<div class="block"><i class="icon16 loading"></i></div>'),a.post("../photos/?module=photo&action=embedSelector",{app_id:"blog"},function(a){e.html(a);b()}))});m.off("click").on("click",function(){d.modal.close()});h.on("click",function(){if(0<c){var b=[];a.each(g,function(a,c){b.push('<figure><img src="'+c+'"></figure>')});d.insert.html(b.join("\n"))}d.modal.close()});a('#redactor-modal-tabber a[rel="0"]').on("click",function(){h.hide();m.hide()});e.on("change","input:checkbox",function(){var b=
a(this),d=b.val();this.checked?g[d]||(g[d]=b.data("photoUrl"),c++):g[d]&&(delete g[d],c--);0<c?l.text(c).closest(".hidden").show():l.text(c).closest(".hidden").hide()});e.on("reloaded",function(a){b()})})()}});b.redactor(f);b.redactor("core.box").css("z-index",0);b.redactor("core.toolbar").css("z-index",1);this.editor=b.data("redactor");this.inited=!0}return!0},show:function(b){var c=a.wa_blog.editor.htmlToWysiwyg(b.val());b.val(c);a(".redactor-box").show();b.redactor("core.editor").find('img[src*="$wa_url"]').each(function(){var b=
decodeURIComponent(a(this).attr("src"));a(this).attr("data-src",b);a(this).attr("src",b.replace(/\{\$wa_url\}/,wa_url))});this.editor.code.set(b.val());this.editor.observe.load();this.editor.focus.start()},hide:function(b){a(".redactor-box").hide()},update:function(b){if(this.inited){var c=this.editor.code.get();c=this.editor.clean.onSync(this.editor.clean.onSet(c));c=a.wa_blog.editor.wysiwygToHtml(c);b.val(c)}}},photo_bridge:{container:null,inited:!1,init:function(b){if(!this.inited){this.inited=
!0;b.hide();this.container=a("#blog-photo_bridge-editor");if(!this.container.length)return;var c=a("#album-frontend-link"),e=this.container.find('select[name="album_id"]'),d=this.container.find(".hidden.field"),f=0;e.change(function(){if(e.val()){var b=e.children(":selected").data("frontend-link");b?(d.slideDown(f),c.text(b)):(d.slideUp(f),d.find('[name="album_link_type"]:checkbox').prop("checked",!1));a("#post-editor .show-when-album-selected").show()}else d.slideUp(f),a("#post-editor .show-when-album-selected").hide()}).change();
f=300;b=a("#post-form .sidebar .b-edit-options:first").height();this.container.css("min-height",b-100)}return!0},show:function(a){this.container.show()},hide:function(){this.container.hide()},update:function(a){}}},getMinEditorHeight:function(){return 200},getExtHeightShift:function(){return-70},editorTooggle:function(){var b=a(this);!b.hasClass("selected")&&a.wa_blog.editor.selectEditor(b.attr("id"))&&(a(".b-post-editor-toggle li.selected").removeClass("selected"),b.parent().addClass("selected"));
return!1},selectEditor:function(b,c){if(this.editors[b]){var e=a("#"+this.options.content_id);if(e.length){try{if(this.editors[b].init(e)){var d=null;if(!c)try{a.storage.set("blog/editor",b)}catch(l){this.log("Exception: "+l.message+"\nline: "+l.fileName+":"+l.lineNumber)}var f=a(".b-post-editor-toggle li.selected a");f.length&&(f.parent().removeClass("selected"),d=f.attr("id"))&&(this.editors[d].update(e),this.editors[d].hide());a("#"+b).parent().addClass("selected");this.editors[b].show(e);setTimeout(function(){a(window).scroll()},
0)}}catch(l){return this.log("Exception: "+l.message+"\nline: "+l.fileName+":"+l.lineNumber,l.stack),!1}return!0}this.log('Text container for "'+b+'" not found');return!1}this.log('Blog editor "'+b+'" not found');return!1},editor_key:!1,editorKeyCallback:function(b){var c=this;return b?function(b){if(b.ctrlKey&&115==b.which&&!a.wa_blog.editor.editor_key)c.onSaveHotkey(b)}:function(b){a.wa_blog.editor.editor_key=!1;b.ctrlKey&&83==b.which&&(a.wa_blog.editor.editor_key=!0,c.onSaveHotkey(b));b.metaKey||
!((33>b.which||40<b.which)&&(27<b.which||8==b.which||13==b.which)&&(112>b.which||124<b.which))||b.ctrlKey&&67==b.which||(a("#b-post-save-button").removeClass("green").addClass("yellow"),a("#postpublish-edit").removeClass("green").addClass("yellow"))}},onSubmit:function(){var b=a.wa_blog;for(c in b)if("editor"!=c&&b[c].onSubmit&&"function"==typeof b[c].onSubmit)try{b[c].onSubmit()}catch(d){"object"==typeof console&&console.log(d)}b=a("#"+this.options.content_id);if(b.length){var c=null;var e=a(".b-post-editor-toggle li.selected a");
e.length&&(c=e.attr("id"))&&this.editors[c].update(b)}b=a("#b-post-save-button");"draft"!=b.attr("name")&&"deadline"!=b.attr("name")&&(b.removeClass("yellow").addClass("green"),a("#postpublish-edit").removeClass("yellow").addClass("green"))},onSaveHotkey:function(b){b.preventDefault();b=a("#b-post-save-draft-button");var c=a("#b-post-save-button");b.length?b.click():c.length&&c.click()},currentDialog:null,closeCurrentDialog:function(){this.currentDialog&&this.currentDialog.waDialog().trigger("close")},
registerEditor:function(a,c){if(this.editors[a])return this.log('Editor "'+a+'" already registered'),!1;this.editors[a]=c;return!0},log:function(a,c){"object"==typeof console&&(console.log(a),c&&console.log(c))},changeBlogHandler:function(){var b=parseInt(a(this).attr("href").replace(/^.*#/,""));a.wa_blog.editor.selectCurrentBlog(b)&&(a(".dialog :input:checked").attr("checked",!1),a(".dialog #b-post-publish-blog-"+b).attr("checked",!0));a.wa.dropdownsClose();return!1},changePublishBlogHandler:function(){if(a(this).attr("checked")){var b=
parseInt(a(this).val());a.wa_blog.editor.selectCurrentBlog(b)}},selectCurrentBlog:function(b){var c=a.wa_blog.editor.options.blogs[b],e=a.wa_blog.editor.options.current_blog_id;if(c&&e!=b){var d=a.tmpl("selected-blog",{blog:c});a(".current-blog").replaceWith(d);a("#blog-selector-"+e).removeClass("selected");d=a("#blog-selector-"+b).addClass("selected");e=a.wa_blog.editor.options.blogs[e];a.wa_blog.editor.options.current_blog_id=parseInt(b);b=a(".b-post");e&&b.removeClass(e.color);b.addClass(c.color);
a.wa_blog.editor.postUrlWidget.changeBlog(d.attr("data-blog-status"));return!0}}}})(jQuery);
//# sourceMappingURL=blog-post-edit.min.js.map