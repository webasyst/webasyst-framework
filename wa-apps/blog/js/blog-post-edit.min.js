var NO_JQUERY={};
(function(a,b,e){if(!("console"in a)){var c=a.console={};c.log=c.warn=c.error=c.debug=function(){}}b===NO_JQUERY&&(b={fn:{},extend:function(){for(var a=arguments[0],b=1,d=arguments.length;b<d;b++){var c=arguments[b],f;for(f in c)a[f]=c[f]}return a}});b.fn.pm=function(){console.log("usage: \nto send: $.pm(options)\nto receive: $.pm.bind(type, fn, [origin])");return this};b.pm=a.pm=function(a){d.send(a)};b.pm.bind=a.pm.bind=function(a,b,c,e,f){d.bind(a,b,c,e,!0===f)};b.pm.unbind=a.pm.unbind=function(a,
b){d.unbind(a,b)};b.pm.origin=a.pm.origin=null;b.pm.poll=a.pm.poll=200;var d={send:function(a){var a=b.extend({},d.defaults,a),c=a.target;if(a.target)if(a.type){var j={data:a.data,type:a.type};a.success&&(j.callback=d._callback(a.success));a.error&&(j.errback=d._callback(a.error));"postMessage"in c&&!a.hash?(d._bind(),c.postMessage(JSON.stringify(j),a.origin||"*")):(d.hash._bind(),d.hash.send(a,j))}else console.warn("postmessage type required");else console.warn("postmessage target window required")},
bind:function(a,b,c,e,f){d._replyBind(a,b,c,e,f)},_replyBind:function(g,c,e,h,f){"postMessage"in a&&!h?d._bind():d.hash._bind();h=d.data("listeners.postmessage");h||(h={},d.data("listeners.postmessage",h));var n=h[g];n||(n=[],h[g]=n);n.push({fn:c,callback:f,origin:e||b.pm.origin})},unbind:function(a,b){var c=d.data("listeners.postmessage");if(c)if(a)if(b){var e=c[a];if(e){for(var f=[],n=0,l=e.length;n<l;n++){var i=e[n];i.fn!==b&&f.push(i)}c[a]=f}}else delete c[a];else for(n in c)delete c[n]},data:function(a,
b){return b===e?d._data[a]:d._data[a]=b},_data:{},_CHARS:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),_random:function(){for(var a=[],b=0;32>b;b++)a[b]=d._CHARS[0|32*Math.random()];return a.join("")},_callback:function(a){var b=d.data("callbacks.postmessage");b||(b={},d.data("callbacks.postmessage",b));var c=d._random();b[c]=a;return c},_bind:function(){d.data("listening.postmessage")||(a.addEventListener?a.addEventListener("message",d._dispatch,!1):a.attachEvent&&a.attachEvent("onmessage",
d._dispatch),d.data("listening.postmessage",1))},_dispatch:function(a){try{var b=JSON.parse(a.data)}catch(c){console.warn("postmessage data invalid json: ",c);return}if(b.type){var e=(d.data("callbacks.postmessage")||{})[b.type];if(e)e(b.data);else for(var e=(d.data("listeners.postmessage")||{})[b.type]||[],f=0,n=e.length;f<n;f++){var l=e[f];if(l.origin&&"*"!==l.origin&&a.origin!==l.origin)console.warn("postmessage message origin mismatch",a.origin,l.origin),b.errback&&d.send({target:a.source,data:{message:"postmessage origin mismatch",
origin:[a.origin,l.origin]},type:b.errback});else{var i=function(c){b.callback&&d.send({target:a.source,data:c,type:b.callback})};try{l.callback?l.fn(b.data,i,a):i(l.fn(b.data,a))}catch(s){if(b.errback)d.send({target:a.source,data:s,type:b.errback});else throw s;}}}}else console.warn("postmessage message type required")},hash:{send:function(b,c){var e=b.target,h=b.url;if(h){var h=d.hash._url(h),f,n=d.hash._url(a.location.href);if(a==e.parent)f="parent";else try{for(var l=0,i=parent.frames.length;l<
i;l++)if(parent.frames[l]==a){f=l;break}}catch(s){f=a.name}null==f?console.warn("postmessage windows must be direct parent/child windows and the child must be available through the parent window.frames list"):(f={"x-requested-with":"postmessage",source:{name:f,url:n},postmessage:c},n="#x-postmessage-id="+d._random(),e.location=h+n+encodeURIComponent(JSON.stringify(f)))}else console.warn("postmessage target window url is required")},_regex:/^\#x\-postmessage\-id\=(\w{32})/,_regex_len:50,_bind:function(){d.data("polling.postmessage")||
(setInterval(function(){var b=""+a.location.hash,c=d.hash._regex.exec(b);c&&(c=c[1],d.hash._last!==c&&(d.hash._last=c,d.hash._dispatch(b.substring(d.hash._regex_len))))},b.pm.poll||200),d.data("polling.postmessage",1))},_dispatch:function(b){if(b){try{if(b=JSON.parse(decodeURIComponent(b)),!("postmessage"===b["x-requested-with"]&&b.source&&null!=b.source.name&&b.source.url&&b.postmessage))return}catch(c){return}var e=b.postmessage,h=(d.data("callbacks.postmessage")||{})[e.type];if(h)h(e.data);else{var f;
f="parent"===b.source.name?a.parent:a.frames[b.source.name];for(var h=(d.data("listeners.postmessage")||{})[e.type]||[],n=0,l=h.length;n<l;n++){var i=h[n];if(i.origin){var s=/https?\:\/\/[^\/]*/.exec(b.source.url)[0];if("*"!==i.origin&&s!==i.origin){console.warn("postmessage message origin mismatch",s,i.origin);e.errback&&d.send({target:f,data:{message:"postmessage origin mismatch",origin:[s,i.origin]},type:e.errback,hash:!0,url:b.source.url});continue}}s=function(a){e.callback&&d.send({target:f,
data:a,type:e.callback,hash:!0,url:b.source.url})};try{i.callback?i.fn(e.data,s):s(i.fn(e.data))}catch(r){if(e.errback)d.send({target:f,data:r,type:e.errback,hash:!0,url:b.source.url});else throw r;}}}}},_url:function(a){return(""+a).replace(/#.*$/,"")}}};b.extend(d,{defaults:{target:null,url:null,type:null,data:null,success:null,error:null,origin:"*",hash:!1}})})(this,"undefined"===typeof jQuery?NO_JQUERY:jQuery);"JSON"in window&&window.JSON||(JSON={});
(function(){function a(a){return 10>a?"0"+a:a}function b(a){d.lastIndex=0;return d.test(a)?'"'+a.replace(d,function(a){var b=j[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function e(a,c){var d,i,j,r,v=g,p,m=c[a];m&&("object"===typeof m&&"function"===typeof m.toJSON)&&(m=m.toJSON(a));"function"===typeof h&&(m=h.call(c,a,m));switch(typeof m){case "string":return b(m);case "number":return isFinite(m)?String(m):"null";case "boolean":case "null":return String(m);
case "object":if(!m)return"null";g+=o;p=[];if("[object Array]"===Object.prototype.toString.apply(m)){r=m.length;for(d=0;d<r;d+=1)p[d]=e(d,m)||"null";j=0===p.length?"[]":g?"[\n"+g+p.join(",\n"+g)+"\n"+v+"]":"["+p.join(",")+"]";g=v;return j}if(h&&"object"===typeof h){r=h.length;for(d=0;d<r;d+=1)i=h[d],"string"===typeof i&&(j=e(i,m))&&p.push(b(i)+(g?": ":":")+j)}else for(i in m)Object.hasOwnProperty.call(m,i)&&(j=e(i,m))&&p.push(b(i)+(g?": ":":")+j);j=0===p.length?"{}":g?"{\n"+g+p.join(",\n"+g)+"\n"+
v+"}":"{"+p.join(",")+"}";g=v;return j}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z"},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var c=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
d=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g,o,j={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},h;"function"!==typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;o=g="";if(typeof c==="number")for(d=0;d<c;d=d+1)o=o+" ";else typeof c==="string"&&(o=c);if((h=b)&&typeof b!=="function"&&(typeof b!=="object"||typeof b.length!=="number"))throw Error("JSON.stringify");return e("",{"":a})});
"function"!==typeof JSON.parse&&(JSON.parse=function(a,b){function d(a,c){var e,f,h=a[c];if(h&&typeof h==="object")for(e in h)if(Object.hasOwnProperty.call(h,e)){f=d(h,e);f!==void 0?h[e]=f:delete h[e]}return b.call(a,c,h)}var e;c.lastIndex=0;c.test(a)&&(a=a.replace(c,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,
""))){e=eval("("+a+")");return typeof b==="function"?d({"":e},""):e}throw new SyntaxError("JSON.parse");})})();(function(a){a.wa_blog.editor={options:{blogs:{},content_id:"post_text",current_blog_id:null,dateMonthCount:2,dateShowWeek:!1,cut_link_label_default:"",version:"1.0"},transliterated:!1,blog_statuses:{"private":"private","public":"public"},init:function(b){function e(b){a(this).show();a(this).parent().find(".datetime").hide();b&&a("#current-time").text(b);a("#current-time").show()}function c(a){var b=a.siblings(".hint:first");0>=b.length&&(b=a.parent().siblings(".hint:first"));return b}function d(a){a.parent().find("input[type=text]").removeClass("error");
c(a).removeClass("errormsg")}function g(a){a.parent().find("input[type=text]").addClass("error");c(a).addClass("errormsg")}function o(){return a.datepicker._defaults.dateFormat.toUpperCase().replace("YY","YYYY")}var j=this;j.options=a.extend(j.options,b);var h=function(b){var c=b.link+b.slug+"/";a("#url-link").text(c);a("#url-link").attr("href",b.preview_hash?c+"?preview="+b.preview_hash:c);a("#pure-url").text(b.link);b.slug&&!l?(a("#post-url").val(b.slug),l=b.slug):a("#post-url").val(l);var d=b.is_adding?
"small":b.is_published?"small":"hint",e=a("#post-url-field span:first").contents().filter(function(){return this.nodeType==3}).get(0).nodeValue;if(b.other_links&&b.other_links instanceof Array){c=[];for(k in b.other_links)c.push({previewText:e,className:d,slug:l,link:b.other_links[k],href:b.preview_hash?b.other_links[k]+l+"/?preview="+b.preview_hash:b.other_links[k]+l+"/"});b=b.is_adding?'<span class="${className}">${previewText}${link}<span class="slug">{{if slug}}${slug}/{{/if}}</span></span><br>':
'<span class="${className}">${previewText}<a target="_blank" href="${href}">${link}<span class="slug">{{if slug}}${slug}/{{/if}}</span></a></span><br>';d=a("#post-url-field").children(":first");d.is(".icon10")&&(b='<i class="'+d.attr("class")+'"></i> '+b);a("#other-urls").html(a.tmpl(b,c))}},f=function(b){b=b||"hidden";"empty"==b?a("#post-url-field-no-settlements").show("fast"):a("#post-url-field-no-settlements").hide("fast");l=null;var c=a("#post-url").val("");"empty"==b||"hidden_empty"==b?c.siblings('[name="update_url_on_error"]').length||
c.after(a.parseHTML('<input type="hidden" name="update_url_on_error" value="1">')):c.siblings('[name="update_url_on_error"]').remove();a("#post-url-field").hide("fast").trigger(a.Event("change",{status:b}))},n=function(b,c){b&&(l=b);a(".slug").each(function(){if(l){var b=a(this).text(l+"/").parents("a:first");b.attr("href",b.text()+(c?"?preview="+c:""))}else a(this).text("")})},b=function(){a("#url-editable").hide();a("#url-edit").show();a("#post-url").focus()},l=null,i={},s=function(){},r={},v=s=
function(){if(a("#post-url-field").length){var b=a("#post-title").val(),c=a("input[name=blog_id]").val();if(r[c]&&r[c].no_frontend)b?f("empty"):f("hidden_empty");else{b||f("hidden");var d=a("input[name=post_id]").val(),e=function(d){d&&(r[c]||(r[c]={id:c,no_frontend:d.is_private_blog||!d.link}),r[c].no_frontend?b?f("empty"):f("hidden_empty"):b?(a("#post-url-field-no-settlements").hide("fast"),d&&h(d),a("#post-url-field").show("fast").trigger(a.Event("change",{status:"visible"}))):(h(d),f("hidden")))},
j=null,g={post_title:b,post_id:d,blog_id:c},n=[c,d].join("&");i[n]&&(l||!b)?e(i[n]):(l&&(g.slug=l),a.ajax({url:"?module=post&action=getPostUrl",data:g,dataType:"json",type:"post",async:!1,success:function(b){j=b.data;i[n]=j;a.wa_blog.editor.transliterated=!0;e(j)}}))}}else f("empty")};a("#post-title").blur(v);a("#post-form").find("input[name=post_id]").val()&&v();a("#url-edit-link").click(b);a("#post-url").keyup(function(a){9!=a.keyCode&&this.value!=l&&n(this.value)});j.postUrlWidget={setEditReady:b,
resetEditReady:function(){a("#url-editable").show();a("#url-edit").hide()},updateSlugs:n,changeBlog:s};var b={beforeSave:function(){var b=a(".datepicker:not(:disabled)"),c=!0;if(0<b.length){var d=b.parent(".datetime").find(".time");if(0<d.length){var e;if(e=d.get(0))e=d.eq(0).val(),e=!(0<=e&&24>=e);e&&(c=!1);if(e=d.get(1))d=d.eq(1).val(),e=!(0<=d&&60>=d);e&&(c=!1)}c||g(b)}if(!c)return!1;a.wa_blog.editor.onSubmit()},afterSave:function(b){a("#b-post-save-button").removeClass("yellow").addClass("green");
a("#postpublish-edit").removeClass("yellow").addClass("green");j.postUrlWidget.resetEditReady();j.postUrlWidget.updateSlugs(b.url,b.preview_hash||!1);e.call(a("#inline-edit-datetime").get(0),b.formatted_datetime);"draft"==j.inlineSaveController.getAction()&&a("#post-url-field .small").removeClass("small").addClass("hint");b=a("#b-post-edit-custom-params-dialog");if(!b.is(":hidden")){var c=b.find(":input[name=meta_title]").val(),d=b.find(":input[name=meta_keywords]").val(),f=b.find(":input[name=meta_description]").val(),
h=b.find(":input[name=params]").val();c?a("#b-post-edit-meta-title").show().find(".val").text(c):a("#b-post-edit-meta-title").hide();d?a("#b-post-edit-meta-keywords").show().find(".val").text(d):a("#b-post-edit-meta-keywords").hide();f?a("#b-post-edit-meta-description").show().find(".val").text(f):a("#b-post-edit-meta-description").hide();h?a("#b-post-edit-custom-params").show().html(h.trim().split("\n").join("<br>")+"<br>"):a("#b-post-edit-custom-params").hide();c||d||f||h?a("#b-post-edit-no-meta").hide():
a("#b-post-edit-no-meta").show();b.trigger("close")}}},p=function(){if(!1!==N()){var b=O,c=a.wa_blog.editor.wysiwygToHtml(a("#post_text","#post-form").val());a("#post_text","#post-form").val(c);c=a("#post-form").serialize()+"&"+t+"=1";c+=x?"&inline=1":"";c+=!a.wa_blog.editor.transliterated?"&transliterate=1":"";b=b||function(){};m("loading");a.ajax({url:"?module=post&action=save",data:c,dataType:"json",type:"post",success:function(c){if("fail"==c.status){c.errors.datetime||a.wa_blog.editor.closeCurrentDialog();
var d=c.errors;if(d.url){a("#post-url-field").show();var e=a("#post-url"),f=d.url,h="#message-"+e.attr("id");e.addClass("error");a(h).addClass("errormsg").text(f)}d.datetime&&(d=a(".datepicker:not(:disabled)"),d.length&&g(d));!c.errors.datetime&&"deadline"==t&&((c=a("#deadline-dialog .datepicker").val())?a("#publication-deadline-changable-part").html(a.tmpl("publication-deadline-setted",{date:c})):a("#publication-deadline-changable-part").html(a.tmpl("publication-deadline-setted")),a("#b-post-save-draft-button").attr("name",
"deadline"))}else c.data.redirect?location.href=c.data.redirect:(b(c.data),c.data.id&&a("#post-id").val(c.data.id),m("saved"));x=!1;m("")},error:function(){}})}},m=function(b,c){b?(a("#form-status span").hide(),a("#form-status #"+b+"-status").show(),a("#form-status").show()):a("#form-status").fadeOut(c&&"function"==typeof c?c:function(){})},b=b||{},t="",x=!1,N=b.beforeSave||function(){},O=b.afterSave||function(){};a("input[type=submit], input[type=button], a.js-submit").click(function(){if(a(this).hasClass("dialog-edit"))return!1;
if(a(this).hasClass("js-submit")){var b=a(this).attr("title")||a(this).text()||"Are you sure?";if(!confirm(b))return!1}if(a("#post-id").val()&&("b-post-save-button"==this.id||"b-post-save-draft-button"==this.id||"b-post-save-custom-params"==this.id))x=!0;t=this.name;("deadline"==t||"schedule"==t)&&a("#"+this.name+"-dialog").find("input[name^=datetime]").attr("disabled",!1);p();return!1});a("#post-url").focus(function(){});j.inlineSaveController={save:p,setAction:function(a){t=a},getAction:function(){return t}};
b=function(){var b="#"+this.id+"-on-label",c="#"+this.id+"-off-label";this.checked?(a(b).removeClass("b-unselected"),a(c).addClass("b-unselected")):(a(b).addClass("b-unselected"),a(c).removeClass("b-unselected"))};s=a("#allow-comment-switcher");b.call(s.get(0));s.iButton({labelOn:"",labelOff:"",className:"mini"}).change(b);b=j.options;b={changeMonth:!0,changeYear:!0,shortYearCutoff:2,showOtherMonths:2>b.dateMonthCount,selectOtherMonths:2>b.dateMonthCount,stepMonths:b.dateMonthCount,numberOfMonths:b.dateMonthCount,
showWeek:b.dateShowWeek,gotoCurrent:!0,constrainInput:!1,beforeShow:function(){setTimeout(function(){10>a("#ui-datepicker-div").css("z-index")&&a("#ui-datepicker-div").css("z-index",10)},0)}};a(".datepicker").datepicker(b).filter("input[name^=schedule_datetime]").datepicker("option","minDate",new Date);a("#ui-datepicker-div").hide();a(".datepicker").focus(function(){d(a(this))});var P=function(){var b=a(this).attr("id").replace(/-.*$/,"");a.wa_blog.editor.currentDialog=a("#"+b+"-dialog").waDialog({disableButtonsOnSubmit:!0,
onLoad:function(){a(this).find("input,select").removeAttr("disabled");a(".user-date-format").text(o())},onSubmit:function(){return!1},onCancel:function(){a(this).find("input:text,select").each(function(){a(this).value=a(this).defaultValue;a(this).attr("disabled","disabled")})}});return!1};a(".dialog-edit").each(function(){a(this).click(function(a){a.preventDefault();return P.call(a.target)})});b=null;try{b=a.storage.get("blog/editor")||"redactor"}catch(C){this.log("Exception: "+C.message+"\nline: "+
C.fileName+":"+C.lineNumber)}if(!b||!this.editors[b])for(b in this.editors)break;if(!this.selectEditor(b,!0))for(b in this.editors)if(this.selectEditor(b,!0))break;a("#post-form").find("input[name=post_id]").val()||a("#post-title").focus();a.wa.dropdownsCloseEnable();a(".change-blog").click(a.wa_blog.editor.changeBlogHandler);a('#postpublish-dialog input[name="publish_blog_id"]').change(a.wa_blog.editor.changePublishBlogHandler);a("#post-title").keyup(function(){var b=a(this),c=b.next(".maxlength"),
d=parseInt(b.attr("maxlength"));d&&b.val().length>=d&&!c.length?b.after('<em class="hint maxlength">'+$_("input_maxlength").replace(/%d/,d)+"</em>"):(!d||b.val().length<d)&&c.length&&c.remove()});a("#inline-edit-datetime").click(function(){a(this).hide();a(this).parent().find(".datetime").show();a("#current-time").hide();a(".user-date-format").text(o())});a(".b-post-editor-toggle li a").click(this.editorTooggle);a(document).keydown(function(a){if(a.ctrlKey&&83==a.keyCode)j.onSaveHotkey(a)});a(".time").focus(function(){d(a(this).parent().find(".datepicker"))});
a("#post-form").submit(function(){return!1});a("#b-post-edit-custom-params-link").click(function(){a("#b-post-edit-custom-params-dialog").waDialog({onSubmit:function(){return!1}});return!1});var E=a(window);a("#buttons-bar").sticky&&a("#buttons-bar").sticky({fixed_class:"b-fixed-button-bar",isStaticVisible:function(a){return E.scrollTop()+E.height()>=a.element.offset().top+a.element.outerHeight()}});var F=function(b){a.pm({target:q[0].contentWindow,type:"update_title",data:b})},H=function(){var a=
G();a&&a!=q.attr("src")&&(q.attr("src",a),q.one("load",function(){}))},I=function(b){return a(b).attr("href").replace(/\/[^\/]*\/(\?[^\/]*)?$/,"/postpreview/")},G=function(){var b=null;a("#post-url-field a").each(function(){var a=I(this);if("javascript:"!=a.substr(0,11)){if(q.attr("src")==a)return b=null,!1;b=a}});b||(b=q.attr("src"),"about:blank"==b&&(b=null));return b},u=a("#post-form"),q=a("#realtime-preview-iframe"),w=q.closest(".sidebar"),z=!1,J=a("<textarea>").hide().appendTo(w),D=a("#post-title"),
A=a("#not-available-message"),K=a("#wa-header"),B=a(".b-fixed-button-bar"),Q=a('#blog-photo_bridge-editor [name="album_id"]'),L=w.find('[name="realtime_on"]'),y=!1,M=!1;q.one("load",function(){M=!0});a.widget("ui.blog_draghandler",a.ui.mouse,{_init:function(){this._mouseInit();this.$content=u.find(".content")},_mouseStart:function(b){this.xStart=b.pageX;this.sidebar_width=w.width();this.window_width=a(window).width();y&&q.hide()},_mouseDrag:function(b){this.sidebar_width+=this.xStart-b.pageX;this.xStart=
b.pageX;320>this.sidebar_width?this.sidebar_width=320:380>this.window_width-this.sidebar_width&&(this.sidebar_width=this.window_width-380);w.width(this.sidebar_width);this.$content.css({marginRight:this.sidebar_width+"px"});B.css("right",this.sidebar_width+16+"px");a(window).resize()},_mouseStop:function(){y&&q.show();a.storage.set("blog/editor/preview_sidebar_width",this.sidebar_width)}});w.find(".column-resize-handler:first").blog_draghandler();a("#realtime-preview-toggle").click(function(){if(!z)if(u.hasClass("realtime-edit-mode")){u.removeClass("realtime-edit-mode");
a(this).removeClass("b-close-live-editor");L.val("");var b=a(".sidebar"),c=b.first().width()-0;z=!0;var d=u.closest(".content").animate({marginLeft:c+"px"},400),e=u.find(".content").animate({marginRight:c+"px"},400);w.hide();K.slideDown(400);B.animate({left:c+15+"px",right:c+16+"px"},400);setTimeout(function(){b.show();w.hide();z=!1;d.css("marginLeft","");e.css("marginRight","");B.css({left:"",right:""});a(window).resize().scroll()},410)}else{u.addClass("realtime-edit-mode");a(this).addClass("b-close-live-editor");
!a("#post-url-field-no-settlements").is(":visible")&&G()?(q.show(),A.hide(),y=!0,H()):(q.hide(),A.show(),y=!1);L.val("1");z=!0;var c=a.storage.get("blog/editor/preview_sidebar_width")||600,f=a(".sidebar").hide().first().width()-0;u.closest(".content").animate({marginLeft:0},400);B.css({"min-width":0,right:f+16+"px"}).animate({left:"15px",right:c-0+15+"px"},400);u.find(".content").animate({marginRight:c+"px"},400);w.css("width",0).show().animate({width:c+"px"},400);K.slideUp(400);setTimeout(function(){z=
false;a(window).resize().scroll()},410)}});D.keyup(function(){F(D.val())});setInterval(function(){if(M&&u.hasClass("realtime-edit-mode")){var b=null;(b=a("#post-form .b-post-editor-toggle li.selected a").attr("id"))&&a.wa_blog.editor.editors[b]&&a.wa_blog.editor.editors[b].update(J);F(D.val());b=J.val();Q.val()&&(b=b+'<p class="attached-album-description"><em>'+$_("Photos from the attached album will be displayed here."),b+="</em></p>");a.pm({target:q[0].contentWindow,type:"update_text",data:b})}},
500);a("#post-url-field").on("click","a",function(){if(u.hasClass("realtime-edit-mode")){var a=I(this);a!=q.attr("src")&&(q.attr("src",a),q.one("load",function(){}));return!1}});a("#post-url-field").change(function(a){u.hasClass("realtime-edit-mode")&&("empty"!=a.status&&"hidden_empty"!=a.status?(q.show(),A.hide(),y=!0,H()):(q.hide(),A.show(),y=!1))});a(window).resize(function(){q.height(a(window).height()-30);q.width(w.width()-10)})},cloneTextarea:function(b,e,c){var d="editor_container_"+c;a(e).append(b.clone(!0).attr({id:d,
name:"text_"+c,disabled:!0}));b.hide();return d},cut_hr:'<span class="b-elrte-wa-split-vertical elrte-wa_post_cut">%text%</span>',cut_str:"<\!-- more %text%--\>",htmlToWysiwyg:function(b){return b.replace(/<\!--[\s]*?more[\s]*?(text[\s]*?=[\s]*?['"]([\s\S]*?)['"])*[\s]*?--\>/g,function(b,c,d){return d?a.wa_blog.editor.cut_hr.replace("%text%",d):a.wa_blog.editor.cut_hr.replace("%text%",a.wa_blog.editor.options.cut_link_label_default)})},wysiwygToHtml:function(b){var e=a("<p></p>").html(b),c=e.find(".elrte-wa_post_cut");
return c.length?(b=c.html(),!b||"<br>"===b||b===a.wa_blog.editor.options.cut_link_label_default?c.replaceWith(a.wa_blog.editor.cut_str.replace("%text%","")):c.replaceWith(a.wa_blog.editor.cut_str.replace("%text%",'text="'+b+'" ')),e.html().replace("<span></span>","")):b},editors:{ace:{editor:null,container:null,inited:!1,init:function(b){if(!this.inited){this.inited=!0;this.container=a('<div id="blog-ace-editor"></div>').appendTo("#post_text_wrapper");this.container.wrap('<div class="ace"></div>');
this.editor=ace.edit("blog-ace-editor");ace.config.set("basePath",wa_url+"wa-content/js/ace/");this.editor.setTheme("ace/theme/eclipse");var e=this.editor.getSession();e.setMode("ace/mode/javascript");e.setMode("ace/mode/css");e.setMode("ace/mode/html");e.setMode("ace/mode/smarty");e.setUseWrapMode(!0);this.editor.renderer.setShowGutter(!1);this.editor.setShowPrintMargin(!1);this.editor.setFontSize(13);a(".ace_editor").css("fontFamily","");e.setValue(b.hide().val());this.editor.moveCursorTo(0,0);
-1!=navigator.appVersion.indexOf("Mac")?this.editor.setFontSize(13):-1!=navigator.appVersion.indexOf("Linux")?this.editor.setFontSize(16):this.editor.setFontSize(14);this.editor.commands.addCommand({name:"unfind",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:function(){return!1},readOnly:!0});var c=a("#post-form .sidebar .b-edit-options:first").height(),d=function(b,d){var e=b.getSession().getScreenLength()*b.renderer.lineHeight+b.renderer.scrollBar.getWidth(),e=1.02*e,g=c-163;e<g&&(e=g);a("#"+d).height(e.toString()+
"px");b.resize()},g=this,o=a(window);e.on("change",function(){d(g.editor,"blog-ace-editor");o.scroll()});setTimeout(function(){d(g.editor,"blog-ace-editor")},50);o.resize(function(){g.editor.resize();d(g.editor,"blog-ace-editor")});this.container.on("keydown",a.wa_blog.editor.editorKeyCallback());this.container.on("keypress",a.wa_blog.editor.editorKeyCallback(!0))}return!0},show:function(b){this.container.show();this.container.parent().show();var e=this;setTimeout(function(){if(e.editor){var c=a.wa_blog.editor.wysiwygToHtml(b.val()),
d=e.editor.getCursorPosition();e.editor.setValue(c);a("#post-title").is(":focus")||e.editor.focus();e.editor.navigateTo(d.row,d.column)}else"object"==typeof console&&console.log("wait for ace editor init"),e.show(b)},100)},hide:function(){this.container.hide();this.container.parent().hide()},update:function(a){this.inited&&a.val(this.editor.getValue())},correctEditorHeight:function(b){return Math.max(b,a.wa_blog.editor.getMinEditorHeight())+a.wa_blog.editor.getExtHeightShift()}},redactor:{options:{},
inited:!1,callback:!1,editor:null,init:function(b){if(!this.inited){var e=a(window),c=a("#b-post-save-button"),d=a("#postpublish-edit"),g=a("#post-form .sidebar .b-edit-options:first").height(),o=a.extend({deniedTags:!1,minHeight:Math.max(300,g-229),buttonSource:!1,paragraphy:!0,convertDivs:!0,toolbarFixedBox:!0,buttons:"html formatting bold italic underline deleted unorderedlist orderedlist outdent indent image video file table link alignment | horizontalrule".split(" "),plugins:"fontcolor fontsize fontfamily table video cut".split(" "),
lang:wa_lang,imageUpload:"?action=upload&filelink=1&absolute=1",uploadImageFields:b.data("uploadFields"),imageUploadErrorCallback:function(a){alert(a.error)},syncBeforeCallback:function(a){return a=a.replace(/{[a-z$][^}]*}/gi,function(a,b,c){var d=c.indexOf("<\/script",b+a.length),b=c.indexOf("<script",b+a.length);if(-1==d||-1!=b&&b<d)a=a.replace(/&gt;/g,">"),a=a.replace(/&lt;/g,"<"),a=a.replace(/&amp;/g,"&"),a=a.replace(/&quot;/g,'"');return a})},changeCallback:function(){d.is(":visible")&&d.removeClass("green").addClass("yellow");
c.is(":visible")&&c.removeClass("green").addClass("yellow");e.scroll()}},o||{});a.wa_blog_options.photos_bridge_available&&(o.modalOpenedCallback=function(b,c){if("image"==b){var d=this;this.modal.width=1100;var e=this.modal.getModal(),g=a('<div class="redactor-tab redactor-tab1">').append(e.children());this.modal.createTabber(e);this.modal.addTab(1,$_("Upload"),"active");this.modal.addTab(2,$_("Select from Photos app"));var i=a('<div id="photos-image-selector-wrapper">'),o=a('<div class="redactor-tab redactor-tab2">').hide().append(i).append('<div class="clear-both">'),
r=o.find(".total-photos-selected"),v=function(){i.find("input:checkbox").each(function(){m[this.value]&&a(this).prop("checked",!0).change()});a(window).resize()},p=0,m={};c.on("click",'#redactor-modal-tabber a[rel="tab2"]',function(){x.is(":visible")||(x.show(),t.show(),i.html('<div class="block"><i class="icon16 loading"></i></div>'),a.post("../photos/?module=photo&action=embedSelector",{app_id:"blog"},function(a){i.html(a);v()}))});d.modal.createCancelButton();var t=a("#redactor-modal > footer > .redactor-modal-btn.redactor-modal-close-btn").css("width",
"50%").hide();t.off("click").on("click",function(){d.modal.close()});var x=d.modal.createActionButton($_("Insert")).css("width","50%").hide();x.on("click",function(){if(0<p){var b=[];a.each(m,function(a,c){b.push('<img src="'+c+'">')});d.insert.html(b.join("\n"))}d.modal.close()});c.on("click",'#redactor-modal-tabber a[rel="tab1"]',function(){x.hide();t.hide()});i.on("change","input:checkbox",function(){var b=a(this),c=b.val();this.checked?m[c]||(m[c]=b.data("photoUrl"),p++):m[c]&&(delete m[c],p--);
0<p?r.text(p).closest(".hidden").show():r.text(p).closest(".hidden").hide()});i.on("reloaded",function(){v()});e.append(g);e.append(o);this.modal.resize()}});b.redactor(o);b.redactor("core.getBox").css("z-index",0);b.redactor("core.getToolbar").css("z-index",1);this.editor=b.data("redactor");this.inited=!0}return!0},show:function(b){var e=a.wa_blog.editor.htmlToWysiwyg(b.val());b.val(e);a(".redactor-box").show();b.redactor("core.getEditor").find('img[src*="$wa_url"]').each(function(){var b=decodeURIComponent(a(this).attr("src"));
a(this).attr("data-src",b);a(this).attr("src",b.replace(/\{\$wa_url\}/,wa_url))});b.redactor("code.set",b.val());b.redactor("observe.load");b.redactor("focus.setStart")},hide:function(){a(".redactor-box").hide()},update:function(a){this.inited&&a.val(this.editor.code.get())}},photo_bridge:{container:null,inited:!1,init:function(b){if(!this.inited){this.inited=!0;b.hide();this.container=a("#blog-photo_bridge-editor");if(!this.container.length)return;var e=a("#album-frontend-link"),c=this.container.find('select[name="album_id"]'),
d=this.container.find(".hidden.field"),g=0;c.change(function(){if(c.val()){var b=c.children(":selected").data("frontend-link");b?(d.slideDown(g),e.text(b)):(d.slideUp(g),d.find('[name="album_link_type"]:checkbox').prop("checked",!1));a("#post-editor .show-when-album-selected").show()}else d.slideUp(g),a("#post-editor .show-when-album-selected").hide()}).change();g=300;b=a("#post-form .sidebar .b-edit-options:first").height();this.container.css("min-height",b-100)}return!0},show:function(){this.container.show()},
hide:function(){this.container.hide()},update:function(){}}},getMinEditorHeight:function(){return 200},getExtHeightShift:function(){return-70},editorTooggle:function(){var b=a(this);!b.hasClass("selected")&&a.wa_blog.editor.selectEditor(b.attr("id"))&&(a(".b-post-editor-toggle li.selected").removeClass("selected"),b.parent().addClass("selected"));return!1},selectEditor:function(b,e){if(this.editors[b]){var c=a("#"+this.options.content_id);if(c.length){try{if(this.editors[b].init(c)){var d=null;if(!e)try{a.storage.set("blog/editor",
b)}catch(g){this.log("Exception: "+g.message+"\nline: "+g.fileName+":"+g.lineNumber)}var o=a(".b-post-editor-toggle li.selected a");if(o.length&&(o.parent().removeClass("selected"),d=o.attr("id")))this.editors[d].update(c),this.editors[d].hide();a("#"+b).parent().addClass("selected");this.editors[b].show(c);setTimeout(function(){a(window).scroll()},0)}}catch(j){return this.log("Exception: "+j.message+"\nline: "+j.fileName+":"+j.lineNumber,j.stack),!1}return!0}this.log('Text container for "'+b+'" not found');
return!1}this.log('Blog editor "'+b+'" not found');return!1},editor_key:!1,editorKeyCallback:function(b){var e=this;return b?function(b){if(b.ctrlKey&&115==b.which&&!a.wa_blog.editor.editor_key)e.onSaveHotkey(b)}:function(b){a.wa_blog.editor.editor_key=!1;b.ctrlKey&&83==b.which&&(a.wa_blog.editor.editor_key=!0,e.onSaveHotkey(b));if(!b.metaKey&&(33>b.which||40<b.which)&&(27<b.which||8==b.which||13==b.which)&&(112>b.which||124<b.which)&&(!b.ctrlKey||67!=b.which))a("#b-post-save-button").removeClass("green").addClass("yellow"),
a("#postpublish-edit").removeClass("green").addClass("yellow")}},onSubmit:function(){var b=a.wa_blog,e;for(e in b)if("editor"!=e&&b[e].onSubmit&&"function"==typeof b[e].onSubmit)try{b[e].onSubmit()}catch(c){"object"==typeof console&&console.log(c)}b=a("#"+this.options.content_id);if(b.length){e=null;var d=a(".b-post-editor-toggle li.selected a");d.length&&(e=d.attr("id"))&&this.editors[e].update(b)}b=a("#b-post-save-button");"draft"==b.attr("name")||"deadline"==b.attr("name")||(b.removeClass("yellow").addClass("green"),
a("#postpublish-edit").removeClass("yellow").addClass("green"))},onSaveHotkey:function(b){b.preventDefault();var b=a("#b-post-save-draft-button"),e=a("#b-post-save-button");b.length?b.click():e.length&&e.click()},currentDialog:null,closeCurrentDialog:function(){this.currentDialog&&this.currentDialog.waDialog().trigger("close")},registerEditor:function(a,e){if(this.editors[a])return this.log('Editor "'+a+'" already registered'),!1;this.editors[a]=e;return!0},log:function(a,e){"object"==typeof console&&
(console.log(a),e&&console.log(e))},changeBlogHandler:function(){var b=parseInt(a(this).attr("href").replace(/^.*#/,""));a.wa_blog.editor.selectCurrentBlog(b)&&(a(".dialog :input:checked").attr("checked",!1),a(".dialog #b-post-publish-blog-"+b).attr("checked",!0));a.wa.dropdownsClose();return!1},changePublishBlogHandler:function(){if(a(this).attr("checked")){var b=parseInt(a(this).val());a.wa_blog.editor.selectCurrentBlog(b)}},selectCurrentBlog:function(b){var e=a.wa_blog.editor.options.blogs[b],
c=a.wa_blog.editor.options.current_blog_id;if(e&&c!=b){var d=a.tmpl("selected-blog",{blog:e});a(".current-blog").replaceWith(d);a("#blog-selector-"+c).removeClass("selected");d=a("#blog-selector-"+b).addClass("selected");c=a.wa_blog.editor.options.blogs[c];a.wa_blog.editor.options.current_blog_id=parseInt(b);b=a(".b-post");c&&b.removeClass(c.color);b.addClass(e.color);a.wa_blog.editor.postUrlWidget.changeBlog(d.attr("data-blog-status"));return!0}}}})(jQuery);
