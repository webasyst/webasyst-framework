var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,b,g){a instanceof String&&(a=String(a));for(var m=a.length,f=0;f<m;f++){var d=a[f];if(b.call(g,d,f,a))return{i:f,v:d}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,g){if(a==Array.prototype||a==Object.prototype)return a;a[b]=g.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var g=a[b];if(g&&g.Math==Math)return g}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var g=$jscomp.propertyToPolyfillSymbol[b];if(null==g)return a[b];g=a[g];return void 0!==g?g:a[b]};
$jscomp.polyfill=function(a,b,g,m){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,g,m):$jscomp.polyfillUnisolated(a,b,g,m))};$jscomp.polyfillUnisolated=function(a,b,g,m){g=$jscomp.global;a=a.split(".");for(m=0;m<a.length-1;m++){var f=a[m];if(!(f in g))return;g=g[f]}a=a[a.length-1];m=g[a];b=b(m);b!=m&&null!=b&&$jscomp.defineProperty(g,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,g,m){var f=a.split(".");a=1===f.length;m=f[0];m=!a&&m in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var d=0;d<f.length-1;d++){var l=f[d];if(!(l in m))return;m=m[l]}f=f[f.length-1];g=$jscomp.IS_SYMBOL_NATIVE&&"es6"===g?m[f]:null;b=b(g);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,f,{configurable:!0,writable:!0,value:b}):b!==g&&(void 0===$jscomp.propertyToPolyfillSymbol[f]&&(g=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[f]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(f):$jscomp.POLYFILL_PREFIX+g+"$"+f),$jscomp.defineProperty(m,$jscomp.propertyToPolyfillSymbol[f],{configurable:!0,writable:!0,value:b})))};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(b,g){return $jscomp.findInternal(this,b,g).v}},"es6","es3");var NO_JQUERY={};
(function(a,b,g){if(!("console"in a)){var m=a.console={};m.log=m.warn=m.error=m.debug=function(){}}b===NO_JQUERY&&(b={fn:{},extend:function(){for(var d=arguments[0],l=1,q=arguments.length;l<q;l++){var c=arguments[l],e;for(e in c)d[e]=c[e]}return d}});b.fn.pm=function(){console.log("usage: \nto send: $.pm(options)\nto receive: $.pm.bind(type, fn, [origin])");return this};b.pm=a.pm=function(d){f.send(d)};b.pm.bind=a.pm.bind=function(d,l,q,c,e){f.bind(d,l,q,c,!0===e)};b.pm.unbind=a.pm.unbind=function(d,
l){f.unbind(d,l)};b.pm.origin=a.pm.origin=null;b.pm.poll=a.pm.poll=200;var f={send:function(d){d=b.extend({},f.defaults,d);var l=d.target;if(d.target)if(d.type){var q={data:d.data,type:d.type};d.success&&(q.callback=f._callback(d.success));d.error&&(q.errback=f._callback(d.error));"postMessage"in l&&!d.hash?(f._bind(),l.postMessage(JSON.stringify(q),d.origin||"*")):(f.hash._bind(),f.hash.send(d,q))}else console.warn("postmessage type required");else console.warn("postmessage target window required")},
bind:function(d,l,q,c,e){f._replyBind(d,l,q,c,e)},_replyBind:function(d,l,q,c,e){"postMessage"in a&&!c?f._bind():f.hash._bind();c=f.data("listeners.postmessage");c||(c={},f.data("listeners.postmessage",c));var h=c[d];h||(h=[],c[d]=h);h.push({fn:l,callback:e,origin:q||b.pm.origin})},unbind:function(d,l){var q=f.data("listeners.postmessage");if(q)if(d)if(l){var c=q[d];if(c){for(var e=[],h=0,p=c.length;h<p;h++){var n=c[h];n.fn!==l&&e.push(n)}q[d]=e}}else delete q[d];else for(h in q)delete q[h]},data:function(d,
l){return l===g?f._data[d]:f._data[d]=l},_data:{},_CHARS:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),_random:function(){for(var d=[],l=0;32>l;l++)d[l]=f._CHARS[0|32*Math.random()];return d.join("")},_callback:function(d){var l=f.data("callbacks.postmessage");l||(l={},f.data("callbacks.postmessage",l));var q=f._random();l[q]=d;return q},_bind:function(){f.data("listening.postmessage")||(a.addEventListener?a.addEventListener("message",f._dispatch,!1):a.attachEvent&&a.attachEvent("onmessage",
f._dispatch),f.data("listening.postmessage",1))},_dispatch:function(d){try{var l=JSON.parse(d.data)}catch(n){console.warn("postmessage data invalid json: ",n);return}if(l.type){var q=(f.data("callbacks.postmessage")||{})[l.type];if(q)q(l.data);else{q=(f.data("listeners.postmessage")||{})[l.type]||[];for(var c=0,e=q.length;c<e;c++){var h=function(n){l.callback&&f.send({target:d.source,data:n,type:l.callback})},p=q[c];if(p.origin&&"*"!==p.origin&&d.origin!==p.origin)console.warn("postmessage message origin mismatch",
d.origin,p.origin),l.errback&&f.send({target:d.source,data:{message:"postmessage origin mismatch",origin:[d.origin,p.origin]},type:l.errback});else try{p.callback?p.fn(l.data,h,d):h(p.fn(l.data,d))}catch(n){if(l.errback)f.send({target:d.source,data:n,type:l.errback});else throw n;}}}}else console.warn("postmessage message type required")},hash:{send:function(d,l){var q=d.target;if(d=d.url){d=f.hash._url(d);var c=f.hash._url(a.location.href);if(a==q.parent)var e="parent";else try{for(var h=0,p=parent.frames.length;h<
p;h++)if(parent.frames[h]==a){e=h;break}}catch(n){e=a.name}null==e?console.warn("postmessage windows must be direct parent/child windows and the child must be available through the parent window.frames list"):(l={"x-requested-with":"postmessage",source:{name:e,url:c},postmessage:l},e="#x-postmessage-id="+f._random(),q.location=d+e+encodeURIComponent(JSON.stringify(l)))}else console.warn("postmessage target window url is required")},_regex:/^#x\-postmessage\-id=(\w{32})/,_regex_len:50,_bind:function(){f.data("polling.postmessage")||
(setInterval(function(){var d=""+a.location.hash,l=f.hash._regex.exec(d);l&&(l=l[1],f.hash._last!==l&&(f.hash._last=l,f.hash._dispatch(d.substring(f.hash._regex_len))))},b.pm.poll||200),f.data("polling.postmessage",1))},_dispatch:function(d){if(d){try{if(d=JSON.parse(decodeURIComponent(d)),!("postmessage"===d["x-requested-with"]&&d.source&&null!=d.source.name&&d.source.url&&d.postmessage))return}catch(x){return}var l=d.postmessage,q=(f.data("callbacks.postmessage")||{})[l.type];if(q)q(l.data);else{var c=
"parent"===d.source.name?a.parent:a.frames[d.source.name];q=(f.data("listeners.postmessage")||{})[l.type]||[];for(var e=0,h=q.length;e<h;e++){var p=function(x){l.callback&&f.send({target:c,data:x,type:l.callback,hash:!0,url:d.source.url})},n=q[e];if(n.origin){var w=/https?:\/\/[^\/]*/.exec(d.source.url)[0];if("*"!==n.origin&&w!==n.origin){console.warn("postmessage message origin mismatch",w,n.origin);l.errback&&f.send({target:c,data:{message:"postmessage origin mismatch",origin:[w,n.origin]},type:l.errback,
hash:!0,url:d.source.url});continue}}try{n.callback?n.fn(l.data,p):p(n.fn(l.data))}catch(x){if(l.errback)f.send({target:c,data:x,type:l.errback,hash:!0,url:d.source.url});else throw x;}}}}},_url:function(d){return(""+d).replace(/#.*$/,"")}}};b.extend(f,{defaults:{target:null,url:null,type:null,data:null,success:null,error:null,origin:"*",hash:!1}})})(this,"undefined"===typeof jQuery?NO_JQUERY:jQuery);"JSON"in window&&window.JSON||(JSON={});
(function(){function a(e){return 10>e?"0"+e:e}function b(e){f.lastIndex=0;return f.test(e)?'"'+e.replace(f,function(h){var p=q[h];return"string"===typeof p?p:"\\u"+("0000"+h.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function g(e,h){var p=d,n=h[e];n&&"object"===typeof n&&"function"===typeof n.toJSON&&(n=n.toJSON(e));"function"===typeof c&&(n=c.call(h,e,n));switch(typeof n){case "string":return b(n);case "number":return isFinite(n)?String(n):"null";case "boolean":case "null":return String(n);
case "object":if(!n)return"null";d+=l;var w=[];if("[object Array]"===Object.prototype.toString.apply(n)){var x=n.length;for(e=0;e<x;e+=1)w[e]=g(e,n)||"null";h=0===w.length?"[]":d?"[\n"+d+w.join(",\n"+d)+"\n"+p+"]":"["+w.join(",")+"]";d=p;return h}if(c&&"object"===typeof c)for(x=c.length,e=0;e<x;e+=1){var t=c[e];"string"===typeof t&&(h=g(t,n))&&w.push(b(t)+(d?": ":":")+h)}else for(t in n)Object.hasOwnProperty.call(n,t)&&(h=g(t,n))&&w.push(b(t)+(d?": ":":")+h);h=0===w.length?"{}":d?"{\n"+d+w.join(",\n"+
d)+"\n"+p+"}":"{"+w.join(",")+"}";d=p;return h}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z"},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var m=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
f=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,d,l,q={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},c;"function"!==typeof JSON.stringify&&(JSON.stringify=function(e,h,p){var n;l=d="";if("number"===typeof p)for(n=0;n<p;n+=1)l+=" ";else"string"===typeof p&&(l=p);if((c=h)&&"function"!==typeof h&&("object"!==typeof h||"number"!==typeof h.length))throw Error("JSON.stringify");return g("",{"":e})});
"function"!==typeof JSON.parse&&(JSON.parse=function(e,h){function p(n,w){var x,t=n[w];if(t&&"object"===typeof t)for(x in t)if(Object.hasOwnProperty.call(t,x)){var y=p(t,x);void 0!==y?t[x]=y:delete t[x]}return h.call(n,w,t)}m.lastIndex=0;m.test(e)&&(e=e.replace(m,function(n){return"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,
"")))return e=eval("("+e+")"),"function"===typeof h?p({"":e},""):e;throw new SyntaxError("JSON.parse");})})();(function(a){a.wa_blog.editor={options:{blogs:{},content_id:"post_text",current_blog_id:null,dateMonthCount:2,dateShowWeek:!1,cut_link_label_default:"",version:"1.0"},transliterated:!1,blog_statuses:{"private":"private","public":"public"},reInit:function(){this.init(this.options)},init:function(b){function g(c){a(this).show();a(this).parent().find(".datetime").hide();c&&a("#current-time").text(c);a("#current-time").show()}function m(c){var e=c.siblings(".hint:first");0>=e.length&&(e=c.parent().siblings(".hint:first"));
return e}function f(c){c.parent().find("input[type=text]").removeClass("error");m(c).removeClass("errormsg")}function d(c){c.parent().find("input[type=text]").addClass("error");m(c).addClass("errormsg")}function l(){return a.datepicker._defaults.dateFormat.toUpperCase().replace("YY","YYYY")}var q=this;q.options=a.extend(q.options,b);q.postUrlWidget=function(){function c(r,u,z,A){var B=null,E={post_title:z,post_id:u,blog_id:r},F=[r,u].join("&");!x[F]||!w&&z?(w&&(E.slug=w),a.ajax({url:"?module=post&action=getPostUrl",
data:E,dataType:"json",type:"post",async:!1,success:function(D){B=D.data;x[F]=B;a.wa_blog.editor.transliterated=!0;A(B)}})):A(x[F])}function e(r){a("#pure-url").text(r.link);a("#preview-url").data("preview-url",r.preview_link);r.slug&&!w?(a("#post-url").val(r.slug),w=r.slug):a("#post-url").val(w);var u=r.is_adding?"small":r.is_published?"small":"hint",z=a("#post-url-field span:first").contents().filter(function(){return 3==this.nodeType}).get(0).nodeValue;if(r.other_links&&r.other_links instanceof
Array){var A=[];for(k in r.other_links)A.push({previewText:z,className:u,slug:w,link:r.other_links[k],preview_link:r.other_preview_links[k],href:r.preview_hash?r.other_links[k]+w+"/?preview="+r.preview_hash:r.other_links[k]+w+"/"});r=r.is_adding?'<span class="${className}">${previewText}${link}<span class="slug">{{if slug}}${slug}/{{/if}}</span></span><br>':'<span class="${className}">${previewText}<a target="_blank" href="${href}" data-preview-url="${preview_link}">${link}<span class="slug">{{if slug}}${slug}/{{/if}}</span></a></span><br>';
u=a("#post-url-field").children(":first");if(u.is(".fas")||u.is("[data-icon]"))r=u.get(0).outerHTML+r;a("#other-urls").html(a.tmpl(r,A))}}function h(r){r=r||"hidden";"empty"==r?a("#post-url-field-no-settlements").show("fast"):a("#post-url-field-no-settlements").hide("fast");w=null;a("#post-url").val("");a("#post-url-field").hide("fast").trigger(a.Event("change",{status:r}))}function p(r,u){r&&(w=r);a(".slug").each(function(){if(w){var z=a(this).text(w+"/").parents("a:first");z.attr("href",z.text()+
(u?"?preview="+u:""))}else a(this).text("")})}function n(){a("#url-editable").hide();a("#url-edit").show();a("#post-url").focus()}var w=null,x={},t=function(){},y={};(function(){var r=t=function(){if(a("#post-url-field").length){var u=a("#post-title").val(),z=a("input[name=blog_id]").val();if(y[z]&&y[z].no_frontend)u?h("empty"):h("hidden_empty");else{u||h("hidden");var A=a("input[name=post_id]").val();c(z,A,u,function(B){B&&(y[z]||(y[z]={id:z,no_frontend:B.is_private_blog||!B.link}),y[z].no_frontend?
u?h("empty"):h("hidden_empty"):u?(a("#post-url-field-no-settlements").hide("fast"),B&&e(B),a("#post-url-field").show("fast").trigger(a.Event("change",{status:"visible"}))):(e(B),h("hidden")))})}}else h("empty")};a("#post-title").blur(r);a("#post-form").find("input[name=post_id]").val()&&r();a("#url-edit-link").click(n);a("#post-url").keyup(function(u){9!=u.keyCode&&this.value!=w&&p(this.value)})})();return{setEditReady:n,resetEditReady:function(){a("#url-editable").show();a("#url-edit").hide()},updateSlugs:p,
changeBlog:t}}();q.inlineSaveController=function(c){function e(){!1!==x()&&h(t)}function h(y){var r=a.wa_blog.editor.wysiwygToHtml(a("#post_text","#post-form").val());a("#post_text","#post-form").val(r);r=a("#post-form").serialize()+"&"+n+"=1";r+=w?"&inline=1":"";r+=a.wa_blog.editor.transliterated?"":"&transliterate=1";a.wa_blog.editor.currentDialog&&"b-post-edit-custom-params-dialog"===a.wa_blog.editor.currentDialog.$wrapper.attr("id")&&(r+="&"+a.wa_blog.editor.currentDialog.$wrapper.find("[name]").serialize());
y=y||function(){};p("loading");a.ajax({url:"?module=post&action=save",data:r,dataType:"json",type:"post",success:function(u){if("fail"==u.status){u.errors.datetime||a.wa_blog.editor.closeCurrentDialog();var z=u.errors;if(z.url){a("#post-url-field").show();var A=a("#post-url"),B=z.url,E="#message-"+A.attr("id");A.addClass("error");a(E).addClass("errormsg").text(B)}z.datetime&&(z=a(".datepicker:not(:disabled)"),z.length&&d(z));u.errors.datetime||"deadline"!=n||((u=a("#deadline-dialog .datepicker").val())?
a("#publication-deadline-changable-part").html(a.tmpl("publication-deadline-setted",{date:u})):a("#publication-deadline-changable-part").html(a.tmpl("publication-deadline-setted")),a("#b-post-save-draft-button").attr("name","deadline"))}else u.data.redirect?location.href=u.data.redirect:(y(u.data),u.data.id&&a("#post-id").val(u.data.id),p("saved"));w=!1;p("")},error:function(u,z,A){}})}function p(y,r){y?(a("#form-status span").hide(),a("#form-status #"+y+"-status").show(),a("#form-status").show()):
a("#form-status").fadeOut(r&&"function"==typeof r?r:function(){})}c=c||{};var n="",w=!1,x=c.beforeSave||function(){},t=c.afterSave||function(){};(function(){a(document).on("click","[type=submit], input[type=button], a.js-submit",function(){function y(){!a("#post-id").val()||"b-post-save-button"!=this.id&&"b-post-save-draft-button"!=this.id&&"b-post-save-custom-params"!=this.id||(w=!0);n=this.name;"deadline"!=n&&"schedule"!=n||a("#"+this.name+"-dialog").find("input[name^=datetime]").attr("disabled",
!1);e()}if(a(this).hasClass("dialog-edit"))return!1;if(a(this).hasClass("js-submit")){var r=this,u=a(r).attr("title")||a(r).text()||"Are you sure?";a.waDialog.confirm({text:u,success_button_title:a.wa.locale.Confirm,success_button_class:"danger",cancel_button_title:a.wa.locale.Cancel,cancel_button_class:"light-gray",onSuccess:function(){y&&y.apply(r)}});return!1}y.apply(this)});a("#post-url").focus(function(){})})();return{save:e,setAction:function(y){n=y},getAction:function(){return n}}}({beforeSave:function(){var c=
a(".datepicker:not(:disabled)"),e=!0;if(0<c.length){var h=c.parent(".datetime").find(".time");if(0<h.length){var p;if(p=h.get(0))p=h.eq(0).val(),p=!(0<=p&&24>=p);p&&(e=!1);if(p=h.get(1))h=h.eq(1).val(),p=!(0<=h&&60>=h);p&&(e=!1)}e||d(c)}if(!e)return!1;a.wa_blog.editor.onSubmit()},afterSave:function(c){a("#b-post-save-button").removeClass("yellow").addClass("blue");a("#postpublish-edit").removeClass("yellow").addClass("blue");q.postUrlWidget.resetEditReady();q.postUrlWidget.updateSlugs(c.url,c.preview_hash||
!1);g.call(a("#inline-edit-datetime").get(0),c.formatted_datetime);"draft"==q.inlineSaveController.getAction()&&a("#post-url-field .small").removeClass("small").addClass("hint");var e,h=null==c?void 0:null==(e=c.meta)?void 0:e.title,p;e=null==c?void 0:null==(p=c.meta)?void 0:p.keywords;var n;p=null==c?void 0:null==(n=c.meta)?void 0:n.description;c=null==c?void 0:c.params;n=a("#b-post-edit-custom-params-dialog");n.find(":input[name=meta_description]").val(p);n.find(":input[name=params]").val(c);h?
(a("#b-post-edit-meta-title").show().find(".val").text(h),n.find(":input[name=meta_title]").val(h)):a("#b-post-edit-meta-title").hide();e?(a("#b-post-edit-meta-keywords").show().find(".val").text(e),n.find(":input[name=meta_keywords]").val(e)):a("#b-post-edit-meta-keywords").hide();p?(a("#b-post-edit-meta-description").show().find(".val").text(p),n.find(":input[name=meta_description]").val(p)):a("#b-post-edit-meta-description").hide();c?(a("#b-post-edit-custom-params").show().html(c.trim().split("\n").join("<br>")+
"<br>"),n.find(":input[name=params]").val(c)):a("#b-post-edit-custom-params").hide();h||e||p||c?a("#b-post-edit-no-meta").hide():a("#b-post-edit-no-meta").show()}});(function(c){c={changeMonth:!0,changeYear:!0,shortYearCutoff:2,showOtherMonths:2>c.dateMonthCount,selectOtherMonths:2>c.dateMonthCount,stepMonths:c.dateMonthCount,numberOfMonths:c.dateMonthCount,showWeek:c.dateShowWeek,gotoCurrent:!0,constrainInput:!1,beforeShow:function(){setTimeout(function(){10>a("#ui-datepicker-div").css("z-index")&&
a("#ui-datepicker-div").css("z-index",10)},0)}};a(".datepicker").datepicker(c).filter("input[name^=schedule_datetime]").datepicker("option","minDate",new Date);a("#ui-datepicker-div").hide();a(".datepicker").on("focus",function(){f(a(this))})})(q.options);(function(){function c(){var h=a(this).attr("id").replace(/-.*$/,""),p;(null==(p=e[h])?0:p.length)||(e[h]=a("#"+h+"-dialog").detach());a.wa_blog.editor.currentDialog=a.waDialog({$wrapper:e[h],append_to:a(this).closest("form"),onOpen:function(n){n.find("input,select").removeAttr("disabled");
a(".user-date-format").text(l())},onClose:function(n){a(this).find("input:text,select").each(function(w){a(this).value=a(this).defaultValue;a(this).attr("disabled","disabled")});if("schedule"===h)return n.hide(),!1}});return!1}var e={};a(".dialog-edit").each(function(){a(this).on("click",function(h){h.preventDefault();return c.call(h.target)})})})();b=null;try{b=localStorage.getItem("blog/editor")||"redactor",b=b.replaceAll('"',"")}catch(c){this.log("Exception: "+c.message+"\nline: "+c.fileName+":"+
c.lineNumber)}if(!b||!this.editors[b])for(b in this.editors)break;if(!this.selectEditor(b,!0))for(b in this.editors)if(this.selectEditor(b,!0))break;a("#post-form").find("input[name=post_id]").val()||a("#post-title").focus();a(".change-blog").click(a.wa_blog.editor.changeBlogHandler);a('#postpublish-dialog input[name="publish_blog_id"]').change(a.wa_blog.editor.changePublishBlogHandler);a("#post-title").keyup(function(){var c=a(this),e=c.next(".maxlength"),h=parseInt(c.attr("maxlength"));h&&c.val().length>=
h&&!e.length?c.after('<em class="hint maxlength">'+$_("input_maxlength").replace(/%d/,h)+"</em>"):(!h||c.val().length<h)&&e.length&&e.remove()});a("#inline-edit-datetime").click(function(){a(this).hide();a(this).parent().find(".datetime").show();a("#current-time").hide();a(".user-date-format").text(l())});a(".b-post-editor-toggle li a").click(this.editorTooggle);a(document).keydown(function(c){if(c.ctrlKey&&83==c.keyCode)q.onSaveHotkey(c)});a(".time").focus(function(){f(a(this).parent().find(".datepicker"))});
a("#post-form").submit(function(){return!1});a("#b-post-edit-custom-params-link").on("click",function(){a.waDialog({$wrapper:a("#b-post-edit-custom-params-dialog").clone(),append_to:"#post-form",onOpen:function(c,e){a.wa_blog.editor.currentDialog=e;c.find('[type="button"]').on("click",function(){e.close();a.wa_blog.editor.currentDialog=null})}});return!1});(function(){function c(v){var C;null!=(C=t[0])&&C.contentWindow&&a.pm({target:t[0].contentWindow,type:"update_title",data:v})}function e(){var v=
p();v&&v!=t.attr("src")&&(t.attr("src",v),t.one("load",function(){}))}function h(v){return v.data("preview-url")||""}function p(){var v=null;a("#post-url-field a").each(function(){var C=h(a(this));if(C&&"javascript:"!=C.substr(0,11)){if(t.attr("src")==C)return v=null,!1;v=C}});v||(v=t.attr("src"),"about:blank"==v&&(v=null));v&&(v+=0<=v.indexOf("?")?"&":"?",v+="parent_url="+encodeURIComponent(location.origin));return v}function n(){!a("#post-url-field-no-settlements").is(":visible")&&p()?(t.show(),
A.hide(),D=!0,e()):(t.hide(),A.show(),D=!1);F.val("1");r=!0;var v=a.storage.get("blog/editor/preview_sidebar_width")||600;a(".sidebar").hide().first().width();x.closest(".content").animate({marginLeft:0},400);x.find(".content").animate({marginRight:v+"px"},400);y.css("width",0).show().animate({width:v+"px"},400);B.slideUp(400);setTimeout(function(){r=!1;a(window).resize().scroll()},410)}function w(){F.val("");var v=a(".sidebar"),C=v.first().width()-0;r=!0;var H=x.closest(".content").animate({marginLeft:C+
"px"},400),I=x.find(".content").animate({marginRight:C+"px"},400);y.hide();B.slideDown(400);setTimeout(function(){v.show();y.hide();r=!1;H.css("marginLeft","");I.css("marginRight","");a(window).resize().scroll()},410)}var x=a("#post-form"),t=a("#realtime-preview-iframe"),y=t.closest(".sidebar"),r=!1,u=a("<textarea>").hide().appendTo(y),z=a("#post-title"),A=a("#not-available-message"),B=a("#wa-header"),E=a('#blog-photo_bridge-editor [name="album_id"]'),F=y.find('[name="realtime_on"]'),D=!1,G=!1;t.one("load",
function(){G=!0});a.pm.bind("updater_loaded",function(v){G=!0});a.widget("ui.blog_draghandler",a.ui.mouse,{_init:function(){this._mouseInit();this.$content=x.find(".content")},_mouseStart:function(v){this.xStart=v.pageX;this.sidebar_width=y.width();this.window_width=a(window).width();D&&t.hide()},_mouseDrag:function(v){this.sidebar_width+=this.xStart-v.pageX;this.xStart=v.pageX;320>this.sidebar_width?this.sidebar_width=320:380>this.window_width-this.sidebar_width&&(this.sidebar_width=this.window_width-
380);y.width(this.sidebar_width);this.$content.css({marginRight:this.sidebar_width+"px"});a(window).resize()},_mouseStop:function(){D&&t.show();a.storage.set("blog/editor/preview_sidebar_width",this.sidebar_width)}});y.find(".column-resize-handler:first").blog_draghandler();a("#realtime-preview-toggle").click(function(){r||(x.hasClass("realtime-edit-mode")?(x.removeClass("realtime-edit-mode"),a(this).removeClass("b-close-live-editor"),w()):(x.addClass("realtime-edit-mode"),a(this).addClass("b-close-live-editor"),
n()))});z.keyup(function(){c(z.val())});setInterval(function(){if(G&&x.hasClass("realtime-edit-mode")){var v;(v=a("#post-form .b-post-editor-toggle li.selected a").attr("id"))&&a.wa_blog.editor.editors[v]&&a.wa_blog.editor.editors[v].update(u);c(z.val());v=u.val();E.val()&&(v=v+'<p class="attached-album-description"><em>'+$_("Photos from the attached album will be displayed here."),v+="</em></p>");a.pm({target:t[0].contentWindow,type:"update_text",data:v})}},500);a("#post-url-field").on("click","a",
function(){if(x.hasClass("realtime-edit-mode")){var v=h(a(this));v!=t.attr("src")&&(t.attr("src",v),t.one("load",function(){}));return!1}});a("#post-url-field").change(function(v){x.hasClass("realtime-edit-mode")&&("empty"!=v.status&&"hidden_empty"!=v.status?(t.show(),A.hide(),D=!0,e()):(t.hide(),A.show(),D=!1))});a(window).resize(function(){t.height(a(window).height()-30);t.width(y.width()-10)})})()},cloneTextarea:function(b,g,m){var f="editor_container_"+m;a(g).append(b.clone(!0).attr({id:f,name:"text_"+
m,disabled:!0}));b.hide();return f},cut_hr:'<span class="b-elrte-wa-split-vertical elrte-wa_post_cut">%text%</span>',cut_str:"\x3c!-- more %text%--\x3e",htmlToWysiwyg:function(b){return b.replace(/\x3c!--[\s]*?more[\s]*?(text[\s]*?=[\s]*?['"]([\s\S]*?)['"])*[\s]*?--\x3e/g,function(g,m,f){return f?a.wa_blog.editor.cut_hr.replace("%text%",f):a.wa_blog.editor.cut_hr.replace("%text%",a.wa_blog.editor.options.cut_link_label_default)})},wysiwygToHtml:function(b){var g=a("<p></p>").html(b),m=g.find(".elrte-wa_post_cut");
return m.length?((b=m.html())&&"<br>"!==b&&b!==a.wa_blog.editor.options.cut_link_label_default?m.replaceWith(a.wa_blog.editor.cut_str.replace("%text%",'text="'+b+'" ')):m.replaceWith(a.wa_blog.editor.cut_str.replace("%text%","")),g.html().replace("<span></span>","")):b},editors:{ace:{editor:null,container:null,inited:!1,init:function(b){if(!this.inited){var g=function(){"dark"===document.documentElement.dataset.theme?m.editor.setTheme("ace/theme/monokai"):m.editor.setTheme("ace/theme/eclipse")},m=
this;this.inited=!0;this.container=a('<div id="blog-ace-editor"></div>').appendTo("#post_text_wrapper");this.container.wrap('<div class="ace"></div>');this.editor=ace.edit("blog-ace-editor");ace.config.set("basePath",wa_url+"wa-content/js/ace/");g();document.documentElement.addEventListener("wa-theme-change",g);g=this.editor.getSession();g.setMode("ace/mode/javascript");g.setMode("ace/mode/css");g.setMode("ace/mode/html");g.setMode("ace/mode/smarty");g.setUseWrapMode(!0);this.editor.$blockScrolling=
Infinity;this.editor.renderer.setShowGutter(!1);this.editor.setShowPrintMargin(!1);this.editor.setFontSize(13);a(".ace_editor").css("fontFamily","");g.setValue(b.hide().val());this.editor.moveCursorTo(0,0);-1!=navigator.appVersion.indexOf("Mac")?this.editor.setFontSize(13):-1!=navigator.appVersion.indexOf("Linux")?this.editor.setFontSize(16):this.editor.setFontSize(14);this.editor.commands.addCommand({name:"unfind",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:function(q,c){return!1},readOnly:!0});
var f=a("#post-form .sidebar .b-edit-options:first").height(),d=function(q,c){var e=q.getSession().getScreenLength()*q.renderer.lineHeight+q.renderer.scrollBar.getWidth();e*=1.02;var h=f-163;e<h&&(e=h);a("#"+c).height(e.toString()+"px");q.resize()},l=a(window);g.on("change",function(){d(m.editor,"blog-ace-editor");l.scroll()});setTimeout(function(){d(m.editor,"blog-ace-editor")},50);l.resize(function(){m.editor.resize();d(m.editor,"blog-ace-editor")});this.container.on("keydown",a.wa_blog.editor.editorKeyCallback());
this.container.on("keypress",a.wa_blog.editor.editorKeyCallback(!0))}return!0},show:function(b){this.container.show();this.container.parent().show();if(this.editor){b=b.val();b=a.wa_blog.editor.wysiwygToHtml(b);var g=this.editor.getCursorPosition();this.editor.setValue(b);""!=a("#post-title").val()&&this.editor.focus();this.editor.navigateTo(g.row,g.column)}else"object"==typeof console&&console.log("wait for ace editor init"),this.show(b)},hide:function(){this.container.hide();this.container.parent().hide()},
update:function(b){this.inited&&b.val(this.editor.getValue())},correctEditorHeight:function(b){return Math.max(b,a.wa_blog.editor.getMinEditorHeight())+a.wa_blog.editor.getExtHeightShift()}},redactor:{options:{},inited:!1,callback:!1,editor:null,init:function(b){if(!this.inited){var g=a(window),m=a("#b-post-save-button"),f=a("#postpublish-edit");a("#post-form .sidebar .b-edit-options:first").height();var d=!0;""==a("#post-title").val()&&(d=!1);var l=a.extend({focus:d,deniedTags:!1,minHeight:300,linkify:!1,
source:!1,paragraphy:!1,replaceDivs:!1,toolbarFixed:!0,replaceTags:{b:"strong",i:"em",strike:"del"},removeNewlines:!1,removeComments:!1,imagePosition:!0,imageResizable:!0,imageFloatMargin:"1.5em",imageTypes:["image/png","image/jpeg","image/gif","image/webp"],buttons:"format bold italic underline deleted lists image video file table link alignment fontcolor fontsize fontfamily".split(" "),plugins:"fontcolor fontfamily alignment fontsize table video cut".split(" "),lang:wa_lang,imageUpload:"?action=upload&r=2&absolute=1",
imageUploadFields:b.data("uploadFields"),callbacks:{change:function(){f.is(":visible")&&f.removeClass("green").addClass("yellow");m.is(":visible")&&m.removeClass("green").addClass("yellow");g.scroll()}}},l||{});l.callbacks=a.extend({imageUploadError:function(q){console.log("imageUploadError",q);alert(q.error)},syncClean:function(q){return q.replace(/\{[a-z\$'"_\(!+\-][^\}]*\}/gi,function(c){return c.replace(/-&gt;/g,"->")})},syncBefore:function(q){return q=q.replace(/{[a-z$][^}]*}/gi,function(c,e,
h){var p=h.indexOf("\x3c/script",e+c.length);e=h.indexOf("<script",e+c.length);if(-1==p||-1!=e&&e<p)c=c.replace(/&gt;/g,">"),c=c.replace(/&lt;/g,"<"),c=c.replace(/&amp;/g,"&"),c=c.replace(/&quot;/g,'"');return c})}},l.callbacks||{});a.wa_blog_options.photos_bridge_available&&(l.callbacks.modalOpened=function(q,c){if("image"==q){var e=this;this.modal.width=1100;q=this.modal.getModal();var h=a('<div id="photos-image-selector-wrapper">'),p=a('<div class="redactor-modal-tab redactor-tab1" data-title="'+
$_("Select from Photos app")+'">').hide().append(h).append('<div class="clear-both">'),n=p.find(".total-photos-selected");q.append(p);this.modal.buildTabber();(function(){function w(){h.find("input:checkbox").each(function(){t[this.value]&&a(this).prop("checked",!0).change()});a(window).resize()}var x=0,t={},y=a('<button id="redactor-modal-button-action" style="margin-top: 16px;">'+e.lang.get("insert")+"</button>").hide();p.append(y);var r=a('<button id="redactor-modal-button-cancel" style="margin-top: 16px;">'+
e.lang.get("cancel")+"</button>").hide();p.append(r);a('#redactor-modal-tabber a[rel="1"]').on("click",function(){y.is(":visible")||(y.show(),r.show(),h.html('<div class="block"><i class="icon16 loading"></i></div>'),a.post("../photos/?module=photo&action=embedSelector",{app_id:"blog"},function(u){h.html(u);w()}))});r.off("click").on("click",function(){e.modal.close()});y.on("click",function(){if(0<x){var u=[];a.each(t,function(z,A){u.push('<figure><img src="'+A+'"></figure>')});e.insert.html(u.join("\n"))}e.modal.close()});
a('#redactor-modal-tabber a[rel="0"]').on("click",function(){y.hide();r.hide()});h.on("change","input:checkbox",function(){var u=a(this),z=u.val();this.checked?t[z]||(t[z]=u.data("photoUrl"),x++):t[z]&&(delete t[z],x--);0<x?n.text(x).closest(".hidden").show():n.text(x).closest(".hidden").hide()});h.on("reloaded",function(u){w()})})()}});b.redactor(l);b.redactor("core.box").css("z-index",0);b.redactor("core.toolbar").css("z-index",1);this.editor=b.data("redactor");this.inited=!0}return!0},show:function(b){var g=
a.wa_blog.editor.htmlToWysiwyg(b.val());b.val(g);a(".redactor-box").show();b.redactor("core.editor").find('img[src*="$wa_url"]').each(function(){var m=decodeURIComponent(a(this).attr("src"));a(this).attr("data-src",m);a(this).attr("src",m.replace(/\{\$wa_url\}/,wa_url))});this.editor.code.set(b.val());this.editor.observe.load();this.editor.focus.start()},hide:function(b){a(".redactor-box").hide()},update:function(b){if(this.inited){var g=this.editor.code.get();g=this.editor.clean.onSync(this.editor.clean.onSet(g));
g=a.wa_blog.editor.wysiwygToHtml(g);b.val(g)}}},photo_bridge:{container:null,inited:!1,init:function(b){if(!this.inited){this.inited=!0;b.hide();this.container=a("#blog-photo_bridge-editor");if(!this.container.length)return;var g=a("#album-frontend-link"),m=this.container.find('select[name="album_id"]'),f=this.container.find(".js-post-url"),d=0;m.change(function(){if(m.val()){var l=m.children(":selected").data("frontend-link");l?(f.slideDown(d),g.text(l)):(f.slideUp(d),f.find('[name="album_link_type"]:checkbox').prop("checked",
!1));a("#post-editor .show-when-album-selected").show()}else f.slideUp(d),a("#post-editor .show-when-album-selected").hide()}).change();d=300;b=a("#post-form .sidebar .b-edit-options:first").height();this.container.css("min-height",b-100)}return!0},show:function(b){this.container.show()},hide:function(){this.container.hide()},update:function(b){}}},getMinEditorHeight:function(){return 200},getExtHeightShift:function(){return-70},editorTooggle:function(){var b=a(this);!b.hasClass("selected")&&a.wa_blog.editor.selectEditor(b.attr("id"))&&
(a(".b-post-editor-toggle li.selected").removeClass("selected"),b.parent().addClass("selected"));return!1},selectEditor:function(b,g){if(this.editors[b]){var m=a("#"+this.options.content_id);if(m.length){try{if(this.editors[b].init(m)){var f=null;if(!g)try{a.storage.set("blog/editor",b)}catch(l){this.log("Exception: "+l.message+"\nline: "+l.fileName+":"+l.lineNumber)}var d=a(".b-post-editor-toggle li.selected a");d.length&&(d.parent().removeClass("selected"),f=d.attr("id"))&&(this.editors[f].update(m),
this.editors[f].hide());a("#"+b).parent().addClass("selected");this.editors[b].show(m);setTimeout(function(){a(window).scroll()},0)}}catch(l){return this.log("Exception: "+l.message+"\nline: "+l.fileName+":"+l.lineNumber,l.stack),!1}return!0}this.log('Text container for "'+b+'" not found');return!1}this.log('Blog editor "'+b+'" not found');return!1},editor_key:!1,editorKeyCallback:function(b){var g=this;return b?function(m){if(m.ctrlKey&&115==m.which&&!a.wa_blog.editor.editor_key)g.onSaveHotkey(m)}:
function(m){a.wa_blog.editor.editor_key=!1;m.ctrlKey&&83==m.which&&(a.wa_blog.editor.editor_key=!0,g.onSaveHotkey(m));m.metaKey||!((33>m.which||40<m.which)&&(27<m.which||8==m.which||13==m.which)&&(112>m.which||124<m.which))||m.ctrlKey&&67==m.which||(a("#b-post-save-button").removeClass("green").addClass("yellow"),a("#postpublish-edit").removeClass("green").addClass("yellow"))}},onSubmit:function(){var b=a.wa_blog;for(g in b)if("editor"!=g&&b[g].onSubmit&&"function"==typeof b[g].onSubmit)try{b[g].onSubmit()}catch(f){"object"==
typeof console&&console.log(f)}b=a("#"+this.options.content_id);if(b.length){var g=null;var m=a(".b-post-editor-toggle li.selected a");m.length&&(g=m.attr("id"))&&this.editors[g].update(b)}b=a("#b-post-save-button");"draft"!=b.attr("name")&&"deadline"!=b.attr("name")&&(b.removeClass("yellow").addClass("blue"),a("#postpublish-edit").removeClass("yellow").addClass("blue"))},onSaveHotkey:function(b){b.preventDefault();b=a("#b-post-save-draft-button");var g=a("#b-post-save-button");b.length?b.click():
g.length&&g.click()},currentDialog:null,closeCurrentDialog:function(){this.currentDialog&&this.currentDialog.close()},registerEditor:function(b,g){if(this.editors[b])return this.log('Editor "'+b+'" already registered'),!1;this.editors[b]=g;return!0},log:function(b,g){"object"==typeof console&&(console.log(b),g&&console.log(g))},changeBlogHandler:function(){var b=parseInt(a(this).find("[data-id]").data("id"));a.wa_blog.editor.selectCurrentBlog(b)&&(a(".dialog :input:checked").attr("checked",!1),a(".dialog #b-post-publish-blog-"+
b).attr("checked",!0))},changePublishBlogHandler:function(){if(a(this).attr("checked")){var b=parseInt(a(this).val());a.wa_blog.editor.selectCurrentBlog(b)}},selectCurrentBlog:function(b){var g=a.wa_blog.editor.options.blogs[b],m=a.wa_blog.editor.options.current_blog_id;if(g&&m!=b){var f=a.tmpl("selected-blog",{blog:g});a(".current-blog").html(f);a("#blog-selector-"+m).removeClass("selected");f=a("#blog-selector-"+b).addClass("selected");m=a.wa_blog.editor.options.blogs[m];a.wa_blog.editor.options.current_blog_id=
parseInt(b);b=a(".b-post");m&&b.removeClass(m.color);b.addClass(g.color);a.wa_blog.editor.postUrlWidget.changeBlog(f.attr("data-blog-status"));return!0}}}})(jQuery);
//# sourceMappingURL=blog-post-edit.min.js.map