(function(b){b.wa_blog.calendar={options:{},init:function(c){this.options=c||{};this._initDateSelecter();if(c.allow_add){b(".b-calendar td").click(function(a){a.target.tagName==b(this).get(0).tagName&&(window.location.href="?module=post&action=edit&date="+b(this).attr("id").replace(/^date-/,""))});var a=this.options.td_title;b(".b-calendar td").each(function(){b(this).attr("title",a)})}this.initDragnDrop();b(document).bind("selectstart",function(a){a=a.target.tagName;if("TD"==a||"TH"==a||"TR"==a||
"TBODY"==a||"TABLE"==a)return!1})},_initDateSelecter:function(){b("select.month,select.year").change(function(){var c=location.search.match(/[&\?](month=.*?&|month=.*)/),a=b("select.month").val(),a=b("select.year").val()+"-"+(10<a?a:"0"+a);c?(c=c[1],a="&"==c.substr(-1)?"month="+a+"&":"month="+a,location.search=location.search.replace(c,a)):location.search+=(location.search?"&":"?")+"month="+a})},initDragnDrop:function(){var c=this;c._extendJqueryUIDragAndDrop();b([".status-"+c.options.statuses.deadline,
".status-"+c.options.statuses.draft].join(),".b-calendar td").liveDraggable({containment:b(".b-calendar"),distance:5,helper:"clone"});b(".b-calendar td").liveDroppable({greedy:!0,tolerance:"pointer",activeClass:"drop-active",hoverClass:"drag-active",drop:function(a,g){if(g.draggable.parent().get(0)!=this){var f=b(this),e=g.draggable,d=e.clone(),h=f.attr("id").replace("date-","");e.hide();f.append(d);b.post("?module=post&action=saveField",{post_id:e.attr("data-post-id"),data:{datetime:h,status:c.options.statuses.deadline}},
function(a){a&&"ok"==a.status?(f.append("<br><br>"),e.nextAll("br:lt(2)").remove().end().remove(),d.find(".icon10.edit-bw").removeClass("edit-bw").addClass("exclamation").attr("title",$_("Overdue")),d.attr(d.attr("class").replace(/status-\w+/,"status-"+c.options.statuses.deadline)),a.data.post.overdue?d.find("a").removeClass("b-draft").addClass("b-draft-overdue"):d.find("a").removeClass("b-draft-overdue").addClass("b-draft")):(e.show(),d.remove())},"json").error(function(){e.show();d.remove()})}}})},
_extendJqueryUIDragAndDrop:function(){b.fn.liveDraggable=function(c){this.each(function(){var a=b(this);a.data("init_draggable")&&a.die("mouseover",a.data("init_draggable"))});this.live("mouseover",function(){var a=b(this);a.data("init_draggable")||a.data("init_draggable",arguments.callee).draggable(c)})};b.fn.liveDroppable=function(c){this.each(function(){var a=b(this);a.data("init_droppable")&&a.die("mouseover",a.data("init_droppable"))});var a=function(){var a=b(this);a.data("init_droppable")||
(a.data("init_droppable",arguments.callee).droppable(c),a.mouseover())};a.call(this);this.die("mouseover",a).live("mouseover",a);this.live("mouseover",a)}}}})(jQuery);
