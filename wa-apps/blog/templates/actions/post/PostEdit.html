<form id="post-form" class="height-100" action="" method="post">
<div class="article wide">
    <div class="article-body">

            {$wa->csrf()}

            <div class="drawer js-drawer">
                <div class="drawer-background"></div>
                <div class="drawer-body bordered-left custom-py-48">
                    <a href="#" class="drawer-close js-close-drawer custom-mt-48 custom-pt-24"><i class="fas fa-times"></i></a>
                    <div class="drawer-block custom-py-32">
                        <div class="drawer-content">
                            <div class="b-post-editor-toolbar">
                                <div class="b-edit-options fields vertical">

                                    <!-- allow comments -->
                                    <h6 class="heading">[`Allow comments`]</h6>
                                    {if !$show_comments}
                                            <span class="text-gray">[`Off`]</span>
                                    {else}
                                        <div class="switch-with-text">
                                            <span class="switch smaller" id="allow-comment-switch">
                                                <input id="allow-comment-switcher" type="checkbox" name="comments_allowed" value="1"{if $post.comments_allowed} checked{/if}>
                                            </span>
                                            <label for="allow-comment-switcher" data-active-text="[`On`]" data-inactive-text="[`Off`]">[`On`]</label>
                                        </div>
                                    {/if}

                                    <!-- author -->
                                    <div class="custom-mt-16">
                                        <h6 class="heading">[`Author`]</h6>
                                        <select class="b-toolbar-select" name="contact_id">
                                            {foreach $users as $id => $name}
                                                <option {if $id == $post.contact_id}selected="selected"{/if} value="{$id}">{$name|escape}</option>
                                            {/foreach}
                                        </select>
                                    </div>

                                    <!-- publication datetime -->
                                    <div class="custom-mt-16">

                                        {if ($post.status eq blogPostModel::STATUS_DRAFT) || ($post.status eq blogPostModel::STATUS_DEADLINE)}

                                            <h6 class="heading">[`Publication deadline`]</h6>

                                            <div id="publication-deadline-changable-part">

                                                {if ($post.datetime || $wa->get('date')) && $post.status eq blogPostModel::STATUS_DEADLINE}
                                                    <i class="fas fa-exclamation-triangle text-orange custom-mr-4 small"></i>{if !$wa->get('date')}{$post.datetime|wa_date}{else}{date('d.m.Y', strtotime($wa->get('date')))}{/if}
                                                    <a id="deadline-edit" href="javascript:void(0);" class="small dialog-edit">[`edit`]</a>
                                                {else}
                                                    <i class="fas fa-exclamation-triangle text-orange custom-mr-4 small"></i><a id="deadline-edit" href="javascript:void(0);" class="dialog-edit">[`Not set`]</a>
                                                    <p class="hint custom-mt-0">[`Deadline is for plan purposes only. It will not automatically published the post, but will highlight the post if publication date is overdue.`]</p>
                                                {/if}
                                            </div>

                                                <!-- jquery template {capture name="publication-deadline-setted-template-js"}{literal} -->
                                            <i class="fas fa-exclamation-triangle text-orange custom-mr-4 small"></i>${date}
                                            <a href="javascript:void(0);" class="small dialog-edit">[`edit`]</a>
                                            <!-- {/literal}{/capture} -->

                                                <!-- jquery template {capture name="publication-deadline-unsetted-template-js"}{literal} -->
                                            <i class="fas fa-exclamation-triangle text-orange custom-mr-4 small"></i><a href="javascript:void(0);" class="dialog-edit">[`Not set`]</a>
                                            <span class="hint">[`Deadline is for plan purposes only. It will not automatically published the post, but will highlight the post if publication date is overdue.`]</span>
                                            <!-- {/literal}{/capture} -->
                                            {capture append="dialogs"}
                                                {include file='./../../dialogs/postDeadline.html' inline}
                                                {include file='./../../dialogs/postDelete.html' inline}
                                            {/capture}

                                        {elseif $post.status != blogPostModel::STATUS_SCHEDULED}

                                            <h6 class="heading">[`Published`]</h6>

                                            <span id="current-time" class="small" title="{$post.datetime}">{$post.datetime|wa_datetime:'humandatetime'}</span>

                                            <a class="small no-wrap custom-ml-16" id="inline-edit-datetime" href="javascript:void(0);">
                                                <i class="fas fa-pencil-alt custom-mr-4 small"></i>[`edit`]
                                            </a>

                                            <div class="datetime" style="display: none">
                                                <input class="datepicker small" name="datetime[]" type="text" value="{$post.datetime|wa_date}" size="12">

                                                <input type="text" name="datetime[]" class="time small number" value="{$post.datetime|wa_datetime:'H'}" size="2" maxlength="2" autocomplete="off">:<input type="text" class="time small number" name="datetime[]" value="{$post.datetime|wa_datetime:'i'}" size="2" maxlength="2" autocomplete="off">

                                                <br>
                                                <span class="hint">(<span class="user-date-format"><!-- format placeholder --></span> [`format`], [`current time is`] <span class="current-user-time">{time()|wa_date:'time'}</span>)</span>
                                            </div>

                                            {capture append="dialogs"}
                                                {include file='./../../dialogs/postDelete.html' inline}
                                            {/capture}

                                        {/if}
                                    </div>

                                    <!--  meta and custom parameters -->
                                    <div class="custom-mt-16">
                                        <h6 class="heading">[`Meta`]</h6>
                                        <p class="hint custom-mt-0">
                                            <span id="b-post-edit-meta-title" {if !$post.meta_title}style="display:none;"{/if}>
                                                <span class="gray" >[`Title`]:</span> <span class="val bold text-dark-gray">{$post.meta_title|escape}</span><br>
                                            </span>
                                            <span id="b-post-edit-meta-keywords" {if !$post.meta_keywords}style="display:none;"{/if}>
                                                <span class="gray">[`Meta Keywords`]:</span> <span class="val bold">{$post.meta_keywords|escape}</span><br>
                                            </span>
                                            <span  id="b-post-edit-meta-description" {if !$post.meta_description}style="display:none;"{/if}>
                                                <span class="gray" >[`Meta Description`]:</span> <span class="val bold">{$post.meta_description|escape}</span><br>
                                            </span>
                                            <span id="b-post-edit-custom-params" {if !$params}style="display:none;"{/if}>
                                                {foreach $params as $k => $v}{$k}={$v|escape}<br>{/foreach}
                                            </span>
                                            <span id="b-post-edit-no-meta" {if $post.meta_title || $post.meta_keywords || $post.meta_description || $params}style="display:none;"{/if}>[`No meta parameters are defined for this blog post.`]</span>
                                            <a href="#" id="b-post-edit-custom-params-link" class="nowrap">[`Edit meta`]</a>
                                        </p>
                                        {capture append="dialogs"}
                                            {include file="./../../dialogs/postEditCustomParams.html" inline}
                                        {/capture}
                                    </div>

                                    {* @event backend_post_edit.%plugin_id%.sidebar *}
                                    <!-- plugin hook: "backend_post_edit.*.sidebar" -->
                                    {if isset($backend_post_edit)}
                                        {foreach $backend_post_edit as $plugin => $output}
                                            {if isset($output.sidebar)}
                                                <!-- begin backend.post_edit.{$plugin}.sidebar -->
                                                {$output.sidebar}
                                                <!-- end {$plugin} -->
                                            {/if}
                                        {/foreach}
                                    {/if}
                                    <!-- end plugin hook: "backend_post_edit.*.sidebar" -->
                                </div>
                            </div>
                        </div>
                        {if $post.id}
                        <footer class="drawer-footer">
                            <a href="#{*?module=post&amp;action=delete&amp;id={$post.id*}" class="button red dialog-confirm" id="postdelete-dialog-confirm">
                                <i class="fas fa-trash-alt custom-mr-4"></i> [`Delete post`]
                            </a>
                        </footer>
                        {/if}
                    </div>
                </div>
            </div>

            <div class="b-stream b-single-post">
                <div class="b-stream-title rounded-block custom-px-20 b-post {$blog.color}">

                    <a href="#" id="realtime-preview-toggle" title="[`Mirror mode`]"></a>

                    <div class="flexbox middle wrap space-16" id="blogs-list">
                        <span>[`Blog`]:</span>
                        <div class="b-stream-title-drop dropdown js-b-stream-title-dropdown">
                            <a href="#{$post.blog_id}" class="dropdown-toggle button light-gray current-blog valign-middle nowrap">
                                {if $blogs[$post.blog_id].color == 'b-white' && strpos($blogs[$post.blog_id].icon_html, 'background-image') !== false}
                                    <span class="icon custom-mr-4">
                                        {$blogs[$post.blog_id].icon_html}
                                    </span>
                                {/if}
                                {if $blogs[$post.blog_id].color != 'b-white'}
                                    {$_color = $blogs[$post.blog_id].color|replace:'b-':'icon16 text-'}
                                    <span class="icon custom-mr-4">
                                        {$blogs[$post.blog_id].icon_html|replace:'icon16':$_color}
                                    </span>
                                {/if}

                                <span data-id="{$post.blog_id}">
                                    {$blogs[$post.blog_id].name|escape|truncate:32}
                                </span>
                                {if $blogs[$post.blog_id].status ==  blogBlogModel::STATUS_PRIVATE}
                                    <i class="fas fa-lock smaller custom-ml-4 custom-mt-2 text-light-gray"></i>
                                {/if}
                                <input type="hidden" name="blog_id" value="{$post.blog_id}">
                            </a>

                            <!-- jquery template {capture name="selected-blog-template-js"}{literal} -->
                                {{if blog.color == "b-white" && blog.icon_html.includes("background-image")}}
                                    <span class="icon custom-mr-4">
                                        {{html blog.icon_html}}
                                    </span>
                                {{/if}}
                                {{if blog.color != "b-white"}}
                                    <span class="icon custom-mr-4">
                                        {{html blog.icon_html.replace("icon16", blog.color.replace("b-","icon16 text-"))}}
                                    </span>
                                {{/if}}

                                <span data-id="${blog.id}">
                                    {{if blog.name.length > 32}}${blog.name.substring(0, 29)}...{{else}}${blog.name}{{/if}}
                                </span>
                                {{if (blog.status == '{/literal}{blogBlogModel::STATUS_PRIVATE}{literal}')}}
                                    <i class="fas fa-lock smaller custom-ml-4 custom-mt-2 text-light-gray"></i>
                                {{/if}}
                                <input type="hidden" name="blog_id" value="${blog.id}">
                            <!-- {/literal}{/capture} -->

                            {if $allow_change_blog}
                            <div class="dropdown-body">
                                <ul class="menu">
                                    {foreach $blogs as $id => $blog_}
                                        {if $blog_.rights ge blogRightConfig::RIGHT_READ_WRITE}
                                            <li id="blog-selector-{$id}" class="{if $id eq $blog.id}selected{/if}" data-blog-status="{if $blog_.status == blogBlogModel::STATUS_PRIVATE}private{else}public{/if}">
                                                <a href="#{$id}" class="change-blog">
                                                    {if $blog_.color == 'b-white' && strpos($blog_.icon_html, 'background-image') !== false}
                                                        <span class="icon">
                                                            {$blog_.icon_html}
                                                        </span>
                                                    {/if}
                                                    {if $blog_.color != 'b-white'}
                                                        {$_color = $blog_.color|replace:'b-':'icon16 text-'}
                                                        <span class="icon">
                                                            {$blog_.icon_html|replace:'icon16':$_color}
                                                        </span>
                                                    {/if}

                                                    <span data-id="{$id}">{$blog_.name|escape|truncate:32}</span>
                                                    <span class="count">
                                                        {if $blog_.status ==  blogBlogModel::STATUS_PRIVATE}
                                                            <span class="small">
                                                                <i class="fas fa-lock smaller custom-mx-4 custom-mt-2 text-light-gray"></i>
                                                            </span>
                                                        {/if}
                                                    </span>
                                                </a>
                                            </li>
                                        {/if}
                                    {/foreach}
                                </ul>
                            </div>
                            {/if}
                        </div>
                        <button class="js-show-drawer button light-gray custom-ml-auto" type="button"><i class="fas fa-sliders-h"></i></button>
                    </div>
                </div>
                <div class="b-giant-title b-post {$blog.color}"{if isset($post.id) && $post.id} id="b-post-{$post.id}"{/if} style="position: static;">

                    <input id="post-title" name="title" type="text" value="{$post.title|escape}" class="b-post-title larger bold width-100" maxlength="255" placeholder="[`Post title`]">

                    {* POST URL *}

                    {assign var="is_adding" value = ($post.status == blogPostModel::STATUS_DRAFT && !$post.id)}
                    {assign var="unsuccessful_save" value = (isset($validate_messages.url) && $validate_messages.url)}

                    <p id="post-url-field-no-settlements" class="small hidden no-settlements custom-mb-0">
                        [`Posts of this blog are not visible in the public frontend because there are no routing rules for the Blog app in your website settings. Use Site app (Routing section) to settle Blog app on your website and to start publishing.`]
                    </p>

                    {if !$no_settlements}
                        <div id="post-url-field" {if ($blog.status == blogBlogModel::STATUS_PRIVATE && !$unsuccessful_save) || ($is_adding && $post.title|escape|strlen == 0 && !$unsuccessful_save)}style="display:none;"{/if} class="{if $no_settlements} no-settlements{/if}">
                            {if $post.status == blogPostModel::STATUS_PUBLISHED}
                                <i class="fas fa-check-circle text-green smaller custom-mr-4"></i><span class="small">[`Published`]:
                            {else}
                                <span class="{if $is_adding}small{else}hint{/if}">{if !$is_adding}[`Preview`]:{/if}
                            {/if}
                                    <span id="url-editable" {if $is_adding || $unsuccessful_save}style="display:none;"{/if}>
                                        {$link = $post.link}
                                        {$full_link = "{if $link}{$link|escape}{if $post.url}{$post.url|escape}{/if}/{if isset($preview_hash)}?preview={$preview_hash}{/if}{/if}"}
                                        {$realtime_preview_url = $post.preview_link}
                                        <a id="url-link" class="bold break-word" target="_blank" href="{$full_link}" data-preview-url="{$realtime_preview_url|escape}">{$post.link|escape}<span class="slug">{if $post.url}{$post.url|escape}/{else}<!-- slug placeholder -->{/if}</span></a>
                                        <a id="url-edit-link" href="javascript:void(0);" class="inline-edit custom-ml-8 text-gray nowrap"><i class="fas fa-pencil-alt smaller custom-mr-4"></i>[`edit`]</a>
                                    </span>
                                    <span id="url-edit" {if !$is_adding && !$unsuccessful_save}style="display:none;"{/if}>
                                        <a href="#" id="preview-url" style="display: none">{$post.preview_url|default:''|escape}</a>
                                        {strip}
                                            <span id="pure-url">{$post.link|escape}</span>
                                            <input type="text" id="post-url" name="url" value="{$post.url|escape}" class="bold{if isset($validate_messages) && !empty($validate_messages)} error{/if}">/
                                        {/strip}
                                    </span>
                                </span>

                                <div id="other-urls">
                                    {if isset($post.other_links) && !empty($post.other_links)}
                                        {foreach $post.other_links as $i => $link}
                                            {$full_link = "{if $link}{$link|escape}{if $post.url}{$post.url|escape}{/if}/{if isset($preview_hash)}?preview={$preview_hash}{/if}{/if}"}
                                            {$realtime_preview_url = ifset($post, 'other_preview_links', $i, '')}
                                            {if $post.status == blogPostModel::STATUS_PUBLISHED}
                                                <i class="fas fa-check-circle text-green custom-mr-4"></i>
                                                <span class="small">[`Published`]:
                                                    <a target="_blank" href="{$full_link}" data-preview-url="{$realtime_preview_url|escape}">{$link|escape}<span class="slug">{if $post.url}{$post.url|escape}/{else}<!-- slug placeholder -->{/if}</span>
                                                    </a>
                                                </span>
                                            {elseif $is_adding}
                                                <span class="small">[`Preview`]:
                                                    {$link|escape}<span class="slug">{if $post.url}{$post.url|escape}/{else}<!-- slug placeholder -->{/if}</span>
                                                </span>
                                            {else}
                                                <span class="hint">[`Preview`]:
                                                    <a target="_blank" href="{$full_link}" data-preview-url="{$realtime_preview_url|escape}">{$link|escape}<span class="slug">{if $post.url}{$post.url|escape}/{else}<!-- slug placeholder -->{/if}</span>
                                                    </a>
                                                </span>
                                            {/if}
                                            <br>
                                        {/foreach}
                                    {/if}
                                </div>

                        {if $unsuccessful_save}
                            <div id="message-post-url" class="hint errormsg">{$validate_messages.url}</div>
                        {else}
                            <div id="message-post-url" class="hint"></div>
                        {/if}
                            </div>
                        {/if} {*/$no_settlements*}

                    {* /POST URL *}

                    {* @event backend_post_edit.%plugin_id%.toolbar *}
                    <!-- plugin hook: "backend_post_edit.*.toolbar" -->
                    {if isset($backend_post_edit)}
                        {foreach $backend_post_edit as $plugin => $output}
                            {if isset($output.toolbar)}
                                <!-- begin backend_post_edit.{$plugin}.toolbar -->
                                {$output.toolbar}
                                <!-- end {$plugin} -->
                            {/if}
                        {/foreach}
                    {/if}
                    <!-- end plugin hook: "backend_post_edit.*.toolbar" -->
                </div>{* .b-post *}

                <div class="b-post-editor rounded-block b-post {$blog.color}" id="post-editor">
                    <ul class="tabs small b-post-editor-toggle">
                        <li>
                            <a id="redactor" href="javascript:void(0);">[`Visual`]</a>
                        </li>
                        <li>
                            <a id="ace" href="javascript:void(0);">[`HTML`]</a>
                        </li>

                        {* @event backend_post_edit.%plugin_id%.editor_tab *}
                        <!-- plugin hook: "backend_post_edit.*.editor_tab" -->
                        {if isset($backend_post_edit)}
                            {foreach $backend_post_edit as $plugin => $output}
                                {if isset($output.editor_tab)}
                                    <li>
                                        <!-- begin backend_post_edit.{$plugin}.toolbar -->
                                        {$output.editor_tab}
                                        <!-- end {$plugin} -->
                                    </li>
                                {/if}
                            {/foreach}
                        {/if}
                        <!-- end plugin hook: "backend_post_edit.*.editor_tab"-->

                        {if blogPhotosBridge::isAvailable()}
                            <li>
                                <a id="photo_bridge" href="javascript:void(0);">
                                    [`Photo Album`]
                                    <i class="fas fa-check-circle text-green show-when-album-selected" style="{if empty($post.album_id)}display:none;{/if}"></i>
                                </a>
                            </li>
                        {/if}
                    </ul>
                    <textarea id="post_text" name="text" cols="60" rows="20" style="border:0; display: none;">{$post.text|escape}</textarea>
                    <div class="b-post-editor-wrapper" id="post_text_wrapper">
                        {if blogPhotosBridge::isAvailable()}
                            <div id="blog-photo_bridge-editor" class="box custom-px-20 custom-py-16" style="display: none;">
                                <div class="fields">
                                    <div class="field">
                                        <div class="name">[`Attach photo album`]</div>
                                        <div class="value">
                                            <i class="fas fa-images custom-mr-4"></i>
                                            <select name="album_id">
                                                <option></option>
                                                {function upload_album_menu parent=0 level=0}
                                                    {foreach $albums as $a}
                                                        {if $a.parent_id == $parent}
                                                            <option value="{$a.id}"{if $post.album_id == $a.id} selected{/if} data-frontend-link="{$a.frontend_link|escape}">{strip}
                                                                    {if $parent}{'-'|str_repeat:$level}{*'*}&nbsp;{/if}
                                                                    {$a.name|default:'[`(no name)`]'|escape|truncate:64}{if $a.status != 1} ([`private album`]){/if}
                                                                {/strip}</option>
                                                            {call upload_album_menu parent=$a.id level=($level+1)}
                                                        {/if}
                                                    {/foreach}
                                                {/function}
                                                {call upload_album_menu}
                                            </select>
                                            <p class="hint">[`Photos from the selected album will be automatically embedded after the post content. Photos descriptions and sort order will be defined by Photos app.`]</p>
                                        </div>
                                    </div>
                                    <div class="js-post-url field" style="display: none;">
                                        <div class="name">[`Post URL`]</div>
                                        <div class="value">
                                            <label>
                                                <input type="hidden" name="album_link_type" value="blog">
                                                <input type="checkbox" name="album_link_type" value="photos"{if $post.album_link_type == 'photos'} checked{/if}>
                                                [`Replace with the direct link to this album`]
                                            </label>
                                            <strong id="album-frontend-link" class="hint"></strong>
                                            <p class="hint">[`Great for photo galleries. Blog post will be published in the blog on a regular basis (in both post stream and RSS), but the main post title link will lead to the album page directly (Photos app).`]</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {/if}
                    </div>
                </div> {* #post-editor.b-post-editor *}

            </div> {* .b-single-post *}

            <input type="hidden" id="post-id" name="post_id" value="{$post.id}">



        <link type="text/css" rel="stylesheet" href="{$wa_url}wa-content/js/elrte/elrte.min.css">
        <link type="text/css" rel="stylesheet" href="{$wa_url}wa-content/js/elrte/elrte-wa.css">
        <script>
            $.wa.locale['Post cut'] = "[`Post cut (Continue reading &rarr;)`]";
            $.wa.locale['Image will be uploaded into'] = "[`Image will be uploaded into`]";
        </script>
        {assign var=lang value=substr($wa->locale(), 0, 2)}
        <script src="{$wa_url}wa-content/js/jquery-ui/jquery.ui.datepicker.min.js"></script>
        <script src="{$wa_url}wa-content/js/jquery-ui/jquery.ui.draggable.min.js"></script>
        <link type="text/css" rel="stylesheet" href="{$wa_url}wa-content/css/jquery-ui/jquery-ui-1.7.2.custom.css">

        {if $lang!='en'}
            <script src="{$wa_url}wa-content/js/jquery-ui/i18n/jquery.ui.datepicker-{$wa->locale()}.js"></script>
        {/if}

        {* REDACTOR (WYSIWYG) *}
        <link type="text/css" rel="stylesheet" href="{$wa_url}wa-content/js/redactor/2/redactor.css?v{$wa->version(true)}">
        {* CUT PLUGIN *}
        <script src="{$wa_app_static_url}js/redactor_plugins.js?v{$wa->version()}"></script>
        <script src="{$wa_url}wa-content/js/redactor/2/redactor.min.js?v{$wa->version(true)}"></script>
        {if substr($wa->locale(), 0, 2)!='en'}
            <script src="{$wa_url}wa-content/js/redactor/2/{substr($wa->locale(), 0, 2)}.js?v{$wa->version(true)}"></script>
        {/if}
        {* ACE *}
        <script src="{$wa_url}wa-content/js/ace/ace.js?v{$wa->version(true)}"></script>
        <script src="{$wa_url}wa-content/js/elrte/elrte.min.js"></script>
        {if $lang!='en'}
            <script src="{$wa_url}wa-content/js/elrte/i18n/elrte.{$lang}.js"></script>
        {/if}
        <script src="{$wa_url}wa-content/js/elrte/elrte-wa.js"></script>

        {wa_js file="js/blog-post-edit.min.js"}
        {$wa_app_static_url}js/postmessage.js
        {$wa_app_static_url}js/postEdit.js
        {/wa_js}

        <script>
            $(".js-b-stream-title-dropdown").waDropdown({
                hover: false,
            });

            var wa_url = "{$wa_url}";
            var wa_lang = "{$lang}";
            var wa_img_upload_path = "{$wa->blog->dataUrl('img')}";
            $.wa.locale = $.extend($.wa.locale, {
                "Upload": "[`Upload`]",
                "Select from Photos app": "[`Select from Photos app`]",
                "Insert": "[`Insert`]",
                "Total photos selected:": "[`Total photos selected:`]",
                "Photos from the attached album will be displayed here.":"[`Photos from the attached album will be displayed here.`]",
                'input_maxlength':{json_encode('[`Max %d characters`]')},
                "Confirm": "[`Confirm`]",
                "Cancel": "[`Cancel`]",
                "Ok": "[`OK`]",
            });
            $.wa_blog_options = $.extend(true, $.wa_blog_options, {
                'photos_bridge_available': {json_encode(blogPhotosBridge::isAvailable())},
                'editor': {
                    'blogs':{json_encode($blogs)},
                    'current_blog_id':{$blog.id},
                    'editor_id':'post_text',
                    'wa_url':"{$wa_url}",
                    'wa_app_static_url':"{$wa_app_static_url}",
                    'cut_link_label_default': "[`Continue reading â†’`]",
                    'version':'{$wa->version()}'
                }
            });

            $('#post_text').data('uploadFields', {
                '_csrf': "{waRequest::cookie('_csrf', '')}"
            });

            const $drawer = $(".js-drawer")
            $(".js-show-drawer").on("click", function() {
                $.waDrawer({
                    $wrapper: $drawer,
                    direction: "right",
                    width: '22rem',
                    lock_body_scroll: false,
                    append_to: '#post-form',
                    onOpen($drawer){
                        commentSwitch($drawer);
                    },
                    onClose(){
                        onClose && onClose.apply(this);
                        return false;
                    },
                    onBgClick() {
                        onClose && onClose.apply(this);
                        return false;
                    }
                });
            });

            function onClose() {
                this.$wrapper.addClass(this.hide_class);

                setTimeout( () => {
                    this.is_visible = false;
                    this.$wrapper.hide();

                }, this.animation_time);
            }

            function commentSwitch($drawer) {
                $drawer.find("#allow-comment-switch").waSwitch({
                    ready(wa_switch) {
                        let $label = wa_switch.$wrapper.siblings('label');
                        wa_switch.$label = $label;
                        wa_switch.active_text = $label.data('active-text');
                        wa_switch.inactive_text = $label.data('inactive-text');

                        if (wa_switch.is_active) {
                            $label.text(wa_switch.active_text);
                        } else {
                            $label.text(wa_switch.inactive_text);
                        }
                    },
                    change(active, wa_switch) {
                        wa_switch.$label.text(active ? wa_switch.active_text : wa_switch.inactive_text);
                    }
                });
            }


            {if waRequest::request('realtime_on')}
            $(function() {
                $('#realtime-preview-toggle').click();
            });
            {/if}
        </script>

        {foreach $smarty.capture as $name => $template}
            {if strpos($name,'template-js')}
                <script type="text/x-jquery-tmpl" id="{$name}">
                    <!-- begin {$name} {$template|replace:'</':'<\/'} end {$name} -->
                </script>
            {/if}
        {/foreach}
    </div>
</div>
<div class="bottombar sticky flexbox middle space-16 b-post {$blog.color}" id="buttons-bar">
    <div class="article wide custom-py-0">
        <div class="article-body custom-py-0">
            {if ($post.status eq blogPostModel::STATUS_DRAFT) || ($post.status eq blogPostModel::STATUS_DEADLINE)}
                <div id="b-post-draft-settings" class="flexbox middle">
                    {if ($allow_change_blog > 1) && ($post.status neq blogPostModel::STATUS_PUBLISHED)}
                        <input id="postpublish-edit" type="button" class="button blue dialog-edit" value="[`Publish`]" >
                        {capture append="dialogs"}
                            {include file='./../../dialogs/postPublish.html' inline}
                        {/capture}
                    {else}
                        <input id="b-post-save-button" type="button" class="button blue" name="published" value="[`Publish`]" >
                    {/if}
                    <button id="b-post-save-draft-button" type="submit" class="button gray" name="{if $post.status eq blogPostModel::STATUS_DEADLINE}deadline{else}draft{/if}"><i class="fas fa-edit"></i><span class="desktop-only custom-ml-4" style="pointer-events: none;">[`Save draft`]</span></button>
                    <span class="hint desktop-only">Ctrl+S</span>
                    <span id="form-status">
                        <span id="saved-status" style="display: none;">
                            <i class="fas fa-check-circle text-green b-post-save-indicator custom-ml-8 custom-mr-4"></i>[`Saved`]
                        </span>
                        <span id="loading-status" style="display: none;">
                            <i class="fas fa-spin fa-spinner b-post-save-indicator custom-ml-8"></i>
                        </span>
                    </span>
                    <a id="schedule-edit" href="javascript:void(0);" class="button light-gray outlined dialog-edit custom-ml-auto">
                        <i class="fas fa-clock"></i>
                        <span class="desktop-only custom-ml-4" style="pointer-events: none;">[`Schedule publication`]</span>
                    </a>
                </div>
                {capture append="dialogs"}
                    {include file='./../../dialogs/postSchedule.html' inline}
                {/capture}
            {else}
                <div id="b-post-public-settings" class="flexbox middle space-12">
                    <input id="b-post-save-button" type="button" class="button blue" name="{if $post.status eq blogPostModel::STATUS_SCHEDULED}scheduled{else}published{/if}" value="[`Save`]" >
                    <span class="hint">Ctrl+S</span>
                    <span id="form-status" >
                        <span id="saved-status" class="nowrap" style="display: none;">
                            <i class="fas fa-check-circle text-green b-post-save-indicator custom-ml-8 custom-mr-4"></i>[`Saved`]
                        </span>
                        <span id="loading-status" style="display: none;">
                            <i class="fas fa-spin fa-spinner b-post-save-indicator custom-ml-8"></i>
                        </span>
                    </span>

                    {if $post.status != blogPostModel::STATUS_PUBLISHED}
                        <div class="custom-ml-auto custom-mb-0 alert info smaller desktop-and-tablet-only">
                            <i class="fas fa-clock"></i>
                            [`Autopublication is scheduled for`]
                            <strong>{$post.datetime|wa_datetime:'humandatetime'}</strong>
                            <span class="small">({$post.remaining_time})</span>
                        </div>
                        <div class="custom-ml-auto custom-mb-0 mobile-only">
                            <span id="tooltip-autopublication" data-wa-tooltip-template="#template-autopublication">
                                <i class="fas fa-clock text-yellow"></i>
                            </span>

                            <div class="wa-tooltip-template" id="template-autopublication">
                                [`Autopublication is scheduled for`]
                                <strong>{$post.datetime|wa_datetime:'humandatetime'}</strong>
                                <span class="small">({$post.remaining_time})</span>
                            </div>

                            <script>
                                ( function($) {
                                    $("#tooltip-autopublication").waTooltip();
                                })(jQuery);
                            </script>
                        </div>
                    {/if}

                    <a name="unpublish" href="#unpublish" class="js-submit button gray outlined custom-ml-auto nowrap" title="[`Unpublish this blog post?`]">
                        <i class="fas fa-times-circle custom-mr-4"></i>
                        <span class="desktop-only" style="pointer-events: none;">[`Unpublish`]</span>
                    </a>
                </div>
                {capture append="dialogs"}
                    {include file='./../../dialogs/postDelete.html' inline}
                {/capture}
            {/if}
        </div>
    </div>
</div>
    {if isset($dialogs)}
        <!-- dialog begin -->
        {foreach $dialogs as $dialog}
            {$dialog}
        {/foreach}
        <!-- dialog end -->
    {/if}
</form>
