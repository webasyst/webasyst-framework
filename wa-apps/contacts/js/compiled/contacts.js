var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(c,d,a){c instanceof String&&(c=String(c));for(var b=c.length,e=0;e<b;e++){var f=c[e];if(d.call(a,f,e,c))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,d,a){if(c==Array.prototype||c==Object.prototype)return c;c[d]=a.value;return c};$jscomp.getGlobal=function(c){c=["object"==typeof globalThis&&globalThis,c,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var d=0;d<c.length;++d){var a=c[d];if(a&&a.Math==Math)return a}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(c,d){var a=$jscomp.propertyToPolyfillSymbol[d];if(null==a)return c[d];a=c[a];return void 0!==a?a:c[d]};
$jscomp.polyfill=function(c,d,a,b){d&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(c,d,a,b):$jscomp.polyfillUnisolated(c,d,a,b))};$jscomp.polyfillUnisolated=function(c,d,a,b){a=$jscomp.global;c=c.split(".");for(b=0;b<c.length-1;b++){var e=c[b];if(!(e in a))return;a=a[e]}c=c[c.length-1];b=a[c];d=d(b);d!=b&&null!=d&&$jscomp.defineProperty(a,c,{configurable:!0,writable:!0,value:d})};
$jscomp.polyfillIsolated=function(c,d,a,b){var e=c.split(".");c=1===e.length;b=e[0];b=!c&&b in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var g=e[f];if(!(g in b))return;b=b[g]}e=e[e.length-1];a=$jscomp.IS_SYMBOL_NATIVE&&"es6"===a?b[e]:null;d=d(a);null!=d&&(c?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:d}):d!==a&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&(a=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+a+"$"+e),$jscomp.defineProperty(b,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:d})))};$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(d,a){return $jscomp.findInternal(this,d,a).v}},"es6","es3");
(function(c){c.wa.controller={free:!0,hashes:[],init:function(d){this.frontend_url=d&&d.url||"/";this.backend_url=d&&d.backend_url||"/webasyst/";this.wa_app_url=d.wa_app_url||"";c.storage=new c.store;c.ajaxSetup({cache:!1});this.lastView={title:null,hash:null,sort:null,order:null,offset:null};this.options=d;this.random=null;c.wa.dropdownsCloseEnable();"undefined"!=typeof c.History&&c.History.bind(function(e){c.wa.controller.dispatch(e)});c.wa.errorHandler=function(e){return 404==e.status?(c.wa.setHash("/contacts/all/"),
!1):!0};c("#contacts-container .contacts-data input.selector").live("click",function(){c(this).is(":radio")&&c(this).parents(".contact-row").siblings().removeClass("selected");c(this).is(":checked")?c(this).parents(".contact-row").addClass("selected"):c(this).parents(".contact-row").removeClass("selected");c.wa.controller.updateSelectedCount()});c(".collapse-handler",c("#wa-app")).die("click").live("click",function(){c.wa.controller.collapseSidebarSection(this,"toggle")});this.restoreCollapsibleStatusInSidebar();
c("ul.collapsible i.darr").click(function(){c(this).hasClass("darr")?(c(this).parent("li").children("ul").hide(),c(this).removeClass("darr").addClass("rarr")):(c(this).parent("li").children("ul").show(),c(this).removeClass("rarr").addClass("darr"))});var a=null,b=function(e){if(e.hasClass("animated"))return!1;e.addClass("animated");e.hoverIntent({over:function(){a=setTimeout(function(){a=null},500);e.removeClass("disabled")},timeout:.3,out:function(){e.addClass("disabled");a&&(clearTimeout(a),a=null)}});
return!0};c("#c-list-toolbar-menu",c("#c-core")[0]).live("mouseover",function(){var e=c(this);b(e)&&e.mouseover()});c("#c-list-toolbar-menu",c("#c-core")[0]).live("click",function(e){var f=c(this);a&&!f.hasClass("disabled")||0<c(e.target).parents("ul#c-list-toolbar-menu ul").size()||(f.toggleClass("disabled"),!b(f)&&a&&(clearTimeout(a),a=null))});c(document).ajaxError(function(){c.storage.del("contacts/last-hash")});c("#c-core").off("click.contact-choose",".contact-row a.contact").on("click.contact-choose",
".contact-row a.contact",function(){c.wa.controller.setLastView({offset:c(this).data("offset")||0,sort:c.wa.grid.settings.sort,order:c.wa.grid.settings.order,title:c.wa.controller.getTitle(),hash:location.hash||""})});c("#c-core").off("click.contact-choose","a.contact.next, a.contact.prev").on("click.contact-choose","a.contact.next, a.contact.prev",function(){c.wa.controller.setLastView({offset:c(this).data("offset")||0})})},stopDispatch:function(d,a){this.stopDispatchIndex=d},previousHash:null,redispatch:function(){this.previousHash=
null;this.dispatch()},dispatch:function(d,a){d=void 0===d?this.getHash():this.cleanHash(d);var b=d.replace(/^[^#]*#\/*/,""),e=(this.previousHash||"").replace(/^[^#]*#\/*/,"");b!==e&&this.hashes.unshift(d.replace(/^[^#]*#\/*/,""));10<this.hashes.length&&this.hashes.pop();if(0<this.stopDispatchIndex)return this.previousHash=d,this.stopDispatchIndex--,!1;if(this.previousHash!=d){b=this.previousHash;this.previousHash=d;e=new c.Event("wa_before_dispatched");c(window).trigger(e,[d]);if(e.isDefaultPrevented())return this.previousHash=
b,window.location.hash=b,!1;if(d=d.replace(/^[^#]*#\/*/,"")){e=!0;d=d.replace(/\\\//g,"ESCAPED_SLASH");d=d.split("/");for(var f=0;f<d.length;f+=1)d[f]=d[f].replace(/ESCAPED_SLASH/g,"/");if(d[0]){var g="",h=d.length;for(f=0;f<d.length;f++)if(b=d[f],2>f)if(0===f)g=b;else if(parseInt(b,10)!=b&&-1==b.indexOf("."))g+=b.substr(0,1).toUpperCase()+b.substr(1);else{h=f;break}else{h=f;break}b=d.slice(h);this[g+"Action"]?(this.currentAction=g,this.currentActionAttr=b,this[g+"Action"].apply(this,[].concat([b],
a||[]))):(e=!1,console&&console.log("Invalid action name:",g+"Action"),c.wa.setHash("#/contacts/all/"))}else this.defaultAction();d.join&&(d=d.join("/"));e&&c.storage.set("contacts/last-hash",d)}else this.defaultAction(),c.storage.del("contacts/last-hash");this.highlightSidebar();c(document).trigger("hashchange",[d]);c(window).trigger("wa-dispatched")}},lastPage:function(){var d=c.storage.get("contacts/last-hash");d?c.wa.setHash("#/"+d):this.defaultAction()},defaultAction:function(){this.contactsAllAction()},
groupsCreateAction:function(d){this.current_group_id=0;this.groupsEditAction(d,$_("New user group"))},groupsEditAction:function(d,a){a=$_("New user group");d[0]&&(this.current_group_id=d[0],a=this.groups[this.current_group_id].name);c("#c-users-sidebar-menu").length?this.showLoading():this.setBlock("contacts-users",a);this.setTitle(a);this.load("#c-core .c-core-content","?module=groups&action=editor"+(d&&d[0]?"&id="+d[0]:""),null,null,function(){this.setTitle(a);c("#c-group-edit-name").focus();c(".wa-page-heading .loading").hide();
c("#c-users-sidebar-menu li.selected").removeClass("selected");d&&d[0]?c("#list-group li[rel=group"+d[0]+"]").addClass("selected"):c("#c-create-group-toggle").addClass("selected")})},categoriesCreateAction:function(d){this.categoriesEditAction()},categoriesEditAction:function(d){this.loadHTML("?module=categories&action=editor"+(d&&d[0]?"&id="+d[0]:""),null,function(){this.setBlock()})},categoriesDeleteAction:function(d){var a=!0;d&&d[0]||(d=[this.current_category_id],a=!1);c.wa.dialogCreate("delete-dialog",
{content:c("<h2>"+$_("Delete this category?")+"</h2><p>"+$_("No contacts will be deleted.")+"</p>"),buttons:c("<div></div>").append(c('<input type="submit" class="button red" value="'+$_("Delete category")+'">').click(function(){0>=c(this).find(".loading").size()&&c('<i style="margin: 8px 0 0 10px" class="icon16 loading"></i>').insertAfter(this);c.post("?module=categories&action=delete",{id:d[0]},function(){c.wa.controller.reloadSidebar();c.wa.dialogHide();c.wa.setHash("#/users/all/")})})).append(" "+
$_("or")+" ").append(c('<a href="javascript:void(0)">'+$_("cancel")+"</a>").click(function(){c.wa.dialogHide();a&&(c.wa.controller.stopDispatch(1),c.wa.back())})),small:!0});return!1},deleteCustomField:function(d){c('.custom-field-th[data-field-id="'+d+'"]').remove();c('.custom-field-td[data-field-id="'+d+'"]').remove();if(c(".custom-field-th").length){d=["first","last"];for(var a=0;a<d.length;a+=1){var b=d[a],e=c(".custom-field-th."+b);e.length||(e.removeClass(b),c(".custom-field-td."+b).removeClass(b),
c(".custom-field-th:"+b).addClass(b),c(".contact-row").each(function(){c(this).find(".custom-field-td:"+b).addClass(b)}))}}else c(".with-custom-fields").removeClass("with-custom-fields"),c(".list-with-custom-fields").removeClass("list-with-custom-fields")},contactsGroupAction:function(d){if(d&&d[0]){var a=this.parseParams(d.slice(1),"contacts/group/"+d[0]);a.fields=["name","email","company","_access"];a.query="group/"+d[0];c(".wa-page-heading").css({width:""});this.loadGrid(a,"/contacts/group/"+d[0]+
"/",!1,{beforeLoad:function(b){this.current_group_id=d[0];if(0<b.count)this.setBlock("contacts-users",null,["group-settings","group-actions"]);else return this.setBlock("contacts-users",null,"group-settings"),c("#contacts-container").html('<div class="block double-padded" style="margin-top: 35px;"><p>'+$_("No users in this group.")+"</p> <p>"+$_('To add users to group, go to <a href="#/users/all/">All users</a>, select them, and click <strong>Actions with selected / Add to group</strong>.')+"</p></div>"),
!1},afterLoad:function(b){c('#list-group li[rel="group'+d[0]+'"]').children("span.count").html(b.count)}})}},groupsDeleteAction:function(d){var a=!0;d&&d[0]||(d=[this.current_group_id],a=!1);c.wa.dialogCreate("delete-dialog",{content:c("<h2>"+$_("Delete this group?")+"</h2><p>"+$_("No contacts will be deleted.")+"</p>"),buttons:c("<div></div>").append(c('<input type="submit" class="button red" value="'+$_("Delete group")+'">').click(function(){c('<i style="margin: 8px 0 0 10px" class="icon16 loading"></i>').insertAfter(this);
c.post("?module=groups&action=delete",{id:d[0]},function(){c('#wa-app .sidebar a[href="#/contacts/group/'+d[0]+'/"]').parent().remove();0>=c("#list-group").find(".c-group").length&&c("#list-group").find(".c-shown-on-no-groups").show();delete c.wa.controller.groups[d[0]];c.wa.dialogHide();c.wa.setHash("#/users/all/")})})).append(" "+$_("or")+" ").append(c('<a href="javascript:void(0)">'+$_("cancel")+"</a>").click(function(){c.wa.dialogHide();a&&(c.wa.controller.stopDispatch(1),c.wa.back())})),small:!0});
return!1},contactsAddAction:function(d){this.setBlock("contacts-info");this.load(c("#c-core .c-core-content"),"?module=contacts&action=add"+(d&&d[0]?"&company=1":""),{},null,function(){c.wa.controller.setTitle($_("New contact"),!0);c.wa.controller.clearLastView()})},contactAction:function(d){var a={};d[1]&&(a={tab:d[1]});this.lastView&&null!==this.lastView.hash&&(a.last_hash=this.lastView.hash,a.sort=this.lastView.sort,a.offset=this.lastView.offset);this.showLoading();this.load("#c-core","?module=contacts&action=info&id="+
d[0],a,function(){this.setBlock("contacts-info")})},contactPhotoAction:function(d){this.showLoading();this.loadHTML("?module=photo&action=editor&id="+d[0]+(d[1]?"&uploaded=1":""),{},function(){this.setBlock("contacts-info")})},contactsAllAction:function(d){this.showLoading();this.loadGrid(this.parseParams(d,"contacts/all"),"/contacts/all/",!1,{beforeLoad:function(){this.setBlock("contacts-list")},afterLoad:function(a){c("#sb-all-contacts-li span.count").html(a.count)}})},contactsSearchAction:function(d,
a){this.showLoading();"results"==d[0]&&(a||(a={search:!0}),d=d.slice(1));var b=d[0];"?"==b.substr(0,1)&&(b=b.substr(1));var e=this.parseParams(d.slice(1),"contacts/search/"+b);e.query=b;a&&a.search&&(e.search=1);d[5]||(e.view="list");c.wa.controller.setBlock("contacts-list",null,["search-actions"]);b=b||"";0<=b.indexOf("/")&&(b=b.replace("/","\\/"));this.loadGrid(e,"/contacts/search/"+(b?b+"/":""),null,{afterLoad:function(f){c.wa.controller.hideLoading();a&&a.search&&(c("#list-main .item-search").show(),
c("#list-main .item-search a").attr("href","#/contacts/search/results/"+d[0]+"/"),e.search=1)}})},contactsCategoryAction:function(d){if(d&&d[0]){this.showLoading();var a=this.parseParams(d.slice(1),"contacts/category/"+d[0]);a.query="/category/"+d[0];this.loadGrid(a,"/contacts/category/"+d[0]+"/",!1,{beforeLoad:function(b){this.current_category_id=d[0];this.setBlock("contacts-list",null,b&&b.system_category?[]:["category-actions"])},afterLoad:function(b){c('#list-category li[rel="category'+d[0]+'"]').children("span.count").html(b.count)}})}},
usersAllAction:function(d){this.showLoading();d=this.parseParams(d,"users/all");d.query="/users/all/";d.fields=["name","email","company","_access"];this.loadGrid(d,"/users/all/",!1,{beforeLoad:function(){this.setBlock("contacts-users",$_("All users"),["group-actions"])},afterLoad:function(a){c("#sb-all-users-li span.count").html(a.count);c("#c-core .sidebar ul.stack li:first").addClass("selected")}})},usersAddAction:function(d){this.checkAdminRights(function(){this.setBlock("contacts-users",$_("New user"),
!1);this.setTitle($_("New user"));c(".wa-page-heading").find(".loading").hide();c(".contacts-data").html('<div class="block double-padded"><p>'+$_("You can grant access to your account backend to any existing contact.")+"<br><br>"+$_('Find a contact, or <a href="#/contacts/add/">create a new contact</a>, and then customize their access rights on Access tab.')+"</p></div>")})},addToGroupDialog:function(){if(0>=c.wa.grid.getSelected().length)return!1;c.wa.controller.last_selected=c.wa.grid.getSelected();
c.wa.dialogCreate("c-d-add-to-group",{url:"?module=groups&action=add"})},addToGroup:function(d){c.post("?module=groups&action=contactSave",{"id[]":c.wa.grid.getSelected(),"groups[]":d||[]},function(a){c.wa.controller.last_selected=[];"ok"===a.status?(c.wa.controller.updateGroupCounters(a.data.counters||{}),c.wa.controller.afterInitHTML=function(){c.wa.controller.showMessage(a.data.message,!0,"float-left max-width")},c.wa.controller.redispatch(),c.wa.dialogHide(),c.wa.grid.selectItems(c("#c-select-all-items").attr("checked",
!1))):c.wa.controller.showMessage(a.data.message)},"json")},updateGroupCounters:function(d){if(!c.isEmptyObject(d))for(var a in d)if(d.hasOwnProperty(a)){var b=d[a]||0;c("#list-group").find("li[rel=group"+a+"] .count").text(b);this.groups[a]&&(this.groups[a].cnt=b)}},merge:function(){var d=c.wa.grid.getSelected();if(2>d.length)return!1;d=d.join(",");c.wa.setHash("/contacts/merge/"+d)},contactsMergeAction:function(d){if(d[0]){var a=[];d=d[0].split(",");for(var b=0;b<d.length;b+=1)parseInt(d[b],10)&&
a.push(d[b]);c("#c-abc-index").remove();this.showLoading();this.load("#c-core .c-core-content","?module=contacts&action=mergeSelectMaster",{ids:a},null,function(){c(window).unbind("wa_after_merge_contacts").one("wa_after_merge_contacts",function(e,f){f&&"ok"===f.status&&(c(window).one("wa_after_load",function(){c.wa.controller.showMessage(f.data.message)}),c.wa.setHash("#/contact/"+f.data.master.id))});c(window).unbind("wa_cancel_merge_contacts").one("wa_cancel_merge_contacts",function(e){e=c.wa.controller.hashes;
e[1]?c.wa.setHash(e[1]):c.wa.setHash("")})})}else c.wa.setHash("/contacts/all/")},simpleSearch:function(){var d=c.trim(c("#search-text").val());d&&(d=d.replace(/\//g,"\\/").replace(/&/,"\\&"),d=-1!=d.indexOf("@")?"email*="+d:"name*="+d,c.wa.controller.stopDispatch(1),c.wa.setHash("#/contacts/search/"+d+"/"),c.wa.controller.contactsSearchAction([d],{search:!0}))},addToCategory:function(d,a){a=a||c.wa.grid.getSelected();c.wa.controller.showMessage("",!0);a.length&&d&&c.post("?module=categories&type=add",
{contacts:a,categories:d},function(b){if(b.data&&b.data.count)for(var e in b.data.count)c('#list-category li[rel="category'+e+'"] span.count').html(b.data.count[e]);c.wa.controller.showMessage(b.data.message,!0)},"json")},dialogAddSelectedToCategory:function(){0>=c.wa.grid.getSelected().length||0>=c("#list-category li:not(.empty):not(.selected):not(.hint)").size()||c('<div id="add-to-category-dialog"></div>').waDialog({url:"?module=categories&action=addSelected"+(this.current_category_id?"&disabled="+
this.current_category_id:"")})},dialogRemoveSelectedFromCategory:function(d){d=d||c.wa.grid.getSelected();0>=d.length||!c.wa.controller.current_category_id||c('<div id="confirm-remove-from-category-dialog" class="small"></div>').waDialog({content:c("<h2></h2>").text($_('Exclude contacts from category "%s"?').replace("%s",c("h1.wa-page-heading").text())),buttons:c("<div></div>").append(c('<input type="submit" class="button red" value="'+$_("Exclude")+'">').click(function(){c('<i style="margin: 8px 0 0 10px" class="icon16 loading"></i>').insertAfter(this);
c.post("?module=categories&action=deleteFrom",{categories:[c.wa.controller.current_category_id],contacts:d},function(a){c.wa.dialogHide();"ok"===a.status&&(c.wa.controller.afterInitHTML=function(){c.wa.controller.showMessage(a.data.message)},c.wa.controller.redispatch())},"json")})).append(" "+$_("or")+" ").append(c('<a href="javascript:void(0)">'+$_("cancel")+"</a>").click(c.wa.dialogHide))})},dialogRemoveSelectedFromGroup:function(d){d=d||c.wa.grid.getSelected();0>=d.length||!c.wa.controller.current_group_id||
c('<div id="confirm-remove-from-category-dialog" class="small"></div>').waDialog({content:c("<h2></h2>").text($_('Exclude users from group "%s"?').replace("%s",c("h1.wa-page-heading").text())),buttons:c("<div></div>").append(c('<input type="submit" class="button red" value="'+$_("Exclude")+'">').click(function(){c('<i style="margin: 8px 0 0 10px" class="icon16 loading"></i>').insertAfter(this);c.post("?module=groups&action=deleteFrom",{groups:[c.wa.controller.current_group_id],contacts:d},function(a){c.wa.dialogHide();
"ok"===a.status&&(c.wa.controller.updateGroupCounters(a.data.counters||{}),c.wa.controller.afterInitHTML=function(){c.wa.controller.showMessage(a.data.message,null)},c.wa.controller.redispatch())},"json")})).append(" "+$_("or")+" ").append(c('<a href="javascript:void(0)">'+$_("cancel")+"</a>").click(c.wa.dialogHide))})},contactsDelete:function(d){d=d||c.wa.grid.getSelected();0>=d.length||c.wa.dialogCreate("delete-dialog",{content:"<h2>"+$_("Checking links to other applications...")+' <i class="icon16 loading"></i></h2>',
url:(this.wa_app_url||"")+"?module=contacts&action=links",small:!0,post:{"id[]":d}})},listTabs:[],addListTab:function(d){this.listTabs.push(d)},addGroup:function(d){c.isEmptyObject(d)||(c.wa.controller.groups[d.id]=d,c("#list-group").replaceWith(this.renderGroups(c.wa.controller.groups)))},renderGroups:function(d){var a='<ul class="menu-v with-icons collapsible" id="list-group"><li class="hint c-shown-on-no-groups" style="padding:0 20px; '+((c.isEmptyObject(d)?"":"display: none;")+'">'+$_("User groups are for organizing Webasyst users and setting common access rights for groups.")+
"</li>");if(!c.isEmptyObject(d)){var b=[];for(e in d)d.hasOwnProperty(e)&&b.push(d[e]);b=b.sort(function(g,h){return g.name.toString().localeCompare(h.name.toString())});var e=0;for(d=b.length;e<d;e+=1){var f=b[e];a+='<li rel="group'+f.id+'" class="c-group">';a+='<span class="count">'+f.cnt+"</span>";a+='<a href="#/contacts/group/'+f.id+'/"><img src="../../wa-content/img/users/'+f.icon+'.png"> <b class="name">'+f.name+"</b></a>";a+="</li>"}}return a+"</ul>"},updateGroup:function(d,a){this.groups[d]=
a;c("#list-group").find("li[rel=group"+d+"]").html('<span class="count">'+a.cnt+'</span><a href="#/contacts/group/'+a.id+'"><img src="../../wa-content/img/users/'+a.icon+'.png"> <b>'+a.name+"</b></a>")},checkAdminRights:function(d,a){c.get("?module=contacts&action=user&a=is_admin",function(){d.call(void 0===a?c.wa.controller:a)})},setBlock:function(d,a,b,e){d||(d="default");if(void 0===a||null===a)a=$_("Loading...");var f=this.block;this.block=d;c("#c-core .c-core-header").remove();e=e||{};b="undefined"===
typeof b?[]:b;var g="";"contacts-users"===d?(g=c("#c-core .c-core-content"),g="",!1!==e.groups&&(g+=c.wa.controller.renderGroups(e.groups||c.wa.controller.groups)),c("#c-core").html('<div class="shadowed" id="c-users-page"><div class="sidebar left200px" style="min-height: 300px;"><ul class="menu-v with-icons stack" id="c-users-sidebar-menu"><li class="selected" style="margin-left: 17px;"><a class="" href="#/users/all/"><i class="icon16 user"></i>'+$_("All users")+'</a></li><li style="margin-left: 15px;"><a class="small" href="#/users/add/"><i class="icon10 add"></i>'+
$_("New user")+'</a></li><li class="" style="text-transform: uppercase;"><h5 class="heading">'+$_("Groups")+"</h5></li>"+g+'<li class="small" id="c-create-group-toggle" style="margin-left: 14px;"><a href="#/groups/create/"><i class="icon10 add"></i>'+$_("New group")+'</a></li></ul></div><div class="content left200px bordered-left blank"><div class="block not-padded c-core-content"><div class="block" style="overflow:hidden;"><div class="c-actions-wrapper float-right" style="margin: 8px;"></div><h1 class="wa-page-heading">'+
(a||$_("All users"))+' <i class="icon16 loading"></i></h1></div><div class="block not-padded tab-content float-left" style="width: 100%;" id="contacts-container"><div class="block not-padded contacts-data"></div></div></div><div class="clear"></div></div><div class="clear"></div></div>'),g=c("#c-core .c-core-content"),c("#c-create-group-toggle").click(function(){c.wa.controller.last_selected=[]}),c.isArray(b)?c.wa.controller.showMenus(b):g.find(".c-list-toolbar").remove()):(g=c("#c-core").empty().append(c('<div class="contacts-background"><div class="block not-padded c-core-content"></div></div>')).find(".c-core-content"),
g.html('<div class="block"><div class="c-actions-wrapper"></div><h1 class="wa-page-heading">'+a+' <i class="icon16 loading"></i></h1></div>'));c.scrollTo(0);b&&0<=b.indexOf("group-settings")&&this.current_group_id?g.find(".c-actions-wrapper").html('<a href="#/groups/edit/'+this.current_group_id+'/"><i class="icon16 settings"></i></a>'):b&&0<=b.indexOf("category-actions")&&this.current_category_id&&this.global_admin?g.find("div.block").prepend('<ul class="menu-h c-actions"><li><a href="#/categories/edit/'+
this.current_category_id+'/"><i class="icon16 edit"></i>'+$_("Edit category")+'</a></li><li><a href="#/categories/delete/'+this.current_category_id+'/" onclick="return $.wa.controller.categoriesDeleteAction();"><i class="icon16 delete"></i>'+$_("Delete")+"</a></li></ul>"):b&&0<=b.indexOf("search-actions")&&!this.free?g.find("div.block").prepend('<ul class="menu-h c-actions"><li><a href="#" onclick="return $.wa.controller.saveSearchAsFilter()"><i class="icon16 save-as-filter"></i>'+$_("Save as a filter")+
"</a></li></ul>"):b&&0<=b.indexOf("view-actions")&&this.current_view_id&&g.find("div.block").prepend('<ul class="menu-h c-actions"><li><a href="#/filters/edit/'+this.current_view_id+'/"><i class="icon16 edit"></i>'+$_("Edit filter")+'</a></li><li><a href="#" onclick="return $.wa.controller.deleteList('+this.current_view_id+', true)"><i class="icon16 delete"></i>'+$_("Delete")+"</a></li></ul>");switch(d){case "contacts-duplicates":case "contacts-list":if(0<this.listTabs.length){e=c('<ul class="tabs" id="c-list-tabs"></ul>');
f=(c("#wa-app .sidebar .selected a").attr("href")||"").replace(/^[^#]*#/g,"");"/"!==f[0]&&(f="/"+f);for(var h=0;h<this.listTabs.length;h++)"function"==typeof this.listTabs[h]&&this.listTabs[h].call(c.wa.controller,e,f);0<e.children().size()&&(e.prepend(c('<li class="selected"></li>').append(c('<a href="#'+f+'">'+$_("Contacts")+"</a>").click(function(){c("#c-list-tabs .selected").removeClass("selected");c(this).parent().addClass("selected");c.wa.controller.showLoading();return!0}))),g.append(e))}g.append('<div id="contacts-container" class="tab-content"></div>');
g.next().hasClass("clear-left")||c('<div class="clear-left"></div>').insertAfter(g);this.showMenus((b||[]).concat(["merge","delete"]));g.find("#contacts-container").append('<div class="block not-padded contacts-data"></div>');break;case "contacts-users":case "contacts-info":case "default":break;default:throw this.block=f,Error("Unknown block: "+d);}this.afterInitHTML&&(this.afterInitHTML(),this.afterInitHTML="");c(window).trigger("wa_after_init_html",[d,a,b])},showMenus:function(d){d='<li><a href="javascript:void(0)" class="inline-link"><b><i>'+
$_("Actions with selected")+' (<span id="selected-count" class="selected-count">0</span>)</i></b><i class="icon10 darr"></i></a><ul class="menu-v" id="actions-with-selected">'+(0<=d.indexOf("group-actions")?'<li><a href="#" onclick="$.wa.controller.addToGroupDialog(); return false"><i class="icon16 contact"></i>'+$_("Add to group")+"</a></li>":"")+'<li id="add-to-category-link"><a href="#" onclick="$.wa.controller.dialogAddSelectedToCategory(); return false"><i class="icon16 contact"></i>'+$_("Add to category")+
"</a></li>"+(0<=d.indexOf("group-actions")&&this.current_group_id?'<li><a href="#" onclick="$.wa.controller.dialogRemoveSelectedFromGroup(); return false"><i class="icon16 contact"></i>'+$_("Exclude from this group")+"</a></li>":"")+(0<=d.indexOf("category-actions")&&this.current_category_id?'<li><a href="#" onclick="$.wa.controller.dialogRemoveSelectedFromCategory(); return false"><i class="icon16 contact"></i>'+$_("Exclude from this category")+"</a></li>":"")+(0<=d.indexOf("merge")&&c.wa.controller.merge&&
c.wa.controller.admin?'<li class="two-or-more disabled"><a href="#" onClick="$.wa.controller.merge(); return false"><i class="icon16 merge"></i>'+$_("Merge contacts")+"</a></li>":"")+(0<=d.indexOf("delete")?'<li><a href="#" onclick="$.wa.controller.contactsDelete(); return false" class="red" id="show-dialog-delete"><i class="icon16 delete"></i>'+$_("Delete")+"</a></li>":"")+"</ul></li>";d='<ul id="list-views" class="menu-h float-right"><li rel="table"><a href="#"><i class="icon16 only view-table" title="'+
$_("List")+'"></i></a></li><li rel="list"><a href="#" title="'+$_("Details")+'"><i class="icon16 only view-thumb-list"></i></a></li><li rel="thumbs"><a href="#" title="'+$_("Userpics")+'"><i class="icon16 only view-thumbs"></i></a></li></ul><div id="c-list-toolbar-menu-wrapper"><input id="c-select-all-items" onclick="$.wa.grid.selectItems(this)" type="checkbox"><ul id="c-list-toolbar-menu" class="menu-h dropdown disabled" style="display:inline-block;">'+d+"</ul></div>";var a=c("#contacts-container").find(".c-list-toolbar");
0>=a.size()&&(a=c('<div class="block c-list-toolbar"></div>').prependTo(c("#contacts-container")));a.html(d);c("#contacts-container").off("click.contacts_view","#list-views > li").on("click.contacts_view","#list-views > li",function(){c.wa.grid.setView(c(this).closest("li").attr("rel"));return!1});c.wa.controller.updateSelectedCount()},showLoading:function(){var d=c("h1");0>=d.size()||(d=c(d[0]),0<d.find(".loading").show().size()||d.append('<i class="icon16 loading"></i>'))},hideLoading:function(){c("h1 .loading").remove()},
updateSelectedCount:function(){var d=c("input.selector:checked").size();c("#selected-count").text(d);c("#selected-count-word-form").text($_(d,"contacts selected"));0>=d?c("#actions-with-selected li").addClass("disabled"):(c("#actions-with-selected li").removeClass("disabled"),0>=c("#list-category li:not(.empty):not(.selected)").size()&&c("#add-to-category-link").addClass("disabled"),2>d&&c("#actions-with-selected li.two-or-more").addClass("disabled"))},getUrl:function(){return this.options.url},loadHTML:function(d,
a,b,e){this.showLoading();this.load(e||"#c-core .c-core-content",d,a,b)},load:function(d,a,b,e,f){c.wa.contactEditor.load.apply(this,Array.prototype.slice.apply(arguments))},parseParams:function(d,a){var b={};d&&d[0]&&(b.offset=d[0]);d&&d[1]&&(b.sort=d[1]);d&&d[2]&&(b.order=d[2]);d&&d[3]?(b.view=d[3],a&&c.storage.set("contacts/view/"+a,b.view)):b.view=c.storage.get("contacts/view/"+a)||"table";d&&d[4]?(b.limit=d[4],a&&c.storage.set("contacts/limit/"+a,b.limit)):b.limit=c.storage.get("contacts/limit/"+
a)||30;return b},setTitle:function(d,a){this.title=d;document.title=this.accountName?d+" \u2014 "+this.accountName:d;a&&c("#c-core h1.wa-page-heading").text("string"===typeof a?a:d)},getTitle:function(){return this.title||""},setLastView:function(d){this.lastView=c.extend(this.lastView,d)},clearLastView:function(){this.lastView={title:null,hash:null,sort:null,order:null,offset:null}},loadGrid:function(d,a,b,e){this.current_category_id=this.current_group_id=this.current_view_id=null;b||(b="?module=contacts&action=list");
e||(e={});c.wa.grid.load(b,d,"#contacts-container .contacts-data",a,e)},showMessage:function(d,a,b){var e=c("#c-core .wa-message");a&&(e.remove(),e=c());d&&(d=c('<div class="wa-message wa-success '+(b||"")+'"><a onclick="$(this).parent().empty().hide();"><i class="icon16 close"></i></a></div>').prepend(c('<span class="wa-message-text"></span>').append(d)),e.size()?c(e[0]).empty().append(d):c("#c-core h1:first").size()?d.insertAfter(c("#c-core h1:first")):c("#c-core").prepend(d))},setHash:function(d){return c.wa.setHash(this.cleanHash(d))},
getHash:function(){return this.cleanHash()},cleanHash:function(d){"undefined"==typeof d&&(d=window.location.hash.toString());for(d.length||(d=""+d);0<d.length&&"/"===d[d.length-1];)d=d.substr(0,d.length-1);d+="/";"#"!=d[0]?("/"!=d[0]&&(d="/"+d),d="#"+d):d[1]&&"/"!=d[1]&&(d="#/"+d.substr(1));return"#/"==d?"":d},collapseSidebarSection:function(d,a){a||(a="coollapse");d=c(d);if(!(0>=d.size())){var b=d.find(".darr, .rarr");0>=b.size()&&(b=c('<i class="icon16 darr">'),d.prepend(b));var e,f=d.attr("id"),
g=b.hasClass("darr")?"shown":"hidden",h=function(){d.parent().find("ul.collapsible").hide();b.removeClass("darr").addClass("rarr");e="hidden";d.trigger("collapsible",["hide"])},l=function(){d.parent().find("ul.collapsible").show();b.removeClass("rarr").addClass("darr");e="shown";d.trigger("collapsible",["show"])};switch(a){case "toggle":"shown"==g?h():l();break;case "restore":f&&("hidden"==c.storage.get("contacts/collapsible/"+f)?h():l());break;case "uncollapse":l();break;default:h()}f&&e&&c.storage.set("contacts/collapsible/"+
f,e)}},restoreCollapsibleStatusInSidebar:function(){c("#wa-app .collapse-handler").each(function(d,a){c.wa.controller.collapseSidebarSection(a,"restore")})},reloadSidebar:function(){c.post("?module=backend&action=sidebar",null,function(d){var a=c("#c-sidebar");a.css("height",a.height()+"px").html(d).css("height","");c.wa.controller.highlightSidebar();c.wa.controller.restoreCollapsibleStatusInSidebar();c.wa.controller.initSidebarDragAndDrop&&c.wa.controller.initSidebarDragAndDrop()})},highlightSidebar:function(){var d=
this.cleanHash(location.hash),a=!1,b=!1;c("#wa-app .sidebar li a").each(function(f,g){g=c(g);f=c.wa.controller.cleanHash(g.attr("href"));if(f==d)return b=g,!1;!a&&2<f.length&&d.substr(0,f.length)===f&&(a=g)});!b&&a&&(b=a);if(b&&(c("#wa-app .sidebar .selected").removeClass("selected"),0>=b.parents("ul.dropdown").size())){for(var e=b.parent();0<e.size()&&"li"!=e[0].tagName.toLowerCase();)e=e.parent();0<e.size()&&e.addClass("selected")}},loadTabSlidingAnimation:function(){c.effects&&!c.effects.slideDIB&&
(c.effects.slideDIB=function(d){return this.queue(function(){var a=c(this),b="position top left width height margin".split(" "),e=c.effects.setMode(a,d.options.mode||"show"),f=d.options.direction||"left";c.effects.save(a,b);a.show();c.effects.createWrapper(a).css({overflow:"hidden",display:"inline-block",width:"auto"});var g="up"==f||"down"==f?"top":"left";f="up"==f||"left"==f?"pos":"neg";var h=d.options.distance||("top"==g?a.outerHeight({margin:!0}):a.outerWidth({margin:!0}));"show"==e&&a.css(g,
"pos"==f?-h:h);var l={};l[g]=("show"==e?"pos"==f?"+=":"-=":"pos"==f?"-=":"+=")+h;a.animate(l,{queue:!1,duration:d.duration,easing:d.options.easing,complete:function(){"hide"==e&&a.hide();c.effects.restore(a,b);c.effects.removeWrapper(a);d.callback&&d.callback.apply(this,arguments);a.dequeue()}})})})}}})(jQuery);(function(c){c.wa.grid={count:0,data:{},highlight_terms:[],init:function(){this.defaultSettings={limit:30,offset:0,sort:"name",order:1,view:"table"};this.settings=c.extend({},this.defaultSettings);var d=this;c("#records-per-page").die(c.browser.msie?"click":"change");c("#records-per-page").live(c.browser.msie?"click":"change",function(){var a=c(this).val(),b=0;d.settings&&d.settings.offset&&(b=d.settings.offset);c.wa.setHash(c.wa.grid.hash+c.wa.grid.getHash({limit:a,offset:b}))})},formatFieldValue:function(d,
a){return"_access"===a.id?"admin"==d?"<strong>"+$_("Administrator")+"</strong>":d?"custom"==d?'<span style="white-space: nowrap">'+$_("Limited access")+"</span>":d:'<span style="color: red; white-space: nowrap">'+$_("No access")+"</span>":d?c.wa.encodeHTML(d):""},setHightlightTerms:function(d){var a=[];if(c.isArray(d)&&d.length)for(var b=0,e=d.length;b<e;b+=1)a.push(d[b]||"");else"string"===typeof d&&a.push(d||"");return this.highlight_terms=d},highlight:function(d){var a=this.highlight_terms;if(d&&
!c.isEmptyObject(a)){var b=c.parseXML?c.parseXML:c.parseHTML,e=function(k){for(var m=0,n=a.length;m<n;m+=1)a[m]&&(k=(""+k).replace(new RegExp("("+a[m].replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+")","ig"),'<span class="highlighted">$1</span>'));return k};try{var f="wrapper"+(""+Math.random()).slice(2),g=b.call(c,'<div id="'+f+'">'+d+"</div>"),h=function(k){return k.contents().map(function(m,n){if(3==n.nodeType)return e(c.wa.encodeHTML(c(n).text()));if(c(n).contents().length){var q=c("<div>");
h(c(n)).each(function(r,u){q.append(u)});return q.find(":first").get(0)}return n})},l=c("<div>");h(c(g).find("#"+f)).each(function(k,m){l.append(m)});return l.html()}catch(k){return console&&console.log([d,k]),e(d)}}return d},formNamesHtml:function(d){var a=this.highlight(c.wa.encodeHTML(d.name)),b=this.highlight(c.wa.encodeHTML(d.lastname)),e=this.highlight(c.wa.encodeHTML(d.middlename)),f=this.highlight(c.wa.encodeHTML(d.firstname)),g=!1,h=[f,e,b].join(" ").trim();d.lastname?(b="<strong>"+b+"</strong>",
g=!0):d.firstname?(f="<strong>"+f+"</strong>",g=!0):d.middlename&&(e="<strong>"+e+"</strong>",g=!0);e=[f,e,b].join(" ").trim();b=[];if(parseInt(d.is_company,10))return h="",h=g?h+(d.company?this.highlight(c.wa.encodeHTML(d.company)):a):h+((d.company?"<strong>"+this.highlight(c.wa.encodeHTML(d.company)):a)+"</strong>"),[h];d.title&&b.push("<span class='title'>"+this.highlight(c.wa.encodeHTML(d.title))+"</span>");h?b.push(e):a?b.push(a):b.push(c("<span></span>").text($_("<no-name>")).html());b=b.join(" ").trim();
h="";if(d.jobtitle||d.company)d.jobtitle&&(h+='<span class="title">'+this.highlight(c.wa.encodeHTML(d.jobtitle))+"</span>"),d.jobtitle&&d.company&&(h+=' <span class="at">'+$_("@")+"</span> "),d.company&&(h=g?h+('<span class="company">'+this.highlight(c.wa.encodeHTML(d.company))+"</span>"):h+('<span class="company"><strong>'+this.highlight(c.wa.encodeHTML(d.company))+"</strong></span>"));return[b,h]},viewtable:function(d,a){var b=tmpl("template-contacts-list-table",d);this.count=d.count;a||(b+=this.getPaging(d.count));
return b},viewlist:function(d){var a=tmpl("template-contacts-list-list",d);this.count=d.count;return a+=this.getPaging(d.count)},viewthumbs:function(d){var a=tmpl("template-contacts-list-thumbs",d);this.count=d.count;return a+=this.getPaging(d.count)},load:function(d,a,b,e,f){this.url=d;this.options=f;this.hash=e;this.settings=c.extend({},this.defaultSettings);for(var g in a)null!==a[g]&&(this.settings[g]=a[g]);var h=this,l=Math.random();c.wa.controller.random=l;c.post(d,this.settings,function(k){if(c.wa.controller.random!=
l||"ok"!=k.status)return!1;k.data.contacts&&(c.wa.grid.data=k.data);if(k.data.count&&k.data.contacts&&!k.data.contacts.length)return k=Math.floor((k.data.count-1)/h.settings.limit)*h.settings.limit,k!=h.settings.offset&&c.wa.setHash(c.wa.grid.hash+c.wa.grid.getHash({offset:k})),!1;var m=null;h.options&&h.options.beforeLoad&&(m=h.options.beforeLoad.call(c.wa.controller,k.data));k.data.title&&c.wa.controller.setTitle(k.data.title,!0);k.data.desc&&c.wa.controller.setDesc(k.data.desc);k.data.history&&
c.wa.history.updateHistory(k.data.history);b=c(b);!1!==m&&b.html(h.view(h.settings.view,k.data));h.options&&h.options.afterLoad&&h.options.afterLoad(k.data);c.wa.controller.clearLastView()},"json")},getSelected:function(d){var a=[];c("input.selector:checked").each(function(){if(d){var b=parseInt(this.value,10);isNaN(b)||a.push(b)}else a.push(this.value)});return a},setView:function(d){c.wa.setHash(this.hash+this.getHash({view:d}));return!1},selectItems:function(d,a){a=c("#"+(a||"contacts-container"));
c(d).is(":checked")?a.find("input.selector").attr("checked","checked").parents(".contact-row,.item-row").addClass("selected"):a.find("input.selector").removeAttr("checked").parents(".contact-row,.item-row").removeClass("selected");c.wa.controller.updateSelectedCount()},viewlistvalue:function(d,a){if("object"!==typeof d)return"Select"===a.type&&(a=a.options||{},void 0!==a[d]&&(d=a[d])),c.wa.encodeHTML(d);var b="";a.icon&&(b+='<i class="icon16 '+a.icon+'"></i>');var e=!0,f;for(f in d)if("ext"!=f&&"value"!=
f){e=!1;break}d.value&&(b+=e?c.wa.encodeHTML(d.value):d.value);c.trim(d.ext)&&!a.fields&&(b=a.ext&&a.ext[d.ext]?b+(' <em class="hint">'+a.ext[d.ext]+"</em>"):b+(' <em class="hint">'+c.wa.encodeHTML(d.ext)+"</em>"));return b},view:function(d,a,b){this["view"+d]||(d="table");c("#list-views li.selected").removeClass("selected");c("#list-views li[rel="+d+"]").addClass("selected");c("#contacts-container .contacts-data").removeClass("padded").addClass("not-padded");var e=a.highlight_terms||(a.info&&a.info.highlight_terms?
a.info.highlight_terms:[])||[];"string"===typeof e&&(e=[e]);c.wa.grid.setHightlightTerms(e);return this["view"+d](a,b)},getHash:function(d){var a={},b;for(b in this.settings)a[b]=this.settings[b];for(b in d)a[b]=d[b];return a.offset+"/"+a.sort+"/"+a.order+"/"+a.view+"/"+a.limit+"/"},getPaging:function(d,a,b){a="undefined"===typeof a?!0:a;var e='<div class="block paging">',f=c.wa.controller.options.paginator_type;if("undefined"===typeof b||b){var g="",h=[30,50,100,200,500];for(b=0;b<h.length;b++)g+=
'<option value="'+h[b]+'"'+(this.settings.limit==h[b]?' selected="selected"':"")+">"+h[b]+"</option>";d>h[0]&&(e+='<span class="c-page-num">'+$_("Show %s records on a page").replace("%s",'<select id="records-per-page">'+g+"</select>")+"</span>")}a&&"page"===f&&(e+='<span class="total">'+$_("Contacts")+": "+d+"</span>");a=Math.ceil(d/parseInt(this.settings.limit));g=Math.ceil(parseInt(this.settings.offset)/parseInt(this.settings.limit))+1;if(1<a){"/"!=this.hash[this.hash.length-1]&&(this.hash+="/");
"page"===f&&(e+="<span>"+$_("Pages")+":</span>");if(1==a)return"";if("page"===f)for(d=0,b=1;b<=a;b++)2>Math.abs(g-b)||2>b||1>a-b?(e+="<a "+(b==g?'class="selected"':"")+' href="#'+this.hash+this.getHash({offset:(b-1)*this.settings.limit})+'">'+b+"</a>",d=0):3>d++&&(e+=".");else e+=parseInt(this.settings.offset,10)+1+"&mdash;"+Math.min(d,parseInt(this.settings.offset,10)+parseInt(this.settings.limit,10)),e+=" "+$_("of")+" "+d}else"page"!==f&&(0>=a?e+=$_("No contacts."):(e+=Math.min(parseInt(this.settings.offset,
10)+1,d)+"&mdash;"+Math.min(d,parseInt(this.settings.offset,10)+parseInt(this.settings.limit,10)),e+=" "+$_("of")+" "+d));1<g&&(e+='<a href="#'+this.hash+this.getHash({offset:(g-2)*this.settings.limit})+'" class="prevnext"><i class="icon10 larr"></i> '+$_("prev")+"</a>");g<a&&(e+='<a href="#'+this.hash+this.getHash({offset:g*this.settings.limit})+'" class="prevnext">'+$_("next")+' <i class="icon10 rarr"></i></a>');return e+"</div>"}}})(jQuery);$.wa.history={data:null,updateHistory:function(c){this.data=c;var d=$("#wa-search-history").empty(),a=$("#wa-creation-history").empty();$.wa.controller.cleanHash(location.hash);for(var b=0;b<c.length;b++){var e=c[b];e.hash=$.wa.controller.cleanHash(e.hash);var f=$('<li rel="'+e.id+'">'+(0<=e.cnt?'<span class="count">'+e.cnt+"</span>":"")+'<a href="'+e.hash+'"><i class="icon16 '+e.type+'"></i></a></li>');"search"!=e.type&&"import"!=e.type||f.addClass("wa-h-type-search");f.children("a").append($("<b>").text(e.name));
"import"==e.type?a.append(f):"add"==e.type?(f.find(".icon16").removeClass(e.type).addClass("userpic20").css("background-image","url("+e.icon+")"),a.append(f)):"search"==e.type&&d.append(f)}c=[d,a];for(d=0;d<c.length;d++)a=c[d],0<a.children().size()?a.parents(".block.wrapper").show():a.parents(".block.wrapper").hide();$.wa.controller.highlightSidebar()},clear:function(c){c&&"search"!=c?c&&"creation"==c?($("#wa-creation-history").parents(".block.wrapper").hide(),$("#wa-creation-history").empty(),c=
"&ctype[]=import&ctype[]=add"):c="":($("#wa-search-history").parents(".block.wrapper").hide(),$("#wa-search-history").empty(),c="&ctype="+c);$.get("?module=contacts&action=history&clear=1"+c);return!1}};$.wa.fieldTypesFactory=function(c,d){c=c||$.wa.contactEditorFactory();c.baseFieldType={contactType:"person",options:{},createEditor:function(a){this.contactType=a||"person";a=$.extend({},this);delete a.createEditor;delete a.initializeFactory;a.parentEditorData={};a.initialize();return a},fieldValue:"",initializeFactory:function(a,b){this.fieldData=a;this.options=b||{}},initialize:function(){this.setValue("")},reinit:function(){this.currentMode="null";this.initialize()},setValue:function(a){this.fieldValue=
a;"null"!=this.currentMode&&null!==this.domElement&&("edit"==this.currentMode?this.domElement.find(".val").val(this.fieldValue):this.domElement.find(".val").html(this.fieldValue))},getValue:function(){var a=this.fieldValue;if("edit"==this.currentMode&&null!==this.domElement){var b=this.domElement.find(".val");0<b.length&&(a="",b.hasClass("empty")||"checkbox"==b.attr("type")&&!b.attr("checked")||(a=b.val()))}return a},isModified:function(){return this.fieldValue!=this.getValue()},validate:function(a){var b=
this.getValue();return a||!this.fieldData.required||b?null:$_("This field is required.")},newFieldElement:function(a){this.fieldData.read_only&&(a="view");var b=this.newInlineFieldElement(a);if(null===b&&(!this.fieldData.show_empty||"edit"==a))return $('<div style="display: none" class="field" data-field-id="'+this.fieldData.id+'"></div>');if("person"===this.contactType)if(0<=["firstname","middlename","lastname"].indexOf(this.fieldData.id)){var e="subname";b.find(".val").attr("placeholder",this.fieldData.name)}else"title"===
this.fieldData.id?(e="subname title",b.find(".val").attr("placeholder",this.fieldData.name)):"jobtitle"===this.fieldData.id?e="jobtitle-company jobtitle":"company"===this.fieldData.id&&(e="jobtitle-company company");else"company"===this.fieldData.id&&(e="company");return c.wrapper(b,this.fieldData.name+"",e).attr("data-field-id",this.fieldData.id)},newInlineFieldElement:function(a){if("view"==a&&!this.fieldValue)return null;"edit"==a?(a=$('<span><input class="val" type="text"></span>'),a.find(".val").val(this.fieldValue)):
(a=$('<span class="val"></span>'),a.text(this.fieldValue));return a},showValidationErrors:function(a){if(null!==this.domElement){var b=this.domElement.find(".val");b.parents(".value").children("em.errormsg").remove();null!==a?(b.parents(".value").append($('<em class="errormsg">'+a+"</em>")),b.addClass("error")):b.removeClass("error")}},fieldData:null,domElement:null,currentMode:"null",parentEditor:null,parentEditorData:null,setMode:function(a,b){"undefined"==typeof b&&(b=!0);if("view"!=a&&"edit"!=
a)throw Error("Unknown mode: "+a);this.currentMode!=a&&(this.currentMode=a,b&&(b=this.domElement,this.domElement=this.newFieldElement(a),null!==b&&b.replaceWith(this.domElement)));return this.domElement}};c.factoryTypes.Hidden=$.extend({},c.baseFieldType,{newFieldElement:function(a){a=this.newInlineFieldElement(a);return c.wrapper(a,this.fieldData.name).attr("data-field-id",this.fieldData.id).hide()},newInlineFieldElement:function(a){if("view"==a&&!this.fieldValue)return null;var b=null;"edit"==a&&
(b=$('<span><input type="hidden" class="val" type="text"></span>'),b.find(".val").val(this.fieldValue));return b}});c.factoryTypes.String=$.extend({},c.baseFieldType,{setValue:function(a){this.fieldValue=a;"null"!=this.currentMode&&null!==this.domElement&&("edit"==this.currentMode?this.domElement.find(".val").val(this.fieldValue):this.domElement.find(".val").html(this.fieldValue))},getValue:function(){var a=this.fieldValue;if("edit"==this.currentMode&&null!==this.domElement){var b=this.domElement.find(".val");
a="";b.hasClass("empty")||(a=b.val())}return a},newInlineFieldElement:function(a){if("view"==a&&!this.fieldValue)return null;var b=this.fieldValue;"edit"==a?(a=1>=this.fieldData.input_height?$('<span><input class="val" type="text"><i class="icon16 loading" style="display:none;"></i></span>'):$('<span><textarea class="val" rows="'+this.fieldData.input_height+'"></textarea></span>'),a.find(".val").val(b)):a=$('<span class="val"></span><i class="icon16 loading" style="display:none;">').text(b);return a},
setMode:function(a,b){"undefined"==typeof b&&(b=!0);if("view"!=a&&"edit"!=a)throw Error("Unknown mode: "+a);this.currentMode!=a&&(this.currentMode=a,b&&(b=this.domElement,this.domElement=this.newFieldElement(a),null!==b&&b.replaceWith(this.domElement)));return this.domElement}});c.factoryTypes.Text=$.extend({},c.factoryTypes.String);c.factoryTypes.Phone=$.extend({},c.baseFieldType);c.factoryTypes.Select=$.extend({},c.baseFieldType,{notSet:function(){return""},newInlineFieldElement:function(a){if("view"==
a&&!this.fieldValue)return null;if("view"==a)return $('<span class="val"></span>').text(this.fieldData.options[this.fieldValue]||this.fieldValue);a="";for(var b=!1,e,f=0;f<this.fieldData.oOrder.length;f++){var g=this.fieldData.oOrder[f];!b&&g==this.fieldValue&&this.fieldValue?(b=!0,e=" selected"):e="";""===g&&(e+=" disabled");a+='<option value="'+g+'"'+e+">"+$.wa.encodeHTML(this.fieldData.options[g])+"</option>"}return $('<div><select class="val '+(this.fieldData.type+"").toLowerCase()+'"><option value=""'+
(b?"":" selected")+">"+this.notSet()+"</option>"+a+"</select></div>")}});c.factoryTypes.Conditional=$.extend({},c.factoryTypes.Select,{unbindEventHandlers:function(){},getValue:function(){var a=this.fieldValue;if("edit"==this.currentMode&&null!==this.domElement){var b=this.domElement.find(".val:visible");0<b.length&&(a=b.hasClass("empty")?"":b.val())}return a},newInlineFieldElement:function(a){if("view"==a&&!this.fieldValue)return null;this.unbindEventHandlers();if("view"==a)return $("<div></div>").append($('<span class="val"></span>').text(this.fieldData.options&&
this.fieldData.options[this.fieldValue]||this.fieldValue));var b=this;a=(b.fieldData.parent_field||"").split(":");for(var e=c.fieldEditors[a.shift()];e&&a.length;){var f=e.subfieldEditors;if(f instanceof Array){e=null;for(var g=0;g<f.length;g++)if(f[g]===b.parentEditor){e=f[g];break}}else e=f[a.shift()]}if(e){var h=this.fieldData.options&&this.fieldData.options[this.fieldValue]||this.fieldValue,l=$('<input type="text" class="hidden val">').val(h),k=$('<select class="hidden val"></select>').hide(),
m=function(){var n=$(this),q=l.is(":visible")?l.val():k.is(":visible")?k.val():h;n=(n.val()||"").toLowerCase();if(n=b.fieldData.parent_options[n]){l.hide();k.show().children().remove();for(g=0;g<n.length;g++)k.append($("<option></option>").attr("value",n[g]).text(n[g]).attr("selected",b.fieldValue==n[g]));k.val(q)}else l.val(q||"").show().blur(),k.hide()};setTimeout(function(){if(e.domElement){e.domElement.on("change",".val",m);var n=e.domElement.find(".val:visible");n.length&&m.call(n.get(0))}else l.show()},
0);b.unbindEventHandlers=function(){m&&e.domElement&&e.domElement.find(".val").unbind("change",m);b.unbindEventHandlers=function(){}};return $("<div></div>").append(l).append(k)}return $("<div></div>").append($('<input type="text" class="val">').val(b.fieldValue))}});c.factoryTypes.Region=$.extend({},c.factoryTypes.Select,{notSet:function(){return""},unbindEventHandlers:function(){},setCurrentCountry:function(){var a=this.current_country;this.current_country=this.parentEditorData.parent.subfieldEditors.country.getValue();
return a!==this.current_country?(delete this.fieldData.options,!0):!1},getRegionsControllerUrl:function(a){return c.getRegionsUrl()+a},newInlineFieldElement:function(a){if("view"==a&&!this.fieldValue)return null;this.unbindEventHandlers();var b=this.options||{};void 0!==b.country&&(this.current_country=b.country);if("view"==a)return $("<div></div>").append($('<span class="val"></span>').text(this.fieldData.options&&this.fieldData.options[this.fieldValue]||this.fieldValue));var e=this;if(this.parentEditorData.parent&&
this.parentEditorData.parent.subfieldEditors.country){this.setCurrentCountry();var f;$(document).on("change","select.country",f=function(){if(e.setCurrentCountry()){var h="",l=e.domElement.find(".val");h=l.is("input")?l.val().trim():l.find(":selected").text().trim();var k=function(m,n){var q=n.toLocaleLowerCase();m.find("option").each(function(){if($(this).text().trim().toLocaleLowerCase()===q)return $(this).attr("selected",!0),!1})};e.domElement.empty().append(e.newInlineFieldElement(a).children());
l=e.domElement.find(".val");l.is("input")&&!l.val()?l.val(h):l.is("select")&&h?k(l,h):e.domElement.unbind("load.fieldTypes").bind("load.fieldTypes",function(){var m=e.domElement.find(".val");m.is("select")&&h&&k(m,h)})}});e.unbindEventHandlers=function(){$(document).off("change","select.country",f);e.unbindEventHandlers=function(){}}}if(!b.no_ajax_select&&void 0===this.fieldData.options&&this.current_country&&this.fieldData.region_countries[this.current_country]){var g=this.current_country;$.get(this.getRegionsControllerUrl(g),
function(h){a===e.currentMode&&g===e.current_country&&(e.fieldData.options=h.data.options||!1,e.fieldData.oOrder=h.data.oOrder||[],$.isPlainObject(e.options)&&void 0!==e.options.country&&delete e.options.country,$("<div></div>").append(e.newInlineFieldElement(a).children()),e.domElement.empty().append(e.newInlineFieldElement(a).children()),e.domElement.trigger("load"))},"json");return $("<div></div>").append($('<i class="icon16 loading"></i>'))}if(this.fieldData.options)return $("<div></div>").append(c.factoryTypes.Select.newInlineFieldElement.call(this,
a));b=$("<div></div>").append(c.baseFieldType.newInlineFieldElement.call(this,a));b.find(".val").val("");b.find(".val").attr("placeholder",this.fieldData.name+(this.fieldData.required?" ("+$_("required")+")":""));return b}});c.factoryTypes.Country=$.extend({},c.factoryTypes.Select);c.factoryTypes.Checklist=$.extend({},c.baseFieldType,{validate:function(a){return null},setValue:function(a){this.fieldValue=a;if("edit"==this.currentMode&&this.domElement){this.domElement.find('input[type="checkbox"]').attr("checked",
!1);for(var b in this.fieldValue)this.domElement.find('input[type="checkbox"][value="'+b+'"]').attr("checked",!0)}else"view"==this.currentMode&&this.domElement&&this.domElement.find(".val").html(this.getValueView())},getValue:function(){if("edit"!=this.currentMode||!this.domElement)return this.fieldValue;var a=[];this.domElement.find('input[type="checkbox"]:checked').each(function(b,e){a.push($(e).val())});return a},getValueView:function(){for(var a="",b=0;b<this.fieldData.oOrder.length;b++){var e=
this.fieldData.oOrder[b];0>this.fieldValue.indexOf(e)||(a+=(a?", ":"")+'<a href="'+(this.fieldData.hrefPrefix||"#")+e+'">'+(this.fieldData.options[e]&&c.htmlentities(this.fieldData.options[e])||$_("&lt;no name&gt;"))+"</a>")}return a||$_("&lt;none&gt;")},newInlineFieldElement:function(a){if(!("view"!=a||this.fieldValue&&this.fieldValue.length))return null;if("view"==a)return $('<span class="val"></span>').html(this.getValueView());a=0;for(var b in this.fieldData.options)if(a++,1<a)break;if(!a)return null;
a="";for(var e=0;e<this.fieldData.oOrder.length;e++)b=this.fieldData.oOrder[e],a+='<li><label><input type="checkbox" value="'+b+'"',this.fieldData.disabled&&this.fieldData.disabled[b]&&(a+=' disabled="disabled"'),-1!==(this.fieldValue||[]).indexOf(b)&&(a+=' checked="checked"'),a+=" />"+(this.fieldData.options[b]&&c.htmlentities(this.fieldData.options[b])||$_("&lt;no name&gt;"))+"</label></li>";return c.initCheckboxList('<div class="c-checkbox-menu-container val"><div><ul class="menu-v compact with-icons c-checkbox-menu">'+
a+"</ul></div></div>")}});c.factoryTypes.Name=$.extend({},c.baseFieldType,{newInlineFieldElement:null,newFieldElement:function(a){return $('<div style="display: none;" class="field" data-field-id="'+this.fieldData.id+'"></div>')},setValue:function(a){this.fieldValue=a},getValue:function(a){if(this.fieldValue&&!a)return this.fieldValue;a=[];"person"==this.contactType?(c.fieldEditors.firstname&&a.push(c.fieldEditors.firstname.getValue()),c.fieldEditors.middlename&&a.push(c.fieldEditors.middlename.getValue()),
c.fieldEditors.lastname&&a.push(c.fieldEditors.lastname.getValue())):c.fieldEditors.company&&a.push(c.fieldEditors.company.getValue());return a.join(" ").trim()},validate:function(a){var b=this.getValue(!0);if(!a&&this.fieldData.required&&!b){a=$("#contact-info-block input:visible:text[value]:not(.empty)").val();if(!a)return $_("At least one of these fields must be filled");c.fieldEditors.firstname.setValue(a)}return null},showValidationErrors:function(a){var b=$("#contact-info-block");b.find("div.wa-errors-block").remove();
if(null!==a){var e=$('<div class="field wa-errors-block"><div class="value"><em class="errormsg">'+a+"</em></div></div>");c.fieldEditors.lastname?c.fieldEditors.lastname.domElement.after(e):b.prepend(e)}b=["firstname","middlename","lastname"];for(e=0;e<b.length;e++){var f=b[e];c.fieldEditors[f]&&(null!==a?c.fieldEditors[f].domElement.find(".val").addClass("external-error"):c.fieldEditors[f].domElement.find(".val").removeClass("external-error"))}},setMode:function(a,b){"undefined"==typeof b&&(b=!0);
if("view"!=a&&"edit"!=a)throw Error("Unknown mode: "+a);this.currentMode!=a&&(this.currentMode=a,b&&(b=this.domElement,this.domElement=this.newFieldElement(a),null!==b&&b.replaceWith(this.domElement)));var e="";c.fieldEditors.title&&(e=c.fieldEditors.title.getValue()+" ");if("view"===a&&!c.not_update_name){b=$("#contact-fullname");var f="",g="",h="";if(c.fieldEditors.firstname){var l=c.fieldEditors.firstname.currentMode;c.fieldEditors.firstname.currentMode=a;f=c.fieldEditors.firstname.getValue();
c.fieldEditors.firstname.currentMode=l}c.fieldEditors.middlename&&(l=c.fieldEditors.middlename.currentMode,c.fieldEditors.middlename.currentMode=a,g=c.fieldEditors.middlename.getValue(),c.fieldEditors.middlename.currentMode=l);c.fieldEditors.lastname&&(l=c.fieldEditors.lastname.currentMode,c.fieldEditors.lastname.currentMode=a,h=c.fieldEditors.lastname.getValue(),c.fieldEditors.lastname.currentMode=l);(l=[f,g,h].join(" ").trim())||(l=this.fieldValue||"<"+$_("no name")+">");e=b.find("h1.name").html('<span class="title">'+
$.wa.encodeHTML(e)+"</span>"+$.wa.encodeHTML(l));"person"===this.contactType&&(h=g=f="",c.fieldEditors.jobtitle&&(l=c.fieldEditors.jobtitle.currentMode,c.fieldEditors.jobtitle.currentMode=a,g=c.fieldEditors.jobtitle.getValue(),c.fieldEditors.jobtitle.currentMode=l),c.fieldEditors.company&&(l=c.fieldEditors.company.currentMode,c.fieldEditors.company.currentMode=a,h=c.fieldEditors.company.getValue(),c.fieldEditors.company.currentMode=l),g&&(f+='<span class="title">'+$.wa.encodeHTML(g)+"</span> "),g&&
h&&(f+='<span class="at">'+$_("@")+"</span> "),h&&(f+='<span class="company">'+$.wa.encodeHTML(h)+"</span> "),b.find("h1.jobtitle-company").html(f));c.update_title&&$.wa.controller.setTitle(e.text())}c.contact_id&&c.contact_id==c.current_user_id&&$("#wa-my-username").text(""+(this.fieldValue?this.fieldValue:"<"+$_("no name")+">"));return this.domElement}});c.factoryTypes.NameSubfield=$.extend({},c.baseFieldType,{});c.factoryTypes.Multifield=$.extend({},c.baseFieldType,{subfieldEditors:null,subfieldFactory:null,
emptySubValue:null,initializeFactory:function(a){this.fieldData=a;if("undefined"!=typeof this.fieldData.ext){this.fieldData.extKeys=[];this.fieldData.extValues=[];for(var b in this.fieldData.ext)this.fieldData.extKeys[this.fieldData.extKeys.length]=b,this.fieldData.extValues[this.fieldData.extValues.length]=this.fieldData.ext[b]}},initialize:function(){this.subfieldFactory=$.extend({},c.factoryTypes[this.fieldData.type]);this.subfieldFactory.parentEditor=this;this.subfieldFactory.initializeFactory($.extend({},
this.fieldData));this.fieldData=$.extend({},this.fieldData,{required:this.subfieldFactory.fieldData.required});this.subfieldEditors=[this.subfieldFactory.createEditor(this.contactType)];this.emptySubValue="object"==typeof this.subfieldEditors[0].fieldValue?$.extend({},this.subfieldEditors[0].fieldValue):{value:this.subfieldEditors[0].fieldValue};this.fieldData.ext&&(this.emptySubValue.ext=this.fieldData.extKeys[0]);this.fieldValue=[this.emptySubValue]},setValue:function(a){a&&"undefined"!=typeof a[0]||
(a=[this.emptySubValue]);this.fieldValue=a;var b=0;do{this.subfieldEditors.length<=b&&(this.subfieldEditors[b]=this.subfieldFactory.createEditor(this.contactType),"null"!=this.currentMode&&this.subfieldEditors[b].setMode(this.currentMode).insertAfter(this.subfieldEditors[b-1].parentEditorData.domElement));if("undefined"!=typeof a[b]){var e=!1,f;for(f in a[b])if("value"!=f&&"ext"!=f){e=!0;break}this.subfieldEditors[b].setValue(e?a[b]:a[b].value?a[b].value:"");if("undefined"!=typeof this.fieldData.ext&&
(e=a[b].ext,"null"!=this.currentMode&&this.subfieldEditors[b].parentEditorData.domElement)){var g=this.subfieldEditors[b].parentEditorData.domElement.find("input.ext");0<g.size()&&g[0].setExtValue(e)}}else throw Error("At least one record must exist in data at this time.");b++}while(b<a.length);if(a.length<this.subfieldEditors.length){for(b=a.length;b<this.subfieldEditors.length;b++)0!==b&&"null"!=this.currentMode&&this.subfieldEditors[b].parentEditorData.domElement.remove();a=0<a.length?a.length:
1;this.subfieldEditors.splice(a,this.subfieldEditors.length-a)}this.origFieldValue=null},getValue:function(){if("null"==this.currentMode)return $.extend({},this.fieldValue);for(var a=[],b=0;b<this.subfieldEditors.length;b++){var e=this.subfieldEditors[b];a[b]={value:e.getValue()};if("undefined"!=typeof this.fieldData.ext){var f=this.fieldValue[b].ext,g=e.parentEditorData.domElement.find("input.ext")[0];"edit"==e.currentMode&&g&&(f=g.getExtValue());a[b].ext=f}}return a},isModified:function(){for(var a=
0;a<this.subfieldEditors.length;a++)if(this.subfieldEditors[a].isModified())return!0;return!1},validate:function(a){for(var b=[],e=!0,f=0;f<this.subfieldEditors.length;f++){var g=this.subfieldEditors[f],h=g.validate(!0);h&&(b[f]=h);if((g=g.getValue())||"string"!=typeof g)e=!1}!a&&this.fieldData.required&&e&&(b[0]="This field is required.");return 0>=b.length?null:b},showValidationErrors:function(a){for(var b=0;b<this.subfieldEditors.length;b++){var e=this.subfieldEditors[b];null!==a&&"undefined"!=
typeof a[b]?e.showValidationErrors(a[b]):e.showValidationErrors(null)}},deleteSubfieldButton:function(a){var b=this,e=$('<a class="delete-subfield hint" href="javascript:void(0)">'+$_("delete")+"</a>").click(function(){if(1>=b.subfieldEditors.length)return!1;var f=b.subfieldEditors.indexOf(a);"null"!=b.currentMode&&b.subfieldEditors[f].parentEditorData.domElement.remove();b.subfieldEditors.splice(f,1);1>=b.subfieldEditors.length&&b.domElement.find(".delete-subfield").hide();return!1});1>=this.subfieldEditors.length&&
e.hide();return e},newSubFieldElement:function(a,b){b-=0;var e=this.subfieldEditors[b];e.parentEditorData||(e.parentEditorData={});e.parentEditorData.parent=this;e.parentEditorData.empty=!1;if("function"!=typeof e.newInlineFieldElement){var f=c.wrapper('<span class="replace-me-with-value"></span>',0===b?this.fieldData.name+"":"","no-bot-margins"),g=f.find("span.replace-me-with-value");var h=this.fieldValue[b].ext;"edit"==a?h=c.createExtSelect(this.fieldData.ext,h):(h=this.fieldData.ext[this.fieldValue[b].ext]||
h,h=$("<strong>"+c.htmlentities(h)+"</strong>"));g.before(h);"edit"==a&&g.before(this.deleteSubfieldButton(e));g.remove();e.domElement=this.subfieldEditors[b].newFieldElement(a);var l=this;e.domElement.find("div.name").each(function(k,m){m.innerHTML.substr(0,l.fieldData.name.length)===l.fieldData.name&&(m.innerHTML="")});e.parentEditorData.domElement=$("<div></div>").append(f).append(e.domElement);e.parentEditorData.empty="edit"==a?!1:!e.fieldValue.value&&!e.fieldData.show_empty;return e.parentEditorData.domElement}h=
e.newInlineFieldElement(a);if(null===h)return e.parentEditorData.domElement=e.domElement=$("<div></div>"),e.parentEditorData.empty=!0,e.parentEditorData.domElement;e.domElement=h;e.domElement.data("subfield-index",b).attr("data-subfield-index",b);f=$('<div class="value"></div>').append(h);g=f.find(".replace-with-ext");0>=g.size()&&(f.append('<span><span class="replace-with-ext"></span></span>'),g=f.find(".replace-with-ext"));"undefined"!=typeof this.fieldData.ext&&(h=this.fieldValue[b].ext,"edit"==
a?g.before(c.createExtSelect(this.fieldData.ext,h)):(h=this.fieldData.ext[this.fieldValue[b].ext]||h,0<g.parents(".ext").size()?g.before(c.htmlentities(h)):g.before($('<em class="hint"></em>').text(" "+h))));"edit"==a&&g.before(this.deleteSubfieldButton(e));g.remove();return e.parentEditorData.domElement=f},newInlineFieldElement:null,newFieldElement:function(a){this.fieldData.read_only&&(a="view");for(var b=$('<div class="multifield-subfields"></div>'),e="function"==typeof this.subfieldFactory.newInlineFieldElement,
f=!0,g=0;g<this.subfieldEditors.length;g++){var h=this.newSubFieldElement(a,g);b.append(h);f=f&&this.subfieldEditors[g].parentEditorData.empty}if(f&&!this.fieldData.show_empty)return $('<div style="display: none;" class="field" data-field-id="'+this.fieldData.id+'"></div>');f=e?$("<div></div>").append(b):$('<div class="field" data-field-id="'+this.fieldData.id+'"></div>').append(b);if("edit"==a){g=e?$('<div class="value multifield-subfields-add-another"><span class="replace-me-with-value"></span></div>'):
c.wrapper('<span class="replace-me-with-value"></span>');var l=this;g.find(".replace-me-with-value").replaceWith($('<a href="javascript:void(0)" class="small inline-link"><b><i>'+$_("Add another")+"</i></b></a>").click(function(k){k=l.subfieldFactory.createEditor(this.contactType);var m=l.subfieldEditors.length;val={value:k.getValue(),temp:!0};"undefined"!=typeof l.fieldData.ext&&(val.ext="");l.fieldValue[m]=val;l.subfieldEditors[m]=k;"null"!=l.currentMode&&k.setMode(l.currentMode);b.append(l.newSubFieldElement(a,
m));l.domElement.find(".delete-subfield").css("display","inline")}));f.append(g)}e&&(f=c.wrapper(f,this.fieldData.name+"").attr("data-field-id",this.fieldData.id));return f},setMode:function(a,b){"undefined"==typeof b&&(b=!0);if("view"!=a&&"edit"!=a)throw Error("Unknown mode: "+a);if(this.currentMode!=a){if("view"==a&&"edit"==this.currentMode&&this.origFieldValue)this.setValue(this.origFieldValue);else if("view"==this.currentMode&&!this.origFieldValue){this.origFieldValue=[];for(var e=0;e<this.fieldValue.length;e++)this.origFieldValue.push($.extend({},
this.fieldValue[e]))}this.currentMode=a;b&&(b=this.domElement,this.domElement=this.newFieldElement(a),null!==b&&b.replaceWith(this.domElement))}for(e=0;e<this.subfieldEditors.length;e++)this.subfieldEditors[e].setMode(a,!1);return this.domElement}});c.factoryTypes.Composite=$.extend({},c.baseFieldType,{subfieldEditors:null,initializeFactory:function(a,b){this.fieldData=a;if(this.fieldData.required){for(var e in this.fieldData.required)if(this.fieldData.required[e]){this.fieldData.required=!0;break}!0!==
this.fieldData.required&&(this.fieldData.required=!1)}this.options=b||{}},initialize:function(){var a={data:{},value:""};this.subfieldEditors={};this.fieldData.subfields=this.fieldData.fields;for(var b in this.fieldData.subfields){var e=$.extend({},c.factoryTypes[this.fieldData.subfields[b].type]),f=this.fieldData.fields[b];this.fieldData.required&&this.fieldData.required[b]&&(f.required=!0);f=$.extend({},f,{id:null,multi:!1});e.initializeFactory(f,this.options);e.parentEditor=this;e.parentEditorData=
{};e.initialize();e.parentEditorData.sfid=b;e.parentEditorData.parent=this;this.subfieldEditors[b]=e;a.data[b]=e.getValue()}this.fieldValue=a},setValue:function(a){if(a){this.fieldValue=a;for(var b in this.subfieldEditors){var e=this.subfieldEditors[b];"undefined"==typeof a.data?(e.initialize(),e.setValue(e.getValue())):"undefined"!=typeof a.data[b]?e.setValue(a.data[b]):e.setValue(e.getValue())}}},getValue:function(){if("null"==this.currentMode)return $.extend({},this.fieldValue.data);var a={},b;
for(b in this.subfieldEditors)a[b]=this.subfieldEditors[b].getValue();return a},isModified:function(){for(var a in this.subfieldEditors)if(this.subfieldEditors[a].isModified())return!0;return!1},validate:function(a){var b={},e=!1,f;for(f in this.subfieldEditors){var g=this.subfieldEditors[f].validate(a);g&&(b[f]=g,e=!0)}return e?b:null},showValidationErrors:function(a){if(null!==this.domElement)for(var b in this.subfieldEditors){var e=this.subfieldEditors[b];null!==a&&"undefined"!=typeof a[b]?e.showValidationErrors(a[b]):
e.showValidationErrors(null)}},newInlineFieldElement:null,newFieldElement:function(a){this.fieldData.read_only&&(a="view");if("view"==a&&!this.fieldValue.value&&!this.fieldData.show_empty)return $('<div style="display: none;" class="field" data-field-id="'+this.fieldData.id+'"></div>');var b=$('<div class="composite '+a+' field" data-field-id="'+this.fieldData.id+'"></div>').append(c.wrapper('<span style="display:none" class="replace-with-ext"></span>',this.fieldData.name,"hdr")),e;for(e in this.subfieldEditors){var f=
this.subfieldEditors[e],g=f.newFieldElement(a);g.attr("data-field-id",e);g.data("fieldId",e);f.domElement=g;b.append(g)}return b},setMode:function(a,b){"undefined"==typeof b&&(b=!0);if("view"!=a&&"edit"!=a)throw Error("Unknown mode: "+a);this.currentMode!=a&&(this.currentMode=a,b&&(b=this.domElement,this.domElement=this.newFieldElement(a),null!==b&&b.replaceWith(this.domElement)));for(var e in this.subfieldEditors)this.subfieldEditors[e].setMode(a,!1);return this.domElement}});c.factoryTypes.Address=
$.extend({},c.factoryTypes.Composite,{showValidationErrors:function(a){if(null!==this.domElement&&(this.domElement.find("em.errormsg").remove(),this.domElement.find(".val").removeClass("error"),a))for(var b in this.subfieldEditors)"undefined"!=typeof a[b]&&this.subfieldEditors[b].domElement.find(".val").addClass("error").parents(".address-subfield").append($('<em class="errormsg">'+a[b]+"</em>"))},newInlineFieldElement:function(a){if("view"==a){if(!this.fieldValue.value)return null;var b="string"===
typeof this.fieldValue.for_map?this.fieldValue.for_map:this.fieldValue.for_map.coords?this.fieldValue.for_map.coords:this.fieldValue.for_map.with_street;return b=$('<div class="address-field"></div>').append(this.fieldValue.value).append('<span style="display:none" class="replace-with-ext"></span> ').append('<a target="_blank" href="//maps.google.com/maps?q='+encodeURIComponent(b)+'&z=15" class="small map-link">'+$_("map")+"</a>")}a=$('<div class="address-field"></div>');a.append('<span style="display:none" class="replace-with-ext"></span>');
for(b in this.subfieldEditors){var e=this.subfieldEditors[b],f=e.newInlineFieldElement("edit");e.domElement=f;a.append($('<div class="address-subfield"></div>').append(f));"Hidden"!==e.fieldData.type&&(e=e.fieldData.name+(e.fieldData.required?" ("+$_("required")+")":""),f.find("input.val,textarea.val").attr("placeholder",e).attr("title",e))}return a}});c.factoryTypes.Birthday=c.factoryTypes.Date=$.extend({},c.baseFieldType,{newInlineFieldElement:function(a){if(!("view"!=a||this.fieldValue&&this.fieldValue.value))return null;
var b=this.fieldValue.data||{};if("edit"==a){a=$('<select class="val" data-part="day"><option data=""></option></select>');for(var e=1;31>=e;e+=1){var f=$('<option data="'+e+'" value="'+e+'">'+e+"</option>");e==b.day&&f.attr("selected",!0);a.append(f)}e=$('<select class="val" data-part="month"><option data=""></option></select>');for(var g="January February March April May June July August September October November December".split(" "),h=0;12>h;h+=1)f=$_(g[h]),f=$('<option data="'+(h+1)+'"  value="'+
(h+1)+'">'+f+"</option>"),h+1==b.month&&f.attr("selected",!0),e.append(f);f=$('<input type="text" data-part="year" class="val" style="min-width: 32px; width: 32px;" placeholder="'+$_("year")+'">');b.year&&f.val(b.year);b=$("<span></span>").append(a).append(" ").append(e).append(" ").append(f)}else b=$('<span class="val"></span>').text(this.fieldValue.value);return b},getValue:function(){var a=this.fieldValue;if("edit"==this.currentMode&&null!==this.domElement){var b=this.domElement.find(".val");0<
b.length&&(a={value:{day:null,month:null,year:null}},b.each(function(){var e=$(this),f=e.data("part");a.value[f]=parseInt(e.val(),10)||null}))}return a},setValue:function(a){this.fieldValue=a;"null"!=this.currentMode&&null!==this.domElement&&("edit"==this.currentMode?a&&a.data&&this.domElement.find(".val").each(function(){var b=$(this),e=b.data("part");b.val(a.data[e]||"")}):this.domElement.find(".val").html(this.fieldValue))}});c.factoryTypes.IM=$.extend({},c.baseFieldType,{setValue:function(a){"undefined"==
typeof a&&(a="");"object"==typeof a?(this.fieldValue=a.data,this.viewValue=a.value):this.fieldValue=this.viewValue=a;"null"!=this.currentMode&&this.domElement&&("edit"==this.currentMode?this.domElement.find("input.val").val(this.fieldValue):this.domElement.find(".val").html(this.viewValue))},newInlineFieldElement:function(a){if("view"==a&&!this.fieldValue)return null;"edit"==a?(a=$('<span><input class="val" type="text"></span>'),a.find(".val").val(this.fieldValue)):a=$('<span class="val"></span>').html(this.viewValue);
return a}});c.factoryTypes.SocialNetwork=$.extend({},c.baseFieldType,{setValue:function(a){"undefined"==typeof a&&(a="");"object"==typeof a?(this.fieldValue=a.data,this.viewValue=a.value):this.fieldValue=this.viewValue=a;"null"!=this.currentMode&&this.domElement&&("edit"==this.currentMode?this.domElement.find("input.val").val(this.fieldValue):this.domElement.find(".val").html(this.viewValue))},newInlineFieldElement:function(a){if("view"==a&&!this.fieldValue)return null;"edit"==a?(a=$('<span><input class="val" type="text"></span>'),
a.find(".val").val(this.fieldValue)):a=$('<span class="val"></span>').html(this.viewValue);return a}});c.factoryTypes.Url=$.extend({},c.factoryTypes.IM,{validate:function(a){var b=$.trim(this.getValue());if(!a&&this.fieldData.required&&!b)return $_("This field is required.");if(!b)return null;/^(https?|ftp|gopher|telnet|file|notes|ms-help)/.test(b)||(b="http://"+b,this.setValue(b));a=/^(https?|ftp|gopher|telnet|file|notes|ms-help):((\/\/)|(\\\\))+[^`!\[\]{}'"<>\u00ab\u00bb\u201c\u201d\u2018\u2019\s]*$/i;
return!a.test(b)||/^(http|ftp)/.test(b.toLowerCase())&&(a=/^(https?|ftp):((\/\/)|(\\\\))+((?:[^`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019\s+]+\.)+[^`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019\s+]{2,6})((\/|\\|#)[^`!\[\]{}'"<>\u00ab\u00bb\u201c\u201d\u2018\u2019\s]*)?$/i,!a.test(b))?$_("Incorrect URL format."):null}});c.factoryTypes.Email=$.extend({},c.factoryTypes.Url,{validate:function(a){var b=$.trim(this.getValue());return a||!this.fieldData.required||b?b?/^([^@\s]+)@[^\s@]+\.[^\s@\.]{2,}$/i.test(b)?
null:$_("Incorrect Email address format."):null:$_("This field is required.")}});c.factoryTypes.Checkbox=$.extend({},c.baseFieldType,{setValue:function(a){this.fieldValue=parseInt(a);"null"!=this.currentMode&&this.domElement&&("edit"==this.currentMode?this.domElement.find("input.val").attr("checked",!!this.fieldValue):this.domElement.find(".val").text(this.fieldValue?"Yes":"No"))},newInlineFieldElement:function(a){"edit"==a?(a=$('<span><input class="val" type="checkbox" value="1" checked="checked"></span>'),
this.fieldValue||a.find(".val").removeAttr("checked")):a=$('<span class="val"></span>').text(this.fieldValue?"Yes":"No");return a}});c.factoryTypes.Number=$.extend({},c.baseFieldType,{validate:function(a){var b=$.trim(this.getValue());return a||!this.fieldData.required||b||0===b?b&&!/^-?[0-9]+([\.,][0-9]+$)?/.test(b)?$_("Must be a number."):null:$_("This field is required.")}});return d?c.factoryTypes[d]:c.factoryTypes};
$.wa.fieldTypeFactory=function(c){return $.extend({},$.wa.fieldTypesFactory(null,c))};$.wa.contactEditorFactory=function(c){c=$.extend({contact_id:null,current_user_id:null,contactType:"person",baseFieldType:null,saveUrl:"?module=contacts&action=save",saveGeocoordsUrl:"?module=contacts&action=saveGeocoords",regionsUrl:"?module=backend&action=regions&country=",el:"#contact-info-block",with_inplace_buttons:!0,update_title:!0},c);var d=$.extend({wa_app_url:"",fields:{},fieldsOrder:[],fieldsValues:{},factoryTypes:{},editorFactories:{},fieldEditors:{},initFactories:function(a,b){this.fields=
a;this.fieldsOrder=b;this.editorFactories={};this.fieldEditors={};for(var e=0;e<b.length;e+=1){var f=b[e];if("object"!=typeof a[f]||!a[f].type)throw Error("Field data error for "+f);if("undefined"==typeof this.factoryTypes[a[f].type])throw Error("Unknown factory type: "+a[f].type);this.editorFactories[f]=a[f].multi?$.extend({},this.factoryTypes.Multifield):$.extend({},this.factoryTypes[a[f].type]);this.editorFactories[f].initializeFactory(a[f])}},initAllEditors:function(){for(var a=0;a<this.fieldsOrder.length;a+=
1){var b=this.fieldsOrder[a];"undefined"==typeof this.fieldEditors[b]?this.fieldEditors[b]=this.editorFactories[b].createEditor(this.contactType,b):this.fieldEditors[b].reinit()}},initFieldEditors:function(a){if(!(a instanceof Array)){this.fieldsValues=a;for(var b=0;b<this.fieldsOrder.length;b+=1){var e=this.fieldsOrder[b];if("undefined"==typeof this.editorFactories[e]){$.wa.controller.contactAction([this.contact_id]);break}try{"undefined"==typeof this.fieldEditors[e]&&(this.fieldEditors[e]=this.editorFactories[e].createEditor(this.contactType)),
this.fieldEditors[e].setValue(a[e])}catch(f){console.log("Unable to initialize editor "+e),console.log(f)}}}},initContactInfoBlock:function(a){this.switchMode(a,!0)},_getUrl:function(a){return"string"===typeof this[a]?this[a].slice(0,this.wa_app_url.length)!==this.wa_app_url?this.wa_app_url+this[a]:this[a]:""},getSaveUrl:function(){return this._getUrl("saveUrl")},getSaveGeocoordsUrl:function(){return this._getUrl("saveGeocoordsUrl")},getPasswdSaveUrl:function(){return this._getUrl("passwdSaveUrl")},
getRegionsUrl:function(){return this._getUrl("regionsUrl")},switchMode:function(a,b){var e=$(this.el),f=this;b&&(e.html(""),e.removeClass("edit-mode"),e.removeClass("view-mode"),$(e).add("#contact-info-top").off("click.map",".map-link").on("click.map",".map-link",function(){var n=$(this).parent().data("subfield-index");void 0!==n&&f.geocodeAddress(f.fieldEditors.address.fieldValue,n)}));if("edit"!=a||!e.hasClass("edit-mode"))if("view"!=a||!e.hasClass("view-mode")){$("#tc-contact").trigger("before_switch_mode");
e.find("div.field.buttons").remove();for(var g=[],h=0;h<this.fieldsOrder.length;h+=1){var l=this.fieldsOrder[h];g.push(l);var k=this.fieldEditors[l].setMode(a);$(this).trigger("set_mode",[{mode:a,el:e,field_id:l,field:this.fieldEditors[l]}]);b&&e.append(k)}var m=this;"edit"==a?(e.find(".subname").wrapAll('<div class="subname-wrapper"></div>'),e.find(".jobtitle-company").wrapAll('<div class="jobtitle-company-wrapper"></div>'),this.with_inplace_buttons&&(b=this.inplaceEditorButtons(g,function(n){if("undefined"!=
typeof n&&!n)return!1;if("undefined"!=typeof m.justCreated&&m.justCreated)return n=$("#sb-all-contacts-li .count"),n.text(1+parseInt(n.text())),$.wa.setHash("/contact/"+m.contact_id),!1;m.switchMode("view");$.scrollTo(0);return!1},function(){null==m.contact_id?$.wa.back():(m.switchMode("view"),$.scrollTo(0))}),null===m.contact_id&&b.find(".cancel, .or").remove(),e.append(b),e.removeClass("view-mode"),e.addClass("edit-mode"),$("#edit-contact-double").hide(),e.find(".buttons").sticky({fixed_css:{bottom:0,
background:"#fff",width:"100%",margin:"0"},fixed_class:"sticky-bottom",isStaticVisible:function(n){var q=$(window);n=n.element.offset().top;return q.scrollTop()+q.height()>n}}),e.find(".sticky-bottom .cancel").click(function(){e.find(".buttons:not(.sticky-bottom) .cancel").click();return!1}),e.find(".sticky-bottom :submit").click(function(){e.find(".buttons:not(.sticky-bottom) :submit").click();return!1}))):(e.removeClass("edit-mode"),e.addClass("view-mode"),$("#edit-contact-double").show(),e.find(".subname-wrapper").length&&
e.find(".subname").unwrap(),e.find(".jobtitle-company-wrapper").length&&e.find(".jobtitle-company").unwrap());$("#tc-contact").trigger("after_switch_mode",[a,this])}},saveFields:function(a,b){if(!a){a=[];for(var e in this.fields)this.fields.hasOwnProperty(e)&&a.push(e)}var f={};e=!1;for(var g=0;g<a.length;g++){var h=a[g],l=this.fieldEditors[h].validate();if(l){if(!e)for(e=this.fieldEditors[h].domElement;!e.is(":visible");)e=e.parent();this.fieldEditors[h].showValidationErrors(l)}else this.fieldEditors[h].showValidationErrors(null);
f[h]=this.fieldEditors[h].getValue()}if(e)$.scrollTo(e),$.scrollTo("-=100px"),b(!1);else{var k=function(q,r,u){if(u)for(var p=0;p<u.length;p+=1){if(q[u[p]]&&r[u[p]]&&q[u[p]]!=r[u[p]])return!1}else{for(p in q)if(q.hasOwnProperty(p)&&q[p]&&r[p]&&q[p]!=r[p])return!1;for(p in r)if(r.hasOwnProperty(p)&&q[p]&&r[p]&&q[p]!=r[p])return!1}return!0},m=this,n=function(q){q=void 0===q?!0:q;$.post(m.getSaveUrl(),{data:$.JSON.encode(f),type:m.contactType,id:null!=m.contact_id?m.contact_id:0},function(r){if("ok"!=
r.status)throw new Exception("AJAX error: "+$.JSON.encode(r));r=r.data;r.history&&$.wa.history.updateHistory(r.history);if(r.data&&r.data.top){for(var u="",p=0;p<r.data.top.length;p++){var t=r.data.top[p];u+="<li>"+("im"!=t.id?t.icon?'<i class="icon16 '+t.id+'"></i>':"":"")+t.value+"</li>"}$("#contact-info-top").html(u);delete r.data.top}u=m.fieldsValues||{};null!=m.contact_id&&m.initFieldEditors(r.data);p=!1;for(t in m.fieldEditors)if("undefined"!=typeof r.errors[t]){if(m.fieldEditors[t].showValidationErrors(r.errors[t]),
!p)for(p=m.fieldEditors[t].domElement;!p.is(":visible");)p=p.parent()}else"edit"==m.fieldEditors[t].currentMode&&m.fieldEditors[t].showValidationErrors(null);if(p)$.scrollTo(p),$.scrollTo("-=100px");else if(m.contact_id&&r.data.reload){window.location.reload();return}if(p)b(!p);else if(null===m.contact_id&&(m.justCreated=!0),m.contact_id=r.data.id,q)if(t=$.storage.get("contacts/last_geocoding")||0,3600<(new Date).getTime()-t)if($.storage.del("contacts/last_geocoding"),r=r.data.address,$.isEmptyObject(r))b(!p);
else{var w=[],x=[];for(t=0;t<r.length;t+=1){var y=!0;f.address[t]&&(y=!k(r[t].data,(u.address[t]||{}).data||{},["city","country","region","street","zip"]));y&&(w.push(m.sendGeocodeRequest(r[t].for_map)),x.push(t))}if(w.length){var A=function(v,z){if("OK"===v.status){var B=v.results[0].geometry.location.lng||"";f.address[z].value.lat=v.results[0].geometry.location.lat||"";f.address[z].value.lng=B}else"OVER_QUERY_LIMIT"===v.status&&$.storage.set("contacts/last_geocoding",(new Date).getTime()/1E3)};
$.when.apply($,w).then(function(){if(1>=w.length&&"success"===arguments[1])A(arguments[0],x[0]);else for(var v=0;v<arguments.length;v+=1)"success"===arguments[v][1]&&A(arguments[v][0],x[v]);n.call(m,!1)})}else b(!p)}else b(!p);else b(!p)},"json")};n()}},createExtSelect:function(a,b){var e="",f=!0,g;for(g in a){var h="";if(a[g]===b||g===b)h=' selected="selected"',f=!1;var l=this.htmlentities(a[g]);e+='<option value="'+("undefined"===typeof a.length?g:l)+'"'+h+">"+l+"</option>"}if(f){e+='<option value="%custom" selected="selected">'+
$_("other")+"...</option>";var k='<input type="text" class="small ext">'}else e+='<option value="%custom">'+$_("other")+"...</option>",k='<input type="text" class="small empty ext">';e=$('<span><select class="ext">'+e+"</select><span>"+k+"</span></span>");var m=e.children("select");k=e.find("input");k.val(b);"%custom"!==m.val()&&k.hide();b=$_("which?");var n=function(){k.val()||k.hasClass("empty")||(k.val(b),k.addClass("empty"))};k.blur(n);k.focus(function(){k.hasClass("empty")&&(k.val(""),k.removeClass("empty"))});
m.change(function(){var q=m.val();"%custom"===q?(k.hasClass("empty")&&k.val(b),k.show()):(k.hide(),k.addClass("empty"),k.val(q||""));n()});k[0].getExtValue=function(){return"%custom"===m.val()&&k.hasClass("empty")?"":k.val()};k[0].setExtValue=function(q){a[q]?m.val(q):m.val("%custom");k.val(q)};return e},inplaceEditorButtons:function(a,b,e){var f=$('<div class="field buttons"><div class="value submit"><em class="errormsg" id="validation-notice"></em></div></div>'),g=this,h=function(){$(".buttons .loading").show();
g.saveFields(a,function(m){$(".buttons .loading").hide();b(m)});return!1},l=$('#contact-info-block.edit-mode input[type="text"]',$("#c-core")[0]);l.die("keyup");l.live("keyup",function(m){13!=m.keyCode||$(m.currentTarget).data("autocomplete")&&$(m.currentTarget).data("contact_id")||h()});l=$('<input type="submit" class="button green" value="'+$_("Save")+'" />').click(h);g=this;var k=$('<a href="javascript:void(0)" class="cancel">'+$_("cancel")+"</a>").click(function(m){$(".buttons .loading").hide();
"function"!=typeof e?b():e();g.fieldEditors.name.showValidationErrors(null);$.scrollTo(0);return!1});f.children("div.value.submit").append(l).append('<span class="or"> '+$_("or")+" </span>").append(k).append($('<i class="icon16 loading" style="margin-left: 16px; display: none;"></i>'));return f},destroy:function(){$(this.el).html("")},wrapper:function(a,b,e){e=$('<div class="field'+("undefined"!=typeof e&&e?" "+e:"")+'"></div>');"undefined"!=typeof b&&b&&e.append('<div class="name">'+$.wa.encodeHTML(b)+
"</div>");if("object"!=typeof a||!(a instanceof jQuery)||0>=a.find("div.value").size())a=$('<div class="value"></div>').append(a);e.append(a);return e},setOptions:function(a){this.options=$.extend(c,this.options||{},a)},htmlentities:function(a){var b=document.createElement("div");a=document.createTextNode(a);b.appendChild(a);return b.innerHTML},addressToString:function(a){var b=[],e=["street","city","country","region","zip"];a=$.extend({},a||{});for(var f=0;f<e.length;f+=1)b.push(a[e[f]]||""),delete a[e[f]];
for(var g in a)a.hasOwnProperty(g)&&"lat"!==g&&"lng"!=g&&b.push(a[g]);return b.join(",")},geocodeAddress:function(a,b){var e=this;a[b].data.lat&&a[b].data.lng||this.sendGeocodeRequest(a[b].for_map||a[b].value,function(f){a[b].data.lat=f.lat;a[b].data.lng=f.lng;$.post(e.getSaveGeocoordsUrl(),{id:e.contact_id,lat:f.lat,lng:f.lng,sort:b})})},sendGeocodeRequest:function(a,b,e){var f=[];"string"===typeof a?f.push(a):a.with_street&&a.without_street&&a.with_street===a.without_street?f.push(a.with_street):
(a.with_street&&f.push(a.with_street),a.without_street&&f.push(a.without_street));e=!0;var g=$.Deferred(),h=this;$.ajax({url:"//maps.googleapis.com/maps/api/geocode/json",data:{sensor:!1,address:f[0]},dataType:"json",success:function(l){var k;if(l)if("OK"===l.status){var m=l.results.length;var n=!1;for(k=0;k<m;k+=1)if(!l.results[k].partial_match){m=l.results[k].geometry.location.lat||"";k=l.results[k].geometry.location.lng||"";b instanceof Function&&b({lat:m,lng:k});n=!0;break}n?g.resolve([l,"success"]):
e?(m=l.results[0].geometry.location.lat||"",k=l.results[0].geometry.location.lng||"",b instanceof Function&&b({lat:m,lng:k}),g.resolve([l,"success"])):f[1]?h.sendGeocodeRequest(f[1],b,!0).always(function(q){g.resolve(q)}):g.resolve([l,"success"])}else g.resolve([l,"success"]);else g.resolve([{},"error"])},error:function(l){g.resolve([l,"error"])}});return g},switchToTab:function(a,b,e,f){"string"==typeof a&&("t-"==a.substr(0,2)?a="#"+a:"#"!=a[0]&&(a="#t-"+a));a=$(a);if(!(0>=a.size()||a.hasClass("selected"))){if(!f){var g=
a.attr("id");if(!g||"t-"!=g.substr(0,2))return;f=$("#tc-"+g.substr(2))}e&&(g=a.parent().children(".selected"),0<g.size()&&g.each(function(l,k){e.call(k)}));var h=function(){a.parent().find("li.selected").removeClass("selected");a.removeClass("hidden").css("display","").addClass("selected");f.siblings(".tab-content").addClass("hidden");f.removeClass("hidden");b&&b.call(a[0]);$("#c-info-tabs").trigger("after_switch_tab",[a])};$("#c-info-tabs").trigger("before_switch_tab",[a]);$.effects&&$.effects.slideDIB&&
!a.is(":visible")?($.wa.controller.loadTabSlidingAnimation(),a.hide().removeClass("hidden").show("slideDIB",{direction:"down"},300,function(){h()})):h()}},initCheckboxList:function(a){a=$(a);var b=function(e,f){e=$(f||this);e.is(":checked")?e.parent().addClass("highlighted"):e.parent().removeClass("highlighted")};a.find('input[type="checkbox"]').click(b).each(b);return a},load:function(a,b,e,f,g){var h=Math.random(),l=this;l.random=h;$.get(b,e,function(k){l.random==h&&(f&&f.call(l),$(window).trigger("wa_before_load",
[a,b,e,k]),$(a).html(k),$(window).trigger("wa_after_load",[a,b,e,k]),g&&g.call(l))})}},c);$.wa.fieldTypesFactory(d);return d};$.wa.contactEditor=$.wa.contactEditorFactory();
//# sourceMappingURL=contacts.js.map