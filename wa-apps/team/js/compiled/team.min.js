/*
 jquery-timepicker v1.11.5 - A jQuery timepicker plugin inspired by Google Calendar. It supports both mouse and keyboard navigation.
 Copyright (c) 2016 Jon Thornton - http://jonthornton.github.com/jquery-timepicker/
 License: MIT
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(b){return b.raw=b};$jscomp.createTemplateTagFirstArgWithRaw=function(b,a){b.raw=a;return b};$jscomp.arrayIteratorImpl=function(b){var a=0;return function(){return a<b.length?{done:!1,value:b[a++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};
$jscomp.makeIterator=function(b){var a="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];if(a)return a.call(b);if("number"==typeof b.length)return $jscomp.arrayIterator(b);throw Error(String(b)+" is not an iterable or ArrayLike");};$jscomp.arrayFromIterator=function(b){for(var a,e=[];!(a=b.next()).done;)e.push(a.value);return e};$jscomp.arrayFromIterable=function(b){return b instanceof Array?b:$jscomp.arrayFromIterator($jscomp.makeIterator(b))};
$jscomp.findInternal=function(b,a,e){b instanceof String&&(b=String(b));for(var c=b.length,d=0;d<c;d++){var f=b[d];if(a.call(e,f,d,b))return{i:d,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,e){if(b==Array.prototype||b==Object.prototype)return b;b[a]=e.value;return b};$jscomp.getGlobal=function(b){b=["object"==typeof globalThis&&globalThis,b,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var a=0;a<b.length;++a){var e=b[a];if(e&&e.Math==Math)return e}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(b,a,e){if(!e||null!=b){e=$jscomp.propertyToPolyfillSymbol[a];if(null==e)return b[a];e=b[e];return void 0!==e?e:b[a]}};
$jscomp.polyfill=function(b,a,e,c){a&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(b,a,e,c):$jscomp.polyfillUnisolated(b,a,e,c))};$jscomp.polyfillUnisolated=function(b,a,e,c){e=$jscomp.global;b=b.split(".");for(c=0;c<b.length-1;c++){var d=b[c];if(!(d in e))return;e=e[d]}b=b[b.length-1];c=e[b];a=a(c);a!=c&&null!=a&&$jscomp.defineProperty(e,b,{configurable:!0,writable:!0,value:a})};
$jscomp.polyfillIsolated=function(b,a,e,c){var d=b.split(".");b=1===d.length;c=d[0];c=!b&&c in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<d.length-1;f++){var g=d[f];if(!(g in c))return;c=c[g]}d=d[d.length-1];e=$jscomp.IS_SYMBOL_NATIVE&&"es6"===e?c[d]:null;a=a(e);null!=a&&(b?$jscomp.defineProperty($jscomp.polyfills,d,{configurable:!0,writable:!0,value:a}):a!==e&&(void 0===$jscomp.propertyToPolyfillSymbol[d]&&(e=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[d]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(d):$jscomp.POLYFILL_PREFIX+e+"$"+d),$jscomp.defineProperty(c,$jscomp.propertyToPolyfillSymbol[d],{configurable:!0,writable:!0,value:a})))};$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(a,e){return $jscomp.findInternal(this,a,e).v}},"es6","es3");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(b){if(b)return b;var a=function(f,g){this.$jscomp$symbol$id_=f;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:g})};a.prototype.toString=function(){return this.$jscomp$symbol$id_};var e="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",c=0,d=function(f){if(this instanceof d)throw new TypeError("Symbol is not a constructor");return new a(e+(f||"")+"_"+c++,f)};return d},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(b){if(b)return b;b=Symbol("Symbol.iterator");for(var a="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),e=0;e<a.length;e++){var c=$jscomp.global[a[e]];"function"===typeof c&&"function"!=typeof c.prototype[b]&&$jscomp.defineProperty(c.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return b},"es6",
"es3");$jscomp.iteratorPrototype=function(b){b={next:b};b[Symbol.iterator]=function(){return this};return b};$jscomp.iteratorFromArray=function(b,a){b instanceof String&&(b+="");var e=0,c=!1,d={next:function(){if(!c&&e<b.length){var f=e++;return{value:a(f,b[f]),done:!1}}c=!0;return{done:!0,value:void 0}}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.polyfill("Array.prototype.entries",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(a,e){return[a,e]})}},"es6","es3");$jscomp.polyfill("Object.is",function(b){return b?b:function(a,e){return a===e?0!==a||1/a===1/e:a!==a&&e!==e}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(b){return b?b:function(a,e){var c=this;c instanceof String&&(c=String(c));var d=c.length;e=e||0;for(0>e&&(e=Math.max(e+d,0));e<d;e++){var f=c[e];if(f===a||Object.is(f,a))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(b,a,e){if(null==b)throw new TypeError("The 'this' value for String.prototype."+e+" must not be null or undefined");if(a instanceof RegExp)throw new TypeError("First argument to String.prototype."+e+" must not be a regular expression");return b+""};$jscomp.polyfill("String.prototype.includes",function(b){return b?b:function(a,e){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,e||0)}},"es6","es3");
$jscomp.polyfill("String.prototype.repeat",function(b){return b?b:function(a){var e=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var c="";a;)if(a&1&&(c+=e),a>>>=1)e+=e;return c}},"es6","es3");$jscomp.stringPadding=function(b,a){b=void 0!==b?String(b):" ";return 0<a&&b?b.repeat(Math.ceil(a/b.length)).substring(0,a):""};
$jscomp.polyfill("String.prototype.padStart",function(b){return b?b:function(a,e){var c=$jscomp.checkStringArgs(this,null,"padStart");return $jscomp.stringPadding(e,a-c.length)+c}},"es8","es3");
!function(b){"object"==typeof exports&&exports&&"object"==typeof module&&module&&module.exports===exports?b(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],b):b(jQuery)}(function(b){function a(k){k=k[0];return 0<k.offsetWidth&&0<k.offsetHeight}function e(k){if(k.minTime&&(k.minTime=A(k.minTime)),k.maxTime&&(k.maxTime=A(k.maxTime)),k.durationTime&&"function"!=typeof k.durationTime&&(k.durationTime=A(k.durationTime)),"now"==k.scrollDefault)k.scrollDefault=function(){return k.roundingFunction(A(new Date),
k)};else if(k.scrollDefault&&"function"!=typeof k.scrollDefault){var r=k.scrollDefault;k.scrollDefault=function(){return k.roundingFunction(A(r),k)}}else k.minTime&&(k.scrollDefault=function(){return k.roundingFunction(k.minTime,k)});if("string"===b.type(k.timeFormat)&&k.timeFormat.match(/[gh]/)&&(k._twelveHourTime=!0),!1===k.showOnFocus&&-1!=k.showOn.indexOf("focus")&&k.showOn.splice(k.showOn.indexOf("focus"),1),0<k.disableTimeRanges.length){for(var p in k.disableTimeRanges)k.disableTimeRanges[p]=
[A(k.disableTimeRanges[p][0]),A(k.disableTimeRanges[p][1])];k.disableTimeRanges=k.disableTimeRanges.sort(function(u,w){return u[0]-w[0]});for(p=k.disableTimeRanges.length-1;0<p;p--)k.disableTimeRanges[p][0]<=k.disableTimeRanges[p-1][1]&&(k.disableTimeRanges[p-1]=[Math.min(k.disableTimeRanges[p][0],k.disableTimeRanges[p-1][0]),Math.max(k.disableTimeRanges[p][1],k.disableTimeRanges[p-1][1])],k.disableTimeRanges.splice(p,1))}return k}function c(k){var r=k.data("timepicker-settings"),p=k.data("timepicker-list");
if(p&&p.length&&(p.remove(),k.data("timepicker-list",!1)),r.useSelect)var u=p=b("<select />",{"class":"ui-timepicker-select"});else p=b("<ul />",{"class":"ui-timepicker-list"}),u=b("<div />",{"class":"ui-timepicker-wrapper",tabindex:-1}),u.css({display:"none",position:"absolute"}).append(p);if(r.noneOption)if(!0===r.noneOption&&(r.noneOption=r.useSelect?"Time...":"None"),b.isArray(r.noneOption))for(var w in r.noneOption){if(parseInt(w,10)==w){var D=d(r.noneOption[w],r.useSelect);p.append(D)}}else D=
d(r.noneOption,r.useSelect),p.append(D);(r.className&&u.addClass(r.className),null===r.minTime&&null===r.durationTime||!r.showDuration)||("function"==typeof r.step?"function":r.step,u.addClass("ui-timepicker-with-duration"),u.addClass("ui-timepicker-step-"+r.step));D=r.minTime;"function"==typeof r.durationTime?D=A(r.durationTime()):null!==r.durationTime&&(D=r.durationTime);w=null!==r.minTime?r.minTime:0;var H=null!==r.maxTime?r.maxTime:w+G-1;w>H&&(H+=G);H===G-1&&"string"===b.type(r.timeFormat)&&r.show2400&&
(H=G);var L=r.disableTimeRanges,K=0,Q=L.length,N=r.step;"function"!=typeof N&&(N=function(){return r.step});for(var O=0;H>=w;O++,w+=60*N(O)){var J=w,M=C(J,r);if(r.useSelect)var I=b("<option />",{value:M});else I=b("<li />"),I.addClass(43200>J%86400?"ui-timepicker-am":"ui-timepicker-pm"),I.data("time",86400>=J?J:J%86400);I.text(M);if((null!==r.minTime||null!==r.durationTime)&&r.showDuration)if(M=B(w-D,r.step),r.useSelect)I.text(I.text()+" ("+M+")");else{var P=b("<span />",{"class":"ui-timepicker-duration"});
P.text(" ("+M+")");I.append(P)}Q>K&&(J>=L[K][1]&&(K+=1),L[K]&&J>=L[K][0]&&J<L[K][1]&&(r.useSelect?I.prop("disabled",!0):I.addClass("ui-timepicker-disabled")));p.append(I)}(u.data("timepicker-input",k),k.data("timepicker-list",u),r.useSelect)?(k.val()&&p.val(f(A(k.val()),r)),p.on("focus",function(){b(this).data("timepicker-input").trigger("showTimepicker")}),p.on("blur",function(){b(this).data("timepicker-input").trigger("hideTimepicker")}),p.on("change",function(){t(k,b(this).val(),"select")}),t(k,
p.val(),"initial"),k.hide().after(p)):(w=r.appendTo,"string"==typeof w?w=b(w):"function"==typeof w&&(w=w(k)),w.append(u),n(k,p),p.on("mousedown click","li",function(R){k.off("focus.timepicker");k.on("focus.timepicker-ie-hack",function(){k.off("focus.timepicker-ie-hack");k.on("focus.timepicker",F.show)});h(k)||k[0].focus();p.find("li").removeClass("ui-timepicker-selected");b(this).addClass("ui-timepicker-selected");E(k)&&(k.trigger("hideTimepicker"),p.on("mouseup.timepicker click.timepicker","li",
function(S){p.off("mouseup.timepicker click.timepicker");u.hide()}))}))}function d(k,r){var p,u,w;return"object"==typeof k?(p=k.label,u=k.className,w=k.value):"string"==typeof k?p=k:b.error("Invalid noneOption value"),r?b("<option />",{value:w,"class":u,text:p}):b("<li />",{"class":u,text:p}).data("time",String(w))}function f(k,r){return k=r.roundingFunction(k,r),null!==k?C(k,r):void 0}function g(k){k.target!=window&&(k=b(k.target),k.closest(".ui-timepicker-input").length||k.closest(".ui-timepicker-wrapper").length||
(F.hide(),b(document).unbind(".ui-timepicker"),b(window).unbind(".ui-timepicker")))}function h(k){k=k.data("timepicker-settings");return(window.navigator.msMaxTouchPoints||"ontouchstart"in document)&&k.disableTouchKeyboard}function m(k,r,p){if(!p&&0!==p)return!1;k=k.data("timepicker-settings");var u=!1;p=k.roundingFunction(p,k);return r.find("li").each(function(w,D){w=b(D);if("number"==typeof w.data("time"))return w.data("time")==p?(u=w,!1):void 0}),u}function n(k,r){r.find("li").removeClass("ui-timepicker-selected");
var p=A(q(k),k.data("timepicker-settings"));null!==p&&(k=m(k,r,p))&&(p=k.offset().top-r.offset().top,(p+k.outerHeight()>r.outerHeight()||0>p)&&r.scrollTop(r.scrollTop()+k.position().top-k.outerHeight()),k.addClass("ui-timepicker-selected"))}function l(k,r){if(""!==this.value&&"timepicker"!=r){var p=b(this);if(!p.is(":focus")||k&&"change"==k.type){k=p.data("timepicker-settings");var u=A(this.value,k);if(null===u)return void p.trigger("timeFormatError");var w=!1;if(null!==k.minTime&&null!==k.maxTime&&
(u<k.minTime||u>k.maxTime)&&(w=!0),b.each(k.disableTimeRanges,function(){return u>=this[0]&&u<this[1]?(w=!0,!1):void 0}),k.forceRoundTime){var D=k.roundingFunction(u,k);D!=u&&(u=D,r=null)}k=C(u,k);w?t(p,k,"error")&&p.trigger("timeRangeError"):t(p,k,r)}}}function q(k){return k.is("input")?k.val():k.data("ui-timepicker-value")}function t(k,r,p){if(k.is("input")){k.val(r);var u=k.data("timepicker-settings");u.useSelect&&"select"!=p&&"initial"!=p&&k.data("timepicker-list").val(f(A(r),u))}return k.data("ui-timepicker-value")!=
r?(k.data("ui-timepicker-value",r),"select"==p?k.trigger("selectTime").trigger("changeTime").trigger("change","timepicker"):-1==["error","initial"].indexOf(p)&&k.trigger("changeTime"),!0):(k.trigger("selectTime"),!1)}function v(k){switch(k.keyCode){case 13:case 9:break;default:k.preventDefault()}}function y(k){var r=b(this),p=r.data("timepicker-list");if(!p||!a(p)){if(40!=k.keyCode)return!0;F.show.call(r.get(0));p=r.data("timepicker-list");h(r)||r.focus()}switch(k.keyCode){case 13:return E(r)&&(l.call(r.get(0),
{type:"change"}),F.hide.apply(this)),k.preventDefault(),!1;case 38:var u=p.find(".ui-timepicker-selected");return u.length?u.is(":first-child")||(u.removeClass("ui-timepicker-selected"),u.prev().addClass("ui-timepicker-selected"),u.prev().position().top<u.outerHeight()&&p.scrollTop(p.scrollTop()-u.outerHeight())):(p.find("li").each(function(w,D){return 0<b(D).position().top?(u=b(D),!1):void 0}),u.addClass("ui-timepicker-selected")),!1;case 40:return u=p.find(".ui-timepicker-selected"),0===u.length?
(p.find("li").each(function(w,D){return 0<b(D).position().top?(u=b(D),!1):void 0}),u.addClass("ui-timepicker-selected")):u.is(":last-child")||(u.removeClass("ui-timepicker-selected"),u.next().addClass("ui-timepicker-selected"),u.next().position().top+2*u.outerHeight()>p.outerHeight()&&p.scrollTop(p.scrollTop()+u.outerHeight())),!1;case 27:p.find("li").removeClass("ui-timepicker-selected");F.hide();break;case 9:F.hide();break;default:return!0}}function z(k){var r=b(this),p=r.data("timepicker-list"),
u=r.data("timepicker-settings");if(!p||!a(p)||u.disableTextInput)return!0;switch(k.keyCode){case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 65:case 77:case 80:case 186:case 8:case 46:u.typeaheadHighlight?n(r,p):p.hide()}}function E(k){var r=k.data("timepicker-settings"),p=null,u=k.data("timepicker-list").find(".ui-timepicker-selected");return u.hasClass("ui-timepicker-disabled")?
!1:(u.length&&(p=u.data("time")),null!==p&&("string"!=typeof p&&(p=C(p,r)),t(k,p,"select")),!0)}function B(k,r){k=Math.abs(k);var p,u;k=Math.round(k/60);var w=[];return 60>k?w=[k,x.mins]:(p=Math.floor(k/60),u=k%60,30==r&&30==u&&(p+=x.decimal+5),w.push(p),w.push(1==p?x.hr:x.hrs),30!=r&&u&&(w.push(u),w.push(x.mins))),w.join(" ")}function C(k,r){if("number"!=typeof k)return null;var p=parseInt(k%60),u=parseInt(k/60%60),w=parseInt(k/3600%24);w=new Date(1970,0,2,w,u,p,0);if(isNaN(w.getTime()))return null;
if("function"===b.type(r.timeFormat))return r.timeFormat(w);for(var D="",H=0;H<r.timeFormat.length;H++)switch(p=r.timeFormat.charAt(H)){case "a":D+=11<w.getHours()?x.pm:x.am;break;case "A":D+=11<w.getHours()?x.PM:x.AM;break;case "g":p=w.getHours()%12;D+=0===p?"12":p;break;case "G":p=w.getHours();k===G&&(p=r.show2400?24:0);D+=p;break;case "h":p=w.getHours()%12;0!==p&&10>p&&(p="0"+p);D+=0===p?"12":p;break;case "H":p=w.getHours();k===G&&(p=r.show2400?24:0);D+=9<p?p:"0"+p;break;case "i":u=w.getMinutes();
D+=9<u?u:"0"+u;break;case "s":p=w.getSeconds();D+=9<p?p:"0"+p;break;case "\\":H++;D+=r.timeFormat.charAt(H);break;default:D+=p}return D}function A(k,r){if(""===k||null===k)return null;if("object"==typeof k)return 3600*k.getHours()+60*k.getMinutes()+k.getSeconds();if("string"!=typeof k)return k;k=k.toLowerCase().replace(/[\s\.]/g,"");"a"!=k.slice(-1)&&"p"!=k.slice(-1)||(k+="m");var p="("+x.am.replace(".","")+"|"+x.pm.replace(".","")+"|"+x.AM.replace(".","")+"|"+x.PM.replace(".","")+")?",u=k.match(new RegExp("^"+
p+"([0-9]?[0-9])\\W?([0-5][0-9])?\\W?([0-5][0-9])?"+p+"$"));if(!u)return null;k=parseInt(1*u[2],10);if(24<k){if(r&&!1===r.wrapHours)return null;k%=24}p=u[1]||u[5];var w=k;12>=k&&p&&(w=p==x.pm||p==x.PM,w=12==k?w?12:0:k+(w?12:0));u=3600*w+60*(1*u[3]||0)+(1*u[4]||0);12>k&&!p&&r&&r._twelveHourTime&&r.scrollDefault&&(r=u-r.scrollDefault(),0>r&&r>=G/-2&&(u=(u+G/2)%G));return u}var G=86400,x={am:"am",pm:"pm",AM:"AM",PM:"PM",decimal:".",mins:"mins",hr:"hr",hrs:"hrs"},F={init:function(k){return this.each(function(){var r=
b(this),p=[],u;for(u in b.fn.timepicker.defaults)r.data(u)&&(p[u]=r.data(u));p=b.extend({},b.fn.timepicker.defaults,p,k);if(p.lang&&(x=b.extend(x,p.lang)),p=e(p),r.data("timepicker-settings",p),r.addClass("ui-timepicker-input"),p.useSelect)c(r);else{if(r.prop("autocomplete","off"),p.showOn)for(var w in p.showOn)r.on(p.showOn[w]+".timepicker",F.show);r.on("change.timepicker",l);r.on("keydown.timepicker",y);r.on("keyup.timepicker",z);p.disableTextInput&&r.on("keydown.timepicker",v);l.call(r.get(0),
null,"initial")}})},show:function(k){var r=b(this),p=r.data("timepicker-settings");if(k&&k.preventDefault(),p.useSelect)return void r.data("timepicker-list").focus();h(r)&&r.blur();k=r.data("timepicker-list");if(!r.prop("readonly")&&(k&&0!==k.length&&"function"!=typeof p.durationTime||(c(r),k=r.data("timepicker-list")),!a(k))){r.data("ui-timepicker-value",r.val());n(r,k);F.hide();k.show();var u={};p.orientation.match(/r/)?u.left=r.offset().left+r.outerWidth()-k.outerWidth()+parseInt(k.css("marginLeft").replace("px",
""),10):u.left=r.offset().left+parseInt(k.css("marginLeft").replace("px",""),10);"t"==(p.orientation.match(/t/)?"t":p.orientation.match(/b/)?"b":r.offset().top+r.outerHeight(!0)+k.outerHeight()>b(window).height()+b(window).scrollTop()?"t":"b")?(k.addClass("ui-timepicker-positioned-top"),u.top=r.offset().top-k.outerHeight()+parseInt(k.css("marginTop").replace("px",""),10)):(k.removeClass("ui-timepicker-positioned-top"),u.top=r.offset().top+r.outerHeight()+parseInt(k.css("marginTop").replace("px",""),
10));k.offset(u);u=k.find(".ui-timepicker-selected");if(!u.length){var w=A(q(r));null!==w?u=m(r,k,w):p.scrollDefault&&(u=m(r,k,p.scrollDefault()))}u&&u.length?(u=k.scrollTop()+u.position().top-u.outerHeight(),k.scrollTop(u)):k.scrollTop(0);return p.stopScrollPropagation&&b(document).on("wheel.ui-timepicker",".ui-timepicker-wrapper",function(D){D.preventDefault();var H=b(this).scrollTop();b(this).scrollTop(H+D.originalEvent.deltaY)}),b(document).on("touchstart.ui-timepicker mousedown.ui-timepicker",
g),b(window).on("resize.ui-timepicker",g),p.closeOnWindowScroll&&b(document).on("scroll.ui-timepicker",g),r.trigger("showTimepicker"),this}},hide:function(k){k=b(this);var r=k.data("timepicker-settings");return r&&r.useSelect&&k.blur(),b(".ui-timepicker-wrapper").each(function(){var p=b(this);if(a(p)){var u=p.data("timepicker-input"),w=u.data("timepicker-settings");w&&w.selectOnBlur&&E(u);p.hide();u.trigger("hideTimepicker")}}),this},option:function(k,r){return"string"==typeof k&&"undefined"==typeof r?
b(this).data("timepicker-settings")[k]:this.each(function(){var p=b(this),u=p.data("timepicker-settings"),w=p.data("timepicker-list");"object"==typeof k?u=b.extend(u,k):"string"==typeof k&&(u[k]=r);u=e(u);p.data("timepicker-settings",u);w&&(w.remove(),p.data("timepicker-list",!1));u.useSelect&&c(p)})},getSecondsFromMidnight:function(){return A(q(this))},getTime:function(k){var r=q(this);if(!r)return null;r=A(r);if(null===r)return null;k||(k=new Date);k=new Date(k);return k.setHours(r/3600),k.setMinutes(r%
3600/60),k.setSeconds(r%60),k.setMilliseconds(0),k},isVisible:function(){var k=this.data("timepicker-list");return!(!k||!a(k))},setTime:function(k){var r=this.data("timepicker-settings"),p=r.forceRoundTime?f(A(k),r):C(A(k),r);return k&&null===p&&r.noneOption&&(p=k),t(this,p),this.data("timepicker-list")&&n(this,this.data("timepicker-list")),this},remove:function(){if(this.hasClass("ui-timepicker-input")){var k=this.data("timepicker-settings");return this.removeAttr("autocomplete","off"),this.removeClass("ui-timepicker-input"),
this.removeData("timepicker-settings"),this.off(".timepicker"),this.data("timepicker-list")&&this.data("timepicker-list").remove(),k.useSelect&&this.show(),this.removeData("timepicker-list"),this}}};b.fn.timepicker=function(k){return this.length?F[k]?this.hasClass("ui-timepicker-input")?F[k].apply(this,Array.prototype.slice.call(arguments,1)):this:"object"!=typeof k&&k?void b.error("Method "+k+" does not exist on jQuery.timepicker"):F.init.apply(this,arguments):this};b.fn.timepicker.defaults={appendTo:"body",
className:null,closeOnWindowScroll:!1,disableTextInput:!1,disableTimeRanges:[],disableTouchKeyboard:!1,durationTime:null,forceRoundTime:!1,maxTime:null,minTime:null,noneOption:!1,orientation:"l",roundingFunction:function(k,r){if(null===k)return null;if("number"!=typeof r.step)return k;var p=k%(60*r.step);return p>=30*r.step?k+=60*r.step-p:k-=p,k==G&&r.show2400?k:k%G},scrollDefault:null,selectOnBlur:!1,show2400:!1,showDuration:!1,showOn:["click","focus"],showOnFocus:!0,step:30,stopScrollPropagation:!1,
timeFormat:"g:ia",typeaheadHighlight:!0,useSelect:!1,wrapHours:!0}});(function(b){b.team={app_url:!1,content:!1,sidebar:!1,calendar:!1,profile:!1,title_pattern:"Team \u2014 %s",init:function(a){["is_debug","app_url","locales"].forEach(function(e){b.team[e]=a[e]});b(document).ajaxSend(function(e,c,d){d.crossDomain||"POST"!==(d.type||"").toUpperCase()||(e=(e=document.cookie.match(RegExp("(?:^|; )_csrf=([^;]*)")))?decodeURIComponent(e[1]):"",d.data=d.data||"","string"==typeof d.data?-1==d.data.indexOf("_csrf=")&&(d.data+=(0<d.data.length?"&":"")+"_csrf="+e,c.setRequestHeader("Content-type",
"application/x-www-form-urlencoded")):"object"==typeof d.data&&(d.data._csrf=e))});b.team.content=new ContentRouter({$content:b("#t-content")});b.team.setSync()},setTitle:function(a){if(a){var e=history.state;e&&(e.title=a);document.title=b.team.title_pattern.replace("%s",a)}},confirmContactDelete:function(a,e){b.post("?module=users&action=prepareDelete",{id:a},function(c){b.waDialog({html:c,onOpen:function(d,f){var g=d.data("allowed-ids"),h=d.find(".js-delete-button");f.$document.trigger("wa_confirm_contact_delete_dialog");
if(g)h.on("click",function(){var m=h.text(),n=d.find('[name="delete_forever"]:checked').attr("value");h.attr("disabled",!0).html(m+' <i class="fas fa-spin fa-spinner wa-animation-spin speed-1000"></i>');b.post("?module=users&action=delete",{delete_forever:n,id:g},function(){f.close();b.team.sidebar.reload();e?b.team.content.reload():b.team.content.load(b.team.app_url)}).always(function(){h.attr("disabled",!1).html(m)})})}})})},setSync:function(){function a(){b.post(b.team.app_url+"?module=calendarExternal&action=sync&background_process=1").always(function(){setTimeout(a,
e)}).error(function(){return!1})}var e=3E4+Math.floor(100*Math.random())/100*3E4;setTimeout(a,b.team.is_debug?100:e/2)},notification:function(a){var e,c=a.appendTo||document.body,d=null!=(e=a.isCloseable)?e:!0;e=a.alertTimeout||!1;var f=c.querySelector("#t-notifications"),g=document.createElement("div");g.classList.add("alert",a.alertClass||"info");g.innerHTML=a.alertContent||"";if(d){d=a.alertCloseClass||"js-alert-error-close";var h=document.createElement("a");h.classList.add("alert-close",d);h.setAttribute("href",
"javascript:void(0)");h.innerHTML='<i class="fas fa-times"></i>';g.insertAdjacentElement("afterbegin",h);h.addEventListener("click",function(){this.closest(".alert").remove()})}f||(f=document.createElement("div"),f.className="alert-fixed-box",a.alertPlacement&&f.classList.add(a.alertPlacement),a.alertSize&&f.classList.add(a.alertSize),f.id="t-notifications",c.append(f));a.alertPlacement?f.prepend(g):f.append(g);e&&setTimeout(function(){return g.remove()},e)}}})(jQuery);
var ContentRouter=function(b){ContentRouter=function(a){this.$window=b(window);this.$content=a.$content;this.$app=b("#wa-app");this.api_enabled=window.history&&window.history.pushState;this.scrollTop=a.scrollTop||!0;this.xhr=!1;this.is_enabled=!0;this.waLoading=b.waLoading();this.initClass()};ContentRouter.prototype.initClass=function(){this.bindEvents()};ContentRouter.prototype.bindEvents=function(){var a=this,e=window.location.origin+b.team.app_url;a.$app.on("click","a",function(c){if(!b(this)[0].hasAttribute("data-disable-routing")){var d=
a.is_enabled&&this.href.substr(0,e.length)==e;c.ctrlKey||c.shiftKey||c.metaKey||!d||(c.preventDefault(),a.load(this.href))}});b("#wa-app-team").on("click","a",function(c){c.stopPropagation()});a.api_enabled&&(window.onpopstate=function(c){c.stopPropagation();a.onPopState(c)})};ContentRouter.prototype.load=function(a,e){var c=this;if(!(0<=a.indexOf(b.team.app_url)))return alert("Determine the path error"),!1;c.xhr&&c.xhr.abort();b(document).trigger("wa_before_load",{content_uri:a});c.animate(!0);c.xhr=
b.get(a,function(d){!e&&c.api_enabled&&history.pushState({reload:!0,content_uri:a},"",a);c.setContent(d);c.animate(!1);c.xhr=!1;b(document).trigger("wa_loaded")})};ContentRouter.prototype.reload=function(a){var e,c=this.api_enabled&&history.state&&(null==(e=history.state)?0:e.content_uri)?history.state.content_uri:!1;a&&(c=location.href);(c||a)&&this.load(c,!0)};ContentRouter.prototype.setContent=function(a){this.$content.html(a);this.scrollTop&&window.scrollTo(0,0)};ContentRouter.prototype.onPopState=
function(a){if(a=a.state||!1){if(!a.content_uri)return alert("Determine the path error"),!1;b(document).trigger("wa_before_load",{content_uri:a.content_uri});a.reload?this.reload(a.content_uri):a.content&&this.setContent(a.content);a.title&&b.team.setTitle(a.title);b.team.sidebar.selectLink(a.content_uri);b(document).trigger("wa_loaded")}else location.reload()};ContentRouter.prototype.animate=function(a){a?this.waLoading.animate(3E3,96,!1):this.waLoading.done()};return ContentRouter}(jQuery),TeamDialog=
function(b){TeamDialog=function(a){this.$wrapper=b(a.html);this.$block=!1;if(this.is_full_screen=this.$wrapper.hasClass("is-full-screen"))this.$block=this.$wrapper.find(".t-dialog-block");this.position=a.position||!1;this.is_closed=!1;this.userPosition=a.setPosition||!1;this.onBgClick=a.onBgClick||!1;this.onOpen=a.onOpen||function(){};this.onClose=a.onClose||function(){};this.onRefresh=a.onRefresh||!1;this.onResize=a.onResize||!1;this.initClass()};TeamDialog.prototype.initClass=function(){this.$wrapper.data("teamDialog",
this);this.show();this.bindEvents()};TeamDialog.prototype.bindEvents=function(){var a=this,e=b(document),c=a.$block?a.$block:a.$wrapper;setTimeout(function(){function d(){a.is_closed||a.close();e.off("click",d);e.off("wa_before_load",d)}function f(){b.contains(document,a.$wrapper[0])?a.resize():b(window).off("resize",f)}e.on("click",d);e.on("wa_before_load",d);a.$wrapper.on("close",d);if(a.is_full_screen)a.$wrapper.on("click",".t-dialog-background",function(g){if(a.onBgClick)a.onBgClick(g);else g.stopPropagation()});
c.on("click",function(g){g.stopPropagation()});b(document).on("keyup",function(g){27===g.keyCode&&a.close()});c.on("click",".js-close-dialog",function(){d()});if(a.is_full_screen)b(window).on("resize",f)},0)};TeamDialog.prototype.show=function(){b("body").append(this.$wrapper);this.setPosition();this.onOpen(this.$wrapper,this)};TeamDialog.prototype.setPosition=function(){function a(m){return{left:parseInt((c-m.width)/2),top:parseInt((d-m.height)/2)}}var e=b(window),c=e.width(),d=this.is_full_screen?
e.height():b(document).height();e=this.$block?this.$block:this.$wrapper;var f=e.outerWidth(),g=e.outerHeight();var h=this.position?this.position:(this.userPosition?this.userPosition:a)({width:f,height:g});0<h.left&&h.left+f>c&&(h.left=c-f-10);0<h.top?h.top+g>d&&(h.top=d-g-10):(h.top=10,this.is_full_screen&&(f=e.find(".t-dialog-content"),f.hide(),g=e.outerHeight(),f.height(d-g-20).addClass("is-long-content").show()));e.css(h)};TeamDialog.prototype.close=function(){this.is_closed=!0;this.$wrapper.remove();
this.onClose(this.$wrapper,this)};TeamDialog.prototype.refresh=function(){this.onRefresh&&(this.onRefresh(),this.close())};TeamDialog.prototype.resize=function(){this.$block.addClass("is-animated");this.setPosition();if(this.onResize)this.onResize(this.$wrapper,this)};return TeamDialog}(jQuery),TeamEditable=function(b){TeamEditable=function(a,e){this.$wrapper=a;this.options=e;this.initClass()};TeamEditable.prototype.initClass=function(){this.bindEvents()};TeamEditable.prototype.bindEvents=function(){this.$wrapper.on("keydown",
b.proxy(this.checkPressEnter,this));this.$wrapper.on("focus",b.proxy(this.enableEditor,this));this.$wrapper.on("blur",b.proxy(this.disableEditor,this));this.$wrapper.on("paste",b.proxy(this.clearHtml,this))};TeamEditable.prototype.checkPressEnter=function(a){13===a.keyCode&&(a.preventDefault(),this.$wrapper.blur())};TeamEditable.prototype.cacheText=function(){this.cachedText=this.$wrapper.text()};TeamEditable.prototype.enableEditor=function(){this.cacheText();this.$wrapper.addClass("editable-highlight")};
TeamEditable.prototype.disableEditor=function(){this.$wrapper.removeClass("editable-highlight");this.$wrapper.text()!==this.cachedText&&this.save()};TeamEditable.prototype.clearHtml=function(a){a.preventDefault();a=a.originalEvent.clipboardData.getData("text/plain");a=a.replace(/<[^>]*>?/gm,"");document.queryCommandSupported("insertText")?document.execCommand("insertText",!1,a):document.execCommand("paste",!1,a)};TeamEditable.prototype.save=function(){var a=this,e={};e=(e["data[id]"]=a.options.groupId,
e[a.options.target]=a.$wrapper.text(),e);var c=b('<span class="smaller text-gray custom-ml-4"><i class="fas fa-spin fa-spinner wa-animation-spin speed-1000"></i></span>');a.$wrapper.append(c);b.post(a.options.api.save,e,function(){c.remove();a.options.reloadSidebar&&b.team.sidebar.reload()})};return TeamEditable}($);var Sidebar=function(b){Sidebar=function(a,e){this.$wrapper=a;this.options=e;this.initClass()};Sidebar.prototype.initClass=function(){this.$body=this.$wrapper.find(".sidebar-body");this.$addUserLink=this.$wrapper.find("#t-new-user-link");this.$groupsWrapper=this.$wrapper.find(".t-groups-list");this.$groups=this.$groupsWrapper.find("> li");this.$locationsWrapper=this.$wrapper.find(".t-locations-list");this.$locations=this.$locationsWrapper.find("> li");this.$searchForm=this.$wrapper.find(".t-search-form");
this.$addGroupLink=this.$wrapper.find(".js-add-user-group");this.$addOfficeLink=this.$wrapper.find(".js-add-user-location");b.extend(this.options,{storage_count_name:"team/sidebar_counts",link_count_update_date:!1,counters:{},storageCount:!1,xhr:!1,timer:0});this.$activeMenuItem=this.$wrapper.find("li."+this.options.classes.selected+":first")||!1;this.groupDialog={};this.setCounts();this.options.can_sort&&this.initSortable();this.initDroppable();this.$activeMenuItem.length||this.selectLink();this.initUpdater();
this.bindEvents()};Sidebar.prototype.bindEvents=function(){this.unBindEvents();this.$wrapper.on("click","li > a",b.proxy(this.onLinkClick,this));this.$addGroupLink.on("click",b.proxy(this.showGroupDialog,this));this.$addOfficeLink.on("click",b.proxy(this.showGroupDialog,this));this.$searchForm.on("submit",b.proxy(this.showSearch,this));this.$addUserLink.on("click",b.proxy(this.showInviteDialog,this))};Sidebar.prototype.unBindEvents=function(){this.$wrapper.off("click","li > a");this.$addGroupLink.off("click");
this.$addOfficeLink.off("click");this.$searchForm.off("submit");this.$addUserLink.off("click")};Sidebar.prototype.onLinkClick=function(a){a=b(a.target).closest("a");var e=a.attr("href");e&&"javascript:"!==e.substr(0,11)&&!a.hasClass(this.options.classes.noHighlight)&&(this.setItem(a.closest("li")),b.team.setTitle(a.text()))};Sidebar.prototype.setItem=function(a){this.$activeMenuItem&&this.$activeMenuItem[0]===a[0]||(this.$activeMenuItem&&this.$activeMenuItem.removeClass(this.options.classes.selected),
a.addClass(this.options.classes.selected),this.$activeMenuItem=a)};Sidebar.prototype.selectLink=function(a){if(a)var e=this.$wrapper.find('a[href="'+a+'"]:first');else if(!1===a){this.$activeMenuItem&&(this.$activeMenuItem.removeClass(this.options.classes.selected),this.$activeMenuItem=null);return}if(e&&e.length)this.setItem(e.closest("li"));else{a=this.$wrapper.find('a[href^="'+this.options.app_url+'"]');var c=location.pathname,d=0,f=0;a.each(function(g){var h=b(this).attr("href"),m=h.length;0<=
c.indexOf(h)&&m>d&&(d=m,f=g)});if(f||0===f)e=a.eq(f),this.setItem(e.closest("li"))}};Sidebar.prototype.reload=function(a){var e=this,c=b.team.app_url+e.options.api.reload;a&&(c+="&background_process=1");clearTimeout(e.options.timer);e.options.xhr&&e.options.xhr.abort();b.contains(document,e.$body[0])&&(e.options.xhr=b.get(c,{is_reload:1},function(d){e.options.xhr=!1;b.contains(document,e.$body[0])&&(e.$body.replaceWith(d),e.$wrapper.find(".sidebar-header").css("display",""),e.$wrapper.find(".sidebar-body").css("display",
""),e.$wrapper.find(".sidebar-footer").css("display",""))}))};Sidebar.prototype.showInviteDialog=function(a){a.preventDefault();b.get(b.team.app_url+this.options.api.inviteDialog,function(e){b.waDialog({html:e})})};Sidebar.prototype.showGroupDialog=function(a){a.preventDefault();var e=this,c=b(a.target).hasClass(e.options.classes.initGroupDialog)?"group":"location";e.groupDialog[c]?e.groupDialog[c].show():b.get(b.team.app_url+e.options.api.group,{type:c},function(d){e.groupDialog[c]=b.waDialog({html:d,
onOpen:function(f,g){g.$content.find(".js-edit-group-name").focus()},onClose:function(f){f.hide();return!1}})})};Sidebar.prototype.setCounts=function(){function a(g,h,m,n){var l=0<=g.indexOf(c.options.app_url),q=c.$wrapper.find('a[href="'+g+'"]');if(l&&q.length&&(m=h-m,!(0>m))){var t=b('<strong class="highlighted small js-sidebar-counter" style="height: fit-content;">+ '+m+"</strong>");l=q.find(".js-sidebar-counter");l.length?l.text("+ "+m):q.append(t);q.one("click",function(v){v.preventDefault();
t.remove();c.saveCount(g,h);c.options.link_count_update_date=n;b(document).one("wa_loaded",function(){c.options.link_count_update_date=!1})})}}function e(){var g=new Date,h=parseInt(g.getUTCDate()),m=parseInt(g.getUTCMonth())+1,n=parseInt(g.getUTCFullYear()),l=parseInt(g.getUTCHours()),q=parseInt(g.getUTCMinutes());g=parseInt(g.getUTCSeconds());return result={year:n,month:m,day:h,hours:l,minutes:q,seconds:g}}var c=this,d=function(){var g={},h=c.$wrapper.find("li .js-count"),m=e();h.each(function(){var n=
b(this),l=parseInt(n.text()),q=n.closest("li").find("> a");0<=l&&(c.options.counters[q.attr("href")]=n,g[q.attr("href")]={count:l,date:m})});return g}(),f=function(g){var h={};(g=localStorage.getItem(g))&&(h=JSON.parse(g));return h}(c.options.storage_count_name);c.options.storageCount=b.extend(!0,{},d);f&&b.each(f,function(g,h){var m=g in d&&0<=d[g].count&&d[g].count!==h.count;0<=h.count&&m&&(c.options.storageCount[g].count=h.count,c.options.storageCount[g].date=h.date,a(g,d[g].count,h.count,h.date))});
c.setStorage()};Sidebar.prototype.saveCount=function(a,e){a in this.options.storageCount&&(this.options.storageCount[a].count=e);this.setStorage()};Sidebar.prototype.updateCount=function(a,e){if(a&&(e||0===e)){var c=this.options.counters[a]||!1;this.saveCount(a,e);c.length?c.text(e):this.reload()}};Sidebar.prototype.setStorage=function(){localStorage.setItem(this.options.storage_count_name,JSON.stringify(this.options.storageCount))};Sidebar.prototype.initUpdater=function(){var a=this;a.options.timer=
setTimeout(function(){b.contains(document,a.$body[0])&&a.reload(!0)},a.options.updateTime)};Sidebar.prototype.initSortable=function(){function a(g){var h=[];g.find("> li").each(function(){var m=b(this).data("group-id");m&&0<m&&h.push(m)});return h}function e(g,h){f&&(f.abort(),f=!1);f=b.post(g,h,function(){f=!1})}var c=this,d=b.team.app_url+c.options.api.sort,f=!1;1<c.$groups.length&&c.$groupsWrapper.sortable({animation:150,handle:"."+c.options.classes.drop,direction:"vertical",onEnd:function(g){if(g.oldIndex!==
g.newIndex){g=a(c.$groupsWrapper);var h=[];b.each(g,function(m,n){h.push({name:"groups[]",value:n})});e(d,h)}}});1<c.$locations.length&&c.$locationsWrapper.sortable({animation:150,handle:"."+c.options.classes.drop,direction:"vertical",onEnd:function(g){g.oldIndex!==g.newIndex&&(g=a(c.$locationsWrapper),e(d,{locations:g}))}})};Sidebar.prototype.initDroppable=function(){function a(d,f){d=parseInt(d.data("group-id"));var g=parseInt(f.data("user-id"));f=b.team.app_url+e.options.api.moveUser;0<d&&0<g&&
(d={user_id:g,group_id:d},c&&c.abort(),c=b.post(f,d,function(h){c=!1;"ok"!==h.status?console.warn(h):b.team.sidebar.reload()}))}var e=this,c=!1;e.$groups.each(function(){var d=b(this);d.hasClass(e.options.classes.drop)&&d.droppable({tolerance:"pointer",hoverClass:e.options.classes.highlighted,over:function(f,g){g.draggable.hasClass(e.options.classes.uiDraggable)||d.removeClass(e.options.classes.highlighted)},drop:function(f,g){a(b(this),g.draggable)}})});e.$locations.each(function(){var d=b(this);
d.hasClass(e.options.classes.drop)&&d.droppable({tolerance:"pointer",hoverClass:e.options.classes.highlighted,over:function(f,g){g.draggable.hasClass(e.options.classes.uiDraggable)||d.removeClass(e.options.classes.highlighted)},drop:function(f,g){a(b(this),g.draggable)}})})};Sidebar.prototype.showSearch=function(a){a.preventDefault();if(a=b(a.target).find(".t-search-field").val())a=encodeURIComponent(a),b.team.content.load(b.team.app_url+"search/"+a+"/"),this.$wrapper.find(".sidebar-mobile-toggle").trigger("click")};
Sidebar.prototype.setSelected=function(a){switch(a.type){case "invited":var e=this.$body.find("[data-invited-item]");break;case "inactive":e=this.$body.find("[data-inactive-item]");break;case "search":e=this.$body.find("#all-users-sidebar-link");break;case "group":e=this.$body.find('[data-group-id="'+a.groupId+'"]')}this.setItem(b(e))};return Sidebar}(jQuery);var CalendarPage=function(b){var a=function(e){a=function(c){this.$wrapper=c.$wrapper;this.$monthSelect=this.$wrapper.find(".month");this.$yearSelect=this.$wrapper.find(".year");this.filters_href=c.filters_href;this.month=parseInt(this.$monthSelect.val());this.year=parseInt(this.$yearSelect.val());this.initClass()};a.prototype.initClass=function(){var c=this;c.$monthSelect.on("change",function(){var d=e(this).val();d&&(c.month=parseInt(d));c.useFilter();return!1});c.$yearSelect.on("change",function(){var d=
e(this).val();d&&(c.year=parseInt(d));c.useFilter();return!1});c.$wrapper.on("click",".t-arrow",function(){var d=e(this);d.hasClass("left")&&c.changeMonth(!1);d.hasClass("right")&&c.changeMonth(!0);c.useFilter();return!1})};a.prototype.changeMonth=function(c){c?12<=this.month?(this.month=1,this.year++):this.month++:1>=this.month?(this.month=12,this.year--):this.month--};a.prototype.useFilter=function(){var c="start="+(this.year+"-"+(9<this.month?this.month:"0"+this.month)+"-01"),d=this.filters_href.split("?"),
f=d[0];d=d[1]||"";d=0<=d.indexOf("&")?d.split("&"):[d];var g=!1;d.length&&e.each(d,function(h,m){"start"==m.split("=")[0]&&(g=h)});g||0===g?d[g]=c:d.push(c);c=f+"?"+d.join("&");e.team.content.load(c)};return a}(jQuery);CalendarPage=function(e){this.$wrapper=e.$wrapper;this.$dateFilter=e.$dateFilter;this.filters_href=e.filters_href;this.user_id=e.user_id;this.local_storage=new b.store;this.initClass()};CalendarPage.prototype.initClass=function(){new a({$wrapper:this.$dateFilter,filters_href:this.filters_href});
this.initInfoBlock()};CalendarPage.prototype.initInfoBlock=function(){var e=this.$wrapper.find(".t-info-notice-wrapper"),c=e.find(".t-info-notice-toggle"),d=new b.store;d.get("team/calendar_info_warn_block_hide")?e.hide():e.show();c.on("click",function(f){f.preventDefault();d.set("team/calendar_info_warn_block_hide",1);e.remove()})};return CalendarPage}(jQuery),TeamCalendar=function(b){function a(e){var c=[];e.each(function(){var d=[];b(this).find(".t-day-ornament").each(function(){d.push(b(this))});
c.push(d)});return c}TeamCalendar=function(e){this.$wrapper=e.$wrapper;this.$rows=this.$wrapper.find(".t-week-row");this.days_count=7;this.weeks_count=this.$rows.length;this.selected_class="is-selected";this.active_class="is-active";this.locales=e.locales;this.is_profile=e.is_profile;this.event_view_uri="?module=schedule&action=eventView";this.event_edit_uri="?module=schedule&action=eventEdit";this.day_uri="?module=schedule&action=day";this.user_id=e.user_id;this.has_right_to_change=e.has_right_to_change;
this.selected_user_id=e.selected_user_id;this.selected_calendar_id=e.selected_calendar_id;this.period_start=e.period_start;this.period_end=e.period_end;this.daysArray=a(this.$rows);this.wrapper_o=this.$wrapper.offset();this.wrapper_w=this.$wrapper.width();this.wrapper_h=this.$wrapper.height();this.day_h=this.day_w=0;this.dialogs=[];this.end=this.start=this.xhr=!1;this.$selectedDays=[];this.is_locked=!1;this.bindEvents();this.initHoverOnDay();this.initMove()};TeamCalendar.prototype.bindEvents=function(){function e(h){b.contains(document,
f.$wrapper[0])?27===h.keyCode&&f.deselectDays():b(document).off("keydown",e)}function c(h){f.is_locked||(f.is_locked=!0,f.onMouseMove(h),setTimeout(function(){f.is_locked=!1},10));return!1}function d(){f.onMouseUp();f.$wrapper.off("mousemove",c);g.off("mouseup",d);return!1}var f=this,g=b(document);f.has_right_to_change&&(f.$wrapper.find(".show-full-days-events, .t-event-wrapper").on("mousedown",function(h){h.stopPropagation();f.clearSelection()}),g.on("mousedown",function(){f.clearSelection()}),f.$wrapper.on("mousedown",
function(h){h.stopPropagation();f.closeDialogs()||(f.onMouseDown(h),f.$wrapper.on("mousemove",c),g.on("mouseup",d));return!1}));f.$wrapper.on("click",".show-full-days-events",function(h){h.preventDefault();f.closeDialogs()||f.showFullDayEvents(b(this))});f.$wrapper.on("click",".t-event-block.js-view-event",function(h){h.preventDefault();f.closeDialogs()||f.showEventDetails(b(this).closest(".t-event-wrapper"))});b(document).on("keydown",e)};TeamCalendar.prototype.showFullDayEvents=function(e){var c=
this,d=e.data("events-id").toString().split(",");e={date:e.data("date"),id:d};c.is_profile&&(e.selected_user_id=c.selected_user_id);c.xhr&&(c.xhr.abort(),c.xhr=!1);c.xhr=b.post(c.day_uri,e,function(f){f=b.waDialog({html:f,animate:!1,onBgClick:function(g,h,m){m.close()}});c.addDialog(f)})};TeamCalendar.prototype.showEventDetails=function(e){var c=this;e={"data[id]":e.data("id")};c.xhr&&(c.xhr.abort(),c.xhr=!1);c.xhr=b.post(c.event_view_uri,e,function(d){d=b.waDialog({html:d});c.addDialog(d)})};TeamCalendar.prototype.createEvent=
function(){var e=this,c=e.daysArray[e.end.week-1][e.end.day-1],d=e.daysArray[e.start.week-1][e.start.day-1].data("date");c=c.data("date");var f={"data[start]":!1,"data[end]":!1,"data[contact_id]":e.selected_user_id||e.user_id},g=(new Date).getHours();f["data[start]"]=d.replace("00:00:00",23<=g?"23:59:59":g+1+":00:00");f["data[end]"]=c.replace("00:00:00",22<=g?"23:59:59":g+2+":00:00");e.selected_calendar_id&&(f["data[calendar_id]"]=e.selected_calendar_id);e.xhr&&(e.xhr.abort(),e.xhr=!1);e.xhr=b.post(e.event_edit_uri,
f,function(h){h=b.waDialog({html:h});e.addDialog(h)})};TeamCalendar.prototype.onMouseDown=function(e){this.end=this.start=this.getDayPosition(e);this.markDays()};TeamCalendar.prototype.onMouseMove=function(e){e=this.getDayPosition(e);this.end&&this.end.week==e.week&&this.end.day==e.day||(this.end=e,this.markDays())};TeamCalendar.prototype.initHoverOnDay=function(e){function c(){f&&f.removeClass("is-highlighted");f=!1}var d=this,f=!1;d.$wrapper.on("mousemove",function(g){var h=d.getDayPosition(g),
m=d.daysArray,n=!1;m[h.week-1]&&m[h.week-1][h.day-1]&&(n=m[h.week-1][h.day-1]);h=n;g=b(g.target);if(g.hasClass("t-event-block")||g.closest(".t-event-block").length||d.start||!h)return c(),!1;if(h.hasClass("is-highlighted"))return!1;f&&c();h.addClass("is-highlighted");f=h}).on("mouseleave",function(){c()})};TeamCalendar.prototype.onMouseUp=function(){if(this.start.week>this.end.week||this.start.week==this.end.week&&this.start.day>this.end.day){var e={week:this.start.week,day:this.start.day};this.start=
{week:this.end.week,day:this.end.day};this.end=e}this.createEvent();this.end=this.start=!1};TeamCalendar.prototype.initMove=function(){function e(n){n=d.getDayPosition(n);var l=d.daysArray[n.week-1][n.day-1];if(!l)return console&&console.log&&console.log("error: date is not exist"),!1;n=b.team.app_url+"?module=schedule&action=eventMove";l={id:parseInt(g.data("id")),start:l.data("date").replace(" 00:00:00","")};m&&m.abort();m=b.post(n,l,function(q){"ok"==q.status&&d.reload()},"json")}function c(n){var l=
f.offset(),q=[l.left,l.left+f.outerWidth()];l=[l.top,l.top+f.outerHeight()];d.clearSelection();if(n.pageX<=q[0]||n.pageX>=q[1]||n.pageY<=l[0]||n.pageY>=l[1])return!1;q=parseInt(g.data("day-count")||g.closest(".t-column").attr("colspan"));d.start=d.getDayPosition(n);n=d.daysArray;var t=d.start;l={week:t.week,day:t.day};t=7-t.day;--q;q<=t?l.day+=q:(l.week+=1,l.day=q-t,l.week>n.length&&(l={week:n.length,day:7}));d.end=l;d.markDays()}var d=this,f=d.$wrapper,g=!1,h=!1,m;f.find(".js-move-event").draggable({helper:"clone",
appendTo:"body",cursor:"move",zIndex:1100,cursorAt:{top:11,left:16},start:function(n,l){n=b(n.target);l=l.helper;g=n;var q=parseInt(g.closest(".t-column").attr("colspan")),t=n.data("move-hint")||!1;t&&l.find(".t-event-block").append("<span class='t-day-count'>("+t+")</span>");l.addClass("is-clone").css({minWidth:parseInt(n.width()/q)+"px",height:n.height()+"px"})},drag:function(n,l){h||(h=!0,setTimeout(function(){h=!1},100),c(n))},stop:function(n,l){d.clearSelection();g=!1}});f.droppable({drop:function(n){e(n)}})};
TeamCalendar.prototype.markDays=function(){this.deselectDays();var e=b.extend({},this.start),c=b.extend({},this.end);e.week>c.week&&(e=b.extend({},this.end),c=b.extend({},this.start));for(var d=e.week,f=c.week,g=d;g<=f;g++){if(d==f){var h=e.day;var m=c.day;h>m&&(h=c.day,m=e.day)}else g==d?(h=e.day,m=this.days_count):g==f?(h=1,m=c.day):(h=1,m=this.days_count);for(;h<=m;h++)if(0<g&&0<h){var n=this.daysArray[g-1][h-1];n.length?(n.addClass(this.selected_class),this.$selectedDays.push(n)):console.log("Error: Day isn't exist")}}};
TeamCalendar.prototype.getDayPosition=function(e){this.wrapper_o=this.$wrapper.offset();this.wrapper_w=this.$wrapper.width();this.wrapper_h=this.$wrapper.height();this.day_w=this.wrapper_w/this.days_count;this.day_h=this.wrapper_h/this.weeks_count;var c=e.pageY-this.wrapper_o.top;e=e.pageX-this.wrapper_o.left;c=parseInt(c/this.day_h)+(0<c%this.day_h?1:0);e=parseInt(e/this.day_w)+(0<e%this.day_w?1:0);return{week:c,day:e}};TeamCalendar.prototype.deselectDays=function(){var e=this;e.$selectedDays.length&&
(b.each(e.$selectedDays,function(){b(this).removeClass(e.selected_class)}),e.$selectedDays=[])};TeamCalendar.prototype.clearSelection=function(){this.deselectDays();this.end=this.start=!1};TeamCalendar.prototype.reload=function(){var e=this,c={};e.closeDialogs();e.selected_user_id&&(c.user=e.selected_user_id);e.selected_calendar_id&&(c.calendar=e.selected_calendar_id);e.period_start&&(c.start=e.period_start);e.period_end&&(c.end=e.period_end);e.is_profile&&(c.period=1);b.get("?module=schedule&action=inc",
c,function(d){b.team.calendar=!1;e.$wrapper.closest(".t-calendar-wrapper").replaceWith(d);b.team.profile.$calendar_wrapper=b(d)})};TeamCalendar.prototype.addDialog=function(e){this.dialogs.push(e)};TeamCalendar.prototype.closeDialogs=function(){var e=!1;this.dialogs.length&&(b.each(this.dialogs,function(c,d){b.contains(document,d.$wrapper[0])&&(d.close(),e=!0)}),this.dialogs=[]);b("#ui-datepicker-div").length&&b(document).trigger("mousedown");return e};return TeamCalendar}(jQuery),DayEventsDialog=
function(b){DayEventsDialog=function(a){this.$wrapper=a.$wrapper;this.event_view_uri="?module=schedule&action=eventView";this.xhr=this.dialog=!1;this.initClass()};DayEventsDialog.prototype.initClass=function(){var a=this;a.$wrapper.on("click",".t-event-block.js-view-event",function(e){e.preventDefault();a.showEventDetails(b(this).closest(".t-event-wrapper"))})};DayEventsDialog.prototype.showEventDetails=function(a){var e=this;a={"data[id]":a.data("id")};e.xhr&&(e.xhr.abort(),e.xhr=!1);e.xhr=b.post(e.event_view_uri,
a,function(c){e.dialog=b.waDialog({html:c})})};return DayEventsDialog}(jQuery),EventEditDialog=function(b){EventEditDialog=function(a){this.$wrapper=a.$wrapper;this.$form=this.$wrapper.find("form");this.$statusToggle=this.$wrapper.find(".t-status-toggle");this.$calendarToggle=this.$wrapper.find(".js-calendar-dropdown");this.$typeToggle=this.$wrapper.find(".t-type-toggle");this.$userToggle=this.$wrapper.find(".js-user-dropdown");this.$startAltField=this.$wrapper.find("input[name='data[start_alt]']");
this.$endAltField=this.$wrapper.find("input[name='data[end_alt]']");this.$summaryField=this.$form.find("input[name='data[summary]']");this.teamDialog=this.$wrapper.data("dialog");this.active_class="is-active";this.extended_class="is-extended";this.selected_class="selected";this.has_error_class="state-error";this.locales=a.locales;this.event_id=a.event_id;this.calendars=a.calendars;this.users=a.users;this.$activeStatusToggle=this.$statusToggle.find("."+this.active_class)||!1;this.is_status=a.is_status;
this.is_changed=this.is_locked=!1;this.user_id=a.user_id;this.calendar_id=a.calendar_id;this.summary=a.summary;this.summary_type=a.summary_type;this.end_date_locale=this.start_date_locale=!1;this.initClass()};EventEditDialog.prototype.initClass=function(){this.initDatePicker();this.initTimePicker();this.bindEvents();this.setStatusLocale();this.is_status&&this.generateStatusTypes()};EventEditDialog.prototype.bindEvents=function(){var a=this;a.$form.on("submit",function(e){e.preventDefault();a.is_locked||
a.save(a.$form);return!1});a.$form.on("click",".js-delete-event",function(e){e.preventDefault();a.is_locked||a.showDeleteConfirm()});a.$statusToggle.on("click",".t-toggle-button",function(){a.changeStatus(b(this));a.changeColors();return!1});a.$calendarToggle.on("click",".menu a",function(e){e.preventDefault();a.changeCalendar(b(this))});a.$startAltField.on("change",function(){a.setStatusLocale();a.generateStatusTypes()});a.$endAltField.on("change",function(){a.setStatusLocale();a.generateStatusTypes()});
a.$summaryField.on("change",function(){a.summary=b(this).val();a.summary_type="custom"});a.$form.on("change","input[name='data[status_summary]']",function(){a.summary=b(this).val();a.$summaryField.val(a.summary)});a.$form.on("change",'textarea[name="data[description]"]',function(){var e=b(this).val();a.$form.find('textarea[name="data[status_description]"]').val(e)});a.$form.on("change",'textarea[name="data[status_description]"]',function(){var e=b(this).val();a.$form.find('textarea[name="data[description]"]').val(e)});
a.$form.on("summaryChange",function(){a.$summaryField.val(a.summary)});if(a.$userToggle.length)a.$userToggle.on("click",".menu a",function(e){e.preventDefault();a.changeUser(b(this))});a.$form.on("change",".js-extended-date",function(){a.dateToggle(b(this));return!1});a.$form.find("input").on("mousedown",function(){var e=b(this);e.hasClass(a.has_error_class)&&e.removeClass(a.has_error_class).closest(".value").find(".state-error-hint").remove()});a.$form.on("click",".js-datepicker-trigger, .js-timepicker-trigger",
function(){b(this).parent().find("input").trigger("focus")})};EventEditDialog.prototype.initDatePicker=function(){this.$wrapper.find(".js-datepicker").each(function(){var a=b(this),e=a.closest(".t-date-wrapper").find("input[type='hidden']");a.datepicker({altField:e,altFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,shortYearCutoff:2,showOtherMonths:!0,selectOtherMonths:!0,stepMonths:2,numberOfMonths:2,beforeShow:function(c,d){d.dpDiv.on("click",function(f){f.stopPropagation()});setTimeout(function(){return d.dpDiv.css({"z-index":"1051"})});
b(c).on("click",function(f){var g=!1,h=b("#ui-datepicker-div");h.length&&"none"!=h.css("display")&&(g=h);g&&(f.stopPropagation(),b(document).trigger("mousedown"))})}})})};EventEditDialog.prototype.initTimePicker=function(){this.$wrapper.find(".js-timepicker").each(function(){var a=b(this),e=!1;a.timepicker();a.on("showTimepicker",function(){var c=a.data("timepicker-list");e||(c.on("click",function(f){f.stopPropagation()}),e=!0);var d=parseInt(a.offset().top)+parseInt(a.outerHeight())-parseInt(b(window).scrollTop());
c.css({position:"fixed",top:d})})})};EventEditDialog.prototype.showDeleteConfirm=function(){var a=this,e={id:a.event_id};a.is_locked=!0;a.xhr&&(a.xhr.abort(),a.xhr=!1);a.xhr=b.get("?module=schedule&action=eventDeleteConfirm",e,function(c){b.waDialog({html:c});a.is_locked=!1;a.close()})};EventEditDialog.prototype.changeColors=function(){var a=this.calendars[this.calendar_id];bg_color=a.bg_color;font_color=a.font_color;status_bg_color=a.status_bg_color;status_font_color=a.status_font_color;this.setCalendarSelectColors(a)};
EventEditDialog.prototype.changeStatus=function(a){if(!a.hasClass(this.active_class)){var e=a.data("status-id");this.$activeStatusToggle&&this.$activeStatusToggle.removeClass(this.active_class+" "+this.selected_class);a.addClass(this.active_class+" "+this.selected_class);this.$activeStatusToggle=a;this.$form.find('input[name="data[is_status]"]').val(e).trigger("change");(this.is_status=a=1==e)?(this.$wrapper.removeClass("is-event").addClass("is-status"),a=this.$form.find(".js-extended-date"),a.prop("checked")||
a.click()):this.$wrapper.removeClass("is-status").addClass("is-event");this.generateStatusTypes();this.teamDialog.resize()}};EventEditDialog.prototype.changeCalendar=function(a){var e=this,c=a.closest("li"),d=c.data("calendar-id");if(!c.hasClass(e.selected_class)&&!e.is_locked){e.is_locked=!0;c=function(){var h=e.calendars[d];bg_color=h.bg_color;font_color=h.font_color;status_bg_color=h.status_bg_color;status_font_color=h.status_font_color;return h}();var f=b.wa.encodeHTML(a.text()),g=a.find("svg").data();
a=g.prefix;g=g.icon;e.calendar_id=d;e.$calendarToggle.find("."+e.selected_class).removeClass(e.selected_class);e.setCalendarSelectColors(c);e.$calendarToggle.find(".t-selected-item").html('<i class="'+a+" fa-"+g+'"></i><span class="custom-ml-8">'+f+"</span>");e.$form.find('input[name="data[calendar_id]"]').val(d).trigger("change");e.$calendarToggle.find(".menu");setTimeout(function(){e.is_locked=!1},500);e.generateStatusTypes()}};EventEditDialog.prototype.setCalendarSelectColors=function(a){var e=
this;e.$calendarToggle.find(".t-selected-item").css({color:function(){return e.is_status?a.status_font_color?a.status_font_color:a.font_color:a.status_font_color?a.font_color:a.bg_color},"background-color":function(){return e.is_status?a.status_bg_color?a.status_bg_color:a.bg_color:a.status_bg_color?a.bg_color:"transparent"},"box-shadow":function(){return e.is_status?"none":a.status_bg_color?"none":"inset 0 0 0 1px currentColor"}})};EventEditDialog.prototype.changeUser=function(a){var e=this,c=a.closest("li"),
d=c.data("user-id");if(!c.hasClass(e.selected_class)&&!e.is_locked){e.is_locked=!0;c=a.data("user-photo-url");a=b.wa.encodeHTML(a.text());e.user_id=d;e.$userToggle.find("."+e.selected_class).removeClass(e.selected_class);e.$userToggle.find(".t-selected-item").html('\n                <img src="'+c+'" class="userpic userpic20">\n                <span class="custom-ml-8">'+a+"</span>");e.$form.find('input[name="data[contact_id]"]').val(d).trigger("change");var f=e.$userToggle.find(".menu");f.hide();
setTimeout(function(){f.removeAttr("style");e.is_locked=!1},200)}};EventEditDialog.prototype.save=function(a){var e=this;a=function(c){function d(n){var l=n.split("-");n=parseInt(l[0]);var q=parseInt(l[1]);l=parseInt(l[2]);return 0<n&&0<q&&0<l?new Date(n,q-1,l):!1}function f(n){e.$form.find(".state-error-hint").remove();b.each(n,function(l,q){l=e.$form.find("[name='"+q.field+"']");l.length&&(l.parent(".value").length?l.addClass(e.has_error_class).after('<span class="state-error-hint custom-mt-4">'+
e.locales[q.locale]+"</span>"):l.addClass(e.has_error_class).closest(".t-date-wrapper").append('<div class="state-error-hint custom-mt-4">'+e.locales[q.locale]+"</div>"))})}var g={},h=[];b.each(c,function(n,l){g[l.name]=l.value});g["data[summary_type]"]||(g["data[summary_type]"]="custom");if(c=e.is_status)g["data[description]"]=g["data[status_description]"]?g["data[status_description]"]:"",delete g["data[status_description]"],g["data[summary]"]=e.summary,delete g["data[status_summary]"];b.trim(g["data[summary]"]).length||
(c?h.push({field:"data[status_summary]",locale:"empty"}):h.push({field:"data[summary]",locale:"empty"}));g["data[start]"].match(/^(\d){4}-(\d){2}-(\d){2}$/)||h.push({field:"data[end]",locale:"date"});g["data[end]"].match(/^(\d){4}-(\d){2}-(\d){2}$/)||h.push({field:"data[end]",locale:"date"});c=d(g["data[start]"]);var m=d(g["data[end]"]);c>m&&(h.push({field:"data[start_alt]",locale:"period"}),h.push({field:"data[end_alt]",locale:"period"}));g["data[start_time]"]>g["data[end_time]"]&&(h.push({field:"data[start_time]",
locale:"period"}),h.push({field:"data[end_time]",locale:"period"}));if(h.length)return f(h),!1;g["data[start_time]"].length||(g["data[start_time]"]="00:00");g["data[end_time]"].length||(g["data[end_time]"]="00:00");g["data[start]"]=g["data[start]"]+" "+g["data[start_time]"];g["data[end]"]=g["data[end]"]+" "+g["data[end_time]"];g["data[is_allday]"]=g["data[is_allday]"]?1:0;delete g["data[start_time]"];delete g["data[end_time]"];delete g["data[start_alt]"];delete g["data[end_alt]"];return g}(a.serializeArray());
e.is_locked=!0;a?b.post("?module=schedule&action=eventSave",a,function(c){if("ok"==c.status)c.data&&c.data.message&&alert(c.data.message),e.reloadCalendar();else if(c.errors){var d=null;b.each(c.errors,function(f,g){"redirect"===g[0]&&(d=g[1])});d&&(location.href=d)}e.close();e.is_locked=!1},"json"):e.is_locked=!1};EventEditDialog.prototype.reloadCalendar=function(){b.team.calendar.reload()};EventEditDialog.prototype.dateToggle=function(a){this.$form.find(".t-date-wrapper").toggleClass(this.extended_class,
!a.prop("checked"))};EventEditDialog.prototype.generateStatusTypes=function(){var a=this,e=a.$typeToggle,c=function(){var d=e.find(".is-template li"),f=d.eq(0),g=d.eq(1);d=b("<ul></ul>");var h=a.calendars[a.calendar_id];if(h.default_status){var m=f.clone();m.find(".t-type").text(h.default_status);m.find("input:radio").val("default");d.append(m)}m=f.clone();m.find(".t-type").text(h.name);m.find("input:radio").val("calendar");d.append(m);m=f.clone();m.find(".t-type").text((h.default_status?h.default_status:
h.name)+" "+a.locales.till+" "+a.end_date_locale);m.find("input:radio").val("till");d.append(m);f=f.clone();f.find(".t-type").text((h.default_status?h.default_status:h.name)+" "+a.locales.from+" "+a.start_date_locale+" "+a.locales.till+" "+a.end_date_locale);f.find("input:radio").val("interval");d.append(f);f=g.clone();f.find("input:radio").val("custom");a.summary&&f.find("input:text").val(a.summary);d.append(f);e.find(".value").html("").append(d);return d}();(function(d){d.on("change","input:radio",
function(){var f=b(this),g=f.is(":checked"),h=f.closest("li").find(".t-type"),m=f.closest("li").find("input:text");if(g){if(h.length)a.summary=h.text();else if(m.length)a.summary=m.val();else return!1;a.summary_type=f.val();a.$form.trigger("summaryChange")}});d.on("focus set","input:text",function(){var f=b(this),g=f.closest("li").find("input:radio");g.is(":checked")||g.prop("checked",!0).trigger("change");f.hasClass(a.has_error_class)&&f.removeClass(a.has_error_class).closest(".value").find(".state-error-hint").parent().remove()});
d.on("focus change keyup","input:text",function(){var f=b(this),g=f.val();a.summary=b("<div />").text(f.val());g.length&&(a.summary_type="custom",a.summary=g)})})(c);(function(d){!a.summary_type&&a.summary&&(a.summary_type="custom");if(a.summary_type){var f=d.find("input:radio[value='"+a.summary_type+"']");f.length?(f.click(),"custom"!==a.summary_type&&d.find("input:text").val("")):"default"==a.summary_type?d.find("input[value='calendar']").click():d.find("input:text").val(a.summary?a.summary:"").trigger("change")}else d.find("input:radio:first").click()})(c)};
EventEditDialog.prototype.setStatusLocale=function(){function a(f){var g=f.val().split(" ")[0].split("-");f=parseInt(g[2]);var h=parseInt(g[1]);g=parseInt(g[0]);var m=(new Date).getFullYear(),n=e.locales.status_type.months[h];f=b.datepicker.formatDate(e.locales.status_type.format,new Date(g,h-1,f));f=f.replace("f",n);m==g&&(f=f.replace(", "+g,"").replace(" "+g,"").replace(g+" ",""));return f}var e=this,c=e.$wrapper.find("input[name='data[start]']"),d=e.$wrapper.find("input[name='data[end]']");e.start_date_locale=
a(c);e.end_date_locale=a(d)};EventEditDialog.prototype.close=function(){this.teamDialog.close()};return EventEditDialog}(jQuery),EventViewDialog=function(b){EventViewDialog=function(a){this.$dialogWrapper=a.$wrapper;this.$wrapper=this.$dialogWrapper.find(".dialog-body");this.event_id=a.event_id;this.event_edit_uri="?module=schedule&action=eventEdit";this.xhr=!1;this.initClass()};EventViewDialog.prototype.initClass=function(){var a=this;a.$wrapper.on("click",".js-edit-event",function(e){e.preventDefault();
a.showEditForm()})};EventViewDialog.prototype.showEditForm=function(){var a=this,e={"data[id]":a.event_id};a.xhr&&(a.xhr.abort(),a.xhr=!1);a.xhr=b.post(a.event_edit_uri,e,function(c){a.$wrapper.offset();var d=b.team.calendar;a.close();c=b.waDialog({html:c});d.addDialog(c)})};EventViewDialog.prototype.close=function(){this.$dialogWrapper.data("dialog").close()};return EventViewDialog}(jQuery),EventDeleteDialog=function(b){EventDeleteDialog=function(a){this.$wrapper=a.$wrapper;this.$block=this.$wrapper.find(".dialog-body");
this.event_id=a.event_id;this.is_locked=!1;this.initClass()};EventDeleteDialog.prototype.initClass=function(){var a=this;a.$block.on("click",".js-delete-event",function(e){e.preventDefault();if(!a.is_locked)a["delete"]()})};EventDeleteDialog.prototype["delete"]=function(){var a=this,e={id:a.event_id};a.is_locked=!0;b.post("?module=schedule&action=eventDelete",e,function(c){"ok"==c.status&&(c.data&&c.data.message&&alert(c.data.message),a.$wrapper.data("dialog").close(),b.team.calendar.reload())})};
return EventDeleteDialog}(jQuery);var Profile=function(b){Profile=function(a){this.$wrapper=a.$wrapper;this.$tabs=this.$wrapper.find(".t-profile-tabs");this.$tabContentPlace=this.$wrapper.find(".t-dynamic-content");this.$calendarPlace=this.$wrapper.find(".t-calendar-place");this.$profile_header_links=this.$wrapper.find(".t-profile-actions-btn");this.$profile_sidebar=this.$wrapper.find(".t-profile-sidebar");this.api_enabled=window.history&&window.history.pushState;this.user=a.user||{id:0};this.photo_dialog_url=a.photo_dialog_url;this.is_own_profile=
a.is_own_profile||!1;this.wa_app_url=a.wa_app_url||"";this.wa_backend_url=a.wa_backend_url||"";this.wa_url=a.wa_url||"";this.wa_version=a.wa_version||"";this.webasyst_id_auth_url=a.webasyst_id_auth_url||"";this.xhr=this.is_locked=!1;this.dialogs=[];this.sidebar_drawer=this.$calendar_date_filter=this.$calendar_wrapper=null;this.sidebarDialog={};this.initClass();this.initEditor(a.editor||{})};Profile.prototype.initEditor=function(a){if(!(b.isEmptyObject(a)||b.isEmptyObject(a.options)||b.isEmptyObject(a.data))){var e=
this;b.storage=new b.store;b.each(a.options||{},function(d,f){b.wa.contactEditor[d]=f});b.wa.contactEditor.wa_app_url=e.is_own_profile?e.wa_backend_url:e.wa_app_url;b.wa.contactEditor.wa_backend_url=e.wa_backend_url;b.wa.contactEditor.initFactories(a.data.contactFields,a.data.contactFieldsOrder);b.wa.contactEditor.resetFieldEditors();b.wa.contactEditor.initFieldEditors(a.data.fieldValues);b.wa.contactEditor.initContactInfoBlock("view");!e.is_own_profile&&a.data.fieldValues.timezone||b.wa.determineTimezone(e.wa_url);
var c='<div class="dialog t-edit-profile">\n            <div class="dialog-background"></div>\n            <div class="dialog-body" style="width: 800px;">\n            <h3 class="dialog-header">'+$_("Contact info")+'</h3>\n                <div class="dialog-content fields"></div>\n                <div class="dialog-footer"></div>\n            </div>\n        </div>';e.$profile_header_links.on("click",".edit-link",function(){b(".js-user-info");var d;e.contactsDialog?e.contactsDialog.show():e.contactsDialog=
b.waDialog({html:c,onOpen:function(f,g){b.wa.contactEditor.dialogInstance(g);b.wa.contactEditor.switchMode("edit");d=b("#contact-info-block");g.$content.append(d);g.resize();b(b.wa.contactEditor).on("contact_saved",function(){g.hide()})},onClose:function(f){f.hide();return!1}})})}};Profile.prototype.initClass=function(){var a=this;a.bindEvents();b.team&&b.team.sidebar&&b.team.sidebar.selectLink(!1);new ProfileWebasystID({is_own_profile:a.is_own_profile,user:a.user,backend_url:a.wa_backend_url,wa_url:a.wa_url,
wa_version:a.wa_version,webasyst_id_auth_url:a.webasyst_id_auth_url,ui:"2.0"});b(document).on("wa_before_load",function(){a.sidebar_drawer=null;a.showSidebarDrawer(!0)});a.showSidebarDrawer(!0)};Profile.prototype.bindEvents=function(){var a=this;a.$tabs.on("click",".t-tab a",function(){a.changeTab(b(this));return!1});a.$calendarPlace.on("click",".js-calendar-toggle",function(e){e.preventDefault();a.calendarToggle(b(this))});a.$wrapper.find(".js-sidebar-calendar").on("click",".js-show-outer-calendar-manager",
function(e){e.stopPropagation();a.showOuterDialogDialog()});b(document).on("click",".t-profile-drawer .js-show-outer-calendar-manager",function(e){e.stopPropagation();a.showOuterDialogDialog()});a.$wrapper.on("photo_updated photo_deleted",function(e,c){a.$wrapper.find(".t-userpic").attr("src",c.url)});a.$wrapper.find(".js-change-photo").on("click",function(){var e=b("#contact-photo-crop-dialog");e.length||(e=b('<div class="dialog" id="contact-photo-crop-dialog"/>'),b("body").append(e));e.load(a.photo_dialog_url,
function(){b.waDialog({$wrapper:e})})});a.$profile_header_links.on("click",".access-link",function(){var e=b(this)[0].dataset;e.userId=a.user.id;if(a.accessDialog)a.accessDialog.show();else{var c,d,f='\n                <div class="dialog t-sidebar-profile-dialog">\n                    <div class="dialog-background"></div>\n                    <div class="dialog-body flexbox vertical" '+(e.dialogWidth?' style="width:'+(null==(c=e.dialogWidth)?void 0:c.replace(/(<([^>]+)>)/gi,""))+'"':"")+'>\n                        <h3 class="dialog-header">'+
((null==(d=e.dialogHeader)?void 0:d.replace(/(<([^>]+)>)/gi,""))||"")+'</h3>\n                        <div class="dialog-content wide"></div>\n                        <div class="dialog-footer custom-mt-auto">\n                            <button type="button" class="button light-gray js-close-dialog">'+$_("Close")+"</button>\n                        </div>\n                    </div>\n                </div>\n            ";a.accessDialog=b.waDialog({html:f,onOpen:function(g,h){h.$content.empty().append('<div class="align-center"><span class="spinner custom-p-16"></span></div>');
b.post("?module=profile&action=sidebarDialog",e,function(m){h.$content.empty().html(m);a.$wrapper.trigger("dialog_opened",h)})},onClose:function(g){g.hide();b.team.content.reload();return!1}})}});a.$profile_header_links.on("click",".delete-link",function(){var e=b(this);b(document).on("wa_confirm_contact_delete_dialog",function(){e.find('[data-icon="trash-alt"]').removeClass("hidden");e.find('[data-icon="spinner"]').addClass("hidden")});e.find("svg").toggleClass("hidden");b.team.confirmContactDelete([a.user.id])});
b(".js-edit-groups").on("click",function(){a.showSidebarDialog(b(".access-link").data())});a.$wrapper.find(".js-profile-user-slider").one("click touchstart",function(){b(this).animate({height:"375px"},function(){b(this).removeClass("cursor-pointer")})});a.$wrapper.find(".js-toggle-user-info").on("click",function(e){e.preventDefault();b(this).find("svg").toggleClass("fa-caret-down fa-caret-up");a.$wrapper.find(".js-user-info").toggleClass("hidden")});a.$profile_sidebar.on("click",".js-sidebar-profile-dialog",
function(e){e.preventDefault();e=this.dataset;void 0===e.sectionId&&(e=this.closest("[data-section]").querySelector(".js-sidebar-profile-dialog").dataset);a.showSidebarDialog(e)});b(document).one("click",".t-profile-drawer .js-sidebar-profile-dialog",function(e){e.preventDefault();e=this.dataset;void 0===e.sectionId&&(e=this.closest("[data-section]").querySelector(".js-sidebar-profile-dialog").dataset);a.showSidebarDialog(e)});a.$wrapper.find(".js-show-drawer").on("click",function(e){e.preventDefault();
a.showSidebarDrawer()})};Profile.prototype.switchToTab=function(a,e){function c(){var m=d.children().filter(function(){return a==b(this).data("tab-id")}).first();try{m[0].contentWindow&&e(m)&&(setTimeout(function(){g.resolve(m)},0),f.off("tab_content_updated",c),h&&clearInterval(h),h=null)}catch(n){}}var d=this.$wrapper.find(".t-profile-tabs-iframes"),f=this.$wrapper.find('.t-tab a[data-tab-id="'+a+'"]'),g=b.Deferred();f.on("tab_content_updated",c);var h=setInterval(c,100);f.closest(".t-tab").hasClass("is-selected")?
c():f.click();f.length&&b("html, body").animate({scrollTop:f.offset().top},500);return g.promise()};Profile.prototype.changeTab=function(a){if(this.api_enabled){a=a.data("tab-id");var e=window.location.href.match(/^.*\/(id|u)\/[^\/]+/);e&&a&&(a=e[0]+"/"+a+"/",history.replaceState({reload:!0,content_uri:a},"",a))}};Profile.prototype.calendarToggle=function(a){var e=a.find(".t-calendar-toggle .text");this.$calendarPlace.hasClass("is-short")?(e.text(a.data("hide-text")),this.$calendarPlace.removeClass("is-short")):
(e.text(a.data("show-text")),this.$calendarPlace.addClass("is-short"))};Profile.prototype.showOuterDialogDialog=function(){function a(){b.post(c,d,function(f){b.waDialog({html:f})}).always(function(){e.is_locked=!1})}var e=this,c="?module=schedule&action=settings",d={};0<e.user.id&&(c+="&id="+e.user.id);e.is_locked||(e.is_locked=!0,a())};Profile.prototype.showSidebarDialog=function(a){var e=this,c=b(".js-profile-sidebar-body"),d=!1;a.userId=e.user.id;if(e.sidebarDialog[a.sectionId])e.sidebarDialog[a.sectionId].show();
else{a.sectionId&&a.userId||(d=!0);var f="";"calendar"===a.sectionId&&(f='<a href="'+e.wa_app_url+'calendar/">\n                                    <span>'+a.dialogTeamCalendar+'</span> \n                                    <i class="fas fa-external-link-alt fa-xs"></i>\n                                </a>');var g,h,m='\n            <div class="dialog t-sidebar-profile-dialog">\n                <div class="dialog-background"></div>\n                <div class="dialog-body flexbox vertical" '+(a.dialogWidth?
' style="width:'+(null==(g=a.dialogWidth)?void 0:g.replace(/(<([^>]+)>)/gi,""))+'"':"")+'>\n                    <div class="dialog-header flexbox"><h3>'+((null==(h=a.dialogHeader)?void 0:h.replace(/(<([^>]+)>)/gi,""))||"")+'</h3></div>\n                    <div class="dialog-content wide"></div>\n                    <div class="dialog-footer custom-mt-auto">\n                        <button type="button" class="button light-gray js-close-dialog">'+(d?"Ok":$_("Close"))+"</button>\n                        "+
f+"\n                    </div>\n                </div>\n            </div>\n        ";e.sidebarDialog[a.sectionId]=b.waDialog({html:m,onOpen:function(n,l){l.$content.empty().append('<div class="align-center"><span class="spinner custom-p-16"></span></div>');if("calendar"===a.sectionId)e.$calendar_wrapper||(e.$calendar_wrapper=c.find(".js-calendar-html > .t-calendar-wrapper").detach()),l.$content.empty().append(e.$calendar_wrapper),l.resize();else if(""===a.url){var q=b(".js-tab-content-"+a.sectionId).html();
l.$content.empty().html(q);l.resize();e.$wrapper.trigger("dialog_opened",l)}else b.post("?module=profile&action=sidebarDialog",a,function(t){l.$content.empty().html(t);e.$wrapper.trigger("dialog_opened",l);t=n.find(".t-profile-section-iframe");t.length&&t.data("dialog",l)})},onClose:function(n){n.hide();"calendar"===a.sectionId&&b.team.content.reload();return!1}})}};Profile.prototype.showSidebarDrawer=function(a){a=void 0===a?!1:a;var e=this;e.sidebar_drawer?(a=e.sidebar_drawer.$wrapper[0].style,
a.removeProperty("z-index"),a.removeProperty("opacity"),e.sidebar_drawer.show()):(e.sidebar_drawer=b.waDrawer({$wrapper:b(".js-profile-sidebar-drawer"),lock_body_scroll:!a,onClose:function(){this.hide();return!1}}),a&&setTimeout(function(){e.sidebar_drawer.close()},100))};Profile.initSidebarWidgetAccess=function(a){var e=a.$wrapper,c=a.wa_backend_url,d=a.user_id,f=a.loc,g=e.find(".js-waid"),h=g.find(".js-sent-email-ok"),m=!1;g.on("click",".js-send-email-invitation",function(n){n.preventDefault();
var l=b(this),q=g.find(".js-loading");m||(q.show(),m=!0,b.post(c+"?module=settings&action=waIDInviteUser",{id:d}).done(function(t){var v=t.errors;t=t.data;v?b.waDialog.alert({title:f.error,text:v,button_title:f.ok}):t&&(l.addClass("hidden").find(".js-text").text(f.email_again).end().find(".js-last-send-datetime").text(t.sent),h.removeClass("hidden"),setTimeout(function(){l.removeClass("hidden");h.addClass("hidden")},1500))}).always(function(){m=!1;q.hide()}))});e.on("click",".js-connect-by-numeric-code",
function(n){var l=b(this).find(".js-loading");m||(l.show(),m=!0,n=[],n.push(b.post(c+"?module=settings&action=waIDInviteUserByCode",{id:d}).then(function(q){var t=q.errors;q=q.data;return t?(new b.Deferred).reject(t).promise():q},function(q,t,v){return t+" "+v})),n.push(b.post("?module=profile&action=waidConnectCodeDialog",{id:d}).then(function(q){return q},function(q,t,v){return(new b.Deferred).reject(t+": "+v).promise()})),b.when.apply(b,n).then(function(q,t){b.waDialog({html:t,onOpen:function(v,
y){v.trigger("dialog_opened",[q,y])}})},function(q){b.waDialog.alert({title:f.error,text:q,button_title:f.ok})}).always(function(){m=!1;l.hide()}))});e.on("click",".js-connect-by-qr-code",function(n){n=b(this);var l=n.find(".js-loading"),q=n.find(".js-code-icon");m||(l.show(),q.hide(),m=!0,n=[],n.push(b.post(c+"?module=settings&action=waIDInviteUserByCode",{id:d,qrcode:1}).then(function(t){var v=t.errors;t=t.data;return v?(new b.Deferred).reject(v).promise():t},function(t,v,y){return v+" "+y})),n.push(b.post("?module=profile&action=waidConnectQrcodeDialog",
{id:d}).then(function(t){return t},function(t,v,y){return(new b.Deferred).reject(v+": "+y).promise()})),n.push(b.getScript(a.wa_url+"wa-content/js/qrcode/qrcode.min.js")),b.when.apply(b,n).then(function(t,v){b.waDialog({html:v,onOpen:function(y,z){y.trigger("dialog_opened",[t,z])}})},function(t){b.waDialog.alert({title:f.error,text:t,button_title:f.ok})}).always(function(){m=!1;l.hide();q.show()}))})};return Profile}(jQuery),ActivityLazyLoading=function(b){ActivityLazyLoading=function(a){this.list_name=
a.names.list;this.items_name=a.names.items;this.pagind_name=a.names.paging;this.user_id=a.user_id;this.$wrapper=a.$wrapper||!1;this.$list=this.$wrapper.find(this.list_name);this.$window=b(window);this.onLoad=a.onLoad||function(){};this.$paging=this.$wrapper.find(this.pagind_name);this.is_locked=this.xhr=!1;this.addWatcher()};ActivityLazyLoading.prototype.addWatcher=function(){function a(){var d=window&&b.contains(document,e.$paging[0]);d&&c&&window.frameElement&&(d=b.contains(c.document,window.frameElement));
if(d)try{e.onScroll()}catch(f){d=!1}d||(e.$window.off("scroll",a),b(c).off("scroll",a))}var e=this,c=window.parent;e.$window.on("scroll",a);if(c&&window.frameElement)b(c).on("scroll",a)};ActivityLazyLoading.prototype.onScroll=function(){var a=this.$window,e=a.scrollTop();a=a.height();var c=this.$paging.offset().top;if(window.parent&&window.frameElement){var d=b(window.parent);a=d.height();e+=d.scrollTop();c+=b(window.frameElement).offset().top}e+a>=c&&!this.is_locked&&(this.is_locked=!0,this.loadNextPage())};
ActivityLazyLoading.prototype.loadNextPage=function(){var a=this,e=b.team.app_url+"?module=profile&action=activity",c={max_id:a.$paging.data("max-id"),id:a.user_id,timestamp:a.$list.find(a.items_name).last().data("timestamp")};a.xhr&&(a.xhr.abort(),a.xhr=!1);a.xhr=b.get(e,c,function(d){var f=b(d);d=f.find(a.list_name+" "+a.items_name);f=f.find(a.pagind_name);a.$list.append(d);a.$paging.after(f);a.$paging.remove();a.$paging=f;a.is_locked=!1;a.onLoad()})};return ActivityLazyLoading}(jQuery),OutsideCalendarsDialog=
function(b){OutsideCalendarsDialog=function(a){this.$dialogWrapper=a.$wrapper;this.$form=this.$wrapper=this.$dialogWrapper.find(".dialog-body");this.dialog=this.$dialogWrapper.data("dialog");this.xhr=this.is_locked=!1;this.initClass()};OutsideCalendarsDialog.prototype.initClass=function(){this.bindEvents()};OutsideCalendarsDialog.prototype.bindEvents=function(){var a=this;a.$wrapper.on("click",".t-external-calendar-unmount",function(){a.deleteExternalCalendar(b(this).data("id"))});a.$wrapper.find(".js-add-external-calendar").on("click",
function(e){e.preventDefault();a.dialog.close();(e=b(this).attr("href"))&&b.team.content.load(e)})};OutsideCalendarsDialog.prototype.deleteExternalCalendar=function(a){var e=this;b.get("?module=calendarExternal&action=DeleteConfirm",{id:a},function(c){b.waDialog({html:c,onOpen:function(d,f){d.on("afterDelete",function(){b.team.content.reload();e.dialog.close();f.close()})}})})};return OutsideCalendarsDialog}(jQuery);(function(b){b.wa.fieldTypesFactory=function(a,e){a=a||b.wa.contactEditorFactory();a.baseFieldType||(a.baseFieldType={contactType:"person",options:{},createEditor:function(c){this.contactType=c||"person";c=b.extend({},this);delete c.createEditor;delete c.initializeFactory;c.parentEditorData={};c.initialize();return c},fieldValue:"",initializeFactory:function(c,d){this.fieldData=c;this.options=d||{}},initialize:function(){this.setValue("")},reinit:function(){this.currentMode="null";this.initialize()},
setValue:function(c){this.fieldValue=c;"null"!=this.currentMode&&null!==this.domElement&&("edit"==this.currentMode?this.domElement.find(".val").val(this.fieldValue):this.domElement.find(".val").html(b.wa.encodeHTML(this.fieldValue)))},getValue:function(){var c=this.fieldValue;if("edit"==this.currentMode&&null!==this.domElement){var d=this.domElement.find(".val");0<d.length&&(c="",d.hasClass("empty")||"checkbox"==d.attr("type")&&!d.prop("checked")||(c=d.val()))}return c},isModified:function(){return this.fieldValue!=
this.getValue()},validate:function(c){var d=this.getValue();return c||!this.fieldData.required||d?null:$_("This field is required.")},newFieldElement:function(c){this.fieldData.read_only&&(c="view");var d=this.newInlineFieldElement(c);if(null===d&&(!this.fieldData.show_empty||"edit"==c))return b('<div style="display: none" class="field" data-field-id="'+this.fieldData.id+'"></div>');if("person"===this.contactType)if(0<=["firstname","middlename","lastname"].indexOf(this.fieldData.id)){var f="subname";
d.find(".val").attr("placeholder",this.fieldData.name).attr("title",this.fieldData.name).addClass("small width-100-mobile")}else"title"===this.fieldData.id?(f="subname title",d.find(".val").attr("placeholder",this.fieldData.name).attr("title",this.fieldData.name).addClass("small width-100-mobile")):"jobtitle"===this.fieldData.id?(f="jobtitle-company jobtitle",d.find(".val").addClass("small width-100-mobile")):"company"===this.fieldData.id&&(f="jobtitle-company company",d.find(".val").addClass("small width-100-mobile"));
else"company"===this.fieldData.id&&(f="company");return a.wrapper(d,this.fieldData.name+"",f).attr("data-field-id",this.fieldData.id)},newInlineFieldElement:function(c){if("view"==c&&!this.fieldValue)return null;var d=b.isPlainObject(this.fieldValue)?this.fieldValue.value:this.fieldValue;"edit"==c?(c=b('<span class="width-100-mobile custom-mr-0-mobile"><input class="val small width-100-mobile" type="text"></span>'),c.find(".val").val(d)):(c=b('<span class="val small"></span>'),c.text(d));return c},
showValidationErrors:function(c){if(null!==this.domElement){var d=this.domElement.find(".val");d.nextAll(".state-error-hint").remove();null!==c?(d.after(b('<p class="state-error-hint custom-mt-8">'+c+"</p>")),d.addClass("state-error")):d.removeClass("state-error");a.dialog.resize()}},fieldData:null,domElement:null,currentMode:"null",parentEditor:null,parentEditorData:null,setMode:function(c,d){"undefined"==typeof d&&(d=!0);if("view"!=c&&"edit"!=c)throw Error("Unknown mode: "+c);this.currentMode!=
c&&(this.currentMode=c,d&&(d=this.domElement,this.domElement=this.newFieldElement(c),null!==d&&d.replaceWith(this.domElement)));return this.domElement}});a.factoryTypes.Hidden=b.extend({},a.baseFieldType,{newFieldElement:function(c){c=this.newInlineFieldElement(c);return a.wrapper(c,this.fieldData.name).attr("data-field-id",this.fieldData.id).hide()},newInlineFieldElement:function(c){if("view"==c&&!this.fieldValue)return null;var d=null;"edit"==c&&(d=b('<span><input type="hidden" class="val" type="text"></span>'),
d.find(".val").val(this.fieldValue));return d}});a.factoryTypes.String=b.extend({},a.baseFieldType,{setValue:function(c){this.fieldValue=c;"null"!=this.currentMode&&null!==this.domElement&&("edit"==this.currentMode?this.domElement.find(".val").val(this.fieldValue):this.domElement.find(".val").html(b.wa.encodeHTML(this.fieldValue)))},getValue:function(){var c=this.fieldValue;if("edit"==this.currentMode&&null!==this.domElement){var d=this.domElement.find(".val");c="";d.hasClass("empty")||(c=d.val())}return c},
newInlineFieldElement:function(c){if("view"==c&&!this.fieldValue)return null;var d=this.fieldValue;"edit"==c?(c=1>=this.fieldData.input_height?b('<span><input class="val small" type="text"><i class="fas fa-spinner fa-spin loading wa-animation-spin speed-1000" style="display:none;"></i></span>'):b('<span><textarea class="val small width-100" rows="'+this.fieldData.input_height+'"></textarea></span>'),c.find(".val").val(d)):1>=this.fieldData.input_height?c=b('<span class="val small"></span><i class="fas fa-spinner fa-spin loading wa-animation-spin speed-1000" style="display:none;">').text(d):
(d=b.wa.encodeHTML(d||"").replace(/\n/g,"<br>"),c=b('<span class="val small"></span><i class="fas fa-spinner fa-spin loading wa-animation-spin speed-1000" style="display:none;">').html(d));return c},setMode:function(c,d){"undefined"==typeof d&&(d=!0);if("view"!=c&&"edit"!=c)throw Error("Unknown mode: "+c);this.currentMode!=c&&(this.currentMode=c,d&&(d=this.domElement,this.domElement=this.newFieldElement(c),null!==d&&d.replaceWith(this.domElement)));return this.domElement}});a.factoryTypes.Text=b.extend({},
a.factoryTypes.String);a.factoryTypes.Phone=b.extend({},a.baseFieldType);a.factoryTypes.Select=b.extend({},a.baseFieldType,{notSet:function(){return""},newInlineFieldElement:function(c){if("view"==c&&!this.fieldValue)return null;if("view"==c)return b('<span class="val small"></span>').text(this.fieldData.options[this.fieldValue]||this.fieldValue);c="";for(var d=!1,f,g=0;g<this.fieldData.oOrder.length;g++){var h=this.fieldData.oOrder[g];!d&&h==this.fieldValue&&this.fieldValue?(d=!0,f=" selected"):
f="";""===h&&(f+=" disabled");h=h||"";h="string"===typeof h?h:""+h;var m=b.wa.encodeHTML(h).replace('"',"&quot;");f='<option value="{$id}" {$attrs}>{$text}</option>'.replace("{$id}",m).replace("{$attrs}",f).replace("{$text}",b.wa.encodeHTML(this.fieldData.options[h]));c+=f}return b('<div class="wa-select small width-100-mobile"><select class="val '+(this.fieldData.type+"").toLowerCase()+'"><option value=""'+(d?"":" selected")+">"+this.notSet()+"</option>"+c+"</select></div>")}});a.factoryTypes.Conditional=
b.extend({},a.factoryTypes.Select,{unbindEventHandlers:function(){},getValue:function(){var c=this.fieldValue;if("edit"==this.currentMode&&null!==this.domElement){var d=this.domElement.find(".val:visible");0<d.length&&(c=d.hasClass("empty")?"":d.val())}return c},newInlineFieldElement:function(c){if("view"==c&&!this.fieldValue)return null;this.unbindEventHandlers();if("view"==c)return b("<div></div>").append(b('<span class="val"></span>').text(this.fieldData.options&&this.fieldData.options[this.fieldValue]||
this.fieldValue));var d=this;c=(d.fieldData.parent_field||"").split(":");for(var f=a.fieldEditors[c.shift()];f&&c.length;){var g=f.subfieldEditors;if(g instanceof Array){f=null;for(var h=0;h<g.length;h++)if(g[h]===d.parentEditor){f=g[h];break}}else f=g[c.shift()]}if(f){var m=this.fieldData.options&&this.fieldData.options[this.fieldValue]||this.fieldValue,n=b('<input type="text" class="hidden val">').val(m),l=b('<select class="hidden val"></select>').hide(),q=function(){var t=b(this),v=n.is(":visible")?
n.val():l.is(":visible")?l.val():m;t=(t.val()||"").toLowerCase();if(t=d.fieldData.parent_options[t]){n.hide();l.show().children().remove();for(h=0;h<t.length;h++)l.append(b("<option></option>").attr("value",t[h]).text(t[h]).attr("selected",d.fieldValue==t[h]));l.val(v)}else n.val(v||"").show().blur(),l.hide()};setTimeout(function(){if(f.domElement){f.domElement.on("change",".val",q);var t=f.domElement.find(".val:visible");t.length&&q.call(t.get(0))}else n.show()},0);d.unbindEventHandlers=function(){q&&
f.domElement&&f.domElement.find(".val").unbind("change",q);d.unbindEventHandlers=function(){}};return b("<div></div>").append(n).append(l)}return b("<div></div>").append(b('<input type="text" class="val small width-100-mobile">').val(d.fieldValue))}});a.factoryTypes.Timezone=b.extend({},a.factoryTypes.Select,{notSet:function(){return $_("Auto")}});a.factoryTypes.Region=b.extend({},a.factoryTypes.Select,{notSet:function(){return""},unbindEventHandlers:function(){},setCurrentCountry:function(){var c=
this.current_country;this.current_country=this.parentEditorData.parent.subfieldEditors.country.getValue();return c!==this.current_country?(delete this.fieldData.options,!0):!1},getRegionsControllerUrl:function(c){return a.getRegionsUrl()+c},newInlineFieldElement:function(c){if("view"==c&&!this.fieldValue)return null;this.unbindEventHandlers();var d=this.options||{};void 0!==d.country&&(this.current_country=d.country);if("view"==c)return b("<div></div>").append(b('<span class="val"></span>').text(this.fieldData.options&&
this.fieldData.options[this.fieldValue]||this.fieldValue));var f=this;if(this.parentEditorData.parent&&this.parentEditorData.parent.subfieldEditors.country){this.setCurrentCountry();var g;b(document).on("change","select.country",g=function(){if(f.setCurrentCountry()){var m="",n=f.domElement.find(".val");m=n.is("input")?n.val().trim():n.find(":selected").text().trim();var l=function(q,t){var v=t.toLocaleLowerCase();q.find("option").each(function(){if(b(this).text().trim().toLocaleLowerCase()===v)return b(this).attr("selected",
!0),!1})};f.domElement.empty().append(f.newInlineFieldElement(c).children());n=f.domElement.find(".val");n.is("input")&&!n.val()?n.val(m):n.is("select")&&m?l(n,m):f.domElement.unbind("load.fieldTypes").bind("load.fieldTypes",function(){var q=f.domElement.find(".val");q.is("select")&&m&&l(q,m)})}});f.unbindEventHandlers=function(){b(document).off("change","select.country",g);f.unbindEventHandlers=function(){}}}if(!d.no_ajax_select&&void 0===this.fieldData.options&&this.current_country&&this.fieldData.region_countries[this.current_country]){var h=
this.current_country;b.get(this.getRegionsControllerUrl(h),function(m){c===f.currentMode&&h===f.current_country&&(f.fieldData.options=m.data.options||!1,f.fieldData.oOrder=m.data.oOrder||[],b.isPlainObject(f.options)&&void 0!==f.options.country&&delete f.options.country,b("<div></div>").append(f.newInlineFieldElement(c).children()),f.domElement.empty().append(f.newInlineFieldElement(c).children()),f.domElement.trigger("load"))},"json");return b("<div></div>").append(b('<i class="icon16 loading"></i>'))}if(this.fieldData.options)return b("<div></div>").append(a.factoryTypes.Select.newInlineFieldElement.call(this,
c));d=b("<div></div>").append(a.baseFieldType.newInlineFieldElement.call(this,c));d.find(".val").attr("placeholder",this.fieldData.name+(this.fieldData.required?" ("+$_("required")+")":"")).addClass("small width-100-mobile");return d}});a.factoryTypes.Country=b.extend({},a.factoryTypes.Select);a.factoryTypes.Checklist=b.extend({},a.baseFieldType,{validate:function(c){return null},setValue:function(c){this.fieldValue=c;if("edit"==this.currentMode&&this.domElement){this.domElement.find('input[type="checkbox"]').attr("checked",
!1);for(var d in this.fieldValue)this.domElement.find('input[type="checkbox"][value="'+d+'"]').attr("checked",!0)}else"view"==this.currentMode&&this.domElement&&this.domElement.find(".val").html(this.getValueView())},getValue:function(){if("edit"!=this.currentMode||!this.domElement)return this.fieldValue;var c=[];this.domElement.find('input[type="checkbox"]:checked').each(function(d,f){c.push(b(f).val())});return c},getValueView:function(){for(var c="",d=0;d<this.fieldData.oOrder.length;d++){var f=
this.fieldData.oOrder[d];0>this.fieldValue.indexOf(f)||(c+=(c?", ":"")+'<a href="'+(this.fieldData.hrefPrefix||"#")+f+'">'+(this.fieldData.options[f]&&a.htmlentities(this.fieldData.options[f])||$_("&lt;no name&gt;"))+"</a>")}return c||$_("&lt;none&gt;")},newInlineFieldElement:function(c){if(!("view"!=c||this.fieldValue&&this.fieldValue.length))return null;if("view"==c)return b('<span class="val"></span>').html(this.getValueView());c=0;for(var d in this.fieldData.options)if(c++,1<c)break;if(!c)return null;
c="";for(var f=0;f<this.fieldData.oOrder.length;f++)d=this.fieldData.oOrder[f],c+='<li><label><span class="wa-checkbox"><input type="checkbox" value="'+d+'"',this.fieldData.disabled&&this.fieldData.disabled[d]&&(c+=' disabled="disabled"'),-1!==(this.fieldValue||[]).indexOf(d)&&(c+=' checked="checked"'),c+=' /><span><span class="icon"><i class="fas fa-check"></i></span></span></span>'+(this.fieldData.options[d]&&a.htmlentities(this.fieldData.options[d])||$_("&lt;no name&gt;"))+"</label></li>";return a.initCheckboxList('<div class="c-checkbox-menu-container val"><div><ul class="menu c-checkbox-menu">'+
c+"</ul></div></div>")}});a.factoryTypes.Name=b.extend({},a.baseFieldType,{newInlineFieldElement:null,newFieldElement:function(c){return b('<div style="display: none;" class="field" data-field-id="'+this.fieldData.id+'"></div>')},setValue:function(c){this.fieldValue=c},getValue:function(c){if(this.fieldValue&&!c)return this.fieldValue;c=[];"person"==this.contactType?(a.fieldEditors.firstname&&c.push(a.fieldEditors.firstname.getValue()),a.fieldEditors.middlename&&c.push(a.fieldEditors.middlename.getValue()),
a.fieldEditors.lastname&&c.push(a.fieldEditors.lastname.getValue())):a.fieldEditors.company&&c.push(a.fieldEditors.company.getValue());return c.join(" ").trim()},validate:function(c){var d=this.getValue(!0);if(!c&&this.fieldData.required&&!d){c=b("#"+this.options.el+" input:visible:text[value]:not(.empty)").val();if(!c)return $_("At least one of these fields must be filled");a.fieldEditors.firstname.setValue(c)}return null},showValidationErrors:function(c){var d=b("#"+this.options.el);d.find("div.wa-errors-block").remove();
if(null!==c){var f=b('<div class="field wa-errors-block"><div class="value"><p class="state-error-hint custom-mt-8">'+c+"</p></div></div>");a.fieldEditors.lastname?a.fieldEditors.lastname.domElement.after(f):d.prepend(f)}d=["firstname","middlename","lastname"];for(f=0;f<d.length;f++){var g=d[f];a.fieldEditors[g]&&(null!==c?a.fieldEditors[g].domElement.find(".val").addClass("state-error"):a.fieldEditors[g].domElement.find(".val").removeClass("state-error"))}},setMode:function(c,d){"undefined"==typeof d&&
(d=!0);if("view"!=c&&"edit"!=c)throw Error("Unknown mode: "+c);this.currentMode!=c&&(this.currentMode=c,d&&(d=this.domElement,this.domElement=this.newFieldElement(c),null!==d&&d.replaceWith(this.domElement)));a.fieldEditors.title&&a.fieldEditors.title.getValue();return this.domElement}});a.factoryTypes.NameSubfield=b.extend({},a.baseFieldType,{});a.factoryTypes.Multifield=b.extend({},a.baseFieldType,{subfieldEditors:null,subfieldFactory:null,emptySubValue:null,initializeFactory:function(c){this.fieldData=
c;if("undefined"!=typeof this.fieldData.ext){this.fieldData.extKeys=[];this.fieldData.extValues=[];for(var d in this.fieldData.ext)this.fieldData.extKeys[this.fieldData.extKeys.length]=d,this.fieldData.extValues[this.fieldData.extValues.length]=this.fieldData.ext[d]}},initialize:function(){this.subfieldFactory=b.extend({},a.factoryTypes[this.fieldData.type]);this.subfieldFactory.parentEditor=this;this.subfieldFactory.initializeFactory(b.extend({},this.fieldData));this.fieldData=b.extend({},this.fieldData,
{required:this.subfieldFactory.fieldData.required});this.subfieldEditors=[this.subfieldFactory.createEditor(this.contactType)];b.isPlainObject(this.subfieldEditors[0].fieldValue)?this.emptySubValue=b.extend({},this.subfieldEditors[0].fieldValue):this.emptySubValue={value:this.subfieldEditors[0].fieldValue};this.fieldData.ext&&(this.emptySubValue.ext=this.fieldData.extKeys[0]);this.fieldValue=[this.emptySubValue]},setValue:function(c){c&&"undefined"!=typeof c[0]||(c=[this.emptySubValue]);this.fieldValue=
c;var d=0;do{this.subfieldEditors.length<=d&&(this.subfieldEditors[d]=this.subfieldFactory.createEditor(this.contactType),"null"!=this.currentMode&&this.subfieldEditors[d].setMode(this.currentMode).insertAfter(this.subfieldEditors[d-1].parentEditorData.domElement));if("undefined"!=typeof c[d]){var f=!1,g;for(g in c[d])if("value"!=g&&"ext"!=g&&"status"!=g){f=!0;break}this.subfieldEditors[d].setValue(f?c[d]:c[d].value?c[d].value:"");if("undefined"!=typeof this.fieldData.ext&&(f=c[d].ext,"null"!=this.currentMode&&
this.subfieldEditors[d].parentEditorData.domElement)){var h=this.subfieldEditors[d].parentEditorData.domElement.find("input.ext");0<h.size()&&h[0].setExtValue(f)}}else throw Error("At least one record must exist in data at this time.");d++}while(d<c.length);if(c.length<this.subfieldEditors.length){for(d=c.length;d<this.subfieldEditors.length;d++)0!==d&&"null"!=this.currentMode&&this.subfieldEditors[d].parentEditorData.domElement.remove();c=0<c.length?c.length:1;this.subfieldEditors.splice(c,this.subfieldEditors.length-
c)}this.origFieldValue=null},getValue:function(){if("null"==this.currentMode)return b.extend({},this.fieldValue);for(var c=[],d=0;d<this.subfieldEditors.length;d++){var f=this.subfieldEditors[d];c[d]={value:f.getValue()};if("undefined"!=typeof this.fieldData.ext){var g=this.fieldValue[d].ext,h=f.parentEditorData.domElement.find("input.ext")[0];"edit"==f.currentMode&&h&&(g=h.getExtValue());c[d].ext=g}}return c},isModified:function(){for(var c=0;c<this.subfieldEditors.length;c++)if(this.subfieldEditors[c].isModified())return!0;
return!1},validate:function(c){for(var d=[],f=!0,g=0;g<this.subfieldEditors.length;g++){var h=this.subfieldEditors[g],m=h.validate(!0);m&&(d[g]=m);if((h=h.getValue())||"string"!=typeof h)f=!1}!c&&this.fieldData.required&&f&&(d[0]="This field is required.");return 0>=d.length?null:d},showValidationErrors:function(c){for(var d=0;d<this.subfieldEditors.length;d++){var f=this.subfieldEditors[d];null!==c&&"undefined"!=typeof c[d]?f.showValidationErrors(c[d]):f.showValidationErrors(null)}},deleteSubfieldButton:function(c){var d=
this,f=b('<a class="delete-subfield text-red custom-mt-8 custom-mt-0-mobile" title="'+$_("delete")+'" href="javascript:void(0)"><i class="fas fa-trash-alt icon size-14"></i></a>').click(function(){if(1>=d.subfieldEditors.length)return!1;var g=d.subfieldEditors.indexOf(c);"null"!=d.currentMode&&d.subfieldEditors[g].parentEditorData.domElement.remove();d.subfieldEditors.splice(g,1);1>=d.subfieldEditors.length&&d.domElement.find(".delete-subfield").hide();return!1});1>=this.subfieldEditors.length&&f.hide();
return f},newSubFieldElement:function(c,d){d-=0;var f=this.subfieldEditors[d];f.parentEditorData||(f.parentEditorData={});f.parentEditorData.parent=this;f.parentEditorData.empty=!1;if("function"!=typeof f.newInlineFieldElement){var g="";if(0==d||"Composite"===this.fieldData.type)g=this.fieldData.name+"";var h=a.wrapper('<span class="replace-me-with-value"></span>',g,"no-bot-margins"),m=h.find("span.replace-me-with-value");g=this.fieldValue[d].ext;"edit"==c?g=a.createExtSelect(this.fieldData.ext,g):
(g=this.fieldData.ext[this.fieldValue[d].ext]||g,g=b("<strong>"+a.htmlentities(g)+"</strong>"));m.before(g);"edit"==c&&m.before(this.deleteSubfieldButton(f));m.remove();f.domElement=this.subfieldEditors[d].newFieldElement(c);var n=this;f.domElement.find("div.name").each(function(l,q){q.innerHTML.substr(0,n.fieldData.name.length)===n.fieldData.name&&(q.innerHTML="")});g="";"Composite"===this.fieldData.type&&(g="field-composite-subfields-block");f.domElement.data("multifield-index",d).attr("data-multifield-index",
d);f.parentEditorData.domElement=b('<div class="'+g+'"></div>').append(h).append(f.domElement);f.parentEditorData.empty="edit"==c?!1:!f.fieldValue.value&&!f.fieldData.show_empty;return f.parentEditorData.domElement}g=f.newInlineFieldElement(c);if(null===g)return f.parentEditorData.domElement=f.domElement=b("<div></div>"),f.parentEditorData.empty=!0,f.parentEditorData.domElement;f.domElement=g;f.domElement.data("multifield-index",d).attr("data-multifield-index",d);h=b('<div class="value flexbox space-12 wrap-mobile"></div>').append(g);
m=h.find(".replace-with-ext");0>=m.size()&&(h.append('<span class="flexbox wide space-12"><span class="replace-with-ext"></span></span>'),m=h.find(".replace-with-ext"));"undefined"!=typeof this.fieldData.ext&&(g=this.fieldValue[d].ext,"edit"==c?m.before(a.createExtSelect(this.fieldData.ext,g)):(g=this.fieldData.ext[this.fieldValue[d].ext]||g,0<m.parents(".ext").size()?m.before(a.htmlentities(g)):m.before(b('<span class="hint" style="align-self: flex-end;"></span>').text(" "+g))));"edit"==c&&m.before(this.deleteSubfieldButton(f));
m.remove();return f.parentEditorData.domElement=h},newInlineFieldElement:null,newFieldElement:function(c){var d=this;this.fieldData.read_only&&(c="view");for(var f=b('<div class="multifield-subfields"></div>'),g="function"==typeof this.subfieldFactory.newInlineFieldElement,h=!0,m=0;m<this.subfieldEditors.length;m++){var n=this.newSubFieldElement(c,m);n.data("subfieldEditor",this.subfieldEditors[m]);"edit"===c&&n.prepend('<span class="sort sort-handler custom-mr-16 custom-mt-8 custom-mt-0-mobile"><i class="fas fa-grip-vertical text-light-gray"></i></span>');
f.append(n);h=h&&this.subfieldEditors[m].parentEditorData.empty}if(h&&!this.fieldData.show_empty)return b('<div style="display: none;" class="field" data-field-id="'+this.fieldData.id+'"></div>');h=g?b('<div class="value"></div>').append(f):b('<div class="field" data-field-id="'+this.fieldData.id+'"></div>').append(f);"edit"==c&&(m=g?b('<div class="value multifield-subfields-add-another"><span class="replace-me-with-value"></span></div>'):a.wrapper('<span class="replace-me-with-value"></span>'),d=
this,m.find(".replace-me-with-value").replaceWith(b('<a href="javascript:void(0)" class="button rounded outlined small light-gray custom-mb-16"><i class="fas fa-plus"></i> '+$_("Add another")+"</a>").click(function(l){var q=d.subfieldFactory.createEditor(this.contactType);l=d.subfieldEditors.length;var t={value:q.getValue(),temp:!0};"undefined"!=typeof d.fieldData.ext&&(t.ext="");d.fieldValue[l]=t;d.subfieldEditors[l]=q;"null"!=d.currentMode&&q.setMode(d.currentMode);q=d.newSubFieldElement(c,l);q.data("subfieldEditor",
d.subfieldEditors[l]);q.prepend('<span class="sort sort-handler custom-mr-16 custom-mt-8 custom-mt-0-mobile"><i class="fas fa-grip-vertical text-light-gray"></i></span>');f.append(q);a.dialog.resize()})),h.append(m),this.fieldData.multi&&b.fn.sortable?h.find(".multifield-subfields").sortable({direction:"vertical",handle:".sort-handler",animation:150,onEnd:function(l){var q=0;b(l.item).closest(".multifield-subfields").find("[data-multifield-index]").each(function(){var t=b(this);d.subfieldEditors[q]=
t.parent().data("subfieldEditor");t.data("subfieldIndex",q).attr("data-multifield-index",q);q++})}}):console.log(["$.fn.sortable available?",!!b.fn.sortable]));g&&(h=a.wrapper(h,this.fieldData.name+"").attr("data-field-id",this.fieldData.id));return h},setMode:function(c,d){"undefined"==typeof d&&(d=!0);if("view"!=c&&"edit"!=c)throw Error("Unknown mode: "+c);if(this.currentMode!=c){if("view"==c&&"edit"==this.currentMode&&this.origFieldValue)this.setValue(this.origFieldValue);else if("view"==this.currentMode&&
!this.origFieldValue){this.origFieldValue=[];for(var f=0;f<this.fieldValue.length;f++)this.origFieldValue.push(b.extend({},this.fieldValue[f]))}this.currentMode=c;d&&(d=this.domElement,this.domElement=this.newFieldElement(c),null!==d&&d.replaceWith(this.domElement))}for(f=0;f<this.subfieldEditors.length;f++)this.subfieldEditors[f].setMode(c,!1);return this.domElement}});a.factoryTypes.Composite=b.extend({},a.baseFieldType,{subfieldEditors:null,initializeFactory:function(c,d){this.fieldData=c;if(this.fieldData.required){for(var f in this.fieldData.required)if(this.fieldData.required[f]){this.fieldData.required=
!0;break}!0!==this.fieldData.required&&(this.fieldData.required=!1)}this.options=d||{}},initialize:function(){var c={data:{},value:""};this.subfieldEditors={};this.fieldData.subfields=this.fieldData.fields;for(var d in this.fieldData.subfields){var f=b.extend({},a.factoryTypes[this.fieldData.subfields[d].type]),g=this.fieldData.fields[d];this.fieldData.required&&this.fieldData.required[d]&&(g.required=!0);g=b.extend({},g,{id:null,multi:!1});f.initializeFactory(g,this.options);f.parentEditor=this;
f.parentEditorData={};f.initialize();f.parentEditorData.sfid=d;f.parentEditorData.parent=this;this.subfieldEditors[d]=f;c.data[d]=f.getValue()}this.fieldValue=c},setValue:function(c){if(c){this.fieldValue=c;for(var d in this.subfieldEditors){var f=this.subfieldEditors[d];"undefined"==typeof c.data?(f.initialize(),f.setValue(f.getValue())):"undefined"!=typeof c.data[d]?f.setValue(c.data[d]):f.setValue(f.getValue())}}},getValue:function(){if("null"==this.currentMode)return b.extend({},this.fieldValue.data);
var c={},d;for(d in this.subfieldEditors)c[d]=this.subfieldEditors[d].getValue();return c},isModified:function(){for(var c in this.subfieldEditors)if(this.subfieldEditors[c].isModified())return!0;return!1},validate:function(c){var d={},f=!1,g;for(g in this.subfieldEditors){var h=this.subfieldEditors[g].validate(c);h&&(d[g]=h,f=!0)}return f?d:null},showValidationErrors:function(c){if(null!==this.domElement)for(var d in this.subfieldEditors){var f=this.subfieldEditors[d];null!==c&&"undefined"!=typeof c[d]?
f.showValidationErrors(c[d]):f.showValidationErrors(null)}},newInlineFieldElement:null,newFieldElement:function(c){this.fieldData.read_only&&(c="view");if("view"==c&&!this.fieldValue.value&&!this.fieldData.show_empty)return b('<div style="display: none;" class="field" data-field-id="'+this.fieldData.id+'"></div>');var d=b('<div class="composite '+c+'" data-field-id="'+this.fieldData.id+'"></div>').append(a.wrapper('<span style="display:none" class="replace-with-ext"></span>',this.fieldData.name,"hdr")),
f;for(f in this.subfieldEditors){var g=this.subfieldEditors[f],h=g.newFieldElement(c);h.attr("data-field-id",f);h.data("fieldId",f);g.domElement=h;d.append(h)}return d},setMode:function(c,d){"undefined"==typeof d&&(d=!0);if("view"!=c&&"edit"!=c)throw Error("Unknown mode: "+c);this.currentMode!=c&&(this.currentMode=c,d&&(d=this.domElement,this.domElement=this.newFieldElement(c),null!==d&&d.replaceWith(this.domElement)));for(var f in this.subfieldEditors)this.subfieldEditors[f].setMode(c,!1);return this.domElement}});
a.factoryTypes.Address=b.extend({},a.factoryTypes.Composite,{showValidationErrors:function(c){if(null!==this.domElement&&(this.domElement.find(".state-error-hint").remove(),this.domElement.find(".val").removeClass("state-error"),c))for(var d in this.subfieldEditors)"undefined"!=typeof c[d]&&this.subfieldEditors[d].domElement.find(".val").addClass("state-error").parents(".address-subfield").append(b('<p class="state-error-hint custom-mt-8">'+c[d]+"</p>"))},newInlineFieldElement:function(c){if("view"==
c){if(!this.fieldValue.value)return null;var d=this.fieldValue.for_map.map_url||"";return d=b('<div class="address-field width-100-mobile"></div>').append('<span class="small">'+this.fieldValue.value+"</span>").append('<span style="display:none" class="replace-with-ext"></span> ').append('<a target="_blank" href="'+d+'" class="map-link small">'+$_("map")+'<i class="fas fa-external-link-alt small custom-ml-4"></i></a>')}c=b('<div class="address-field width-100-mobile"></div>');c.append('<span style="display:none" class="replace-with-ext"></span>');
for(d in this.subfieldEditors){var f=this.subfieldEditors[d],g=f.newInlineFieldElement("edit");f.domElement=g;"Hidden"!==f.fieldData.type?c.append(b('<div class="address-subfield custom-mt-12"></div>').append(g)):c.append(b('<div class="address-subfield"></div>').append(g));"Hidden"!==f.fieldData.type&&(f=f.fieldData.name+(f.fieldData.required?" ("+$_("required")+")":""),g.find("input.val,textarea.val").attr("placeholder",f).attr("title",f).addClass("small width-100-mobile"))}return c}});a.factoryTypes.Birthday=
b.extend({},a.baseFieldType,{newInlineFieldElement:function(c){this.fieldValue=this.fieldValue||{};if("view"==c&&!this.fieldValue.value)return null;var d=this.fieldValue.data||{};if("edit"==c){c=b('<div class="wa-select small"></div>');var f=b('<select class="val" data-part="day"><option data=""></option></select>'),g=[].concat($jscomp.arrayFromIterable(Array(32).keys())).slice(1);g=$jscomp.makeIterator(g);for(var h=g.next();!h.done;h=g.next()){h=h.value;var m=b('<option data="'+h+'" value="'+h+'">'+
h+"</option>");h===+d.day&&m.attr("selected",!0);f.append(m)}c.append(f);f=b('<div class="wa-select small"></div>');g=b('<select class="val" data-part="month"><option data=""></option></select>');h="January February March April May June July August September October November December".split(" ");m=$jscomp.makeIterator(h.entries());for(var n=m.next();!n.done;n=m.next()){n=$jscomp.makeIterator(n.value);var l=n.next().value;n.next();n=l+1;l=$_(h[l]);l=b('<option data="'+n+'" value="'+n+'">'+l+"</option>");
n===+d.month&&l.attr("selected",!0);g.append(l)}f.append(g);g=b('<input type="text" data-part="year" class="val small" style="min-width: 54px; width: 54px;" placeholder="'+$_("year")+'">');d.year&&g.val(d.year);d=b("<span></span>").append(c).append(" ").append(f).append(" ").append(g)}else d=b('<span class="val small"></span>').text(this.fieldValue.value);return d},getValue:function(){var c=this.fieldValue;if("edit"==this.currentMode&&null!==this.domElement){var d=this.domElement.find(".val");0<d.length&&
(c={value:{day:null,month:null,year:null}},d.each(function(){var f=b(this),g=f.data("part");c.value[g]=parseInt(f.val(),10)||null}))}return c},setValue:function(c){this.fieldValue=c;if("null"!=this.currentMode&&null!==this.domElement)if("edit"==this.currentMode)c&&c.data&&this.domElement.find(".val").each(function(){var f=b(this),g=f.data("part");f.val(c.data[g]||"")});else{var d=this.fieldValue;"object"===typeof this.fieldValue&&this.fieldValue.value&&(d=this.fieldValue.value);this.domElement.find(".val").html(b.wa.encodeHTML(d))}}});
a.factoryTypes.Date=b.extend({},a.factoryTypes.String,{initializeFactory:function(c,d){this.fieldData=c||{};this.options=d||{};this.fieldData.input_height=1},setValue:function(c){this.fieldValue=c;"null"!=this.currentMode&&null!==this.domElement&&("edit"==this.currentMode?this.domElement.find("input:text").datepicker("setDate",this.fieldValue):this.domElement.find(".val").html(b.wa.encodeHTML(this.fieldValue)))},newInlineFieldElement:function(c){var d=a.factoryTypes.String.newInlineFieldElement.call(this,
c);if("edit"==c){var f=this,g=d.addClass("state-with-inner-icon right").find("input:text").addClass("js-datepicker").removeClass("val"),h=b('<input type="hidden" class="val">').insertAfter(g);b('<span class="icon cursor-pointer js-datepicker-trigger"><i class="fas fa-calendar-alt"></i></span>').insertAfter(g);(function(m){g.datepicker?m():b.wa.loadFiles([b.wa.contactEditor.wa_backend_url+"wa-content/js/jquery-ui/jquery.ui.core.min.js",b.wa.contactEditor.wa_backend_url+"wa-content/js/jquery-ui/jquery.ui.datepicker.min.js"]).then(m)})(function(){g.datepicker({altField:h,
altFormat:"yy-mm-dd",dateFormat:f.fieldData.format,changeMonth:!0,changeYear:!0,shortYearCutoff:2,showOtherMonths:!0,selectOtherMonths:!0,stepMonths:2,numberOfMonths:2,beforeShow:function(m,n){setTimeout(function(){return n.dpDiv.css({"z-index":"1051"})})}});f.fieldValue&&g.datepicker("setDate",f.fieldValue);(function(m){var n=null;g.keydown(function(){n&&clearTimeout(n);n=setTimeout(function(){m()},250)});g.change(m)})(function(){0>=b.trim(g.val()).length&&(g.datepicker("setDate",null),f.fieldValue=
null)})});d.on("click",".js-datepicker-trigger",function(){g.trigger("focus")})}return d}});a.factoryTypes.IM=b.extend({},a.baseFieldType,{setValue:function(c){"undefined"==typeof c&&(c="");b.isPlainObject(c)?(this.fieldValue=c.data,this.viewValue=c.value):this.fieldValue=this.viewValue=c;"null"!=this.currentMode&&this.domElement&&("edit"==this.currentMode?this.domElement.find("input.val").val(this.fieldValue):this.domElement.find(".val").html(this.viewValue))},newInlineFieldElement:function(c){if("view"==
c&&!this.fieldValue)return null;"edit"==c?(c=b('<span class="width-100-mobile custom-mr-0-mobile"><input class="val small width-100-mobile" type="text"></span>'),c.find(".val").val(this.fieldValue)):c=b('<span class="val small custom-mt-12-mobile"></span>').html(this.viewValue);return c}});a.factoryTypes.SocialNetwork=b.extend({},a.baseFieldType,{setValue:function(c){"undefined"==typeof c&&(c="");b.isPlainObject(c)?(this.fieldValue=c.data,this.viewValue=c.value):this.fieldValue=this.viewValue=c;"null"!=
this.currentMode&&this.domElement&&("edit"==this.currentMode?this.domElement.find("input.val").val(this.fieldValue):this.domElement.find(".val").html(this.viewValue))},newInlineFieldElement:function(c){if("view"==c&&!this.fieldValue)return null;"edit"==c?(c=b('<span class="width-100-mobile custom-mr-0-mobile"><input class="val small width-100-mobile" type="text"></span>'),c.find(".val").val(this.fieldValue)):c=b('<span class="val small nowrap custom-mt-12-mobile"></span>').html(this.viewValue);return c}});
a.factoryTypes.Url=b.extend({},a.factoryTypes.IM,{validate:function(c){var d=b.trim(this.getValue());if(!c&&this.fieldData.required&&!d)return $_("This field is required.");if(!d)return null;/^(https?|ftp|gopher|telnet|file|notes|ms-help)/.test(d)||(d="http://"+d,this.setValue(d));c=RegExp("^(https?|ftp|gopher|telnet|file|notes|ms-help):((//)|(\\\\\\\\))+[^`!\\[\\]{}'\"<>\u00ab\u00bb\u201c\u201d\u2018\u2019\\s]*$","i");return!c.test(d)||/^(http|ftp)/.test(d.toLowerCase())&&(c=RegExp("^(https?|ftp):((//)|(\\\\\\\\))+((?:[^`!()\\[\\]{};:'\".,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019\\s+]+\\.)+[^`!()\\[\\]{};:'\".,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019\\s+]{2,6})((/|\\\\|#)[^`!\\[\\]{}'\"<>\u00ab\u00bb\u201c\u201d\u2018\u2019\\s]*)?$",
"i"),!c.test(d))?$_("Incorrect URL format."):null}});a.factoryTypes.Email=b.extend({},a.factoryTypes.Url,{validate:function(c){var d=b.trim(this.getValue());return c||!this.fieldData.required||d?d?RegExp("^([^@\\s]+)@[^\\s@]+\\.[^\\s@\\.]{2,}$","i").test(d)?null:$_("Incorrect email address format."):null:$_("This field is required.")}});a.factoryTypes.Checkbox=b.extend({},a.baseFieldType,{setValue:function(c){this.fieldValue=parseInt(c);"null"!=this.currentMode&&this.domElement&&("edit"==this.currentMode?
this.domElement.find("input.val").attr("checked",!!this.fieldValue):this.domElement.find(".val").text(this.fieldValue?$_("Yes"):$_("No")))},newInlineFieldElement:function(c){"edit"==c?(c=b('<label>\n                    <span class="wa-checkbox">\n                        <input class="val" type="checkbox" value="1" checked="checked">\n                        <span>\n                            <span class="icon">\n                                <i class="fas fa-check"></i>\n                            </span>\n                        </span>\n                    </span>\n                </label>'),
this.fieldValue||c.find(".val").removeAttr("checked")):c=b('<span class="val small"></span>').text(this.fieldValue?$_("Yes"):$_("No"));return c}});a.factoryTypes.Number=b.extend({},a.baseFieldType,{validate:function(c){var d=b.trim(this.getValue());return c||!this.fieldData.required||d||0===d?d&&!/^-?[0-9]+([\.,][0-9]+$)?/.test(d)?$_("Must be a number."):null:$_("This field is required.")}});return a.factoryTypes};b.wa.contactEditorFactory=function(a){a=b.extend({contact_id:null,current_user_id:null,
contactType:"person",baseFieldType:null,saveUrl:"?module=profile&action=save",saveGeocoordsUrl:"?module=contacts&action=saveGeocoords",regionsUrl:"?module=backend&action=regions&country=",el:"#contact-info-block",update_title:!0,dialog:{}},a);var e=b.extend({wa_app_url:"",fields:{},fieldsOrder:[],fieldsValues:{},factoryTypes:{},editorFactories:{},fieldEditors:{},initFactories:function(c,d){var f=this;this.fields=c;this.fieldsOrder=d;this.editorFactories={};this.fieldEditors={};this.fieldsOrder=b.each(d,
function(g,h){try{if("object"!=typeof c[h]||!c[h].type)throw Error("Field data error for "+h);if("undefined"==typeof f.factoryTypes[c[h].type])throw Error("Unknown factory type: "+c[h].type);f.editorFactories[h]=c[h].multi?b.extend({},f.factoryTypes.Multifield):b.extend({},f.factoryTypes[c[h].type]);f.editorFactories[h].initializeFactory(c[h]);return h}catch(m){console.log("Unable to init field "+h),console.log(m),c[h]=void 0,delete c[h]}}).filter(function(g){return!!g})},resetFieldEditors:function(){for(var c=
0;c<this.fieldsOrder.length;c+=1){var d=this.fieldsOrder[c];"undefined"==typeof this.fieldEditors[d]?this.fieldEditors[d]=this.editorFactories[d].createEditor(this.contactType,d):this.fieldEditors[d].reinit()}},initFieldEditors:function(c){if(!(c instanceof Array)){this.fieldsValues=c;for(var d=0;d<this.fieldsOrder.length;d+=1){var f=this.fieldsOrder[d];if("undefined"==typeof this.editorFactories[f]){b.wa.controller.contactAction([this.contact_id]);break}try{"undefined"==typeof this.fieldEditors[f]&&
(this.fieldEditors[f]=this.editorFactories[f].createEditor(this.contactType)),this.fieldEditors[f].setValue(c[f])}catch(g){console.log("Unable to initialize editor "+f),console.log(g)}}}},initContactInfoBlock:function(c){this.switchMode(c,!0)},getSaveUrl:function(){return this.saveUrl},getSaveGeocoordsUrl:function(){return b.wa.contactEditor.wa_backend_url+"?module=profile&action=saveGeocoords"},getRegionsUrl:function(){return b.wa.contactEditor.wa_backend_url+"?module=profile&action=regions&country="},
switchMode:function(c,d){var f=b(this.el),g=this;d&&(f.html(""),f.removeClass("edit-mode view-mode"),f.off("click.map",".map-link").on("click.map",".map-link",function(){var q=b(this).parent().data("multifield-index");void 0!==q&&g.geocodeAddress(g.fieldEditors.address.fieldValue,q)}));if("edit"!=c||!f.hasClass("edit-mode"))if("view"!=c||!f.hasClass("view-mode")){b(this).trigger("before_switch_mode",[c,this]);f.find(".buttons").remove();for(var h=[],m=0;m<this.fieldsOrder.length;m+=1){var n=this.fieldsOrder[m];
h.push(n);try{var l=this.fieldEditors[n].setMode(c);b(this).trigger("set_mode",[{mode:c,el:f,field_id:n,field:this.fieldEditors[n]}]);d&&f.append(l)}catch(q){console.log("Error initializing field",n,q)}}"edit"==c?(f.addClass("edit-mode"),f.removeClass("view-mode"),f.find(".subname").wrapAll('<div class="subname-wrapper custom-mt-0"></div>'),f.find(".jobtitle-company").wrapAll('<div class="jobtitle-company-wrapper custom-mt-16"></div>'),d=this.inplaceEditorButtons(h,function(q){if("undefined"!=typeof q&&
!q)return!1;if("undefined"!=typeof g.justCreated&&g.justCreated)throw q=b("#all-users-sidebar-link .count"),q.text(1+parseInt(q.text())),Error("!!! Not implemented because never used. Redirect to contact_id="+g.contact_id);g.dialog.hide()}),null===g.contact_id&&d.find(".cancel").remove(),g.dialog.$body.find(".dialog-footer").append(d)):(f.addClass("view-mode"),f.removeClass("edit-mode"),f.find(".subname-wrapper").length&&f.find(".subname").unwrap(),f.find(".jobtitle-company-wrapper").length&&f.find(".jobtitle-company").unwrap());
b(this).trigger("after_switch_mode",[c,this])}},saveFields:function(c,d){function f(y,z,E){if(E)for(var B=0;B<E.length;B+=1){if(y[E[B]]&&z[E[B]]&&y[E[B]]!=z[E[B]])return!1}else{for(B in y)if(y.hasOwnProperty(B)&&y[B]&&z[B]&&y[B]!=z[B])return!1;for(B in z)if(z.hasOwnProperty(B)&&y[B]&&z[B]&&y[B]!=z[B])return!1}return!0}function g(y){y=void 0===y?!0:y;b.post(l.getSaveUrl(),{data:JSON.stringify(n),type:l.contactType,id:null!=l.contact_id?l.contact_id:0},function(z){if("ok"!==z.status){if(z.errors.length){z=
z.errors["0"];b(".buttons .loading").hide();b("#validation-notice").text(z.text);return}throw new Exception("AJAX error:",z);}b("#validation-notice").text("");var E=l.fieldsValues||{};z=z.data;var B=null;z.data&&z.data.top&&(B=z.data.top);z.data.top=void 0;delete z.data.top;null!=l.contact_id&&l.initFieldEditors(z.data);var C=!1,A;for(A in l.fieldEditors)if("undefined"!=typeof z.errors[A]){if(l.fieldEditors[A].showValidationErrors(z.errors[A]),!C)for(C=l.fieldEditors[A].domElement;!C.is(":visible");)C=
C.parent()}else"edit"==l.fieldEditors[A].currentMode&&l.fieldEditors[A].showValidationErrors(null);C||(l.contact_id&&z.data.reload?window.profileTab?window.profileTab.rootWindow.location.reload():window.location.reload():(null===l.contact_id&&(l.justCreated=!0),l.contact_id=z.data.id,!C&&y&&h(E,z),d(!C),C||(b(e).trigger("contact_saved",z.data),B&&b(e).trigger("top_fields_updated",{data:B}),b.team.content.reload(!0))))},"json")}function h(y,z){var E=b.storage.get("contacts/last_geocoding")||0;if(3600<
(new Date).getTime()-E&&(b.storage.del("contacts/last_geocoding"),z=z.data.address,!b.isEmptyObject(z))){var B=[],C=[];for(E=0;E<z.length;E+=1){var A=!0;n.address[E]&&(A=!f(z[E].data,(y.address[E]||{}).data||{},["city","country","region","street","zip"]));A&&(B.push(l.sendGeocodeRequest(z[E].for_map)),C.push(E))}if(B.length){var G=function(x,F){if("OK"===x.status){var k=x.lng||"";n.address[F].value.lat=x.lat||"";n.address[F].value.lng=k}else"OVER_QUERY_LIMIT"===x.status&&b.storage.set("contacts/last_geocoding",
(new Date).getTime()/1E3)};b.when.apply(b,B).then(function(){if(1>=B.length&&"success"===arguments[1])G(arguments[0],C[0]);else for(var x=0;x<arguments.length;x+=1)"success"===arguments[x][1]&&G(arguments[x][0],C[x]);g(!1)})}}}if(!c){c=[];for(var m in this.fields)this.fields.hasOwnProperty(m)&&c.push(m)}var n={},l=this;m=!1;for(var q=0;q<c.length;q++){var t=c[q],v=this.fieldEditors[t].validate();if(v){if(!m)for(m=this.fieldEditors[t].domElement;!m.is(":visible");)m=m.parent();this.fieldEditors[t].showValidationErrors(v)}else this.fieldEditors[t].showValidationErrors(null);
n[t]=this.fieldEditors[t].getValue()}m?d(!1):g(!0)},createExtSelect:function(c,d){var f="",g=!0,h;for(h in c){var m="";if(c[h]===d||h===d)m=' selected="selected"',g=!1;var n=this.htmlentities(c[h]);f+='<option value="'+("undefined"===typeof c.length?h:n)+'"'+m+">"+n+"</option>"}if(g){f+='<option value="%custom" selected="selected">'+$_("other")+"...</option>";var l='<input type="text" class="shorter small ext width-100-mobile custom-mt-12-mobile">'}else f+='<option value="%custom">'+$_("other")+"...</option>",
l='<input type="text" class="shorter small empty ext width-100-mobile custom-mt-12-mobile">';f=b('<div class="wa-select small width-100-mobile custom-mr-12 custom-mt-12-mobile"><select class="ext">'+f+'</select></div><span class="width-100-mobile custom-mr-12 custom-mr-0-mobile">'+l+"</span>");var q=f.children("select");l=f.find("input");l.val(d);"%custom"!==q.val()&&l.hide();d=$_("which?");var t=function(){l.val()||l.hasClass("empty")||(l.val(d),l.addClass("empty"))};l.blur(t);l.focus(function(){l.hasClass("empty")&&
(l.val(""),l.removeClass("empty"))});q.change(function(){var v=q.val();"%custom"===v?(l.hasClass("empty")&&l.val(d),l.show()):(l.hide(),l.addClass("empty"),l.val(v||""));t()});l[0].getExtValue=function(){return"%custom"===q.val()&&l.hasClass("empty")?"":l.val()};l[0].setExtValue=function(v){c[v]?q.val(v):q.val("%custom");l.val(v)};return f},inplaceEditorButtons:function(c,d){var f=b('<div class="field buttons"><div class="value"><p class="state-error-hint custom-mt-8" id="validation-notice"></p></div></div>'),
g=this,h=function(){b(".buttons .loading").show();g.saveFields(c,function(l){b(".buttons .loading").hide();d(l)});return!1};b("#tc-contact").off("keyup.contact_save").on("keyup.contact_save",'#contact-info-block.edit-mode input[type="text"]',function(l){13!=l.keyCode||b(l.currentTarget).data("autocomplete")&&b(l.currentTarget).data("contact_id")||h()});var m=b('<input type="submit" class="button" value="'+$_("Save")+'" />').click(h);g=this;var n=b('<a href="javascript:void(0)" class="cancel button light-gray js-close-dialog">'+
$_("Cancel")+"</a>");n.on("click",function(l){l.preventDefault();b("#validation-notice").text("");b(".buttons .loading").hide();g.fieldEditors.name.showValidationErrors(null)});f.children(".value").append(m).append(n).append(b('<i class="fas fa-spinner fa-spin loading custom-ml-16 wa-animation-spin speed-1000" style="display: none;"></i>'));return f},destroy:function(){b(this.el).html("")},dialogInstance:function(c){this.dialog=c},wrapper:function(c,d,f){f=b('<div class="field'+("undefined"!=typeof f&&
f?" "+f:"")+'"></div>');"undefined"!=typeof d&&d&&(b(this).on("set_mode",function(g,h){"Checkbox"===h.field.fieldData.type?h.field.domElement.find(".name").toggleClass("for-checkbox","edit"==h.mode):h.field.domElement.find(".name").toggleClass("for-input","edit"==h.mode)}),f.append('<div class="name'+(b(this.el).closest(".dialog-content").length?" for-input":"")+'">'+b.wa.encodeHTML(d)+"</div>"));if("object"!=typeof c||!(c instanceof jQuery)||0>=c.find("div.value").size())c=b('<div class="value custom-mb-12"></div>').append(c);
f.append(c);return f},htmlentities:function(c){var d=document.createElement("div");c=document.createTextNode(c);d.appendChild(c);return d.innerHTML},geocodeAddress:function(c,d){var f=this;c[d].data.lat&&c[d].data.lng||this.sendGeocodeRequest(c[d].for_map||c[d].value,function(g){c[d].data.lat=g.lat;c[d].data.lng=g.lng;b.post(f.getSaveGeocoordsUrl(),{id:f.contact_id,lat:g.lat,lng:g.lng,sort:d})})},sendGeocodeRequest:function(c,d){var f=[];"string"===typeof c?f.push(c):c.with_street&&c.without_street&&
c.with_street===c.without_street?f.push(c.with_street):(c.with_street&&f.push(c.with_street),c.without_street&&f.push(c.without_street));var g=b.Deferred();c=this.geocoding||{};var h=function(n){b.ajax({url:"https://maps.googleapis.com/maps/api/geocode/json",data:{sensor:!1,key:n,address:f[0]},dataType:"json",success:function(l){if(l)if("OK"===l.status){for(var q=l.results.length,t=!1,v=0;v<q;v+=1)if(!l.results[v].partial_match){var y=l.results[v].geometry.location.lat||"";var z=l.results[v].geometry.location.lng||
"";d instanceof Function&&d({lat:y,lng:z});t=!0;break}t||(y=l.results[0].geometry.location.lat||"",z=l.results[0].geometry.location.lng||"",d instanceof Function&&d({lat:y,lng:z}));g.resolve([{lat:y,lng:z,status:l.status},"success"])}else g.resolve([{status:l.status},"success"]);else g.resolve([{status:"FAIL"},"error"])},error:function(l){g.resolve([{status:l.status},"error"])}})},m=function(n){b.ajax({url:"https://geocode-maps.yandex.ru/1.x/?format=json",data:{apikey:n,geocode:f[0]},dataType:"json",
success:function(l){var q,t;l.response&&l.response.GeoObjectCollection&&l.response.GeoObjectCollection.featureMember?(b.each(l.response.GeoObjectCollection.featureMember,function(v,y){if(y.GeoObject&&y.GeoObject.Point&&y.GeoObject.Point.pos&&"string"===typeof y.GeoObject.Point.pos&&(v=y.GeoObject.Point.pos.split(" "),2===v.length))return t=v[0],q=v[1],d instanceof Function&&d({lat:q,lng:t}),g.resolve([{lat:q,lng:t,status:"OK"},"success"]),!1}),q&&t||g.resolve([{status:"FAIL"},"error"])):g.resolve([{status:"FAIL"},
"error"])},error:function(l){g.resolve([{status:"FAIL"},"error"])}})};"google"===c.type&&c.key?h(c.key):"yandex"===c.type&&c.key?m(c.key):g.resolve([{geocoding:c},"error"]);return g},initCheckboxList:function(c){c=b(c);var d=function(f,g){f=b(g||this);f.is(":checked")?f.parent().addClass("access-highlighted"):f.parent().removeClass("access-highlighted")};c.find('input[type="checkbox"]').click(d).each(d);return c}},a);b.wa.fieldTypesFactory(e);return e};b.wa.contactEditor=b.wa.contactEditorFactory()})(jQuery);var AccessPage=function(b){var a=function(c){a=function(d){this.$wrapper=d.$wrapper;this.$accessWrapper=this.$wrapper.find(".t-access-wrapper");this.$accessSlider=this.$wrapper.find(".t-access-slider");this.$headerApps=this.$wrapper.find(".t-header-apps");this.$headerList=this.$headerApps.find(".t-apps-list");this.$apps=this.$headerList.find(".t-app-item");this.item_count=this.$apps.length;this.type_class=!1;this.items_left=this.left=0;this.item_w=this.access_slider_w=this.access_wrapper_w=!1;this.initClass()};
a.prototype.initClass=function(){function d(){c.contains(document,f.$wrapper[0])?f.reset():c(window).off("resize",d)}var f=this;f.detectSliderWidth();f.showArrows();f.setWrapMaxWidth();c(window).on("resize",c.proxy(f.setWrapMaxWidth,f));c(window).on("resize",d);f.$wrapper.on("click",".t-action",function(){var g=c(this);g.hasClass("left")&&f.moveSlider(!1);g.hasClass("right")&&f.moveSlider(!0)})};a.prototype.setWrapMaxWidth=function(){var d=window.innerWidth-document.documentElement.offsetWidth;d=
document.body.scrollHeight>window.innerHeight?window.innerWidth-d-this.$wrapper.offset().left:window.innerWidth-this.$wrapper.offset().left;this.$wrapper[0].style.setProperty("max-width",d+"px");c("body")[0].style.setProperty("overflow-x","hidden")};a.prototype.detectSliderWidth=function(){this.access_wrapper_w=this.$accessWrapper.outerWidth();this.access_slider_w=this.$accessSlider.outerWidth();this.item_w=this.$apps.first().outerWidth()};a.prototype.showArrows=function(){function d(g){f.type_class&&
(f.$accessWrapper.removeClass(f.type_class),f.$headerApps.removeClass(f.type_class));g&&(f.$accessWrapper.addClass(g),f.$headerApps.addClass(g),f.type_class=g)}var f=this;0<=f.left?f.access_wrapper_w<f.access_slider_w?d("type-1"):d():f.access_wrapper_w<f.access_slider_w-Math.abs(f.left)?d("type-2"):d("type-3")};a.prototype.setLeft=function(d){this.$headerList.css({left:d});this.$accessSlider.css({left:d});this.left=d};a.prototype.moveSlider=function(d){var f=this.items_left;d?d=f+1:(d=f-1,0>d&&(d=
0));f=d*this.item_w;f>-(this.access_wrapper_w-this.access_slider_w)&&(f=-(this.access_wrapper_w-this.access_slider_w));this.items_left=d;this.setLeft(-f);this.showArrows()};a.prototype.reset=function(){this.items_left=0;this.setLeft(0);this.detectSliderWidth();this.showArrows()};return a}(b),e=function(c){e=function(d){this.$wrapper=d.$wrapper;this.$header=this.$wrapper.find(".t-elastic-header");this.wrapper_offset=this.$wrapper.offset();this.header_w=this.$header.outerWidth();this.header_h=this.$header.outerHeight();
this.fixed_class="is-fixed";this.is_fixed=!1;this.initClass()};e.prototype.initClass=function(){function d(){if(c.contains(document,g.$header[0]))g.onScroll(h.scrollTop());else h.off("scroll",d)}function f(){if(c.contains(document,g.$header[0]))g.onResize();else h.off("resize",f)}var g=this,h=c(window);h.on("scroll",d).on("resize",f)};e.prototype.onScroll=function(d){d>this.wrapper_offset.top?(this.$header.addClass(this.fixed_class).css({left:this.wrapper_offset.left,width:this.header_w}),this.is_fixed=
!0):(this.$header.removeClass(this.fixed_class).removeAttr("style"),this.is_fixed=!1)};e.prototype.onResize=function(){this.header_w=this.$wrapper.outerWidth();this.is_fixed&&this.$header.width(this.header_w)};return e}(jQuery);AccessPage=function(c){this.$wrapper=c.$wrapper;this.slider=!1;this.dialogs=[];this.initClass()};AccessPage.prototype.initClass=function(){this.initAccessSlider();this.initElasticHeader();this.initHover();this.bindEvents()};AccessPage.prototype.bindEvents=function(){var c=
this;c.$wrapper.on("click",".t-access-status",function(f){f.preventDefault();f=b(this);f.hasClass("is-admin")&&!c.dialogs.length?b.team.content.load(f.data("uri")):showAccessDialog(f,f.data("app-id"),f.data("user-id"))});var d;b(document).on("team_access_level_changed",d=function(f,g){b.contains(document.body,c.$wrapper[0])?c.$wrapper.find('table.t-access-table tr[data-user-id="'+g.contact_id+'"] .t-access-status[data-app-id="'+g.app_id+'"]').removeClass("type-no type-limited type-full type-"+g.prev_level).addClass("type-"+
g.new_level):b(document).off("team_access_level_changed",d)})};AccessPage.prototype.initAccessSlider=function(){this.slider||(this.slider=new a({$wrapper:this.$wrapper}))};AccessPage.prototype.initElasticHeader=function(){new e({$wrapper:this.$wrapper})};AccessPage.prototype.closeDialogs=function(){var c=!1;this.dialogs.length&&(b.each(this.dialogs,function(d,f){b.contains(document,f.$wrapper[0])&&(f.close(),c=!0)}),this.dialogs=[]);return c};AccessPage.prototype.initHover=function(){function c(){d&&
(d.removeClass("access-highlighted"),d=!1);f&&(f.removeClass("access-highlighted"),f=!1)}var d=!1,f=!1;this.$wrapper.on("mouseenter",".t-access-status",function(){var g=b(this),h=g.data("user-id");g=g.data("app-id");c();h&&g&&(h=b("#t-user-"+h),g=b("#t-app-"+g),h.length&&(h.addClass("access-highlighted"),d=h),g.length&&(g.addClass("access-highlighted"),f=g))});this.$wrapper.on("mouseleave",".t-access-status",c)};return AccessPage}(jQuery);
(function(b){window.AccessDialog=function(a){function e(d){this.$dialogWrapper=d.$wrapper;this.$wrapper=this.$dialogWrapper.find(".dialog-body");this.$limitedContent=this.$wrapper.find(".t-limited-access-form");this.$submit_btn=this.$wrapper.find('[type="submit"]');this.active_class="selected";this.disabled_class="disabled";this.wa_app_url=d.wa_app_url;this.app_id=d.app_id;this.contact_id=d.contact_id;this.teamDialog=this.$dialogWrapper.data("dialog")||!1;this.noticeToggle=c(this.$wrapper);this.$activeTab=
this.$wrapper.find(".t-access-item."+this.active_class);this.active_access_id=this.$activeTab.data("access-id");this.is_locked=!1;this.initClass()}function c(d){var f=d.find(".t-loading"),g=d.find(".t-success"),h,m;return h={loading:function(){g.removeClass("is-visible");f.addClass("is-visible")},success:function(){g.addClass("is-visible");f.removeClass("is-visible");m&&clearTimeout(m);m=setTimeout(function(){a.contains(document,g[0])&&h.hide()},2E3)},hide:function(){m&&clearTimeout(m);f.removeClass("is-visible");
g.removeClass("is-visible")}}}e.prototype.initClass=function(){this.bindEvents()};e.prototype.bindEvents=function(){var d=this;d.$wrapper.find(".t-access-list").waToggle({use_animation:!1,change:function(f,g,h){f=a(g);g=f.hasClass(d.disabled_class);d.$submit_btn.toggleClass("yellow",h.$active.data("access-id")!=d.active_access_id);g?g&&a.waDialog.alert({text:f.data("reason-disabled"),button_title:"Ok",onClose:function(m){h.$before.trigger("click");m.$wrapper.remove()}}):(d.changeTab(f),d.teamDialog&&
d.teamDialog.resize())}});d.$wrapper.on("click",'input[type="submit"]',function(f){f.stopPropagation();d.save()});d.$wrapper.on("change",'input[type!="hidden"], select',function(){d.$submit_btn.toggleClass("yellow",!!d.$limitedContent.find("tr[data-state-changed]").length)})};e.prototype.changeTab=function(d){var f=d.data("access-id"),g=this.$limitedContent,h=this.$wrapper.find(".js-access");this.$activeTab=d;h.addClass("hidden").filter("."+f).removeClass("hidden");this.$limitedContent.length&&g.toggleClass("hidden",
"limited"!==f)};e.prototype.save=function(){var d=this,f=d.$activeTab.data("access-id"),g=function(h){var m=!1,n={no:0,limited:1,full:2};n.hasOwnProperty(h)&&(m=n[h]);return m}(f);d.is_locked=!0;d.noticeToggle.loading();g=a.post(d.wa_app_url+"?module=accessSave&action=rights&id="+d.contact_id,{app_id:d.app_id,name:"backend",value:g},"json");"limited"===f&&(g=g.then(function(){var h=d.$limitedContent.find("form");return a.post(h.attr("action"),h.serialize(),"json")}));g.then(function(){var h=d.active_access_id;
a(document).trigger("team_access_level_changed",{app_id:d.app_id,contact_id:d.contact_id,prev_level:h,new_level:f});d.active_access_id=f;d.noticeToggle.success();d.is_locked=!1;d.teamDialog.close()})};return e}(b);window.ProfileAccessTab=function(a){function e(){b(".js-webasyst-id-auth").on("click",function(l){l.preventDefault();b("body").trigger("wa_webasyst_id_auth")})}function c(l,q){if(b.fn.iButton){var t=b(".basic-user-fields"),v=b(".js-block-user-reason-form");v.on("click",".js-block-user-cancel",
function(){v.hide()});v.on("submit",function(E){E.preventDefault();b.waDialog.confirm({title:'<i class="fas fa-exclamation-triangle smaller state-error"></i> '+y.data("alert"),success_button_title:n.blockUser||"Ok",success_button_class:"danger",cancel_button_title:n.cancel,cancel_button_class:"light-gray",onSuccess:function(){var B=v.find(".js-block-user-reason");B=b.trim(B.val());b(".c-shown-on-enabled").hide();var C=z.parent().find(".loading").show();b.post(h+"?module=accessSave&action=ban&id="+
g,{magic_word:"please",text:B},function(A){C.hide();v.hide();"ok"===A.status&&(t.addClass("gray"),b(".c-shown-on-disabled").show(),b("#tc-user-access-disabled").show().html(A.data.access_disable_msg),b.team.sidebar.reload())},"json")}})});var y=b("#c-access-link-block");y.on("click",function(E){E.preventDefault();v.show()});var z=b("#c-access-link-unblock").on("click",function(E){E.preventDefault();b.waDialog.confirm({title:'<i class="fas fa-exclamation-triangle smaller state-error"></i> '+z.data("alert"),
success_button_title:n.unblockUser||"Ok",success_button_class:"danger",cancel_button_title:n.cancel,cancel_button_class:"light-gray",onOpen:function(B,C){console.log(B,C)},onSuccess:function(){b(".c-shown-on-disabled").hide();var B=z.parent().find(".loading").show();b.post(h+"?module=accessSave&action=unban&id="+g,{magic_word:"please"},function(){B.hide();t.removeClass("gray");b(".c-shown-on-enabled").show();b("#tc-user-access-disabled").hide().html("");b(".t-sidebar-profile-dialog").data("dialog").resize();
b.team.sidebar.reload()})}})})}else b.ajax({cache:!0,dataType:"script",url:l+"wa-content/js/jquery-plugins/ibutton/jquery.ibutton.min.js?"+q,success:function(){c(l,q)}})}var d=a.login,f=a.password,g=a.contact_id,h=a.wa_app_url,m=a.url_change_api_token,n=a.loc;(function(){var l=b("#form-customize-groups");l.length&&(b("#open-customize-groups").on("click",function(q){q.preventDefault();b(this).hide();b("#form-customize-groups").toggle()}),b("#cancel-customize-groups").on("click",function(q){q.preventDefault();
q=b("#form-customize-groups").hide();b("#open-customize-groups").show();q.find(".loading").hide();q.find(".state-error-hint").remove()}),l.submit(function(){var q=b(this);q.find(".state-error-hint").remove();q.find(".loading").show();b.post(q.attr("action"),q.serialize(),function(t){if("ok"==t.status){try{b.team.sidebar.reload();b.team.content.reload();q.find(".loading").hide();q.hide();var v=b.team.profile.$profile_header_links.find('[data-section-id="access"]:first').attr("data-url"),y=q.closest(".dialog").data("dialog");
y.$content.css({position:"relative",overflow:"hidden"}).append('<div class="js-reload-spinner" style="position:absolute;top:0;bottom:0;left:0;right:0;display:grid;place-items:center;background:var(--background-color-blank);"><span class="spinner custom-p-16"></span></div>');b.post(v,{userId:b.team.profile.user.id},function(z){y.$content.css("overflow","auto").empty().html(z)}).always(function(){y.$content.css("overflow","auto").find(".js-reload-spinner").remove()})}catch(z){}window.hasOwnProperty("profileTab")&&
window.profileTab.reload()}else"fail"==t.status&&q.find(".c-checkbox-menu-container").after(b('<span class="state-error-hint">'+t.errors.join("<br />")+"</span>"))},"json");return!1}))})();(function(){b("#c-credentials-form").submit(function(){var l=b(this);l.find("input.state-error").removeClass("error");l.find(".state-error-hint").remove();var q=l.find(".c-login-input"),t=b.trim(q.val());if(!t)return q.addClass("error").after('<p class="state-error-hint custom-mt-4">'+n["Login is required"]+"</p>"),
!1;q=l.serializeArray();"1"===b("#c-access-rights-toggle").val()&&(q=q.concat([{name:"set_rights",value:"1"},{name:"app_id",value:"webasyst"},{name:"name",value:"backend"},{name:"value",value:1}]));b.post(l.attr("action"),q,function(v){if("ok"===v.status){l.hide();d=t;b("#c-login-block").show().find(".c-login-input").val(d).end().find(".c-login").text(d);try{b.team.sidebar.reload()}catch(y){}try{window.profileTab.reload()}catch(y){}}else"fail"===v.status&&l.find('input[type="submit"]').parent().prepend(b('<p class="state-error-hint custom-mt-4 custom-mb-8">'+
v.errors.join("<br>")+"</p>"))},"json");return!1}).find(".cancel").click(function(l){l.preventDefault();b("#c-credentials-block").hide();return!1})})();(function(){var l=b("#c-login-form"),q=l.find(".c-login-input");l.submit(function(){b(".dialog-footer .js-close-dialog").prop("disabled",!0);l.find("input.state-error").removeClass("error");l.find(".state-error-hint").remove();var t=b.trim(q.val());if(d===t)return!1;if(!t)return q.addClass("error").after('<p class="state-error-hint custom-mt-4">'+
n["Login is required."]+"</p>"),!1;l.find(".loading").show();b.post(l.attr("action"),l.serialize(),function(v){l.find(".loading").hide();if("ok"===v.status){b("#c-login-block").show();q.val(t);l.find(".c-login").text(t);l.find(".c-one-tab").show();l.find(".c-two-tab").hide();if(!d)try{window.profileTab.reload()}catch(y){}v=window.location.href.replace(d,t);d=t;window.location.assign(v)}else"fail"===v.status&&(b(".dialog-footer .js-close-dialog").prop("disabled",!1),l.find('input[type="submit"]').parent().prepend(b('<p class="state-error-hint custom-mt-4 custom-mb-8">'+
v.errors.join("\n<br>\n")+"</p>")))},"json");return!1});l.find(".c-tab-toggle").click(function(t){t.preventDefault();l.find(".c-one-tab,.c-two-tab").toggle();q.is(":visible")&&q.focus();return!1})})();(function(){var l=b("#c-password-form"),q=l.find(".c-password-input"),t=l.find(".c-confirm-password-input");l.submit(function(){l.find("input.state-error").removeClass("error");l.find(".state-error-hint").remove();if(q.val()!==t.val())return q.addClass("error"),t.after().after('<p class="state-error-hint custom-mt-4">'+
n["Passwords do not match."]+"</p>"),!1;l.find(".loading").show();b.post(l.attr("action"),l.serialize(),function(v){l.find(".loading").hide();"ok"===v.status?(f=!0,q.val(""),t.val(""),l.find(".c-one-tab").show(),l.find(".c-two-tab").hide(),b("#c-password-block").show()):"fail"===v.status&&t.after('<p class="state-error-hint custom-mt-4">'+v.errors.join("<br />")+"</p>")},"json");return!1});l.find(".c-tab-toggle").click(function(v){v.preventDefault();l.find(".c-one-tab,.c-two-tab").toggle();v=l.find(".c-password-input");
v.is(":visible")&&v.focus();return!1})})();(function(){var l=b("#tc-api-tokens-filed"),q=l.find(".js-api-tokens-list"),t=!1;l.on("click",".js-remove-api-token",function(v){v.preventDefault();var y=b(this).parents(".js-token-item"),z=y.find(".icon16");v=y.data("token");var E={action:"remove",token_id:v};!t&&v&&confirm(n.remove_ask)&&(t=!0,z.removeClass("no").addClass("loading"),b.post(m,E,function(B){B.status&&"ok"===B.status?(y.remove(),0===q.find(".js-token-item").length&&l.remove()):(t=!1,z.removeClass("loading").addClass("no"))}).always(function(){t=
!1;z.removeClass("loading").addClass("no")}))})})();a.is_own_profile||c(a.wa_url,a.wa_framework_version);a.is_own_profile&&e();(function(){b(".js-webasyst-id-unbind-auth").on("click",function(l){l.preventDefault();b(document).trigger("wa_waid_unbind_auth",{id:g})})})();(function(){b(".js-webasyst-id-help-link").on("click",function(l){l.preventDefault();b("body").trigger("wa_waid_help_link")})})();(function(l,q,t){function v(){y(!0)&&z()}function y(x){b("#c-access-rights-hint-warning").hide();b("#c-access-rights-hint-customize").hide();
var F=b("#c-access-single-app-by-app").hide(),k=C.val();void 0===k&&(k="1");switch(k){case "remove":b("#c-credentials-block").hide();b("#c-login-block").hide();b("#c-password-block").hide();if(t){b("#c-access-rights-by-app").hide();b(".c-shown-on-access").hide();break}C.val(G||"0");b("#c-access-rights-hint-warning").show();return!1;case "0":if(d||f)if(d){F=b("#c-access-rights-by-app");F.show();x&&F.find(".t-access-status").removeClass("type-no type-limited type-full").addClass("type-no");b(".c-shown-on-access").show();
b("#c-login-block").show();b("#c-password-block").show();break}else return b("#c-login-block").show().find(".cancel").one("click.access",function(){C.val(G);v()}).end().find(".c-tab-toggle:first").click(),b("#c-password-block").show(),!1;else return b("#c-credentials-block").show().find(".c-login-input").focus().end().find(".cancel").one("click.access",function(){C.val(G);v()}),!1;case "1":if(d||f)if(d){b("#c-access-rights-by-app").hide();b(".c-shown-on-access").show();b("#c-login-block").show();
b("#c-password-block").show();break}else return b("#c-login-block").show().find(".cancel").one("click.access",function(){C.val(G);v()}).end().find(".c-tab-toggle:first").click(),b("#c-password-block").show(),!1;else return b("#c-credentials-block").show().find(".c-login-input").focus().end().find(".cancel").one("click.access",function(){C.val(G);v()}),!1;case "single_app_mode":if(d||f)if(d){var r=F.find(".c-access-single-app-checkbox");x&&(F.find(".t-access-status").removeClass("type-no type-limited type-full").addClass("type-no").closest("tr").addClass("t-single-app-selected").removeClass("t-single-app-selected"),
r.prop("checked",!1));F.show();b("#c-access-rights-by-app").hide();b(".c-shown-on-access").show();b("#c-login-block").show();b("#c-password-block").show();r.off("change").on("change",function(){var p=b(this),u=p.closest("label"),w=p.val();if(w){var D=b('<span><i class="spinner loading large custom-mr-4"></i></span>');u.hide();D.insertAfter(u);E(w).always(function(){D.remove();u.show()}).done(function(){b("#c-access-single-app-by-app").find(".t-access-status").removeClass("type-no type-limited type-full").addClass("type-full");
p.closest("tr").addClass("t-single-app-selected").siblings().removeClass("t-single-app-selected")}).fail(function(){p.prop("checked",!1)})}});break}else return b("#c-login-block").show().find(".cancel").one("click.access",function(){C.val(G);v()}).end().find(".c-tab-toggle:first").click(),b("#c-password-block").show(),!1;else return b("#c-credentials-block").show().find(".c-login-input").focus().end().find(".cancel").one("click.access",function(){C.val(G);v()}),!1;default:return!1}l&&(b("#c-login-block").show(),
b("#c-password-block").show());G=k;return!0}function z(){var x=C.val();void 0===x&&(x="1");(function(){switch(x){case "0":return b.post(h+"?module=accessSave&action=makeuser",{id:g},"json").then(function(){return B("webasyst","backend",0)});case "1":return B("webasyst","backend",1);case "single_app_mode":return E("webasyst");case "remove":return b.post(h+"?module=accessSave&action=revoke",{id:g},"json")}})().then(function(){t&&"0"==x?b("#c-access-rights-hint-customize").show():b("#c-access-rights-hint-warning").hide()})}
function E(x){return b.post(h+"?module=accessSave&action=singleAppMode&id="+g,{app_id:x},"json")}function B(x,F,k){return b.post(h+"?module=accessSave&action=rights&id="+g,{app_id:x,name:F,value:k},"json")}var C=b("#c-access-rights-toggle"),A=b("#access-rights-toggle-confirm"),G=C.val();q?b(".c-shown-on-access").hide():b(".c-shown-on-access").show();y();A.on("click",".cancel",function(){C.val(G);A.hide()});A.on("click",".button",function(){A.hide();v();b(".t-sidebar-profile-dialog").data("dialog").resize()});
C.change(function(){if(d){b("#c-access-rights-hint-warning").hide();b("#c-access-rights-hint-customize").hide();var x=C.val();void 0===x&&(x="1");x===G?A.hide():A.show()}else y(!0)})})(a.is_own_profile,a.contact_no_access,a.contact_groups_no_access);new UserAccessTable({$wrapper:b(".c-access-rights-wrapper"),contact_id:g,is_frame:!0})};window.UserAccessTable=function(a){var e=a.$wrapper,c=a.contact_id,d=a.is_frame||!1;e.on("click",".t-access-status",function(g){g.preventDefault();g=b(this);showAccessDialog(g,
g.data("app-id"),c,!0,d)});var f;b(document).on("team_access_level_changed",f=function(g,h){b.contains(document.body,e[0])?e.find('.t-access-status[data-app-id="'+h.app_id+'"]').removeClass("type-no type-limited type-full type-"+h.prev_level).addClass("type-"+h.new_level):b(document).off("team_access_level_changed",f)})};window.showAccessDialog=function(a,e,c,d,f){a.trigger("close");b.post(b.team.app_url+"?module=access&action=dialog",{user_id:c,app_id:e},function(g){g={html:g};f&&d&&(g.setPosition=
function(h){var m=b(window).width();return{top:a.offset().top,left:parseInt((m-h.width)/2)}});b.waDialog(g)})}})(jQuery);var GroupPage=function(b){GroupPage=function(a){this.$wrapper=a.$wrapper;this.group_id=a.group_id;this.map_adapter=a.map_adapter;this.latitude=a.latitude;this.longitude=a.longitude;this.address=a.address;this.can_manage=a.can_manage;this.initClass()};GroupPage.prototype.initClass=function(){this.bindEvents();this.can_manage&&(this.initEditableName(),this.initEditableDescription());this.initInfoBlock();this.initMap()};GroupPage.prototype.bindEvents=function(){var a=this;a.$wrapper.on("click",".js-open-map-link",
function(){a.toggleMap()});a.$wrapper.on("click",".js-edit-group",function(e){e.preventDefault();a.group_id&&!GroupManage.is_locked&&GroupManage.prototype.showEditGroupDialog(a.group_id)});a.$wrapper.on("click",".js-delete-group",function(e){e.preventDefault();a.group_id&&!GroupManage.is_locked&&GroupManage.prototype.showDeleteDialog(a.group_id)})};GroupPage.prototype.toggleMap=function(){this.$wrapper.find(".t-map-wrapper").slideToggle(200)};GroupPage.prototype.initMap=function(){function a(){var c=
e.$wrapper.find("#t-location-map"),d=new TeamMap(c,e.map_adapter);""!==e.latitude&&""!==e.longitude?d.render(e.latitude,e.longitude):d.geocode(e.address,function(f,g){d.render(f,g)})}var e=this;"yandex"===e.map_adapter?ymaps.ready(a):a()};GroupPage.prototype.initEditableName=function(){var a=this.$wrapper.find(".js-name-editable").first();a&&new TeamEditable(a,{groupId:this.group_id,reloadSidebar:!0,api:{save:b.team.app_url+"?module=group&action=save"},target:"data[name]"})};GroupPage.prototype.initEditableDescription=
function(){var a=this.$wrapper.find(".js-desc-editable").first();a&&new TeamEditable(a,{groupId:this.group_id,api:{save:b.team.app_url+"?module=group&action=save"},target:"data[description]"})};GroupPage.prototype.initInfoBlock=function(){var a=this.$wrapper.find(".t-info-notice-wrapper"),e=a.find(".t-info-notice-toggle"),c=new b.store;c.get("team/empty_group_notice_hide")?a.hide():a.show();e.on("click",function(d){d.preventDefault();c.set("team/empty_group_notice_hide",1);a.remove()})};return GroupPage}(jQuery),
GroupManage=function(b){GroupManage=function(a){this.$wrapper=a.$wrapper;this.$groupUsersW=this.$wrapper.find(".t-users-list.is-used-list");this.$groupUsersHint=this.$wrapper.find(".t-empty-users-in-group");this.$otherUsersW=this.$wrapper.find(".t-users-list.is-unused-list");this.$otherUsersHint=this.$wrapper.find(".t-empty-users-outside-group");this.group_id=a.group_id;this.hidden_class="is-hidden";this.locales=a.locales;this.xhr=this.is_locked=this.$sidebarLink=!1;this.group_count=this.$groupUsersW.find(".t-user-wrapper").length;
this.other_count=this.$otherUsersW.find(".t-user-wrapper").length;this.initClass()};GroupManage.prototype.initClass=function(){this.bindEvents();this.initAutoComplete();this.initEditableName()};GroupManage.prototype.bindEvents=function(){var a=this;a.$wrapper.on("click",".js-edit-group",function(e){e.preventDefault();a.group_id&&!a.is_locked&&a.showEditGroupDialog()});a.$wrapper.on("click",".js-delete-group",function(e){e.preventDefault();a.group_id&&!a.is_locked&&a.showDeleteDialog()});a.$groupUsersW.on("click",
".js-move-user",function(e){e.preventDefault();a.is_locked||a.moveUser(b(this).closest(".t-user-wrapper"),!1)});a.$otherUsersW.on("click",".js-move-user",function(e){e.preventDefault();a.is_locked||a.moveUser(b(this).closest(".t-user-wrapper"),!0)})};GroupManage.prototype.showEditGroupDialog=function(a){var e=this;a={id:e.group_id||a};e.is_locked||(e.is_locked=!0,e.xhr&&(e.xhr.abort(),e.xhr=!1),e.xhr=b.get("?module=group&action=edit",a,function(c){b.waDialog({html:c});e.is_locked=!1}))};GroupManage.prototype.showDeleteDialog=
function(a){var e=this,c=b.team.app_url+"?module=group&action=deleteConfirm";a={id:e.group_id||a};e.is_locked||(e.is_locked=!0,e.xhr&&(e.xhr.abort(),e.xhr=!1),e.xhr=b.get(c,a,function(d){b.waDialog({html:d});e.is_locked=!1}))};GroupManage.prototype.moveUser=function(a,e){var c=this,d={user_id:a.data("user-id"),group_id:c.group_id};if(!c.is_locked){c.xhr&&(c.xhr.abort(),c.xhr=!1);var f=e?b.team.app_url+"?module=group&action=userAdd":b.team.app_url+"?module=group&action=userRemove";e?(c.$groupUsersW.append(a),
c.group_count++,c.other_count--):(c.$otherUsersW.prepend(a),c.group_count--,c.other_count++);0>=c.group_count?(c.$groupUsersW.addClass(c.hidden_class),c.$groupUsersHint.removeClass(c.hidden_class)):(c.$groupUsersW.removeClass(c.hidden_class),c.$groupUsersHint.addClass(c.hidden_class));0>=c.other_count?(c.$otherUsersW.addClass(c.hidden_class),c.$otherUsersHint.removeClass(c.hidden_class)):(c.$otherUsersW.removeClass(c.hidden_class),c.$otherUsersHint.addClass(c.hidden_class));c.setCount(c.group_count);
c.xhr=b.post(f,d,function(g){"ok"!==g.status&&console.error("Error while sending data on "+f,g);c.is_locked=!1})}};GroupManage.prototype.setCount=function(a){var e=b.team.app_url+"group/"+this.group_id+"/";this.$sidebarLink||(this.$sidebarLink=b.team.sidebar.$wrapper.find('a[href="'+e+'"] '));if(this.$sidebarLink.length){var c=this.$sidebarLink.closest("li");c.find(".indicator").remove();c.find(".count").text(a);b.team.sidebar.saveCount(e,a)}};GroupManage.prototype.initAutoComplete=function(){function a(){clearTimeout(g);
f.length&&(f.remove(),f=!1)}function e(h){f=b('<span class="t-hint"><i class="fas fa-check text-green custom-mr-4"></i>'+h+"</span>");d.after(f);g=setTimeout(a,1E3)}var c=this,d=c.$wrapper.find(".t-autocomplete-wrapper .t-input"),f=!1,g=0;d.autocomplete({source:function(h,m){var n=b.team.app_url+"?module=autocomplete&type=user";h={term:h.term};c.group_id&&(h.group_id=c.group_id);b.post(n,h,function(l){m(l)},"json")},minLength:2,open:function(){a()},focus:function(){return!1},select:function(h,m){m.item.id&&
(h=c.$otherUsersW.find('.t-user-wrapper[data-user-id="'+m.item.id+'"]'),h.length?(c.moveUser(h,!0),e(c.locales.added)):e(c.locales.in_group));d.val("");return!1}})};GroupManage.prototype.initEditableName=function(){var a=this.$wrapper.find(".js-name-editable").first();a&&new TeamEditable(a,{groupId:this.group_id,reloadSidebar:!0,api:{save:b.team.app_url+"?module=group&action=save"},target:"data[name]"})};return GroupManage}(jQuery),GroupEditDialog=function(b){GroupEditDialog=function(a){this.$wrapper=
a.$wrapper;this.$form=this.$block=this.$wrapper.find(".dialog-body");this.$iconToggle=this.$block.find(".t-icon-toggle");this.$addressToggle=this.$block.find(".t-address-toggle");this.$mapToggle=this.$block.find(".t-map-toggle");this.$submitButton=this.$form.find('input[type="submit"]');this.$groupType=this.$form.find('[name="data[type]"]');this.selected_class="selected";this.hidden_class="hidden";this.has_error_class="state-error";this.locales=a.locales;this.dialog=this.$wrapper.data("dialog");this.$activeIcon=
this.$iconToggle.find("."+this.selected_class);this.is_locked=!1;this.save_timeout=0;this.is_map_loading=!1;this.map_type=a.map_type||"google";this.map_key=a.map_key||null;this.teamMap=null;this.bindEvents()};GroupEditDialog.prototype.bindEvents=function(){var a=this;a.$block.find(".js-type-toggle").waToggle({ready:function(c){"location"===c.$active.data("type")&&!a.teamMap&&a.map_key&&setTimeout(function(){return a.teamMap=a.initMap(a.map_type,a.map_key)})},change:function(c,d){a.setType(b(d));"location"===
d.dataset.type&&!a.teamMap&&a.map_key&&(a.teamMap=a.initMap(a.map_type,a.map_key))}});a.$iconToggle.on("click",".t-icon-item",function(c){c.preventDefault();a.setIcon(b(this))});a.$form.on("submit",function(c){c.preventDefault();a.is_locked||a.save()});a.$form.find("input, textarea").on("mousedown",function(){var c=b(this),d=c.hasClass(a.has_error_class);a.$form.find(".js-submit-loading").remove();d&&c.removeClass(a.has_error_class).closest(".value").find(".state-error-hint").remove()});var e=a.$form.find(".t-icon-list");
e.find(".t-icon-item.selected").length||a.setIcon(e.find(".t-icon-item:eq(0)"))};GroupEditDialog.prototype.setType=function(a){var e="group"===a.data("type");this.$groupType.val(a.data("type"));this.$iconToggle.toggleClass(this.hidden_class,!e);this.$addressToggle.toggleClass(this.hidden_class,e);this.$mapToggle.toggleClass(this.hidden_class,e);this.dialog.resize()};GroupEditDialog.prototype.setIcon=function(a){var e=a.data("icon-class");if(a.hasClass(this.selected_class))return!1;this.$activeIcon.length&&
this.$activeIcon.removeClass(this.selected_class);this.$form.find('input[name="data[icon]"]').val(e).trigger("change");a.addClass(this.selected_class);this.$activeIcon=a};GroupEditDialog.prototype.save=function(a){function e(n){function l(v){c.$form.find(".state-error-hint").remove();b.each(v,function(y,z){y=c.$form.find("[name='"+z.field+"']");y.length&&y.addClass(c.has_error_class).after('<p class="state-error-hint custom-my-0">'+c.locales[z.locale]+"</p>")})}var q={},t=[];b.each(n,function(v,y){q[y.name]=
y.value});b.trim(q["data[name]"]).length||t.push({field:"data[name]",locale:"empty"});return t.length?(l(t),!1):q}var c=this,d;a=a||0;if(!c.is_locked)if(c.is_locked=!0,d=e(c.$form.serializeArray())){if(c.is_map_loading&&5>a)return c.is_locked=!1,c.save_timeout=setTimeout(function(){b.contains(document,c.$wrapper[0])&&c.save(a+1)},1E3),!1;c.$form.find(".js-submit-loading").remove();c.$submitButton.parent().append("<i class='fas fa-spin fa-spinner js-submit-loading wa-animation-spin speed-1000'></i>");
var f=function(){b.post("?module=group&action=save",d,function(n){"ok"==n.status&&(b.team.content.load(b.team.app_url+"group/"+n.data.id+"/manage/"),b.team.sidebar.reload(),n=b.team.sidebar.$body.find('[data-group-id="'+n.data.id+'"]'),b.team.sidebar.setItem(n),c.is_locked=!1,c.dialog.close())}).always(function(){c.$form.find(".js-submit-loading").remove()})},g=d["data[location][address]"],h=d["data[location][latitude]"],m=d["data[location][longitude]"];!g||h&&m||!c.teamMap?f():c.teamMap.geocode(g,
function(n,l){d["data[location][latitude]"]=n;d["data[location][longitude]"]=l;f()},function(){f()})}else c.is_locked=!1};GroupEditDialog.prototype.initMap=function(a){function e(t){function v(y,z){h.is(":hidden")&&h.show();q.render(y,z);g.val(y);f.val(z);c.dialog.resize()}clearTimeout(n);"string"===b.type(t)?(c.is_map_loading=!0,q.geocode(t,function(y,z){g.val(y);f.val(z);m.hide();v(y,z);c.is_map_loading=!1},function(){h.hide();f.val("");g.val("");m.show();c.is_map_loading=!1})):v(t.lat,t.lng)}var c=
this,d=c.$addressToggle.find(".f-location-edit-address-input"),f=c.$addressToggle.find(".t-location-longitude-input"),g=c.$addressToggle.find(".t-location-latitude-input"),h=c.$mapToggle.find(".t-location-edit-map"),m=c.$addressToggle.find(".t-map-hint"),n=0;if(0<d.length){var l=c.$form.find(".value").first().width();h.width(l);h.height(l/1.618)}var q=new TeamMap(h,a);a=f.val();l=g.val();a&&l&&e({lat:l,lng:a});d.on("change",function(){var t=b(this).val();t.length?e(t):(f.val(""),g.val(""),h.hide(400,
function(){return c.dialog.resize()}))});d.on("keyup",function(){clearTimeout(n);var t=b(this).val();t.length?(c.is_map_loading=!0,n=setTimeout(function(){e(t)},1E3)):(f.val(""),g.val(""),h.hide(400,function(){return c.dialog.resize()}))});return q};return GroupEditDialog}(jQuery),GroupDeleteDialog=function(b){GroupDeleteDialog=function(a){this.$wrapper=a.$wrapper;this.$block=this.$wrapper.find(".t-dialog-block");this.$deleteButton=this.$wrapper.find(".js-delete-event");this.api_enabled=window.history&&
window.history.replaceState;this.group_id=a.group_id;this.is_locked=!1;this.dialog={};this.initClass()};GroupDeleteDialog.prototype.initClass=function(){var a=this;setTimeout(function(){a.dialog=a.$wrapper.data("dialog")});if(!a.is_locked)a.$deleteButton.on("click",b.proxy(a.deleteFunction,a))};GroupDeleteDialog.prototype.deleteFunction=function(a){a.preventDefault();var e=this;a={id:e.group_id};e.is_locked=!0;b.post("?module=group&action=delete",a,function(c){"ok"==c.status&&(e.dialog.close(),e.api_enabled?
(history.state.content_uri=b.team.app_url,history.replaceState({reload:!0,content_uri:b.team.app_url},"",b.team.app_url),b.team.sidebar.reload(),b.team.content.reload()):location.href=b.team.app_url)},"json")};return GroupDeleteDialog}(jQuery);var SettingsPage=function(b){SettingsPage=function(a,e){this.$wrapper=a;this.$calendarToggle=this.$wrapper.find("#t-calendar-settings");this.$form=this.$wrapper.find("#calendar_settings");this.$submitButton=this.$wrapper.siblings(".bottombar").find('[type="submit"]');this.options=e;this.xhr=this.is_form_changed=this.is_locked=this.$notice=!1;this.initClass()};SettingsPage.prototype.initClass=function(){this.bindEvents();this.initSortable()};SettingsPage.prototype.bindEvents=function(){this.$calendarToggle.on("click",
".js-edit-calendar, .js-add-calendar",b.proxy(this.showEditDialog,this));this.$form.on("change","input, select, textarea",b.proxy(this.checkFormChanges,this));this.$form.on("submit",b.proxy(this.save,this))};SettingsPage.prototype.initSortable=function(){var a=this;a.$calendarToggle.sortable({animation:150,handle:".t-toggle",direction:"vertical",filter:".t-actions",onMove:function(e){if(e.related.classList.contains("t-actions"))return-1},onStart:function(){a.$notice&&(a.$notice.remove(),a.$notice=
!1)},onEnd:function(e){e.oldIndex!==e.newIndex&&a.saveCalendarsSort(e.item)}})};SettingsPage.prototype.checkFormChanges=function(){this.is_form_changed||(this.is_form_changed=!0,this.$submitButton.addClass("yellow"))};SettingsPage.prototype.showEditDialog=function(a){a.preventDefault();var e=this,c={};(a=parseInt(b(a.target).closest(".t-calendar-item").data("id")))&&(c.id=a);e.xhr&&(e.xhr.abort(),e.xhr=!1);e.xhr=b.post(e.options.api.editDialog,c,function(d){e.dialog=b.waDialog({html:d})})};SettingsPage.prototype.saveCalendarsSort=
function(a){function e(g){var h=b('<span class="t-notice state-success"><i class="fas fa-check-circle"></i></span>');h.appendTo(g);return h}var c=this,d=b(a);a=b.team.app_url+"?module=settings&action=calendarsSortSave";var f={calendars:function(){var g=[];c.$calendarToggle.find(".t-calendar-item").each(function(){var h=b(this).data("id");h&&0<h&&g.push(h)});return g}()};c.xhr&&(c.xhr.abort(),c.xhr=!1);c.$notice=function(g){var h=b('<span class="t-notice"><i class="fas fa-spin fa-spinner wa-animation-spin speed-1000"></i></span>');
h.appendTo(g);return h}(d);c.xhr=b.post(a,f,function(){c.$notice.remove();c.$notice=e(d);setTimeout(function(){c.$notice&&b.contains(document,c.$notice[0])&&c.$notice.remove()},1E3);c.xhr=!1})};SettingsPage.prototype.save=function(a){a.preventDefault();var e=this;e.is_form_changed&&!e.is_locked&&(a=e.$form.serializeArray(),e.$submitButton.append('<i class="fas fa-spinner wa-animation-spin speed-1000 custom-ml-4 js-profile-settings-spinner"></i>'),e.is_locked=!0,b.post(e.options.api.save,a,function(c){"ok"===
c.status&&(e.is_form_changed=!1,e.is_locked=!1,e.$submitButton.removeClass("yellow"),e.$submitButton.find(".js-profile-settings-spinner").remove())}))};return SettingsPage}(jQuery),CalendarEditDialog=function(b){CalendarEditDialog=function(a,e){this.$wrapper=a;this.$form=this.$block=this.$wrapper.find(".dialog-body");this.$styleWrapper=this.$block.find(".t-style-wrapper");this.$iconsWrapper=this.$block.find(".t-calendar-icons");this.$limitedToggle=this.$block.find(".t-limited-toggle");this.$limitedGroups=
this.$block.find(".t-hidden-content");this.$colorToggle=this.$block.find(".t-color-toggle");this.$nameField=this.$block.find('input[name="data[name]"]');this.$iconField=this.$block.find('input[name="data[icon]"]');this.$inputStatusBg=this.$block.find('input[name="data[status_bg_color]"]');this.$inputStatusFont=this.$block.find('input[name="data[status_font_color]"]');this.$inputEventBg=this.$block.find('input[name="data[bg_color]"]');this.$inputEventFont=this.$block.find('input[name="data[font_color]"]');
this.$pickerBgColor=this.$block.find(".js-bg-color");this.$badge_status=this.$block.find(".js-badge-preview.is-status");this.$badge_event=this.$block.find(".js-badge-preview.is-event");this.$badgeIcon=this.$block.find(".js-badge-icon");this.$badgeName=this.$block.find(".js-badge-name");this.$fields=this.$form.find("input, textarea");this.calendar_id=e.calendar_id;this.teamDialog=this.$wrapper.data("dialog");this.options=e;this.classes={selected_class:"is-selected",hidden_class:"is-hidden",has_error_class:"state-error"};
this.$selectedStyleButton=this.$styleWrapper.find("."+this.classes.selected_class);this.xhr=this.is_locked=!1;this.initClass()};CalendarEditDialog.prototype.initClass=function(){this.bindEvents();this.initColorPicker();this.checkCustomColor()};CalendarEditDialog.prototype.bindEvents=function(){this.$block.on("click",".js-delete-calendar",b.proxy(this.showDeleteConfirm,this));this.$styleWrapper.on("click",".t-style-item",b.proxy(this.setStyleToggle,this));this.$styleWrapper.on("click",".js-custom-color",
b.proxy(this.toggleCustomColor,this));this.$iconsWrapper.on("click",".t-calendar-icons--item",b.proxy(this.setBadgeIcon,this));this.$form.on("submit",b.proxy(this.save,this));this.$fields.on("mousedown",b.proxy(this.removeErrors,this));this.$nameField.on("change keyup",b.proxy(this.setPreviewName,this));this.$limitedToggle.on("change","input:radio",b.proxy(this.toggleLimitSection,this))};CalendarEditDialog.prototype.checkCustomColor=function(){this.$selectedStyleButton.length||(this.$styleWrapper.find(".js-custom-color-check").removeClass("hidden"),
this.$colorToggle.removeClass("hidden"))};CalendarEditDialog.prototype.setBadgeIcon=function(a){a.preventDefault();a=b(a.target);var e=a.find("svg");e=e.attr("data-prefix")+" fa-"+e.attr("data-icon");a.addClass(this.classes.selected_class).siblings().removeClass(this.classes.selected_class);this.$badgeIcon.html('<i class="'+e+'"></i>');this.$iconField.val(e)};CalendarEditDialog.prototype.toggleCustomColor=function(a){a.preventDefault();b(a.target).find(".js-custom-color-caret").toggleClass("fa-caret-down fa-caret-up");
this.$colorToggle.toggleClass("hidden");this.teamDialog.resize()};CalendarEditDialog.prototype.toggleLimitSection=function(a){a.target.value.length?this.$limitedGroups.show():this.$limitedGroups.hide();this.teamDialog.resize()};CalendarEditDialog.prototype.removeErrors=function(a){a=b(a.target);a.hasClass(this.classes.has_error_class)&&a.removeClass(this.classes.classes.has_error_class).closest(".value").find(".state-error-hint").remove()};CalendarEditDialog.prototype.setStyleToggle=function(a){a=
b(a.target);var e=a.css("color"),c=a.css("background-color"),d=this.colorConvert(c,-15).hex,f=this.colorConvert(c,40).hex;this.$selectedStyleButton.removeClass(this.classes.selected_class);this.setStyleData(e,c);a.addClass(this.classes.selected_class);this.$selectedStyleButton=a;this.$styleWrapper.find(".js-custom-color-check").addClass("hidden");this.$colorToggle.addClass("hidden");this.$badge_status.css({color:e,"background-color":c});this.$badge_event.css({color:d,"background-color":f})};CalendarEditDialog.prototype.setStyleData=
function(a,e){function c(d){d=d.split("(")[1].split(")")[0];d=d.split(",").splice(0,3);return"#"+d.map(function(f){f=parseInt(f).toString(16);return 1===f.length?"0"+f:f}).join("")}a.includes("#")||(a=c(a));e.includes("#")||(e=c(e));this.$badge_event[0].style.removeProperty("box-shadow");this.$inputStatusBg.val(e).trigger("change");this.$inputStatusFont.val(a).trigger("change");this.$inputEventBg.val(this.colorConvert(e,40).hex).trigger("change");this.$inputEventFont.val(this.colorConvert(e,-15).hex).trigger("change");
this.$pickerBgColor.css("background-color",e)};CalendarEditDialog.prototype.showDeleteConfirm=function(a){a.preventDefault();var e=this;e.is_locked||(a={id:e.calendar_id},e.is_locked=!0,e.xhr&&(e.xhr.abort(),e.xhr=!1),e.xhr=b.get(e.options.api.showDeleteConfirm,a,function(c){b.waDialog({html:c});e.is_locked=!1;e.teamDialog.close()}))};CalendarEditDialog.prototype.initColorPicker=function(){var a=this,e=function(){e=function(c){this.$wrapper=c.$wrapper;this.$field=this.$wrapper.querySelector(".t-color-field");
this.$pick_color_btn=this.$wrapper.querySelector(".js-show-color-picker");this.pickr_options={el:this.$pick_color_btn,theme:"classic",appClass:"wa-pcr-app small",lockOpacity:!0,position:"right-start",useAsButton:!0,container:a.$wrapper[0],default:this.$field.value||"#42445a",components:{palette:!0,hue:!0}};this.initClass()};e.prototype.initClass=function(){function c(f){f=f.hasOwnProperty("toHEXA")?f.toHEXA().toString(0):f.target.value;d.$field.value=f;d.$pick_color_btn.style.backgroundColor=f;d.$pick_color_btn.classList.contains("js-bg-color")&&
(a.$badge_status.css("background-color",f),a.$badge_event.css("background-color",a.colorConvert(f,40).hex),a.$badge_event.css("color",f),a.$form.find('[name="data[status_bg_color]"]').val(f),a.$form.find('[name="data[bg_color]"]').val(a.colorConvert(f,40).hex),a.$form.find('[name="data[font_color]"]').val(f));d.$pick_color_btn.classList.contains("js-font-color")&&(a.$badge_status.css("color",f),a.$form.find('[name="data[status_font_color]"]').val(f));a.$styleWrapper.find(".js-custom-color-check").removeClass("hidden");
a.$selectedStyleButton.removeClass(a.classes.selected_class)}var d=this;Pickr.create(d.pickr_options).on("change",function(f){return c(f)});d.$wrapper.dataset.colorPicker=d;d.$field.addEventListener("keyup",c,!1)};return e}();a.$styleWrapper.find(".t-color-toggle .t-toggle").each(function(){new e({$wrapper:this})})};CalendarEditDialog.prototype.setPreviewName=function(a){this.$badgeName.text(a.target.value.length?a.target.value:this.options.locales.preview)};CalendarEditDialog.prototype.colorConvert=
function(a,e){e=void 0===e?0:e;var c=0,d=0,f=0;a.includes("#")?4===a.length?(c="0x"+a[1]+a[1],d="0x"+a[2]+a[2],f="0x"+a[3]+a[3]):7===a.length&&(c="0x"+a[1]+a[2],d="0x"+a[3]+a[4],f="0x"+a[5]+a[6]):(f=a.split("(")[1].split(")")[0].split(",").splice(0,3),c=f[0],d=f[1],f=f[2]);c/=255;d/=255;f/=255;var g=Math.min(c,d,f),h=Math.max(c,d,f),m=h-g,n=0,l=a=0;n=0===m?0:h===c?(d-f)/m%6:h==d?(f-c)/m+2:(c-d)/m+4;n=Math.round(60*n);0>n&&(n+=360);l=(h+g)/2;a=0==m?0:m/(1-Math.abs(2*l-1));a=+(100*a).toFixed();l=+(100*
l).toFixed();0!==e&&(50<=l&&(l-=20),0<e?(l+=parseInt(e,10),100<=l&&(l-=10)):0>e&&(l+=parseInt(e,10)));e={hsl:"hsl("+n+","+a+"%,"+l+"%)"};l/=100;var q=a*Math.min(l,1-l)/100;c=function(t){t=(t+n/30)%12;return Math.round(255*(l-q*Math.max(Math.min(t-3,9-t,1),-1))).toString(16).padStart(2,"0")};e.hex="#"+c(0)+c(8)+c(4);return e};CalendarEditDialog.prototype.save=function(a){a.preventDefault();var e=this;e.is_locked||((a=function(c){function d(h){e.$form.find(".state-error-hint").remove();b.each(h,function(m,
n){m=e.$form.find('[name="'+n.field+'"]');m.length&&m.addClass(e.classes.has_error_class).after('<div class="state-error-hint custom-mt-4">'+e.options.locales[n.locale]+"</div>")})}var f={},g=[];b.each(c,function(h,m){f[m.name]=m.value});f["data[is_limited]"]||delete f["data[is_limited]"];b.trim(f["data[name]"]).length||g.push({field:"data[name]",locale:"empty"});return g.length?(d(g),!1):f}(e.$form.serializeArray()))?(e.is_locked=!0,b.post(e.options.api.save,a,function(c){"ok"!==c.status?console.warn(c):
(e.is_locked=!1,b.team.content.reload(),b.team.sidebar.reload(),e.teamDialog.close())})):(console.warn("have no data to save"),e.is_locked=!1,e.teamDialog.close()))};return CalendarEditDialog}(jQuery),CalendarDeleteDialog=function(b){CalendarDeleteDialog=function(a,e){this.$wrapper=a;this.$block=this.$wrapper.find(".dialog-body");this.$deleteButton=this.$block.find(".js-delete-calendar");this.options=e;this.is_locked=!1;this.initClass()};CalendarDeleteDialog.prototype.initClass=function(){this.$deleteButton.on("click",
b.proxy(this.deleteCalendar,this))};CalendarDeleteDialog.prototype.deleteCalendar=function(a){a.preventDefault();var e=this;e.is_locked||(a={id:e.options.calendar_id},e.is_locked=!0,b.post(e.options.api.delete,a,function(c){"ok"!==c.status?console.warn(c):(b.team.content.reload(),e.$wrapper.data("dialog").close())},"json"))};return CalendarDeleteDialog}(jQuery);var SiteApiTokenPage=function(b){SiteApiTokenPage=function(a){this.$wrapper=a.$wrapper;this.locale=a.locale;this.initClass()};SiteApiTokenPage.prototype.initClass=function(){this.initRemoveApiToken()};SiteApiTokenPage.prototype.initRemoveApiToken=function(){var a=this,e=a.$wrapper.find(".js-api-tokens-list"),c;a.$wrapper.on("click",".js-remove-api-token",function(d){d.preventDefault();d.stopImmediatePropagation();var f=b(this).closest(".js-token-item"),g=f.find("svg"),h=f.data("token");d=f.data("contact-id");
var m={action:"remove",token_id:h,contact_id:d};b.waDialog.confirm({title:a.locale.remove_ask,success_button_title:a.locale.delete,success_button_class:"danger",cancel_button_title:a.locale.cancel,cancel_button_class:"light-gray",onSuccess:function(){c&&!h?console.warn("System error. is_locked="+c+". token_id="+h):(c=!0,g.removeClass("fa-times").addClass("fa-spin fa-spinner wa-animation-spin speed-1000"),b.post("?module=apiTokensRemove",m,function(n){n.status&&"ok"===n.status?(f.remove(),e.find(".js-token-item")):
(c=!1,g.removeClass("fa-spin fa-spinner wa-animation-spin speed-1000").addClass("fa-times"))}).always(function(){c=!1;g.removeClass("fa-spin fa-spinner wa-animation-spin speed-1000").addClass("fa-times")}))}})})};return SiteApiTokenPage}(jQuery);var UserList=function(b){UserList=function(a){this.$wrapper=a.$wrapper;this.$items=this.$wrapper.find(".t-user-wrapper");this.$draggableItems=this.$wrapper.find(".js-move-user");this.initClass()};UserList.prototype.initClass=function(){this.initHightlight();this.initDraggable()};UserList.prototype.initDraggable=function(){var a;b(".js-move-user").mousedown(function(){document.activeElement.blur()});this.$draggableItems.draggable({helper:"clone",delay:200,handle:".userpic, .details",appendTo:document.body,
start:function(e,c){c.helper.addClass("is-clone align-center list").find(" > *:not(.userpic, .image)").addClass("hidden").end().find(" > a").css({border:"0.1875rem solid var(--thumbs-highlighted-color)","border-radius":"50%",display:"inline-block"});(a=b.team.sidebar.$wrapper.find(".js-drop-block"))&&a.addClass("t-drop-here")},stop:function(e,c){e=c.helper;var d=e.clone();d.insertAfter(e).fadeOut(270);setTimeout(function(){d.remove()},300);a&&a.removeClass("t-drop-here")}})};UserList.prototype.initHightlight=
function(){function a(c){return new Date(c.year,c.month-1,c.day,c.hours,c.minutes,c.seconds)}var e=b.team.sidebar.options.link_count_update_date;e&&(e=a(e),this.$items.each(function(){var c=b(this),d=c.data("update-datetime");if(d&&d.length){var f=d.split(" ");d=f[0].split("-");f=f[1].split(":");d={year:parseInt(d[0]),month:parseInt(d[1]),day:parseInt(d[2]),hours:parseInt(f[0]),minutes:parseInt(f[1]),seconds:parseInt(f[2])};a(d)>e&&c.find(".userpic").addClass("t-users-avatar-highlight")}}))};return UserList}(jQuery);var WelcomePage=function(b){WelcomePage=function(a){this.$wrapper=a.$wrapper;this.$inviteWrapper=this.$wrapper.find("#t-invite-wrapper");this.$inviteList=this.$inviteWrapper.find(".t-invite-list");this.locales=a.locales;this.error_class="state-error";this.is_locked=!1;this.switch_count=3;this.initClass()};WelcomePage.prototype.initClass=function(){b(document).on("ready",function(){b.team.content.is_enabled=!1});this.initWaToggle();this.bindEvents()};WelcomePage.prototype.bindEvents=function(){var a=
this;a.$wrapper.on("click",".js-skip-page",function(e){e.stopPropagation()});a.$wrapper.on("click",".js-send-invites",function(e){e.preventDefault();a.is_locked||a.sendInvites()});a.$inviteWrapper.on("click",".js-add-invite",function(e){e.preventDefault();a.addNewInvite()});a.$inviteWrapper.on("click",".js-remove-invite",function(e){e.preventDefault();b(this).closest("li").remove()});a.$inviteWrapper.on("click","."+a.error_class,function(){a.removeErrors(b(this))})};WelcomePage.prototype.initWaToggle=
function(){this.$inviteWrapper.find(".js-access-toggle").waToggle({change:function(a,e,c){c.$wrapper.find('[type="hidden"]').prop("checked","full"===e.dataset.type).attr("checked","full"===e.dataset.type)}})};WelcomePage.prototype.addNewInvite=function(){var a=this.$inviteWrapper.find(".t-invite-template").clone().html();a=b("<li>"+a+"</li>");this.switch_count+=1;a.find('[type="checkbox"]').attr("id","access_switch_"+this.switch_count);a.find("label").attr("for","access_switch_"+this.switch_count);
this.$inviteList.append(a);this.initWaToggle()};WelcomePage.prototype.sendInvites=function(){function a(g){var h=[];b.each(g,function(m,n){m=n.name;n=n.text;var l=parseInt(m.replace(/[^0-9]/g,""));l=e.$inviteList.find(".t-invite-item").eq(l).find('[type="email"]');(l.length||"general"==m)&&h.push({$field:l,name:m,locale:n})});e.displayErrors(h)}var e=this,c=b.team.app_url+"?module=welcome&action=save",d=function(){var g=[],h=[];e.$inviteList.find(".t-invite-item").each(function(m){var n=b(this).find('[type="email"]'),
l=b(this).find('[type="checkbox"]'),q=n.val();l=l.prop("checked");b.trim(q).length&&(q.match(".+@.+")?(g.push({name:"data["+m+"][email]",value:q}),g.push({name:"data["+m+"][access]",value:l})):h.push({$field:n,locale:e.locales.incorrect}))});return h.length?(e.displayErrors(h),!1):g.length?g:!1}(),f=e.$wrapper.find(".js-send-invites");e.is_locked=!0;f.attr("disabled",e.is_locked).find("svg").toggleClass("hidden",!e.is_locked);d?b.post(c,d,function(g){g.errors&&g.errors.length?a(g.errors):location.href=
b.team.app_url}).always(function(){e.is_locked=!1;f.attr("disabled",e.is_locked).find("svg").toggleClass("hidden",!e.is_locked)}):(e.is_locked=!1,f.attr("disabled",e.is_locked).find("svg").toggleClass("hidden",!e.is_locked))};WelcomePage.prototype.removeErrors=function(a){var e=this.error_class;a?(a.removeClass(e),a.closest(".t-invite-item").find(".state-error-hint").remove()):(this.$wrapper.find(".state-error-hint").remove(),this.$wrapper.find("."+e).removeClass(e))};WelcomePage.prototype.displayErrors=
function(a){var e=this,c=e.error_class;e.removeErrors();b.each(a,function(d,f){d='<span class="state-error-hint" style="display: block">'+f.locale+"</span>";"general"==f.name?e.$inviteWrapper.after(d):f.$field.addClass(c).closest(".t-invite-item").append(d)})};return WelcomePage}(jQuery);var LongActionProcess=function(b){var a="",e="",c=500,d=750,f=[],g={},h=null,m,n,l,q,t,v,y,z,E=!1,B=function(){for(;0<f.length;){var x=f.shift();x&&clearTimeout(x)}},C=function(){var x=b.extend(!0,{},g);x.processId=e;x.cleanup=1;b.post(a,x,function(F){m&&m(F)}).always(function(){B()})},A=function(x){E||(x=x||c,x=setTimeout(function(){var F=b.extend(!0,{},g);F.processId=e;b.post(a,F,function(k){k?k.ready?(n&&n.call(h,k),C()):k.error?q&&q.call(h,k):k.progress?(l&&l.call(h,k),A()):k.warning?(t&&t.call(h,
k),A()):A(d):A(d);z&&z.call(h,k)},"json").error(function(){A(d)})},x),f.push(x))},G=function(x){if(!x.url)throw Error("Url is required");a=x.url;c=x.step_delay||c;d=x.rest_delay||d;g=x.post_data||g;m=x.onCleanup;n=x.onReady;l=x.onProgress;q=x.onError;t=x.onWarning;v=x.onStart;y=x.onStop;z=x.onAlways;h=this};b.extend(G.prototype,{start:function(){v&&v();var x=b.extend(!0,{},g);b.post(a,x,function(F){F&&F.processId?(e=F.processId,A(100),A(200)):F&&F.error?q&&q.call(h,F):q&&q.call(h,"Server error")},
"json").error(function(){q&&q.call(h,"Server error")})},stop:function(){E=!0;y&&y.call(h);B()}});return G}(jQuery);var TeamMap=function(b){var a=function(e,c,d){if(!e)throw Error("DOM element is required");this.$map=b(e);(this.provider=c)&&0>["google","yandex","disabled"].indexOf(this.provider)&&console.error("Not supported map provider: %s".replace("%s",this.provider));this.map_info=null;this.initClass()};a.prototype.initClass=function(){};a.prototype.render=function(e,c){switch(this.provider){case "google":return this.googleRender(e,c);case "yandex":return this.yandexRender(e,c)}};a.prototype.googleRender=function(e,
c){var d=this;d.map_info=d.map_info||{};e=new google.maps.LatLng(e,c);d.map_info.map||(c={zoom:12,center:e,mapTypeId:google.maps.MapTypeId.ROADMAP},d.map_info.map=new google.maps.Map(d.$map.get(0),c));d.map_info.marker&&d.map_info.marker.setMap(null);d.map_info.marker=new google.maps.Marker({position:e,map:d.map_info.map});d.map_info.map.setCenter(e);a.google_error_html=a.google_error_html||"";setTimeout(function(){if(d.$map.find(".gm-err-container").length)d.$map.find(".gm-err-container").find(".gm-err-message").last().after('<div class="gm-err-message">'+
b.team.locales.map_check_your_key+"</div>"),a.google_error_html=d.$map.find(".gm-err-container").parent().html();else if(!d.$map.find(".gm-style").length)if(a.google_error_html)d.$map.children().html(a.google_error_html);else{var f='<div class="gm-err-container"><div class="gm-err-content"><div class="gm-err-icon"><img src="https://maps.gstatic.com/mapfiles/api-3/images/icon_error.png" draggable="false" style="user-select: none;"></div><div class="gm-err-title">:title:</div><div class="gm-err-message">:message1:</div><div class="gm-err-message">:message2:</div></div></div>'.replace(":title:",
b.team.locales.map_error_title);f=f.replace(":message1:",b.team.locales.map_error_message);f=f.replace(":message2:",b.team.locales.map_check_your_key);d.$map.children().html(f)}},5E3)};a.prototype.yandexRender=function(e,c){this.map_info=this.map_info||{};e=[e,c];this.map_info.map||(c={zoom:12,center:e,controls:["zoomControl","fullscreenControl"]},this.map_info.map=new ymaps.Map(this.$map.get(0),c));this.map_info.marker&&this.map_info.map.geoObjects.remove(this.map_info.marker);this.map_info.marker=
new ymaps.Placemark(e,null,{preset:"islands#redDotIcon"});this.map_info.map.geoObjects.add(this.map_info.marker);this.map_info.map.setCenter(e)};a.prototype.geocode=function(e,c,d){switch(this.provider){case "google":return this.googleGeocode(e,c,d);case "yandex":return this.yandexGeocode(e,c,d);default:d?d():c&&c()}};a.prototype.googleGeocode=function(e,c,d){var f=!1,g=!1;(new google.maps.Geocoder).geocode({address:e},function(h,m){f=!0;g||(m==google.maps.GeocoderStatus.OK?(h=h[0].geometry.location,
c(h.lat(),h.lng())):d&&d())});setTimeout(function(){f||(g=!0,d&&d(!0))},5E3)};a.prototype.yandexGeocode=function(e,c,d){ymaps.geocode(e,{results:1}).then(function(f){var g=1;f.metaData&&f.metaData.geocoder&&"found"in f.metaData.geocoder&&(g=f.metaData.geocoder.found);0>=g?d():(f=f.geoObjects.get(0).geometry.getCoordinates(),c(f[0],f[1]))},function(f){d(f)})};return a}(jQuery);var SwiperSlider=function(b){this.container=b.selector||".swiper-container";this.containerParent=document.querySelector(this.container).closest("#t-access-page");this.params=b.params||{};this.params.on=b.params.on||{};this.events=b.events||{};this.calculate_group_size=b.calculateGroupSize||!1;this.watch_nav=b.watchNav||!1;this.set_container_width=b.setContainerWidth||!1;this.swiper={};this.init()};
SwiperSlider.prototype.init=function(){var b=this;b.params.on.beforeInit=function(a){b.calculate_group_size&&(a.params.slidesPerGroup=b.calculateGroupSize(a),a.params.slidesPerView=b.calculateGroupSize(a));b.set_container_width&&b.setContainerWidth(a)};b.swiper=new Swiper(b.container,b.params);b.bindEvents();b.watch_nav&&b.showNavigation();b.set_container_width&&b.setContainerWidth(b.swiper)};
SwiperSlider.prototype.setContainerWidth=function(b){var a=this;b.onAny(function(){a.set_container_width.forEach(function(e){var c=document.body.clientWidth;c<=e?b.$el.css("width",c+"px"):b.$el.css("width","")})})};
SwiperSlider.prototype.showNavigation=function(){var b=this,a=b.swiper.navigation.prevEl,e=b.swiper.navigation.nextEl;if(b.containerParent)b.swiper.on("slideChange sliderMove",function(c){c.isEnd?(b.containerParent.classList.add("reachend"),e.children[0].classList.add("hidden")):c.isBeginning?(b.containerParent.classList.add("reachstart"),a.children[0].classList.add("hidden")):(b.containerParent.classList.remove("reachend"),b.containerParent.classList.remove("reachstart"),e.children[0].classList.remove("hidden"),
a.children[0].classList.remove("hidden"))});a&&e&&(a.classList.toggle("hidden",b.swiper.isLocked),e.classList.toggle("hidden",b.swiper.isLocked),b.swiper.on("lock unlock",function(){a.classList.toggle("hidden",b.swiper.isLocked);e.classList.toggle("hidden",b.swiper.isLocked)}))};
SwiperSlider.prototype.calculateGroupSize=function(b){var a=b.el.clientWidth-(b.params.slidesOffsetBefore||0)-(b.params.slidesOffsetAfter||0);b=b.wrapperEl.querySelector("."+b.params.slideClass).clientWidth;return Math.round(a/b)};SwiperSlider.prototype.bindEvents=function(){for(var b in this.events)if(this.events.hasOwnProperty(b))this.swiper.on(b,this.events[b])};
//# sourceMappingURL=team.min.js.map