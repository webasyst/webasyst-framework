/*
 jquery-timepicker v1.11.5 - A jQuery timepicker plugin inspired by Google Calendar. It supports both mouse and keyboard navigation.
 Copyright (c) 2016 Jon Thornton - http://jonthornton.github.com/jquery-timepicker/
 License: MIT
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(c){return c.raw=c};$jscomp.createTemplateTagFirstArgWithRaw=function(c,a){c.raw=a;return c};$jscomp.arrayIteratorImpl=function(c){var a=0;return function(){return a<c.length?{done:!1,value:c[a++]}:{done:!0}}};$jscomp.arrayIterator=function(c){return{next:$jscomp.arrayIteratorImpl(c)}};$jscomp.makeIterator=function(c){var a="undefined"!=typeof Symbol&&Symbol.iterator&&c[Symbol.iterator];return a?a.call(c):$jscomp.arrayIterator(c)};
$jscomp.arrayFromIterator=function(c){for(var a,e=[];!(a=c.next()).done;)e.push(a.value);return e};$jscomp.arrayFromIterable=function(c){return c instanceof Array?c:$jscomp.arrayFromIterator($jscomp.makeIterator(c))};$jscomp.findInternal=function(c,a,e){c instanceof String&&(c=String(c));for(var b=c.length,d=0;d<b;d++){var f=c[d];if(a.call(e,f,d,c))return{i:d,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,a,e){if(c==Array.prototype||c==Object.prototype)return c;c[a]=e.value;return c};
$jscomp.getGlobal=function(c){c=["object"==typeof globalThis&&globalThis,c,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var a=0;a<c.length;++a){var e=c[a];if(e&&e.Math==Math)return e}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(c,a){var e=$jscomp.propertyToPolyfillSymbol[a];if(null==e)return c[a];e=c[e];return void 0!==e?e:c[a]};$jscomp.polyfill=function(c,a,e,b){a&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(c,a,e,b):$jscomp.polyfillUnisolated(c,a,e,b))};
$jscomp.polyfillUnisolated=function(c,a,e,b){e=$jscomp.global;c=c.split(".");for(b=0;b<c.length-1;b++){var d=c[b];if(!(d in e))return;e=e[d]}c=c[c.length-1];b=e[c];a=a(b);a!=b&&null!=a&&$jscomp.defineProperty(e,c,{configurable:!0,writable:!0,value:a})};
$jscomp.polyfillIsolated=function(c,a,e,b){var d=c.split(".");c=1===d.length;b=d[0];b=!c&&b in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<d.length-1;f++){var g=d[f];if(!(g in b))return;b=b[g]}d=d[d.length-1];e=$jscomp.IS_SYMBOL_NATIVE&&"es6"===e?b[d]:null;a=a(e);null!=a&&(c?$jscomp.defineProperty($jscomp.polyfills,d,{configurable:!0,writable:!0,value:a}):a!==e&&(void 0===$jscomp.propertyToPolyfillSymbol[d]&&(e=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[d]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(d):$jscomp.POLYFILL_PREFIX+e+"$"+d),$jscomp.defineProperty(b,$jscomp.propertyToPolyfillSymbol[d],{configurable:!0,writable:!0,value:a})))};$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(a,e){return $jscomp.findInternal(this,a,e).v}},"es6","es3");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(c){if(c)return c;var a=function(f,g){this.$jscomp$symbol$id_=f;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:g})};a.prototype.toString=function(){return this.$jscomp$symbol$id_};var e="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",b=0,d=function(f){if(this instanceof d)throw new TypeError("Symbol is not a constructor");return new a(e+(f||"")+"_"+b++,f)};return d},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(c){if(c)return c;c=Symbol("Symbol.iterator");for(var a="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),e=0;e<a.length;e++){var b=$jscomp.global[a[e]];"function"===typeof b&&"function"!=typeof b.prototype[c]&&$jscomp.defineProperty(b.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return c},"es6",
"es3");$jscomp.iteratorPrototype=function(c){c={next:c};c[Symbol.iterator]=function(){return this};return c};$jscomp.iteratorFromArray=function(c,a){c instanceof String&&(c+="");var e=0,b=!1,d={next:function(){if(!b&&e<c.length){var f=e++;return{value:a(f,c[f]),done:!1}}b=!0;return{done:!0,value:void 0}}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.polyfill("Array.prototype.entries",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(a,e){return[a,e]})}},"es6","es3");$jscomp.polyfill("Object.is",function(c){return c?c:function(a,e){return a===e?0!==a||1/a===1/e:a!==a&&e!==e}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(c){return c?c:function(a,e){var b=this;b instanceof String&&(b=String(b));var d=b.length;e=e||0;for(0>e&&(e=Math.max(e+d,0));e<d;e++){var f=b[e];if(f===a||Object.is(f,a))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(c,a,e){if(null==c)throw new TypeError("The 'this' value for String.prototype."+e+" must not be null or undefined");if(a instanceof RegExp)throw new TypeError("First argument to String.prototype."+e+" must not be a regular expression");return c+""};$jscomp.polyfill("String.prototype.includes",function(c){return c?c:function(a,e){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,e||0)}},"es6","es3");
$jscomp.polyfill("String.prototype.repeat",function(c){return c?c:function(a){var e=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var b="";a;)if(a&1&&(b+=e),a>>>=1)e+=e;return b}},"es6","es3");$jscomp.stringPadding=function(c,a){c=void 0!==c?String(c):" ";return 0<a&&c?c.repeat(Math.ceil(a/c.length)).substring(0,a):""};
$jscomp.polyfill("String.prototype.padStart",function(c){return c?c:function(a,e){var b=$jscomp.checkStringArgs(this,null,"padStart");return $jscomp.stringPadding(e,a-b.length)+b}},"es8","es3");
!function(c){"object"==typeof exports&&exports&&"object"==typeof module&&module&&module.exports===exports?c(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],c):c(jQuery)}(function(c){function a(k){k=k[0];return 0<k.offsetWidth&&0<k.offsetHeight}function e(k){if(k.minTime&&(k.minTime=B(k.minTime)),k.maxTime&&(k.maxTime=B(k.maxTime)),k.durationTime&&"function"!=typeof k.durationTime&&(k.durationTime=B(k.durationTime)),"now"==k.scrollDefault)k.scrollDefault=function(){return k.roundingFunction(B(new Date),
k)};else if(k.scrollDefault&&"function"!=typeof k.scrollDefault){var r=k.scrollDefault;k.scrollDefault=function(){return k.roundingFunction(B(r),k)}}else k.minTime&&(k.scrollDefault=function(){return k.roundingFunction(k.minTime,k)});if("string"===c.type(k.timeFormat)&&k.timeFormat.match(/[gh]/)&&(k._twelveHourTime=!0),!1===k.showOnFocus&&-1!=k.showOn.indexOf("focus")&&k.showOn.splice(k.showOn.indexOf("focus"),1),0<k.disableTimeRanges.length){for(var q in k.disableTimeRanges)k.disableTimeRanges[q]=
[B(k.disableTimeRanges[q][0]),B(k.disableTimeRanges[q][1])];k.disableTimeRanges=k.disableTimeRanges.sort(function(u,w){return u[0]-w[0]});for(q=k.disableTimeRanges.length-1;0<q;q--)k.disableTimeRanges[q][0]<=k.disableTimeRanges[q-1][1]&&(k.disableTimeRanges[q-1]=[Math.min(k.disableTimeRanges[q][0],k.disableTimeRanges[q-1][0]),Math.max(k.disableTimeRanges[q][1],k.disableTimeRanges[q-1][1])],k.disableTimeRanges.splice(q,1))}return k}function b(k){var r=k.data("timepicker-settings"),q=k.data("timepicker-list");
if(q&&q.length&&(q.remove(),k.data("timepicker-list",!1)),r.useSelect)var u=q=c("<select />",{"class":"ui-timepicker-select"});else q=c("<ul />",{"class":"ui-timepicker-list"}),u=c("<div />",{"class":"ui-timepicker-wrapper",tabindex:-1}),u.css({display:"none",position:"absolute"}).append(q);if(r.noneOption)if(!0===r.noneOption&&(r.noneOption=r.useSelect?"Time...":"None"),c.isArray(r.noneOption))for(var w in r.noneOption){if(parseInt(w,10)==w){var E=d(r.noneOption[w],r.useSelect);q.append(E)}}else E=
d(r.noneOption,r.useSelect),q.append(E);(r.className&&u.addClass(r.className),null===r.minTime&&null===r.durationTime||!r.showDuration)||("function"==typeof r.step?"function":r.step,u.addClass("ui-timepicker-with-duration"),u.addClass("ui-timepicker-step-"+r.step));E=r.minTime;"function"==typeof r.durationTime?E=B(r.durationTime()):null!==r.durationTime&&(E=r.durationTime);w=null!==r.minTime?r.minTime:0;var H=null!==r.maxTime?r.maxTime:w+G-1;w>H&&(H+=G);H===G-1&&"string"===c.type(r.timeFormat)&&r.show2400&&
(H=G);var L=r.disableTimeRanges,K=0,Q=L.length,N=r.step;"function"!=typeof N&&(N=function(){return r.step});for(var O=0;H>=w;O++,w+=60*N(O)){var J=w,M=D(J,r);if(r.useSelect)var I=c("<option />",{value:M});else I=c("<li />"),I.addClass(43200>J%86400?"ui-timepicker-am":"ui-timepicker-pm"),I.data("time",86400>=J?J:J%86400);I.text(M);if((null!==r.minTime||null!==r.durationTime)&&r.showDuration)if(M=A(w-E,r.step),r.useSelect)I.text(I.text()+" ("+M+")");else{var P=c("<span />",{"class":"ui-timepicker-duration"});
P.text(" ("+M+")");I.append(P)}Q>K&&(J>=L[K][1]&&(K+=1),L[K]&&J>=L[K][0]&&J<L[K][1]&&(r.useSelect?I.prop("disabled",!0):I.addClass("ui-timepicker-disabled")));q.append(I)}(u.data("timepicker-input",k),k.data("timepicker-list",u),r.useSelect)?(k.val()&&q.val(f(B(k.val()),r)),q.on("focus",function(){c(this).data("timepicker-input").trigger("showTimepicker")}),q.on("blur",function(){c(this).data("timepicker-input").trigger("hideTimepicker")}),q.on("change",function(){t(k,c(this).val(),"select")}),t(k,
q.val(),"initial"),k.hide().after(q)):(w=r.appendTo,"string"==typeof w?w=c(w):"function"==typeof w&&(w=w(k)),w.append(u),n(k,q),q.on("mousedown click","li",function(R){k.off("focus.timepicker");k.on("focus.timepicker-ie-hack",function(){k.off("focus.timepicker-ie-hack");k.on("focus.timepicker",F.show)});h(k)||k[0].focus();q.find("li").removeClass("ui-timepicker-selected");c(this).addClass("ui-timepicker-selected");C(k)&&(k.trigger("hideTimepicker"),q.on("mouseup.timepicker click.timepicker","li",
function(S){q.off("mouseup.timepicker click.timepicker");u.hide()}))}))}function d(k,r){var q,u,w;return"object"==typeof k?(q=k.label,u=k.className,w=k.value):"string"==typeof k?q=k:c.error("Invalid noneOption value"),r?c("<option />",{value:w,"class":u,text:q}):c("<li />",{"class":u,text:q}).data("time",String(w))}function f(k,r){return k=r.roundingFunction(k,r),null!==k?D(k,r):void 0}function g(k){k.target!=window&&(k=c(k.target),k.closest(".ui-timepicker-input").length||k.closest(".ui-timepicker-wrapper").length||
(F.hide(),c(document).unbind(".ui-timepicker"),c(window).unbind(".ui-timepicker")))}function h(k){k=k.data("timepicker-settings");return(window.navigator.msMaxTouchPoints||"ontouchstart"in document)&&k.disableTouchKeyboard}function m(k,r,q){if(!q&&0!==q)return!1;k=k.data("timepicker-settings");var u=!1;q=k.roundingFunction(q,k);return r.find("li").each(function(w,E){w=c(E);if("number"==typeof w.data("time"))return w.data("time")==q?(u=w,!1):void 0}),u}function n(k,r){r.find("li").removeClass("ui-timepicker-selected");
var q=B(p(k),k.data("timepicker-settings"));null!==q&&(k=m(k,r,q))&&(q=k.offset().top-r.offset().top,(q+k.outerHeight()>r.outerHeight()||0>q)&&r.scrollTop(r.scrollTop()+k.position().top-k.outerHeight()),k.addClass("ui-timepicker-selected"))}function l(k,r){if(""!==this.value&&"timepicker"!=r){var q=c(this);if(!q.is(":focus")||k&&"change"==k.type){k=q.data("timepicker-settings");var u=B(this.value,k);if(null===u)return void q.trigger("timeFormatError");var w=!1;if(null!==k.minTime&&null!==k.maxTime&&
(u<k.minTime||u>k.maxTime)&&(w=!0),c.each(k.disableTimeRanges,function(){return u>=this[0]&&u<this[1]?(w=!0,!1):void 0}),k.forceRoundTime){var E=k.roundingFunction(u,k);E!=u&&(u=E,r=null)}k=D(u,k);w?t(q,k,"error")&&q.trigger("timeRangeError"):t(q,k,r)}}}function p(k){return k.is("input")?k.val():k.data("ui-timepicker-value")}function t(k,r,q){if(k.is("input")){k.val(r);var u=k.data("timepicker-settings");u.useSelect&&"select"!=q&&"initial"!=q&&k.data("timepicker-list").val(f(B(r),u))}return k.data("ui-timepicker-value")!=
r?(k.data("ui-timepicker-value",r),"select"==q?k.trigger("selectTime").trigger("changeTime").trigger("change","timepicker"):-1==["error","initial"].indexOf(q)&&k.trigger("changeTime"),!0):(k.trigger("selectTime"),!1)}function v(k){switch(k.keyCode){case 13:case 9:break;default:k.preventDefault()}}function x(k){var r=c(this),q=r.data("timepicker-list");if(!q||!a(q)){if(40!=k.keyCode)return!0;F.show.call(r.get(0));q=r.data("timepicker-list");h(r)||r.focus()}switch(k.keyCode){case 13:return C(r)&&(l.call(r.get(0),
{type:"change"}),F.hide.apply(this)),k.preventDefault(),!1;case 38:var u=q.find(".ui-timepicker-selected");return u.length?u.is(":first-child")||(u.removeClass("ui-timepicker-selected"),u.prev().addClass("ui-timepicker-selected"),u.prev().position().top<u.outerHeight()&&q.scrollTop(q.scrollTop()-u.outerHeight())):(q.find("li").each(function(w,E){return 0<c(E).position().top?(u=c(E),!1):void 0}),u.addClass("ui-timepicker-selected")),!1;case 40:return u=q.find(".ui-timepicker-selected"),0===u.length?
(q.find("li").each(function(w,E){return 0<c(E).position().top?(u=c(E),!1):void 0}),u.addClass("ui-timepicker-selected")):u.is(":last-child")||(u.removeClass("ui-timepicker-selected"),u.next().addClass("ui-timepicker-selected"),u.next().position().top+2*u.outerHeight()>q.outerHeight()&&q.scrollTop(q.scrollTop()+u.outerHeight())),!1;case 27:q.find("li").removeClass("ui-timepicker-selected");F.hide();break;case 9:F.hide();break;default:return!0}}function y(k){var r=c(this),q=r.data("timepicker-list"),
u=r.data("timepicker-settings");if(!q||!a(q)||u.disableTextInput)return!0;switch(k.keyCode){case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 65:case 77:case 80:case 186:case 8:case 46:u.typeaheadHighlight?n(r,q):q.hide()}}function C(k){var r=k.data("timepicker-settings"),q=null,u=k.data("timepicker-list").find(".ui-timepicker-selected");return u.hasClass("ui-timepicker-disabled")?
!1:(u.length&&(q=u.data("time")),null!==q&&("string"!=typeof q&&(q=D(q,r)),t(k,q,"select")),!0)}function A(k,r){k=Math.abs(k);var q,u;k=Math.round(k/60);var w=[];return 60>k?w=[k,z.mins]:(q=Math.floor(k/60),u=k%60,30==r&&30==u&&(q+=z.decimal+5),w.push(q),w.push(1==q?z.hr:z.hrs),30!=r&&u&&(w.push(u),w.push(z.mins))),w.join(" ")}function D(k,r){if("number"!=typeof k)return null;var q=parseInt(k%60),u=parseInt(k/60%60),w=parseInt(k/3600%24);w=new Date(1970,0,2,w,u,q,0);if(isNaN(w.getTime()))return null;
if("function"===c.type(r.timeFormat))return r.timeFormat(w);for(var E="",H=0;H<r.timeFormat.length;H++)switch(q=r.timeFormat.charAt(H)){case "a":E+=11<w.getHours()?z.pm:z.am;break;case "A":E+=11<w.getHours()?z.PM:z.AM;break;case "g":q=w.getHours()%12;E+=0===q?"12":q;break;case "G":q=w.getHours();k===G&&(q=r.show2400?24:0);E+=q;break;case "h":q=w.getHours()%12;0!==q&&10>q&&(q="0"+q);E+=0===q?"12":q;break;case "H":q=w.getHours();k===G&&(q=r.show2400?24:0);E+=9<q?q:"0"+q;break;case "i":u=w.getMinutes();
E+=9<u?u:"0"+u;break;case "s":q=w.getSeconds();E+=9<q?q:"0"+q;break;case "\\":H++;E+=r.timeFormat.charAt(H);break;default:E+=q}return E}function B(k,r){if(""===k||null===k)return null;if("object"==typeof k)return 3600*k.getHours()+60*k.getMinutes()+k.getSeconds();if("string"!=typeof k)return k;k=k.toLowerCase().replace(/[\s\.]/g,"");"a"!=k.slice(-1)&&"p"!=k.slice(-1)||(k+="m");var q="("+z.am.replace(".","")+"|"+z.pm.replace(".","")+"|"+z.AM.replace(".","")+"|"+z.PM.replace(".","")+")?",u=k.match(new RegExp("^"+
q+"([0-9]?[0-9])\\W?([0-5][0-9])?\\W?([0-5][0-9])?"+q+"$"));if(!u)return null;k=parseInt(1*u[2],10);if(24<k){if(r&&!1===r.wrapHours)return null;k%=24}q=u[1]||u[5];var w=k;12>=k&&q&&(w=q==z.pm||q==z.PM,w=12==k?w?12:0:k+(w?12:0));u=3600*w+60*(1*u[3]||0)+(1*u[4]||0);12>k&&!q&&r&&r._twelveHourTime&&r.scrollDefault&&(r=u-r.scrollDefault(),0>r&&r>=G/-2&&(u=(u+G/2)%G));return u}var G=86400,z={am:"am",pm:"pm",AM:"AM",PM:"PM",decimal:".",mins:"mins",hr:"hr",hrs:"hrs"},F={init:function(k){return this.each(function(){var r=
c(this),q=[],u;for(u in c.fn.timepicker.defaults)r.data(u)&&(q[u]=r.data(u));q=c.extend({},c.fn.timepicker.defaults,q,k);if(q.lang&&(z=c.extend(z,q.lang)),q=e(q),r.data("timepicker-settings",q),r.addClass("ui-timepicker-input"),q.useSelect)b(r);else{if(r.prop("autocomplete","off"),q.showOn)for(var w in q.showOn)r.on(q.showOn[w]+".timepicker",F.show);r.on("change.timepicker",l);r.on("keydown.timepicker",x);r.on("keyup.timepicker",y);q.disableTextInput&&r.on("keydown.timepicker",v);l.call(r.get(0),
null,"initial")}})},show:function(k){var r=c(this),q=r.data("timepicker-settings");if(k&&k.preventDefault(),q.useSelect)return void r.data("timepicker-list").focus();h(r)&&r.blur();k=r.data("timepicker-list");if(!r.prop("readonly")&&(k&&0!==k.length&&"function"!=typeof q.durationTime||(b(r),k=r.data("timepicker-list")),!a(k))){r.data("ui-timepicker-value",r.val());n(r,k);F.hide();k.show();var u={};q.orientation.match(/r/)?u.left=r.offset().left+r.outerWidth()-k.outerWidth()+parseInt(k.css("marginLeft").replace("px",
""),10):u.left=r.offset().left+parseInt(k.css("marginLeft").replace("px",""),10);"t"==(q.orientation.match(/t/)?"t":q.orientation.match(/b/)?"b":r.offset().top+r.outerHeight(!0)+k.outerHeight()>c(window).height()+c(window).scrollTop()?"t":"b")?(k.addClass("ui-timepicker-positioned-top"),u.top=r.offset().top-k.outerHeight()+parseInt(k.css("marginTop").replace("px",""),10)):(k.removeClass("ui-timepicker-positioned-top"),u.top=r.offset().top+r.outerHeight()+parseInt(k.css("marginTop").replace("px",""),
10));k.offset(u);u=k.find(".ui-timepicker-selected");if(!u.length){var w=B(p(r));null!==w?u=m(r,k,w):q.scrollDefault&&(u=m(r,k,q.scrollDefault()))}u&&u.length?(u=k.scrollTop()+u.position().top-u.outerHeight(),k.scrollTop(u)):k.scrollTop(0);return q.stopScrollPropagation&&c(document).on("wheel.ui-timepicker",".ui-timepicker-wrapper",function(E){E.preventDefault();var H=c(this).scrollTop();c(this).scrollTop(H+E.originalEvent.deltaY)}),c(document).on("touchstart.ui-timepicker mousedown.ui-timepicker",
g),c(window).on("resize.ui-timepicker",g),q.closeOnWindowScroll&&c(document).on("scroll.ui-timepicker",g),r.trigger("showTimepicker"),this}},hide:function(k){k=c(this);var r=k.data("timepicker-settings");return r&&r.useSelect&&k.blur(),c(".ui-timepicker-wrapper").each(function(){var q=c(this);if(a(q)){var u=q.data("timepicker-input"),w=u.data("timepicker-settings");w&&w.selectOnBlur&&C(u);q.hide();u.trigger("hideTimepicker")}}),this},option:function(k,r){return"string"==typeof k&&"undefined"==typeof r?
c(this).data("timepicker-settings")[k]:this.each(function(){var q=c(this),u=q.data("timepicker-settings"),w=q.data("timepicker-list");"object"==typeof k?u=c.extend(u,k):"string"==typeof k&&(u[k]=r);u=e(u);q.data("timepicker-settings",u);w&&(w.remove(),q.data("timepicker-list",!1));u.useSelect&&b(q)})},getSecondsFromMidnight:function(){return B(p(this))},getTime:function(k){var r=p(this);if(!r)return null;r=B(r);if(null===r)return null;k||(k=new Date);k=new Date(k);return k.setHours(r/3600),k.setMinutes(r%
3600/60),k.setSeconds(r%60),k.setMilliseconds(0),k},isVisible:function(){var k=this.data("timepicker-list");return!(!k||!a(k))},setTime:function(k){var r=this.data("timepicker-settings"),q=r.forceRoundTime?f(B(k),r):D(B(k),r);return k&&null===q&&r.noneOption&&(q=k),t(this,q),this.data("timepicker-list")&&n(this,this.data("timepicker-list")),this},remove:function(){if(this.hasClass("ui-timepicker-input")){var k=this.data("timepicker-settings");return this.removeAttr("autocomplete","off"),this.removeClass("ui-timepicker-input"),
this.removeData("timepicker-settings"),this.off(".timepicker"),this.data("timepicker-list")&&this.data("timepicker-list").remove(),k.useSelect&&this.show(),this.removeData("timepicker-list"),this}}};c.fn.timepicker=function(k){return this.length?F[k]?this.hasClass("ui-timepicker-input")?F[k].apply(this,Array.prototype.slice.call(arguments,1)):this:"object"!=typeof k&&k?void c.error("Method "+k+" does not exist on jQuery.timepicker"):F.init.apply(this,arguments):this};c.fn.timepicker.defaults={appendTo:"body",
className:null,closeOnWindowScroll:!1,disableTextInput:!1,disableTimeRanges:[],disableTouchKeyboard:!1,durationTime:null,forceRoundTime:!1,maxTime:null,minTime:null,noneOption:!1,orientation:"l",roundingFunction:function(k,r){if(null===k)return null;if("number"!=typeof r.step)return k;var q=k%(60*r.step);return q>=30*r.step?k+=60*r.step-q:k-=q,k==G&&r.show2400?k:k%G},scrollDefault:null,selectOnBlur:!1,show2400:!1,showDuration:!1,showOn:["click","focus"],showOnFocus:!0,step:30,stopScrollPropagation:!1,
timeFormat:"g:ia",typeaheadHighlight:!0,useSelect:!1,wrapHours:!0}});(function(c){c.team={app_url:!1,content:!1,sidebar:!1,calendar:!1,profile:!1,title_pattern:"Team \u2014 %s",init:function(a){["is_debug","app_url","locales"].forEach(function(e){c.team[e]=a[e]});c(document).ajaxSend(function(e,b,d){d.crossDomain||"POST"!==(d.type||"").toUpperCase()||(e=(e=document.cookie.match(/(?:^|; )_csrf=([^;]*)/))?decodeURIComponent(e[1]):"",d.data=d.data||"","string"==typeof d.data?-1==d.data.indexOf("_csrf=")&&(d.data+=(0<d.data.length?"&":"")+"_csrf="+e,b.setRequestHeader("Content-type",
"application/x-www-form-urlencoded")):"object"==typeof d.data&&(d.data._csrf=e))});c.team.content=new ContentRouter({$content:c("#t-content")});c.team.setSync()},setTitle:function(a){if(a){var e=history.state;e&&(e.title=a);document.title=c.team.title_pattern.replace("%s",a)}},confirmContactDelete:function(a,e){c.post("?module=users&action=prepareDelete",{id:a},function(b){c.waDialog({html:b,onOpen:function(d,f){var g=d.data("allowed-ids"),h=d.find(".js-delete-button");f.$document.trigger("wa_confirm_contact_delete_dialog");
if(g)h.on("click",function(){var m=h.text(),n=d.find('[name="delete_forever"]:checked').attr("value");h.attr("disabled",!0).html(m+' <i class="fas fa-spin fa-spinner wa-animation-spin speed-1000"></i>');c.post("?module=users&action=delete",{delete_forever:n,id:g},function(){f.close();c.team.sidebar.reload();e?c.team.content.reload():c.team.content.load(c.team.app_url)}).always(function(){h.attr("disabled",!1).html(m)})})}})})},setSync:function(){function a(){c.post(c.team.app_url+"?module=calendarExternal&action=sync&background_process=1").always(function(){setTimeout(a,
e)}).error(function(){return!1})}var e=3E4+Math.floor(100*Math.random())/100*3E4;setTimeout(a,c.team.is_debug?100:e/2)},notification:function(a){var e,b=a.appendTo||document.body,d=null!=(e=a.isCloseable)?e:!0;e=a.alertTimeout||!1;var f=b.querySelector("#t-notifications"),g=document.createElement("div");g.classList.add("alert",a.alertClass||"info");g.innerHTML=a.alertContent||"";if(d){d=a.alertCloseClass||"js-alert-error-close";var h=document.createElement("a");h.classList.add("alert-close",d);h.setAttribute("href",
"javascript:void(0)");h.innerHTML='<i class="fas fa-times"></i>';g.insertAdjacentElement("afterbegin",h);h.addEventListener("click",function(){this.closest(".alert").remove()})}f||(f=document.createElement("div"),f.className="alert-fixed-box",a.alertPlacement&&f.classList.add(a.alertPlacement),a.alertSize&&f.classList.add(a.alertSize),f.id="t-notifications",b.append(f));a.alertPlacement?f.prepend(g):f.append(g);e&&setTimeout(function(){return g.remove()},e)}}})(jQuery);
var ContentRouter=function(c){ContentRouter=function(a){this.$window=c(window);this.$content=a.$content;this.$app=c("#wa-app");this.api_enabled=window.history&&window.history.pushState;this.scrollTop=a.scrollTop||!0;this.xhr=!1;this.is_enabled=!0;this.waLoading=c.waLoading();this.initClass()};ContentRouter.prototype.initClass=function(){this.bindEvents()};ContentRouter.prototype.bindEvents=function(){var a=this,e=window.location.origin+c.team.app_url;a.$app.on("click","a",function(b){if(!c(this)[0].hasAttribute("data-disable-routing")){var d=
a.is_enabled&&this.href.substr(0,e.length)==e;b.ctrlKey||b.shiftKey||b.metaKey||!d||(b.preventDefault(),a.load(this.href))}});c("#wa-app-team").on("click","a",function(b){b.stopPropagation()});a.api_enabled&&(window.onpopstate=function(b){b.stopPropagation();a.onPopState(b)})};ContentRouter.prototype.load=function(a,e){var b=this;if(!(0<=a.indexOf(c.team.app_url)))return alert("Determine the path error"),!1;b.xhr&&b.xhr.abort();c(document).trigger("wa_before_load",{content_uri:a});b.animate(!0);b.xhr=
c.get(a,function(d){!e&&b.api_enabled&&history.pushState({reload:!0,content_uri:a},"",a);b.setContent(d);b.animate(!1);b.xhr=!1;c(document).trigger("wa_loaded")})};ContentRouter.prototype.reload=function(a){var e,b=this.api_enabled&&history.state&&(null==(e=history.state)?0:e.content_uri)?history.state.content_uri:!1;a&&(b=location.href);(b||a)&&this.load(b,!0)};ContentRouter.prototype.setContent=function(a){this.$content.html(a);this.scrollTop&&window.scrollTo(0,0)};ContentRouter.prototype.onPopState=
function(a){if(a=a.state||!1){if(!a.content_uri)return alert("Determine the path error"),!1;c(document).trigger("wa_before_load",{content_uri:a.content_uri});a.reload?this.reload(a.content_uri):a.content&&this.setContent(a.content);a.title&&c.team.setTitle(a.title);c.team.sidebar.selectLink(a.content_uri);c(document).trigger("wa_loaded")}else location.reload()};ContentRouter.prototype.animate=function(a){a?this.waLoading.animate(3E3,96,!1):this.waLoading.done()};return ContentRouter}(jQuery),TeamDialog=
function(c){TeamDialog=function(a){this.$wrapper=c(a.html);this.$block=!1;if(this.is_full_screen=this.$wrapper.hasClass("is-full-screen"))this.$block=this.$wrapper.find(".t-dialog-block");this.position=a.position||!1;this.is_closed=!1;this.userPosition=a.setPosition||!1;this.onBgClick=a.onBgClick||!1;this.onOpen=a.onOpen||function(){};this.onClose=a.onClose||function(){};this.onRefresh=a.onRefresh||!1;this.onResize=a.onResize||!1;this.initClass()};TeamDialog.prototype.initClass=function(){this.$wrapper.data("teamDialog",
this);this.show();this.bindEvents()};TeamDialog.prototype.bindEvents=function(){var a=this,e=c(document),b=a.$block?a.$block:a.$wrapper;setTimeout(function(){function d(){a.is_closed||a.close();e.off("click",d);e.off("wa_before_load",d)}function f(){c.contains(document,a.$wrapper[0])?a.resize():c(window).off("resize",f)}e.on("click",d);e.on("wa_before_load",d);a.$wrapper.on("close",d);if(a.is_full_screen)a.$wrapper.on("click",".t-dialog-background",function(g){if(a.onBgClick)a.onBgClick(g);else g.stopPropagation()});
b.on("click",function(g){g.stopPropagation()});c(document).on("keyup",function(g){27===g.keyCode&&a.close()});b.on("click",".js-close-dialog",function(){d()});if(a.is_full_screen)c(window).on("resize",f)},0)};TeamDialog.prototype.show=function(){c("body").append(this.$wrapper);this.setPosition();this.onOpen(this.$wrapper,this)};TeamDialog.prototype.setPosition=function(){function a(m){return{left:parseInt((b-m.width)/2),top:parseInt((d-m.height)/2)}}var e=c(window),b=e.width(),d=this.is_full_screen?
e.height():c(document).height();e=this.$block?this.$block:this.$wrapper;var f=e.outerWidth(),g=e.outerHeight();var h=this.position?this.position:(this.userPosition?this.userPosition:a)({width:f,height:g});0<h.left&&h.left+f>b&&(h.left=b-f-10);0<h.top?h.top+g>d&&(h.top=d-g-10):(h.top=10,this.is_full_screen&&(f=e.find(".t-dialog-content"),f.hide(),g=e.outerHeight(),f.height(d-g-20).addClass("is-long-content").show()));e.css(h)};TeamDialog.prototype.close=function(){this.is_closed=!0;this.$wrapper.remove();
this.onClose(this.$wrapper,this)};TeamDialog.prototype.refresh=function(){this.onRefresh&&(this.onRefresh(),this.close())};TeamDialog.prototype.resize=function(){this.$block.addClass("is-animated");this.setPosition();if(this.onResize)this.onResize(this.$wrapper,this)};return TeamDialog}(jQuery),TeamEditable=function(c){TeamEditable=function(a,e){this.$wrapper=a;this.options=e;this.initClass()};TeamEditable.prototype.initClass=function(){this.bindEvents()};TeamEditable.prototype.bindEvents=function(){this.$wrapper.on("keydown",
c.proxy(this.checkPressEnter,this));this.$wrapper.on("focus",c.proxy(this.enableEditor,this));this.$wrapper.on("blur",c.proxy(this.disableEditor,this));this.$wrapper.on("paste",c.proxy(this.clearHtml,this))};TeamEditable.prototype.checkPressEnter=function(a){13===a.keyCode&&(a.preventDefault(),this.$wrapper.blur())};TeamEditable.prototype.cacheText=function(){this.cachedText=this.$wrapper.text()};TeamEditable.prototype.enableEditor=function(){this.cacheText();this.$wrapper.addClass("editable-highlight")};
TeamEditable.prototype.disableEditor=function(){this.$wrapper.removeClass("editable-highlight");this.$wrapper.text()!==this.cachedText&&this.save()};TeamEditable.prototype.clearHtml=function(a){a.preventDefault();a=a.originalEvent.clipboardData.getData("text/plain");a=a.replace(/<[^>]*>?/gm,"");document.queryCommandSupported("insertText")?document.execCommand("insertText",!1,a):document.execCommand("paste",!1,a)};TeamEditable.prototype.save=function(){var a=this,e={};e=(e["data[id]"]=a.options.groupId,
e[a.options.target]=a.$wrapper.text(),e);var b=c('<span class="smaller text-gray custom-ml-4"><i class="fas fa-spin fa-spinner wa-animation-spin speed-1000"></i></span>');a.$wrapper.append(b);c.post(a.options.api.save,e,function(){b.remove();a.options.reloadSidebar&&c.team.sidebar.reload()})};return TeamEditable}($);var Sidebar=function(c){Sidebar=function(a,e){this.$wrapper=a;this.options=e;this.initClass()};Sidebar.prototype.initClass=function(){this.$body=this.$wrapper.find(".sidebar-body");this.$addUserLink=this.$wrapper.find("#t-new-user-link");this.$groupsWrapper=this.$wrapper.find(".t-groups-list");this.$groups=this.$groupsWrapper.find("> li");this.$locationsWrapper=this.$wrapper.find(".t-locations-list");this.$locations=this.$locationsWrapper.find("> li");this.$searchForm=this.$wrapper.find(".t-search-form");
this.$addGroupLink=this.$wrapper.find(".js-add-user-group");this.$addOfficeLink=this.$wrapper.find(".js-add-user-location");c.extend(this.options,{storage_count_name:"team/sidebar_counts",link_count_update_date:!1,counters:{},storageCount:!1,xhr:!1,timer:0});this.$activeMenuItem=this.$wrapper.find("li."+this.options.classes.selected+":first")||!1;this.groupDialog={};this.setCounts();this.options.can_sort&&this.initSortable();this.initDroppable();this.$activeMenuItem.length||this.selectLink();this.initUpdater();
this.bindEvents()};Sidebar.prototype.bindEvents=function(){this.unBindEvents();this.$wrapper.on("click","li > a",c.proxy(this.onLinkClick,this));this.$addGroupLink.on("click",c.proxy(this.showGroupDialog,this));this.$addOfficeLink.on("click",c.proxy(this.showGroupDialog,this));this.$searchForm.on("submit",c.proxy(this.showSearch,this));this.$addUserLink.on("click",c.proxy(this.showInviteDialog,this))};Sidebar.prototype.unBindEvents=function(){this.$wrapper.off("click","li > a");this.$addGroupLink.off("click");
this.$addOfficeLink.off("click");this.$searchForm.off("submit");this.$addUserLink.off("click")};Sidebar.prototype.onLinkClick=function(a){a=c(a.target).closest("a");var e=a.attr("href");e&&"javascript:"!==e.substr(0,11)&&!a.hasClass(this.options.classes.noHighlight)&&(this.setItem(a.closest("li")),c.team.setTitle(a.text()))};Sidebar.prototype.setItem=function(a){this.$activeMenuItem&&this.$activeMenuItem[0]===a[0]||(this.$activeMenuItem&&this.$activeMenuItem.removeClass(this.options.classes.selected),
a.addClass(this.options.classes.selected),this.$activeMenuItem=a)};Sidebar.prototype.selectLink=function(a){if(a)var e=this.$wrapper.find('a[href="'+a+'"]:first');else if(!1===a){this.$activeMenuItem&&(this.$activeMenuItem.removeClass(this.options.classes.selected),this.$activeMenuItem=null);return}if(e&&e.length)this.setItem(e.closest("li"));else{a=this.$wrapper.find('a[href^="'+this.options.app_url+'"]');var b=location.pathname,d=0,f=0;a.each(function(g){var h=c(this).attr("href"),m=h.length;0<=
b.indexOf(h)&&m>d&&(d=m,f=g)});if(f||0===f)e=a.eq(f),this.setItem(e.closest("li"))}};Sidebar.prototype.reload=function(a){var e=this,b=c.team.app_url+e.options.api.reload;a&&(b+="&background_process=1");clearTimeout(e.options.timer);e.options.xhr&&e.options.xhr.abort();e.options.xhr=c.get(b,{is_reload:1},function(d){e.options.xhr=!1;e.$body.replaceWith(d);e.$wrapper.find(".sidebar-header").css("display","");e.$wrapper.find(".sidebar-body").css("display","");e.$wrapper.find(".sidebar-footer").css("display",
"");e.initClass()})};Sidebar.prototype.showInviteDialog=function(a){a.preventDefault();c.get(c.team.app_url+this.options.api.inviteDialog,function(e){c.waDialog({html:e})})};Sidebar.prototype.showGroupDialog=function(a){a.preventDefault();var e=this,b=c(a.target).hasClass(e.options.classes.initGroupDialog)?"group":"location";e.groupDialog[b]?e.groupDialog[b].show():c.get(c.team.app_url+e.options.api.group,{type:b},function(d){e.groupDialog[b]=c.waDialog({html:d,onOpen:function(f,g){g.$content.find(".js-edit-group-name").focus()},
onClose:function(f){f.hide();return!1}})})};Sidebar.prototype.setCounts=function(){function a(g,h,m,n){var l=0<=g.indexOf(b.options.app_url),p=b.$wrapper.find('a[href="'+g+'"]');if(l&&p.length&&(m=h-m,!(0>m))){var t=c('<strong class="highlighted small js-sidebar-counter" style="height: fit-content;">+ '+m+"</strong>");l=p.find(".js-sidebar-counter");l.length?l.text("+ "+m):p.append(t);p.one("click",function(v){v.preventDefault();t.remove();b.saveCount(g,h);b.options.link_count_update_date=n;c(document).one("wa_loaded",
function(){b.options.link_count_update_date=!1})})}}function e(){var g=new Date,h=parseInt(g.getUTCDate()),m=parseInt(g.getUTCMonth())+1,n=parseInt(g.getUTCFullYear()),l=parseInt(g.getUTCHours()),p=parseInt(g.getUTCMinutes());g=parseInt(g.getUTCSeconds());return result={year:n,month:m,day:h,hours:l,minutes:p,seconds:g}}var b=this,d=function(){var g={},h=b.$wrapper.find("li .js-count"),m=e();h.each(function(){var n=c(this),l=parseInt(n.text()),p=n.closest("li").find("> a");0<=l&&(b.options.counters[p.attr("href")]=
n,g[p.attr("href")]={count:l,date:m})});return g}(),f=function(g){var h={};(g=localStorage.getItem(g))&&(h=JSON.parse(g));return h}(b.options.storage_count_name);b.options.storageCount=c.extend(!0,{},d);f&&c.each(f,function(g,h){var m=g in d&&0<=d[g].count&&d[g].count!==h.count;0<=h.count&&m&&(b.options.storageCount[g].count=h.count,b.options.storageCount[g].date=h.date,a(g,d[g].count,h.count,h.date))});b.setStorage()};Sidebar.prototype.saveCount=function(a,e){a in this.options.storageCount&&(this.options.storageCount[a].count=
e);this.setStorage()};Sidebar.prototype.updateCount=function(a,e){if(a&&(e||0===e)){var b=this.options.counters[a]||!1;this.saveCount(a,e);b.length?b.text(e):this.reload()}};Sidebar.prototype.setStorage=function(){localStorage.setItem(this.options.storage_count_name,JSON.stringify(this.options.storageCount))};Sidebar.prototype.initUpdater=function(){var a=this;a.options.timer=setTimeout(function(){c.contains(document,a.$wrapper[0])&&a.reload(!0)},a.options.updateTime)};Sidebar.prototype.initSortable=
function(){function a(g){var h=[];g.find("> li").each(function(){var m=c(this).data("group-id");m&&0<m&&h.push(m)});return h}function e(g,h){f&&(f.abort(),f=!1);f=c.post(g,h,function(){f=!1})}var b=this,d=c.team.app_url+b.options.api.sort,f=!1;1<b.$groups.length&&b.$groupsWrapper.sortable({animation:150,handle:"."+b.options.classes.drop,direction:"vertical",onEnd:function(g){if(g.oldIndex!==g.newIndex){g=a(b.$groupsWrapper);var h=[];c.each(g,function(m,n){h.push({name:"groups[]",value:n})});e(d,h)}}});
1<b.$locations.length&&b.$locationsWrapper.sortable({animation:150,handle:"."+b.options.classes.drop,direction:"vertical",onEnd:function(g){g.oldIndex!==g.newIndex&&(g=a(b.$locationsWrapper),e(d,{locations:g}))}})};Sidebar.prototype.initDroppable=function(){function a(d,f){d=parseInt(d.data("group-id"));var g=parseInt(f.data("user-id"));f=c.team.app_url+e.options.api.moveUser;0<d&&0<g&&(d={user_id:g,group_id:d},b&&b.abort(),b=c.post(f,d,function(h){b=!1;"ok"!==h.status?console.warn(h):c.team.sidebar.reload()}))}
var e=this,b=!1;e.$groups.each(function(){var d=c(this);d.hasClass(e.options.classes.drop)&&d.droppable({tolerance:"pointer",hoverClass:e.options.classes.highlighted,over:function(f,g){g.draggable.hasClass(e.options.classes.uiDraggable)||d.removeClass(e.options.classes.highlighted)},drop:function(f,g){a(c(this),g.draggable)}})});e.$locations.each(function(){var d=c(this);d.hasClass(e.options.classes.drop)&&d.droppable({tolerance:"pointer",hoverClass:e.options.classes.highlighted,over:function(f,g){g.draggable.hasClass(e.options.classes.uiDraggable)||
d.removeClass(e.options.classes.highlighted)},drop:function(f,g){a(c(this),g.draggable)}})})};Sidebar.prototype.showSearch=function(a){a.preventDefault();if(a=c(a.target).find(".t-search-field").val())a=encodeURIComponent(a),c.team.content.load(c.team.app_url+"search/"+a+"/"),this.$wrapper.find(".sidebar-mobile-toggle").trigger("click")};Sidebar.prototype.setSelected=function(a){switch(a.type){case "invited":var e=this.$body.find("[data-invited-item]");break;case "inactive":e=this.$body.find("[data-inactive-item]");
break;case "search":e=this.$body.find("#all-users-sidebar-link");break;case "group":e=this.$body.find('[data-group-id="'+a.groupId+'"]')}this.setItem(c(e))};return Sidebar}(jQuery);var CalendarPage=function(c){var a=function(e){a=function(b){this.$wrapper=b.$wrapper;this.$monthSelect=this.$wrapper.find(".month");this.$yearSelect=this.$wrapper.find(".year");this.filters_href=b.filters_href;this.month=parseInt(this.$monthSelect.val());this.year=parseInt(this.$yearSelect.val());this.initClass()};a.prototype.initClass=function(){var b=this;b.$monthSelect.on("change",function(){var d=e(this).val();d&&(b.month=parseInt(d));b.useFilter();return!1});b.$yearSelect.on("change",function(){var d=
e(this).val();d&&(b.year=parseInt(d));b.useFilter();return!1});b.$wrapper.on("click",".t-arrow",function(){var d=e(this);d.hasClass("left")&&b.changeMonth(!1);d.hasClass("right")&&b.changeMonth(!0);b.useFilter();return!1})};a.prototype.changeMonth=function(b){b?12<=this.month?(this.month=1,this.year++):this.month++:1>=this.month?(this.month=12,this.year--):this.month--};a.prototype.useFilter=function(){var b="start="+(this.year+"-"+(9<this.month?this.month:"0"+this.month)+"-01"),d=this.filters_href.split("?"),
f=d[0];d=d[1]||"";d=0<=d.indexOf("&")?d.split("&"):[d];var g=!1;d.length&&e.each(d,function(h,m){"start"==m.split("=")[0]&&(g=h)});g||0===g?d[g]=b:d.push(b);b=f+"?"+d.join("&");e.team.content.load(b)};return a}(jQuery);CalendarPage=function(e){this.$wrapper=e.$wrapper;this.$dateFilter=e.$dateFilter;this.filters_href=e.filters_href;this.user_id=e.user_id;this.local_storage=new c.store;this.initClass()};CalendarPage.prototype.initClass=function(){new a({$wrapper:this.$dateFilter,filters_href:this.filters_href});
this.initInfoBlock()};CalendarPage.prototype.initInfoBlock=function(){var e=this.$wrapper.find(".t-info-notice-wrapper"),b=e.find(".t-info-notice-toggle"),d=new c.store;d.get("team/calendar_info_warn_block_hide")?e.hide():e.show();b.on("click",function(f){f.preventDefault();d.set("team/calendar_info_warn_block_hide",1);e.remove()})};return CalendarPage}(jQuery),TeamCalendar=function(c){function a(e){var b=[];e.each(function(){var d=[];c(this).find(".t-day-ornament").each(function(){d.push(c(this))});
b.push(d)});return b}TeamCalendar=function(e){this.$wrapper=e.$wrapper;this.$rows=this.$wrapper.find(".t-week-row");this.days_count=7;this.weeks_count=this.$rows.length;this.selected_class="is-selected";this.active_class="is-active";this.locales=e.locales;this.is_profile=e.is_profile;this.event_view_uri="?module=schedule&action=eventView";this.event_edit_uri="?module=schedule&action=eventEdit";this.day_uri="?module=schedule&action=day";this.user_id=e.user_id;this.has_right_to_change=e.has_right_to_change;
this.selected_user_id=e.selected_user_id;this.selected_calendar_id=e.selected_calendar_id;this.period_start=e.period_start;this.period_end=e.period_end;this.daysArray=a(this.$rows);this.wrapper_o=this.$wrapper.offset();this.wrapper_w=this.$wrapper.width();this.wrapper_h=this.$wrapper.height();this.day_h=this.day_w=0;this.dialogs=[];this.end=this.start=this.xhr=!1;this.$selectedDays=[];this.is_locked=!1;this.bindEvents();this.initHoverOnDay();this.initMove()};TeamCalendar.prototype.bindEvents=function(){function e(h){c.contains(document,
f.$wrapper[0])?27===h.keyCode&&f.deselectDays():c(document).off("keydown",e)}function b(h){f.is_locked||(f.is_locked=!0,f.onMouseMove(h),setTimeout(function(){f.is_locked=!1},10));return!1}function d(){f.onMouseUp();f.$wrapper.off("mousemove",b);g.off("mouseup",d);return!1}var f=this,g=c(document);f.has_right_to_change&&(f.$wrapper.find(".show-full-days-events, .t-event-wrapper").on("mousedown",function(h){h.stopPropagation();f.clearSelection()}),g.on("mousedown",function(){f.clearSelection()}),f.$wrapper.on("mousedown",
function(h){h.stopPropagation();f.closeDialogs()||(f.onMouseDown(h),f.$wrapper.on("mousemove",b),g.on("mouseup",d));return!1}));f.$wrapper.on("click",".show-full-days-events",function(h){h.preventDefault();f.closeDialogs()||f.showFullDayEvents(c(this))});f.$wrapper.on("click",".t-event-block.js-view-event",function(h){h.preventDefault();f.closeDialogs()||f.showEventDetails(c(this).closest(".t-event-wrapper"))});c(document).on("keydown",e)};TeamCalendar.prototype.showFullDayEvents=function(e){var b=
this,d=e.data("events-id").toString().split(",");e={date:e.data("date"),id:d};b.is_profile&&(e.selected_user_id=b.selected_user_id);b.xhr&&(b.xhr.abort(),b.xhr=!1);b.xhr=c.post(b.day_uri,e,function(f){f=c.waDialog({html:f,animate:!1,onBgClick:function(g,h,m){m.close()}});b.addDialog(f)})};TeamCalendar.prototype.showEventDetails=function(e){var b=this;e={"data[id]":e.data("id")};b.xhr&&(b.xhr.abort(),b.xhr=!1);b.xhr=c.post(b.event_view_uri,e,function(d){d=c.waDialog({html:d});b.addDialog(d)})};TeamCalendar.prototype.createEvent=
function(){var e=this,b=e.daysArray[e.end.week-1][e.end.day-1],d=e.daysArray[e.start.week-1][e.start.day-1].data("date");b=b.data("date");var f={"data[start]":!1,"data[end]":!1,"data[contact_id]":e.selected_user_id||e.user_id},g=(new Date).getHours();f["data[start]"]=d.replace("00:00:00",23<=g?"23:59:59":g+1+":00:00");f["data[end]"]=b.replace("00:00:00",22<=g?"23:59:59":g+2+":00:00");e.selected_calendar_id&&(f["data[calendar_id]"]=e.selected_calendar_id);e.xhr&&(e.xhr.abort(),e.xhr=!1);e.xhr=c.post(e.event_edit_uri,
f,function(h){h=c.waDialog({html:h});e.addDialog(h)})};TeamCalendar.prototype.onMouseDown=function(e){this.end=this.start=this.getDayPosition(e);this.markDays()};TeamCalendar.prototype.onMouseMove=function(e){e=this.getDayPosition(e);this.end&&this.end.week==e.week&&this.end.day==e.day||(this.end=e,this.markDays())};TeamCalendar.prototype.initHoverOnDay=function(e){function b(){f&&f.removeClass("is-highlighted");f=!1}var d=this,f=!1;d.$wrapper.on("mousemove",function(g){var h=d.getDayPosition(g),
m=d.daysArray,n=!1;m[h.week-1]&&m[h.week-1][h.day-1]&&(n=m[h.week-1][h.day-1]);h=n;g=c(g.target);if(g.hasClass("t-event-block")||g.closest(".t-event-block").length||d.start||!h)return b(),!1;if(h.hasClass("is-highlighted"))return!1;f&&b();h.addClass("is-highlighted");f=h}).on("mouseleave",function(){b()})};TeamCalendar.prototype.onMouseUp=function(){if(this.start.week>this.end.week||this.start.week==this.end.week&&this.start.day>this.end.day){var e={week:this.start.week,day:this.start.day};this.start=
{week:this.end.week,day:this.end.day};this.end=e}this.createEvent();this.end=this.start=!1};TeamCalendar.prototype.initMove=function(){function e(n){n=d.getDayPosition(n);var l=d.daysArray[n.week-1][n.day-1];if(!l)return console&&console.log&&console.log("error: date is not exist"),!1;n=c.team.app_url+"?module=schedule&action=eventMove";l={id:parseInt(g.data("id")),start:l.data("date").replace(" 00:00:00","")};m&&m.abort();m=c.post(n,l,function(p){"ok"==p.status&&d.reload()},"json")}function b(n){var l=
f.offset(),p=[l.left,l.left+f.outerWidth()];l=[l.top,l.top+f.outerHeight()];d.clearSelection();if(n.pageX<=p[0]||n.pageX>=p[1]||n.pageY<=l[0]||n.pageY>=l[1])return!1;p=parseInt(g.data("day-count")||g.closest(".t-column").attr("colspan"));d.start=d.getDayPosition(n);n=d.daysArray;var t=d.start;l={week:t.week,day:t.day};t=7-t.day;--p;p<=t?l.day+=p:(l.week+=1,l.day=p-t,l.week>n.length&&(l={week:n.length,day:7}));d.end=l;d.markDays()}var d=this,f=d.$wrapper,g=!1,h=!1,m;f.find(".js-move-event").draggable({helper:"clone",
appendTo:"body",cursor:"move",zIndex:1100,cursorAt:{top:11,left:16},start:function(n,l){n=c(n.target);l=l.helper;g=n;var p=parseInt(g.closest(".t-column").attr("colspan")),t=n.data("move-hint")||!1;t&&l.find(".t-event-block").append("<span class='t-day-count'>("+t+")</span>");l.addClass("is-clone").css({minWidth:parseInt(n.width()/p)+"px",height:n.height()+"px"})},drag:function(n,l){h||(h=!0,setTimeout(function(){h=!1},100),b(n))},stop:function(n,l){d.clearSelection();g=!1}});f.droppable({drop:function(n){e(n)}})};
TeamCalendar.prototype.markDays=function(){this.deselectDays();var e=c.extend({},this.start),b=c.extend({},this.end);e.week>b.week&&(e=c.extend({},this.end),b=c.extend({},this.start));for(var d=e.week,f=b.week,g=d;g<=f;g++){if(d==f){var h=e.day;var m=b.day;h>m&&(h=b.day,m=e.day)}else g==d?(h=e.day,m=this.days_count):g==f?(h=1,m=b.day):(h=1,m=this.days_count);for(;h<=m;h++)if(0<g&&0<h){var n=this.daysArray[g-1][h-1];n.length?(n.addClass(this.selected_class),this.$selectedDays.push(n)):console.log("Error: Day isn't exist")}}};
TeamCalendar.prototype.getDayPosition=function(e){this.wrapper_o=this.$wrapper.offset();this.wrapper_w=this.$wrapper.width();this.wrapper_h=this.$wrapper.height();this.day_w=this.wrapper_w/this.days_count;this.day_h=this.wrapper_h/this.weeks_count;var b=e.pageY-this.wrapper_o.top;e=e.pageX-this.wrapper_o.left;b=parseInt(b/this.day_h)+(0<b%this.day_h?1:0);e=parseInt(e/this.day_w)+(0<e%this.day_w?1:0);return{week:b,day:e}};TeamCalendar.prototype.deselectDays=function(){var e=this;e.$selectedDays.length&&
(c.each(e.$selectedDays,function(){c(this).removeClass(e.selected_class)}),e.$selectedDays=[])};TeamCalendar.prototype.clearSelection=function(){this.deselectDays();this.end=this.start=!1};TeamCalendar.prototype.reload=function(){var e=this,b={};e.closeDialogs();e.selected_user_id&&(b.user=e.selected_user_id);e.selected_calendar_id&&(b.calendar=e.selected_calendar_id);e.period_start&&(b.start=e.period_start);e.period_end&&(b.end=e.period_end);e.is_profile&&(b.period=1);c.get("?module=schedule&action=inc",
b,function(d){c.team.calendar=!1;e.$wrapper.closest(".t-calendar-wrapper").replaceWith(d);c.team.profile.$calendar_wrapper=c(d)})};TeamCalendar.prototype.addDialog=function(e){this.dialogs.push(e)};TeamCalendar.prototype.closeDialogs=function(){var e=!1;this.dialogs.length&&(c.each(this.dialogs,function(b,d){c.contains(document,d.$wrapper[0])&&(d.close(),e=!0)}),this.dialogs=[]);c("#ui-datepicker-div").length&&c(document).trigger("mousedown");return e};return TeamCalendar}(jQuery),DayEventsDialog=
function(c){DayEventsDialog=function(a){this.$wrapper=a.$wrapper;this.event_view_uri="?module=schedule&action=eventView";this.xhr=this.dialog=!1;this.initClass()};DayEventsDialog.prototype.initClass=function(){var a=this;a.$wrapper.on("click",".t-event-block.js-view-event",function(e){e.preventDefault();a.showEventDetails(c(this).closest(".t-event-wrapper"))})};DayEventsDialog.prototype.showEventDetails=function(a){var e=this;a={"data[id]":a.data("id")};e.xhr&&(e.xhr.abort(),e.xhr=!1);e.xhr=c.post(e.event_view_uri,
a,function(b){e.dialog=c.waDialog({html:b})})};return DayEventsDialog}(jQuery),EventEditDialog=function(c){EventEditDialog=function(a){this.$wrapper=a.$wrapper;this.$form=this.$wrapper.find("form");this.$statusToggle=this.$wrapper.find(".t-status-toggle");this.$calendarToggle=this.$wrapper.find(".js-calendar-dropdown");this.$typeToggle=this.$wrapper.find(".t-type-toggle");this.$userToggle=this.$wrapper.find(".js-user-dropdown");this.$startAltField=this.$wrapper.find("input[name='data[start_alt]']");
this.$endAltField=this.$wrapper.find("input[name='data[end_alt]']");this.$summaryField=this.$form.find("input[name='data[summary]']");this.teamDialog=this.$wrapper.data("dialog");this.active_class="is-active";this.extended_class="is-extended";this.selected_class="selected";this.has_error_class="state-error";this.locales=a.locales;this.event_id=a.event_id;this.calendars=a.calendars;this.users=a.users;this.$activeStatusToggle=this.$statusToggle.find("."+this.active_class)||!1;this.is_status=a.is_status;
this.is_changed=this.is_locked=!1;this.user_id=a.user_id;this.calendar_id=a.calendar_id;this.summary=a.summary;this.summary_type=a.summary_type;this.end_date_locale=this.start_date_locale=!1;this.initClass()};EventEditDialog.prototype.initClass=function(){this.initDatePicker();this.initTimePicker();this.bindEvents();this.setStatusLocale();this.is_status&&this.generateStatusTypes()};EventEditDialog.prototype.bindEvents=function(){var a=this;a.$form.on("submit",function(e){e.preventDefault();a.is_locked||
a.save(a.$form);return!1});a.$form.on("click",".js-delete-event",function(e){e.preventDefault();a.is_locked||a.showDeleteConfirm()});a.$statusToggle.on("click",".t-toggle-button",function(){a.changeStatus(c(this));a.changeColors();return!1});a.$calendarToggle.on("click",".menu a",function(e){e.preventDefault();a.changeCalendar(c(this))});a.$startAltField.on("change",function(){a.setStatusLocale();a.generateStatusTypes()});a.$endAltField.on("change",function(){a.setStatusLocale();a.generateStatusTypes()});
a.$summaryField.on("change",function(){a.summary=c(this).val();a.summary_type="custom"});a.$form.on("change","input[name='data[status_summary]']",function(){a.summary=c(this).val();a.$summaryField.val(a.summary)});a.$form.on("change",'textarea[name="data[description]"]',function(){var e=c(this).val();a.$form.find('textarea[name="data[status_description]"]').val(e)});a.$form.on("change",'textarea[name="data[status_description]"]',function(){var e=c(this).val();a.$form.find('textarea[name="data[description]"]').val(e)});
a.$form.on("summaryChange",function(){a.$summaryField.val(a.summary)});if(a.$userToggle.length)a.$userToggle.on("click",".menu a",function(e){e.preventDefault();a.changeUser(c(this))});a.$form.on("change",".js-extended-date",function(){a.dateToggle(c(this));return!1});a.$form.find("input").on("mousedown",function(){var e=c(this);e.hasClass(a.has_error_class)&&e.removeClass(a.has_error_class).closest(".value").find(".state-error-hint").remove()});a.$form.on("click",".js-datepicker-trigger, .js-timepicker-trigger",
function(){c(this).parent().find("input").trigger("focus")})};EventEditDialog.prototype.initDatePicker=function(){this.$wrapper.find(".js-datepicker").each(function(){var a=c(this),e=a.closest(".t-date-wrapper").find("input[type='hidden']");a.datepicker({altField:e,altFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,shortYearCutoff:2,showOtherMonths:!0,selectOtherMonths:!0,stepMonths:2,numberOfMonths:2,beforeShow:function(b,d){d.dpDiv.on("click",function(f){f.stopPropagation()});setTimeout(function(){return d.dpDiv.css({"z-index":"1051"})});
c(b).on("click",function(f){var g=!1,h=c("#ui-datepicker-div");h.length&&"none"!=h.css("display")&&(g=h);g&&(f.stopPropagation(),c(document).trigger("mousedown"))})}})})};EventEditDialog.prototype.initTimePicker=function(){this.$wrapper.find(".js-timepicker").each(function(){var a=c(this),e=!1;a.timepicker();a.on("showTimepicker",function(){var b=a.data("timepicker-list");e||(b.on("click",function(f){f.stopPropagation()}),e=!0);var d=parseInt(a.offset().top)+parseInt(a.outerHeight())-parseInt(c(window).scrollTop());
b.css({position:"fixed",top:d})})})};EventEditDialog.prototype.showDeleteConfirm=function(){var a=this,e={id:a.event_id};a.is_locked=!0;a.xhr&&(a.xhr.abort(),a.xhr=!1);a.xhr=c.get("?module=schedule&action=eventDeleteConfirm",e,function(b){c.waDialog({html:b});a.is_locked=!1;a.close()})};EventEditDialog.prototype.changeColors=function(){var a=this.calendars[this.calendar_id];bg_color=a.bg_color;font_color=a.font_color;status_bg_color=a.status_bg_color;status_font_color=a.status_font_color;this.setCalendarSelectColors(a)};
EventEditDialog.prototype.changeStatus=function(a){if(!a.hasClass(this.active_class)){var e=a.data("status-id");this.$activeStatusToggle&&this.$activeStatusToggle.removeClass(this.active_class+" "+this.selected_class);a.addClass(this.active_class+" "+this.selected_class);this.$activeStatusToggle=a;this.$form.find('input[name="data[is_status]"]').val(e).trigger("change");(this.is_status=a=1==e)?(this.$wrapper.removeClass("is-event").addClass("is-status"),a=this.$form.find(".js-extended-date"),a.prop("checked")||
a.click()):this.$wrapper.removeClass("is-status").addClass("is-event");this.generateStatusTypes();this.teamDialog.resize()}};EventEditDialog.prototype.changeCalendar=function(a){var e=this,b=a.closest("li"),d=b.data("calendar-id");if(!b.hasClass(e.selected_class)&&!e.is_locked){e.is_locked=!0;b=function(){var h=e.calendars[d];bg_color=h.bg_color;font_color=h.font_color;status_bg_color=h.status_bg_color;status_font_color=h.status_font_color;return h}();var f=c.wa.encodeHTML(a.text()),g=a.find("svg").data();
a=g.prefix;g=g.icon;e.calendar_id=d;e.$calendarToggle.find("."+e.selected_class).removeClass(e.selected_class);e.setCalendarSelectColors(b);e.$calendarToggle.find(".t-selected-item").html('<i class="'+a+" fa-"+g+'"></i><span class="custom-ml-8">'+f+"</span>");e.$form.find('input[name="data[calendar_id]"]').val(d).trigger("change");e.$calendarToggle.find(".menu");setTimeout(function(){e.is_locked=!1},500);e.generateStatusTypes()}};EventEditDialog.prototype.setCalendarSelectColors=function(a){var e=
this;e.$calendarToggle.find(".t-selected-item").css({color:function(){return e.is_status?a.status_font_color?a.status_font_color:a.font_color:a.status_font_color?a.font_color:a.bg_color},"background-color":function(){return e.is_status?a.status_bg_color?a.status_bg_color:a.bg_color:a.status_bg_color?a.bg_color:"transparent"},"box-shadow":function(){return e.is_status?"none":a.status_bg_color?"none":"inset 0 0 0 1px currentColor"}})};EventEditDialog.prototype.changeUser=function(a){var e=this,b=a.closest("li"),
d=b.data("user-id");if(!b.hasClass(e.selected_class)&&!e.is_locked){e.is_locked=!0;b=a.data("user-photo-url");a=c.wa.encodeHTML(a.text());e.user_id=d;e.$userToggle.find("."+e.selected_class).removeClass(e.selected_class);e.$userToggle.find(".t-selected-item").html('\n                <img src="'+b+'" class="userpic userpic20">\n                <span class="custom-ml-8">'+a+"</span>");e.$form.find('input[name="data[contact_id]"]').val(d).trigger("change");var f=e.$userToggle.find(".menu");f.hide();
setTimeout(function(){f.removeAttr("style");e.is_locked=!1},200)}};EventEditDialog.prototype.save=function(a){var e=this;a=function(b){function d(n){var l=n.split("-");n=parseInt(l[0]);var p=parseInt(l[1]);l=parseInt(l[2]);return 0<n&&0<p&&0<l?new Date(n,p-1,l):!1}function f(n){e.$form.find(".state-error-hint").remove();c.each(n,function(l,p){l=e.$form.find("[name='"+p.field+"']");l.length&&(l.parent(".value").length?l.addClass(e.has_error_class).after('<span class="state-error-hint custom-mt-4">'+
e.locales[p.locale]+"</span>"):l.addClass(e.has_error_class).closest(".t-date-wrapper").append('<div class="state-error-hint custom-mt-4">'+e.locales[p.locale]+"</div>"))})}var g={},h=[];c.each(b,function(n,l){g[l.name]=l.value});g["data[summary_type]"]||(g["data[summary_type]"]="custom");if(b=e.is_status)g["data[description]"]=g["data[status_description]"]?g["data[status_description]"]:"",delete g["data[status_description]"],g["data[summary]"]=e.summary,delete g["data[status_summary]"];c.trim(g["data[summary]"]).length||
(b?h.push({field:"data[status_summary]",locale:"empty"}):h.push({field:"data[summary]",locale:"empty"}));g["data[start]"].match(/^(\d){4}-(\d){2}-(\d){2}$/)||h.push({field:"data[end]",locale:"date"});g["data[end]"].match(/^(\d){4}-(\d){2}-(\d){2}$/)||h.push({field:"data[end]",locale:"date"});b=d(g["data[start]"]);var m=d(g["data[end]"]);b>m&&(h.push({field:"data[start_alt]",locale:"period"}),h.push({field:"data[end_alt]",locale:"period"}));g["data[start_time]"]>g["data[end_time]"]&&(h.push({field:"data[start_time]",
locale:"period"}),h.push({field:"data[end_time]",locale:"period"}));if(h.length)return f(h),!1;g["data[start_time]"].length||(g["data[start_time]"]="00:00");g["data[end_time]"].length||(g["data[end_time]"]="00:00");g["data[start]"]=g["data[start]"]+" "+g["data[start_time]"];g["data[end]"]=g["data[end]"]+" "+g["data[end_time]"];g["data[is_allday]"]=g["data[is_allday]"]?1:0;delete g["data[start_time]"];delete g["data[end_time]"];delete g["data[start_alt]"];delete g["data[end_alt]"];return g}(a.serializeArray());
e.is_locked=!0;a?c.post("?module=schedule&action=eventSave",a,function(b){if("ok"==b.status)b.data&&b.data.message&&alert(b.data.message),e.reloadCalendar();else if(b.errors){var d=null;c.each(b.errors,function(f,g){"redirect"===g[0]&&(d=g[1])});d&&(location.href=d)}e.close();e.is_locked=!1},"json"):e.is_locked=!1};EventEditDialog.prototype.reloadCalendar=function(){c.team.calendar.reload()};EventEditDialog.prototype.dateToggle=function(a){this.$form.find(".t-date-wrapper").toggleClass(this.extended_class,
!a.prop("checked"))};EventEditDialog.prototype.generateStatusTypes=function(){var a=this,e=a.$typeToggle,b=function(){var d=e.find(".is-template li"),f=d.eq(0),g=d.eq(1);d=c("<ul></ul>");var h=a.calendars[a.calendar_id];if(h.default_status){var m=f.clone();m.find(".t-type").text(h.default_status);m.find("input:radio").val("default");d.append(m)}m=f.clone();m.find(".t-type").text(h.name);m.find("input:radio").val("calendar");d.append(m);m=f.clone();m.find(".t-type").text((h.default_status?h.default_status:
h.name)+" "+a.locales.till+" "+a.end_date_locale);m.find("input:radio").val("till");d.append(m);f=f.clone();f.find(".t-type").text((h.default_status?h.default_status:h.name)+" "+a.locales.from+" "+a.start_date_locale+" "+a.locales.till+" "+a.end_date_locale);f.find("input:radio").val("interval");d.append(f);f=g.clone();f.find("input:radio").val("custom");a.summary&&f.find("input:text").val(a.summary);d.append(f);e.find(".value").html("").append(d);return d}();(function(d){d.on("change","input:radio",
function(){var f=c(this),g=f.is(":checked"),h=f.closest("li").find(".t-type"),m=f.closest("li").find("input:text");if(g){if(h.length)a.summary=h.text();else if(m.length)a.summary=m.val();else return!1;a.summary_type=f.val();a.$form.trigger("summaryChange")}});d.on("focus set","input:text",function(){var f=c(this),g=f.closest("li").find("input:radio");g.is(":checked")||g.prop("checked",!0).trigger("change");f.hasClass(a.has_error_class)&&f.removeClass(a.has_error_class).closest(".value").find(".state-error-hint").parent().remove()});
d.on("focus change keyup","input:text",function(){var f=c(this),g=f.val();a.summary=c("<div />").html(f.val()).text();g.length&&(a.summary_type="custom",a.summary=g)})})(b);(function(d){!a.summary_type&&a.summary&&(a.summary_type="custom");if(a.summary_type){var f=d.find("input:radio[value='"+a.summary_type+"']");f.length?(f.click(),"custom"!==a.summary_type&&d.find("input:text").val("")):"default"==a.summary_type?d.find("input[value='calendar']").click():d.find("input:text").val(a.summary?a.summary:
"").trigger("change")}else d.find("input:radio:first").click()})(b)};EventEditDialog.prototype.setStatusLocale=function(){function a(f){var g=f.val().split(" ")[0].split("-");f=parseInt(g[2]);var h=parseInt(g[1]);g=parseInt(g[0]);var m=(new Date).getFullYear(),n=e.locales.status_type.months[h];f=c.datepicker.formatDate(e.locales.status_type.format,new Date(g,h-1,f));f=f.replace("f",n);m==g&&(f=f.replace(", "+g,"").replace(" "+g,"").replace(g+" ",""));return f}var e=this,b=e.$wrapper.find("input[name='data[start]']"),
d=e.$wrapper.find("input[name='data[end]']");e.start_date_locale=a(b);e.end_date_locale=a(d)};EventEditDialog.prototype.close=function(){this.teamDialog.close()};return EventEditDialog}(jQuery),EventViewDialog=function(c){EventViewDialog=function(a){this.$dialogWrapper=a.$wrapper;this.$wrapper=this.$dialogWrapper.find(".dialog-body");this.event_id=a.event_id;this.event_edit_uri="?module=schedule&action=eventEdit";this.xhr=!1;this.initClass()};EventViewDialog.prototype.initClass=function(){var a=this;
a.$wrapper.on("click",".js-edit-event",function(e){e.preventDefault();a.showEditForm()})};EventViewDialog.prototype.showEditForm=function(){var a=this,e={"data[id]":a.event_id};a.xhr&&(a.xhr.abort(),a.xhr=!1);a.xhr=c.post(a.event_edit_uri,e,function(b){a.$wrapper.offset();var d=c.team.calendar;a.close();b=c.waDialog({html:b});d.addDialog(b)})};EventViewDialog.prototype.close=function(){this.$dialogWrapper.data("dialog").close()};return EventViewDialog}(jQuery),EventDeleteDialog=function(c){EventDeleteDialog=
function(a){this.$wrapper=a.$wrapper;this.$block=this.$wrapper.find(".dialog-body");this.event_id=a.event_id;this.is_locked=!1;this.initClass()};EventDeleteDialog.prototype.initClass=function(){var a=this;a.$block.on("click",".js-delete-event",function(e){e.preventDefault();if(!a.is_locked)a["delete"]()})};EventDeleteDialog.prototype["delete"]=function(){var a=this,e={id:a.event_id};a.is_locked=!0;c.post("?module=schedule&action=eventDelete",e,function(b){"ok"==b.status&&(b.data&&b.data.message&&
alert(b.data.message),a.$wrapper.data("dialog").close(),c.team.calendar.reload())})};return EventDeleteDialog}(jQuery);var Profile=function(c){Profile=function(a){this.$wrapper=a.$wrapper;this.$tabs=this.$wrapper.find(".t-profile-tabs");this.$tabContentPlace=this.$wrapper.find(".t-dynamic-content");this.$calendarPlace=this.$wrapper.find(".t-calendar-place");this.$profile_header_links=this.$wrapper.find(".t-profile-actions-btn");this.$profile_sidebar=this.$wrapper.find(".t-profile-sidebar");this.api_enabled=window.history&&window.history.pushState;this.user=a.user||{id:0};this.photo_dialog_url=a.photo_dialog_url;this.is_own_profile=
a.is_own_profile||!1;this.wa_app_url=a.wa_app_url||"";this.wa_backend_url=a.wa_backend_url||"";this.wa_url=a.wa_url||"";this.wa_version=a.wa_version||"";this.webasyst_id_auth_url=a.webasyst_id_auth_url||"";this.xhr=this.is_locked=!1;this.dialogs=[];this.sidebar_drawer=this.$calendar_date_filter=this.$calendar_wrapper=null;this.sidebarDialog={};this.initClass();this.initEditor(a.editor||{})};Profile.prototype.initEditor=function(a){if(!(c.isEmptyObject(a)||c.isEmptyObject(a.options)||c.isEmptyObject(a.data))){var e=
this;c.storage=new c.store;c.each(a.options||{},function(d,f){c.wa.contactEditor[d]=f});c.wa.contactEditor.wa_app_url=e.is_own_profile?e.wa_backend_url:e.wa_app_url;c.wa.contactEditor.wa_backend_url=e.wa_backend_url;c.wa.contactEditor.initFactories(a.data.contactFields,a.data.contactFieldsOrder);c.wa.contactEditor.resetFieldEditors();c.wa.contactEditor.initFieldEditors(a.data.fieldValues);c.wa.contactEditor.initContactInfoBlock("view");!e.is_own_profile&&a.data.fieldValues.timezone||c.wa.determineTimezone(e.wa_url);
var b='<div class="dialog t-edit-profile">\n            <div class="dialog-background"></div>\n            <div class="dialog-body" style="width: 800px;">\n            <h3 class="dialog-header">'+$_("Contact info")+'</h3>\n                <div class="dialog-content fields"></div>\n                <div class="dialog-footer"></div>\n            </div>\n        </div>';e.$profile_header_links.on("click",".edit-link",function(){c(".js-user-info");var d;e.contactsDialog?e.contactsDialog.show():e.contactsDialog=
c.waDialog({html:b,onOpen:function(f,g){c.wa.contactEditor.dialogInstance(g);c.wa.contactEditor.switchMode("edit");d=c("#contact-info-block");g.$content.append(d);g.resize();c(c.wa.contactEditor).on("contact_saved",function(){g.hide()})},onClose:function(f){f.hide();return!1}})})}};Profile.prototype.initClass=function(){var a=this;a.bindEvents();c.team&&c.team.sidebar&&c.team.sidebar.selectLink(!1);new ProfileWebasystID({is_own_profile:a.is_own_profile,user:a.user,backend_url:a.wa_backend_url,wa_url:a.wa_url,
wa_version:a.wa_version,webasyst_id_auth_url:a.webasyst_id_auth_url,ui:"2.0"});c(document).on("wa_before_load",function(){a.sidebar_drawer=null;a.showSidebarDrawer(!0)});a.showSidebarDrawer(!0)};Profile.prototype.bindEvents=function(){var a=this;a.$tabs.on("click",".t-tab a",function(){a.changeTab(c(this));return!1});a.$calendarPlace.on("click",".js-calendar-toggle",function(e){e.preventDefault();a.calendarToggle(c(this))});a.$wrapper.find(".js-sidebar-calendar").on("click",".js-show-outer-calendar-manager",
function(e){e.stopPropagation();a.showOuterDialogDialog()});c(document).on("click",".t-profile-drawer .js-show-outer-calendar-manager",function(e){e.stopPropagation();a.showOuterDialogDialog()});a.$wrapper.on("photo_updated photo_deleted",function(e,b){a.$wrapper.find(".t-userpic").attr("src",b.url)});a.$wrapper.find(".js-change-photo").on("click",function(){var e=c("#contact-photo-crop-dialog");e.length||(e=c('<div class="dialog" id="contact-photo-crop-dialog"/>'),c("body").append(e));e.load(a.photo_dialog_url,
function(){c.waDialog({$wrapper:e})})});a.$profile_header_links.on("click",".access-link",function(){var e=c(this)[0].dataset;e.userId=a.user.id;if(a.accessDialog)a.accessDialog.show();else{var b,d,f='\n                <div class="dialog t-sidebar-profile-dialog">\n                    <div class="dialog-background"></div>\n                    <div class="dialog-body flexbox vertical" '+(e.dialogWidth?' style="width:'+(null==(b=e.dialogWidth)?void 0:b.replace(/(<([^>]+)>)/gi,""))+'"':"")+'>\n                        <h3 class="dialog-header">'+
((null==(d=e.dialogHeader)?void 0:d.replace(/(<([^>]+)>)/gi,""))||"")+'</h3>\n                        <div class="dialog-content wide"></div>\n                        <div class="dialog-footer custom-mt-auto">\n                            <button type="button" class="button light-gray js-close-dialog">'+$_("Close")+"</button>\n                        </div>\n                    </div>\n                </div>\n            ";a.accessDialog=c.waDialog({html:f,onOpen:function(g,h){h.$content.empty().append('<div class="align-center"><span class="spinner custom-p-16"></span></div>');
c.post("?module=profile&action=sidebarDialog",e,function(m){h.$content.empty().html(m);a.$wrapper.trigger("dialog_opened",h)})},onClose:function(g){g.hide();c.team.content.reload();return!1}})}});a.$profile_header_links.on("click",".delete-link",function(){var e=c(this);c(document).on("wa_confirm_contact_delete_dialog",function(){e.find('[data-icon="trash-alt"]').removeClass("hidden");e.find('[data-icon="spinner"]').addClass("hidden")});e.find("svg").toggleClass("hidden");c.team.confirmContactDelete([a.user.id])});
c(".js-edit-groups").on("click",function(){a.showSidebarDialog(c(".access-link").data())});a.$wrapper.find(".js-profile-user-slider").one("click touchstart",function(){c(this).animate({height:"375px"},function(){c(this).removeClass("cursor-pointer")})});a.$wrapper.find(".js-toggle-user-info").on("click",function(e){e.preventDefault();c(this).find("svg").toggleClass("fa-caret-down fa-caret-up");a.$wrapper.find(".js-user-info").toggleClass("hidden")});a.$profile_sidebar.on("click",".js-sidebar-profile-dialog",
function(e){e.preventDefault();e=this.dataset;void 0===e.sectionId&&(e=this.closest("[data-section]").querySelector(".js-sidebar-profile-dialog").dataset);a.showSidebarDialog(e)});c(document).one("click",".t-profile-drawer .js-sidebar-profile-dialog",function(e){e.preventDefault();e=this.dataset;void 0===e.sectionId&&(e=this.closest("[data-section]").querySelector(".js-sidebar-profile-dialog").dataset);a.showSidebarDialog(e)});a.$wrapper.find(".js-show-drawer").on("click",function(e){e.preventDefault();
a.showSidebarDrawer()})};Profile.prototype.switchToTab=function(a,e){function b(){var m=d.children().filter(function(){return a==c(this).data("tab-id")}).first();try{m[0].contentWindow&&e(m)&&(setTimeout(function(){g.resolve(m)},0),f.off("tab_content_updated",b),h&&clearInterval(h),h=null)}catch(n){}}var d=this.$wrapper.find(".t-profile-tabs-iframes"),f=this.$wrapper.find('.t-tab a[data-tab-id="'+a+'"]'),g=c.Deferred();f.on("tab_content_updated",b);var h=setInterval(b,100);f.closest(".t-tab").hasClass("is-selected")?
b():f.click();f.length&&c("html, body").animate({scrollTop:f.offset().top},500);return g.promise()};Profile.prototype.changeTab=function(a){if(this.api_enabled){a=a.data("tab-id");var e=window.location.href.match(/^.*\/(id|u)\/[^\/]+/);e&&a&&(a=e[0]+"/"+a+"/",history.replaceState({reload:!0,content_uri:a},"",a))}};Profile.prototype.calendarToggle=function(a){var e=a.find(".t-calendar-toggle .text");this.$calendarPlace.hasClass("is-short")?(e.text(a.data("hide-text")),this.$calendarPlace.removeClass("is-short")):
(e.text(a.data("show-text")),this.$calendarPlace.addClass("is-short"))};Profile.prototype.showOuterDialogDialog=function(){function a(){c.post(b,d,function(f){c.waDialog({html:f})}).always(function(){e.is_locked=!1})}var e=this,b="?module=schedule&action=settings",d={};0<e.user.id&&(b+="&id="+e.user.id);e.is_locked||(e.is_locked=!0,a())};Profile.prototype.showSidebarDialog=function(a){var e=this,b=c(".js-profile-sidebar-body"),d=!1;a.userId=e.user.id;if(e.sidebarDialog[a.sectionId])e.sidebarDialog[a.sectionId].show();
else{a.sectionId&&a.userId||(d=!0);var f="";"calendar"===a.sectionId&&(f='<a href="'+e.wa_app_url+'calendar/">\n                                    <span>'+a.dialogTeamCalendar+'</span> \n                                    <i class="fas fa-external-link-alt fa-xs"></i>\n                                </a>');var g,h;d='\n            <div class="dialog t-sidebar-profile-dialog">\n                <div class="dialog-background"></div>\n                <div class="dialog-body flexbox vertical" '+(a.dialogWidth?
' style="width:'+(null==(g=a.dialogWidth)?void 0:g.replace(/(<([^>]+)>)/gi,""))+'"':"")+'>\n                    <div class="dialog-header flexbox"><h3>'+((null==(h=a.dialogHeader)?void 0:h.replace(/(<([^>]+)>)/gi,""))||"")+'</h3></div>\n                    <div class="dialog-content wide"></div>\n                    <div class="dialog-footer custom-mt-auto">\n                        <button type="button" class="button light-gray js-close-dialog">'+(d?"Ok":$_("Close"))+"</button>\n                        "+
f+"\n                    </div>\n                </div>\n            </div>\n        ";e.sidebarDialog[a.sectionId]=c.waDialog({html:d,onOpen:function(m,n){n.$content.empty().append('<div class="align-center"><span class="spinner custom-p-16"></span></div>');if("calendar"===a.sectionId)e.$calendar_wrapper||(e.$calendar_wrapper=b.find(".js-calendar-html > .t-calendar-wrapper").detach()),n.$content.empty().append(e.$calendar_wrapper),n.resize();else if(""===a.url){var l=c(".js-tab-content-"+a.sectionId).html();
n.$content.empty().html(l);n.resize();e.$wrapper.trigger("dialog_opened",n)}else c.post("?module=profile&action=sidebarDialog",a,function(p){n.$content.empty().html(p);e.$wrapper.trigger("dialog_opened",n);p=m.find(".t-profile-section-iframe");p.length&&p.data("dialog",n)})},onClose:function(m){m.hide();"calendar"===a.sectionId&&c.team.content.reload();return!1}})}};Profile.prototype.showSidebarDrawer=function(a){a=void 0===a?!1:a;var e=this;e.sidebar_drawer?(a=e.sidebar_drawer.$wrapper[0].style,
a.removeProperty("z-index"),a.removeProperty("opacity"),e.sidebar_drawer.show()):(e.sidebar_drawer=c.waDrawer({$wrapper:c(".js-profile-sidebar-drawer"),lock_body_scroll:!a,onClose:function(){this.hide();return!1}}),a&&setTimeout(function(){e.sidebar_drawer.close()},100))};Profile.initSidebarWidgetAccess=function(a){var e=a.$wrapper,b=a.wa_backend_url,d=a.user_id,f=a.loc,g=e.find(".js-waid"),h=g.find(".js-sent-email-ok"),m=!1;g.on("click",".js-send-email-invitation",function(n){n.preventDefault();
var l=c(this),p=g.find(".js-loading");m||(p.show(),m=!0,c.post(b+"?module=settings&action=waIDInviteUser",{id:d}).done(function(t){var v=t.errors;t=t.data;v?c.waDialog.alert({title:f.error,text:v,button_title:f.ok}):t&&(l.addClass("hidden").find(".js-text").text(f.email_again).end().find(".js-last-send-datetime").text(t.sent),h.removeClass("hidden"),setTimeout(function(){l.removeClass("hidden");h.addClass("hidden")},1500))}).always(function(){m=!1;p.hide()}))});e.on("click",".js-connect-by-numeric-code",
function(n){var l=c(this).find(".js-loading");m||(l.show(),m=!0,n=[],n.push(c.post(b+"?module=settings&action=waIDInviteUserByCode",{id:d}).then(function(p){var t=p.errors;p=p.data;return t?(new c.Deferred).reject(t).promise():p},function(p,t,v){return t+" "+v})),n.push(c.post("?module=profile&action=waidConnectCodeDialog",{id:d}).then(function(p){return p},function(p,t,v){return(new c.Deferred).reject(t+": "+v).promise()})),c.when.apply(c,n).then(function(p,t){c.waDialog({html:t,onOpen:function(v,
x){v.trigger("dialog_opened",[p,x])}})},function(p){c.waDialog.alert({title:f.error,text:p,button_title:f.ok})}).always(function(){m=!1;l.hide()}))});e.on("click",".js-connect-by-qr-code",function(n){n=c(this);var l=n.find(".js-loading"),p=n.find(".js-code-icon");m||(l.show(),p.hide(),m=!0,n=[],n.push(c.post(b+"?module=settings&action=waIDInviteUserByCode",{id:d,qrcode:1}).then(function(t){var v=t.errors;t=t.data;return v?(new c.Deferred).reject(v).promise():t},function(t,v,x){return v+" "+x})),n.push(c.post("?module=profile&action=waidConnectQrcodeDialog",
{id:d}).then(function(t){return t},function(t,v,x){return(new c.Deferred).reject(v+": "+x).promise()})),n.push(c.getScript(a.wa_url+"wa-content/js/qrcode/qrcode.min.js")),c.when.apply(c,n).then(function(t,v){c.waDialog({html:v,onOpen:function(x,y){x.trigger("dialog_opened",[t,y])}})},function(t){c.waDialog.alert({title:f.error,text:t,button_title:f.ok})}).always(function(){m=!1;l.hide();p.show()}))})};return Profile}(jQuery),ActivityLazyLoading=function(c){ActivityLazyLoading=function(a){this.list_name=
a.names.list;this.items_name=a.names.items;this.pagind_name=a.names.paging;this.user_id=a.user_id;this.$wrapper=a.$wrapper||!1;this.$list=this.$wrapper.find(this.list_name);this.$window=c(window);this.onLoad=a.onLoad||function(){};this.$paging=this.$wrapper.find(this.pagind_name);this.is_locked=this.xhr=!1;this.addWatcher()};ActivityLazyLoading.prototype.addWatcher=function(){function a(){var d=window&&c.contains(document,e.$paging[0]);d&&b&&window.frameElement&&(d=c.contains(b.document,window.frameElement));
if(d)try{e.onScroll()}catch(f){d=!1}d||(e.$window.off("scroll",a),c(b).off("scroll",a))}var e=this,b=window.parent;e.$window.on("scroll",a);if(b&&window.frameElement)c(b).on("scroll",a)};ActivityLazyLoading.prototype.onScroll=function(){var a=this.$window,e=a.scrollTop();a=a.height();var b=this.$paging.offset().top;if(window.parent&&window.frameElement){var d=c(window.parent);a=d.height();e+=d.scrollTop();b+=c(window.frameElement).offset().top}e+a>=b&&!this.is_locked&&(this.is_locked=!0,this.loadNextPage())};
ActivityLazyLoading.prototype.loadNextPage=function(){var a=this,e=c.team.app_url+"?module=profile&action=activity",b={max_id:a.$paging.data("max-id"),id:a.user_id,timestamp:a.$list.find(a.items_name).last().data("timestamp")};a.xhr&&(a.xhr.abort(),a.xhr=!1);a.xhr=c.get(e,b,function(d){var f=c(d);d=f.find(a.list_name+" "+a.items_name);f=f.find(a.pagind_name);a.$list.append(d);a.$paging.after(f);a.$paging.remove();a.$paging=f;a.is_locked=!1;a.onLoad()})};return ActivityLazyLoading}(jQuery),OutsideCalendarsDialog=
function(c){OutsideCalendarsDialog=function(a){this.$dialogWrapper=a.$wrapper;this.$form=this.$wrapper=this.$dialogWrapper.find(".dialog-body");this.dialog=this.$dialogWrapper.data("dialog");this.xhr=this.is_locked=!1;this.initClass()};OutsideCalendarsDialog.prototype.initClass=function(){this.bindEvents()};OutsideCalendarsDialog.prototype.bindEvents=function(){var a=this;a.$wrapper.on("click",".t-external-calendar-unmount",function(){a.deleteExternalCalendar(c(this).data("id"))});a.$wrapper.find(".js-add-external-calendar").on("click",
function(e){e.preventDefault();a.dialog.close();(e=c(this).attr("href"))&&c.team.content.load(e)})};OutsideCalendarsDialog.prototype.deleteExternalCalendar=function(a){var e=this;c.get("?module=calendarExternal&action=DeleteConfirm",{id:a},function(b){c.waDialog({html:b,onOpen:function(d,f){d.on("afterDelete",function(){c.team.content.reload();e.dialog.close();f.close()})}})})};return OutsideCalendarsDialog}(jQuery);(function(c){c.wa.fieldTypesFactory=function(a,e){a=a||c.wa.contactEditorFactory();a.baseFieldType||(a.baseFieldType={contactType:"person",options:{},createEditor:function(b){this.contactType=b||"person";b=c.extend({},this);delete b.createEditor;delete b.initializeFactory;b.parentEditorData={};b.initialize();return b},fieldValue:"",initializeFactory:function(b,d){this.fieldData=b;this.options=d||{}},initialize:function(){this.setValue("")},reinit:function(){this.currentMode="null";this.initialize()},
setValue:function(b){this.fieldValue=b;"null"!=this.currentMode&&null!==this.domElement&&("edit"==this.currentMode?this.domElement.find(".val").val(this.fieldValue):this.domElement.find(".val").html(c.wa.encodeHTML(this.fieldValue)))},getValue:function(){var b=this.fieldValue;if("edit"==this.currentMode&&null!==this.domElement){var d=this.domElement.find(".val");0<d.length&&(b="",d.hasClass("empty")||"checkbox"==d.attr("type")&&!d.prop("checked")||(b=d.val()))}return b},isModified:function(){return this.fieldValue!=
this.getValue()},validate:function(b){var d=this.getValue();return b||!this.fieldData.required||d?null:$_("This field is required.")},newFieldElement:function(b){this.fieldData.read_only&&(b="view");var d=this.newInlineFieldElement(b);if(null===d&&(!this.fieldData.show_empty||"edit"==b))return c('<div style="display: none" class="field" data-field-id="'+this.fieldData.id+'"></div>');if("person"===this.contactType)if(0<=["firstname","middlename","lastname"].indexOf(this.fieldData.id)){var f="subname";
d.find(".val").attr("placeholder",this.fieldData.name).attr("title",this.fieldData.name).addClass("small width-100-mobile")}else"title"===this.fieldData.id?(f="subname title",d.find(".val").attr("placeholder",this.fieldData.name).attr("title",this.fieldData.name).addClass("small width-100-mobile")):"jobtitle"===this.fieldData.id?(f="jobtitle-company jobtitle",d.find(".val").addClass("small width-100-mobile")):"company"===this.fieldData.id&&(f="jobtitle-company company",d.find(".val").addClass("small width-100-mobile"));
else"company"===this.fieldData.id&&(f="company");return a.wrapper(d,this.fieldData.name+"",f).attr("data-field-id",this.fieldData.id)},newInlineFieldElement:function(b){if("view"==b&&!this.fieldValue)return null;var d=c.isPlainObject(this.fieldValue)?this.fieldValue.value:this.fieldValue;"edit"==b?(b=c('<span class="width-100-mobile custom-mr-0-mobile"><input class="val small width-100-mobile" type="text"></span>'),b.find(".val").val(d)):(b=c('<span class="val small"></span>'),b.text(d));return b},
showValidationErrors:function(b){if(null!==this.domElement){var d=this.domElement.find(".val");d.nextAll(".state-error-hint").remove();null!==b?(d.after(c('<p class="state-error-hint custom-mt-8">'+b+"</p>")),d.addClass("state-error")):d.removeClass("state-error");a.dialog.resize()}},fieldData:null,domElement:null,currentMode:"null",parentEditor:null,parentEditorData:null,setMode:function(b,d){"undefined"==typeof d&&(d=!0);if("view"!=b&&"edit"!=b)throw Error("Unknown mode: "+b);this.currentMode!=
b&&(this.currentMode=b,d&&(d=this.domElement,this.domElement=this.newFieldElement(b),null!==d&&d.replaceWith(this.domElement)));return this.domElement}});a.factoryTypes.Hidden=c.extend({},a.baseFieldType,{newFieldElement:function(b){b=this.newInlineFieldElement(b);return a.wrapper(b,this.fieldData.name).attr("data-field-id",this.fieldData.id).hide()},newInlineFieldElement:function(b){if("view"==b&&!this.fieldValue)return null;var d=null;"edit"==b&&(d=c('<span><input type="hidden" class="val" type="text"></span>'),
d.find(".val").val(this.fieldValue));return d}});a.factoryTypes.String=c.extend({},a.baseFieldType,{setValue:function(b){this.fieldValue=b;"null"!=this.currentMode&&null!==this.domElement&&("edit"==this.currentMode?this.domElement.find(".val").val(this.fieldValue):this.domElement.find(".val").html(c.wa.encodeHTML(this.fieldValue)))},getValue:function(){var b=this.fieldValue;if("edit"==this.currentMode&&null!==this.domElement){var d=this.domElement.find(".val");b="";d.hasClass("empty")||(b=d.val())}return b},
newInlineFieldElement:function(b){if("view"==b&&!this.fieldValue)return null;var d=this.fieldValue;"edit"==b?(b=1>=this.fieldData.input_height?c('<span><input class="val small" type="text"><i class="fas fa-spinner fa-spin loading wa-animation-spin speed-1000" style="display:none;"></i></span>'):c('<span><textarea class="val small width-100" rows="'+this.fieldData.input_height+'"></textarea></span>'),b.find(".val").val(d)):1>=this.fieldData.input_height?b=c('<span class="val small"></span><i class="fas fa-spinner fa-spin loading wa-animation-spin speed-1000" style="display:none;">').text(d):
(d=c.wa.encodeHTML(d||"").replace(/\n/g,"<br>"),b=c('<span class="val small"></span><i class="fas fa-spinner fa-spin loading wa-animation-spin speed-1000" style="display:none;">').html(d));return b},setMode:function(b,d){"undefined"==typeof d&&(d=!0);if("view"!=b&&"edit"!=b)throw Error("Unknown mode: "+b);this.currentMode!=b&&(this.currentMode=b,d&&(d=this.domElement,this.domElement=this.newFieldElement(b),null!==d&&d.replaceWith(this.domElement)));return this.domElement}});a.factoryTypes.Text=c.extend({},
a.factoryTypes.String);a.factoryTypes.Phone=c.extend({},a.baseFieldType);a.factoryTypes.Select=c.extend({},a.baseFieldType,{notSet:function(){return""},newInlineFieldElement:function(b){if("view"==b&&!this.fieldValue)return null;if("view"==b)return c('<span class="val small"></span>').text(this.fieldData.options[this.fieldValue]||this.fieldValue);b="";for(var d=!1,f,g=0;g<this.fieldData.oOrder.length;g++){var h=this.fieldData.oOrder[g];!d&&h==this.fieldValue&&this.fieldValue?(d=!0,f=" selected"):
f="";""===h&&(f+=" disabled");h=h||"";h="string"===typeof h?h:""+h;var m=c.wa.encodeHTML(h).replace('"',"&quot;");f='<option value="{$id}" {$attrs}>{$text}</option>'.replace("{$id}",m).replace("{$attrs}",f).replace("{$text}",c.wa.encodeHTML(this.fieldData.options[h]));b+=f}return c('<div class="wa-select small width-100-mobile"><select class="val '+(this.fieldData.type+"").toLowerCase()+'"><option value=""'+(d?"":" selected")+">"+this.notSet()+"</option>"+b+"</select></div>")}});a.factoryTypes.Conditional=
c.extend({},a.factoryTypes.Select,{unbindEventHandlers:function(){},getValue:function(){var b=this.fieldValue;if("edit"==this.currentMode&&null!==this.domElement){var d=this.domElement.find(".val:visible");0<d.length&&(b=d.hasClass("empty")?"":d.val())}return b},newInlineFieldElement:function(b){if("view"==b&&!this.fieldValue)return null;this.unbindEventHandlers();if("view"==b)return c("<div></div>").append(c('<span class="val"></span>').text(this.fieldData.options&&this.fieldData.options[this.fieldValue]||
this.fieldValue));var d=this;b=(d.fieldData.parent_field||"").split(":");for(var f=a.fieldEditors[b.shift()];f&&b.length;){var g=f.subfieldEditors;if(g instanceof Array){f=null;for(var h=0;h<g.length;h++)if(g[h]===d.parentEditor){f=g[h];break}}else f=g[b.shift()]}if(f){var m=this.fieldData.options&&this.fieldData.options[this.fieldValue]||this.fieldValue,n=c('<input type="text" class="hidden val">').val(m),l=c('<select class="hidden val"></select>').hide(),p=function(){var t=c(this),v=n.is(":visible")?
n.val():l.is(":visible")?l.val():m;t=(t.val()||"").toLowerCase();if(t=d.fieldData.parent_options[t]){n.hide();l.show().children().remove();for(h=0;h<t.length;h++)l.append(c("<option></option>").attr("value",t[h]).text(t[h]).attr("selected",d.fieldValue==t[h]));l.val(v)}else n.val(v||"").show().blur(),l.hide()};setTimeout(function(){if(f.domElement){f.domElement.on("change",".val",p);var t=f.domElement.find(".val:visible");t.length&&p.call(t.get(0))}else n.show()},0);d.unbindEventHandlers=function(){p&&
f.domElement&&f.domElement.find(".val").unbind("change",p);d.unbindEventHandlers=function(){}};return c("<div></div>").append(n).append(l)}return c("<div></div>").append(c('<input type="text" class="val small width-100-mobile">').val(d.fieldValue))}});a.factoryTypes.Timezone=c.extend({},a.factoryTypes.Select,{notSet:function(){return $_("Auto")}});a.factoryTypes.Region=c.extend({},a.factoryTypes.Select,{notSet:function(){return""},unbindEventHandlers:function(){},setCurrentCountry:function(){var b=
this.current_country;this.current_country=this.parentEditorData.parent.subfieldEditors.country.getValue();return b!==this.current_country?(delete this.fieldData.options,!0):!1},getRegionsControllerUrl:function(b){return a.getRegionsUrl()+b},newInlineFieldElement:function(b){if("view"==b&&!this.fieldValue)return null;this.unbindEventHandlers();var d=this.options||{};void 0!==d.country&&(this.current_country=d.country);if("view"==b)return c("<div></div>").append(c('<span class="val"></span>').text(this.fieldData.options&&
this.fieldData.options[this.fieldValue]||this.fieldValue));var f=this;if(this.parentEditorData.parent&&this.parentEditorData.parent.subfieldEditors.country){this.setCurrentCountry();var g;c(document).on("change","select.country",g=function(){if(f.setCurrentCountry()){var m="",n=f.domElement.find(".val");m=n.is("input")?n.val().trim():n.find(":selected").text().trim();var l=function(p,t){var v=t.toLocaleLowerCase();p.find("option").each(function(){if(c(this).text().trim().toLocaleLowerCase()===v)return c(this).attr("selected",
!0),!1})};f.domElement.empty().append(f.newInlineFieldElement(b).children());n=f.domElement.find(".val");n.is("input")&&!n.val()?n.val(m):n.is("select")&&m?l(n,m):f.domElement.unbind("load.fieldTypes").bind("load.fieldTypes",function(){var p=f.domElement.find(".val");p.is("select")&&m&&l(p,m)})}});f.unbindEventHandlers=function(){c(document).off("change","select.country",g);f.unbindEventHandlers=function(){}}}if(!d.no_ajax_select&&void 0===this.fieldData.options&&this.current_country&&this.fieldData.region_countries[this.current_country]){var h=
this.current_country;c.get(this.getRegionsControllerUrl(h),function(m){b===f.currentMode&&h===f.current_country&&(f.fieldData.options=m.data.options||!1,f.fieldData.oOrder=m.data.oOrder||[],c.isPlainObject(f.options)&&void 0!==f.options.country&&delete f.options.country,c("<div></div>").append(f.newInlineFieldElement(b).children()),f.domElement.empty().append(f.newInlineFieldElement(b).children()),f.domElement.trigger("load"))},"json");return c("<div></div>").append(c('<i class="icon16 loading"></i>'))}if(this.fieldData.options)return c("<div></div>").append(a.factoryTypes.Select.newInlineFieldElement.call(this,
b));d=c("<div></div>").append(a.baseFieldType.newInlineFieldElement.call(this,b));d.find(".val").attr("placeholder",this.fieldData.name+(this.fieldData.required?" ("+$_("required")+")":"")).addClass("small width-100-mobile");return d}});a.factoryTypes.Country=c.extend({},a.factoryTypes.Select);a.factoryTypes.Checklist=c.extend({},a.baseFieldType,{validate:function(b){return null},setValue:function(b){this.fieldValue=b;if("edit"==this.currentMode&&this.domElement){this.domElement.find('input[type="checkbox"]').attr("checked",
!1);for(var d in this.fieldValue)this.domElement.find('input[type="checkbox"][value="'+d+'"]').attr("checked",!0)}else"view"==this.currentMode&&this.domElement&&this.domElement.find(".val").html(this.getValueView())},getValue:function(){if("edit"!=this.currentMode||!this.domElement)return this.fieldValue;var b=[];this.domElement.find('input[type="checkbox"]:checked').each(function(d,f){b.push(c(f).val())});return b},getValueView:function(){for(var b="",d=0;d<this.fieldData.oOrder.length;d++){var f=
this.fieldData.oOrder[d];0>this.fieldValue.indexOf(f)||(b+=(b?", ":"")+'<a href="'+(this.fieldData.hrefPrefix||"#")+f+'">'+(this.fieldData.options[f]&&a.htmlentities(this.fieldData.options[f])||$_("&lt;no name&gt;"))+"</a>")}return b||$_("&lt;none&gt;")},newInlineFieldElement:function(b){if(!("view"!=b||this.fieldValue&&this.fieldValue.length))return null;if("view"==b)return c('<span class="val"></span>').html(this.getValueView());b=0;for(var d in this.fieldData.options)if(b++,1<b)break;if(!b)return null;
b="";for(var f=0;f<this.fieldData.oOrder.length;f++)d=this.fieldData.oOrder[f],b+='<li><label><span class="wa-checkbox"><input type="checkbox" value="'+d+'"',this.fieldData.disabled&&this.fieldData.disabled[d]&&(b+=' disabled="disabled"'),-1!==(this.fieldValue||[]).indexOf(d)&&(b+=' checked="checked"'),b+=' /><span><span class="icon"><i class="fas fa-check"></i></span></span></span>'+(this.fieldData.options[d]&&a.htmlentities(this.fieldData.options[d])||$_("&lt;no name&gt;"))+"</label></li>";return a.initCheckboxList('<div class="c-checkbox-menu-container val"><div><ul class="menu c-checkbox-menu">'+
b+"</ul></div></div>")}});a.factoryTypes.Name=c.extend({},a.baseFieldType,{newInlineFieldElement:null,newFieldElement:function(b){return c('<div style="display: none;" class="field" data-field-id="'+this.fieldData.id+'"></div>')},setValue:function(b){this.fieldValue=b},getValue:function(b){if(this.fieldValue&&!b)return this.fieldValue;b=[];"person"==this.contactType?(a.fieldEditors.firstname&&b.push(a.fieldEditors.firstname.getValue()),a.fieldEditors.middlename&&b.push(a.fieldEditors.middlename.getValue()),
a.fieldEditors.lastname&&b.push(a.fieldEditors.lastname.getValue())):a.fieldEditors.company&&b.push(a.fieldEditors.company.getValue());return b.join(" ").trim()},validate:function(b){var d=this.getValue(!0);if(!b&&this.fieldData.required&&!d){b=c("#"+this.options.el+" input:visible:text[value]:not(.empty)").val();if(!b)return $_("At least one of these fields must be filled");a.fieldEditors.firstname.setValue(b)}return null},showValidationErrors:function(b){var d=c("#"+this.options.el);d.find("div.wa-errors-block").remove();
if(null!==b){var f=c('<div class="field wa-errors-block"><div class="value"><p class="state-error-hint custom-mt-8">'+b+"</p></div></div>");a.fieldEditors.lastname?a.fieldEditors.lastname.domElement.after(f):d.prepend(f)}d=["firstname","middlename","lastname"];for(f=0;f<d.length;f++){var g=d[f];a.fieldEditors[g]&&(null!==b?a.fieldEditors[g].domElement.find(".val").addClass("state-error"):a.fieldEditors[g].domElement.find(".val").removeClass("state-error"))}},setMode:function(b,d){"undefined"==typeof d&&
(d=!0);if("view"!=b&&"edit"!=b)throw Error("Unknown mode: "+b);this.currentMode!=b&&(this.currentMode=b,d&&(d=this.domElement,this.domElement=this.newFieldElement(b),null!==d&&d.replaceWith(this.domElement)));a.fieldEditors.title&&a.fieldEditors.title.getValue();return this.domElement}});a.factoryTypes.NameSubfield=c.extend({},a.baseFieldType,{});a.factoryTypes.Multifield=c.extend({},a.baseFieldType,{subfieldEditors:null,subfieldFactory:null,emptySubValue:null,initializeFactory:function(b){this.fieldData=
b;if("undefined"!=typeof this.fieldData.ext){this.fieldData.extKeys=[];this.fieldData.extValues=[];for(var d in this.fieldData.ext)this.fieldData.extKeys[this.fieldData.extKeys.length]=d,this.fieldData.extValues[this.fieldData.extValues.length]=this.fieldData.ext[d]}},initialize:function(){this.subfieldFactory=c.extend({},a.factoryTypes[this.fieldData.type]);this.subfieldFactory.parentEditor=this;this.subfieldFactory.initializeFactory(c.extend({},this.fieldData));this.fieldData=c.extend({},this.fieldData,
{required:this.subfieldFactory.fieldData.required});this.subfieldEditors=[this.subfieldFactory.createEditor(this.contactType)];c.isPlainObject(this.subfieldEditors[0].fieldValue)?this.emptySubValue=c.extend({},this.subfieldEditors[0].fieldValue):this.emptySubValue={value:this.subfieldEditors[0].fieldValue};this.fieldData.ext&&(this.emptySubValue.ext=this.fieldData.extKeys[0]);this.fieldValue=[this.emptySubValue]},setValue:function(b){b&&"undefined"!=typeof b[0]||(b=[this.emptySubValue]);this.fieldValue=
b;var d=0;do{this.subfieldEditors.length<=d&&(this.subfieldEditors[d]=this.subfieldFactory.createEditor(this.contactType),"null"!=this.currentMode&&this.subfieldEditors[d].setMode(this.currentMode).insertAfter(this.subfieldEditors[d-1].parentEditorData.domElement));if("undefined"!=typeof b[d]){var f=!1,g;for(g in b[d])if("value"!=g&&"ext"!=g&&"status"!=g){f=!0;break}this.subfieldEditors[d].setValue(f?b[d]:b[d].value?b[d].value:"");if("undefined"!=typeof this.fieldData.ext&&(f=b[d].ext,"null"!=this.currentMode&&
this.subfieldEditors[d].parentEditorData.domElement)){var h=this.subfieldEditors[d].parentEditorData.domElement.find("input.ext");0<h.size()&&h[0].setExtValue(f)}}else throw Error("At least one record must exist in data at this time.");d++}while(d<b.length);if(b.length<this.subfieldEditors.length){for(d=b.length;d<this.subfieldEditors.length;d++)0!==d&&"null"!=this.currentMode&&this.subfieldEditors[d].parentEditorData.domElement.remove();b=0<b.length?b.length:1;this.subfieldEditors.splice(b,this.subfieldEditors.length-
b)}this.origFieldValue=null},getValue:function(){if("null"==this.currentMode)return c.extend({},this.fieldValue);for(var b=[],d=0;d<this.subfieldEditors.length;d++){var f=this.subfieldEditors[d];b[d]={value:f.getValue()};if("undefined"!=typeof this.fieldData.ext){var g=this.fieldValue[d].ext,h=f.parentEditorData.domElement.find("input.ext")[0];"edit"==f.currentMode&&h&&(g=h.getExtValue());b[d].ext=g}}return b},isModified:function(){for(var b=0;b<this.subfieldEditors.length;b++)if(this.subfieldEditors[b].isModified())return!0;
return!1},validate:function(b){for(var d=[],f=!0,g=0;g<this.subfieldEditors.length;g++){var h=this.subfieldEditors[g],m=h.validate(!0);m&&(d[g]=m);if((h=h.getValue())||"string"!=typeof h)f=!1}!b&&this.fieldData.required&&f&&(d[0]="This field is required.");return 0>=d.length?null:d},showValidationErrors:function(b){for(var d=0;d<this.subfieldEditors.length;d++){var f=this.subfieldEditors[d];null!==b&&"undefined"!=typeof b[d]?f.showValidationErrors(b[d]):f.showValidationErrors(null)}},deleteSubfieldButton:function(b){var d=
this,f=c('<a class="delete-subfield text-red custom-mt-8 custom-mt-0-mobile" title="'+$_("delete")+'" href="javascript:void(0)"><i class="fas fa-trash-alt icon size-14"></i></a>').click(function(){if(1>=d.subfieldEditors.length)return!1;var g=d.subfieldEditors.indexOf(b);"null"!=d.currentMode&&d.subfieldEditors[g].parentEditorData.domElement.remove();d.subfieldEditors.splice(g,1);1>=d.subfieldEditors.length&&d.domElement.find(".delete-subfield").hide();return!1});1>=this.subfieldEditors.length&&f.hide();
return f},newSubFieldElement:function(b,d){d-=0;var f=this.subfieldEditors[d];f.parentEditorData||(f.parentEditorData={});f.parentEditorData.parent=this;f.parentEditorData.empty=!1;if("function"!=typeof f.newInlineFieldElement){var g="";if(0==d||"Composite"===this.fieldData.type)g=this.fieldData.name+"";var h=a.wrapper('<span class="replace-me-with-value"></span>',g,"no-bot-margins"),m=h.find("span.replace-me-with-value");g=this.fieldValue[d].ext;"edit"==b?g=a.createExtSelect(this.fieldData.ext,g):
(g=this.fieldData.ext[this.fieldValue[d].ext]||g,g=c("<strong>"+a.htmlentities(g)+"</strong>"));m.before(g);"edit"==b&&m.before(this.deleteSubfieldButton(f));m.remove();f.domElement=this.subfieldEditors[d].newFieldElement(b);var n=this;f.domElement.find("div.name").each(function(l,p){p.innerHTML.substr(0,n.fieldData.name.length)===n.fieldData.name&&(p.innerHTML="")});g="";"Composite"===this.fieldData.type&&(g="field-composite-subfields-block");f.domElement.data("multifield-index",d).attr("data-multifield-index",
d);f.parentEditorData.domElement=c('<div class="'+g+'"></div>').append(h).append(f.domElement);f.parentEditorData.empty="edit"==b?!1:!f.fieldValue.value&&!f.fieldData.show_empty;return f.parentEditorData.domElement}g=f.newInlineFieldElement(b);if(null===g)return f.parentEditorData.domElement=f.domElement=c("<div></div>"),f.parentEditorData.empty=!0,f.parentEditorData.domElement;f.domElement=g;f.domElement.data("multifield-index",d).attr("data-multifield-index",d);h=c('<div class="value flexbox space-12 wrap-mobile"></div>').append(g);
m=h.find(".replace-with-ext");0>=m.size()&&(h.append('<span class="flexbox wide space-12"><span class="replace-with-ext"></span></span>'),m=h.find(".replace-with-ext"));"undefined"!=typeof this.fieldData.ext&&(g=this.fieldValue[d].ext,"edit"==b?m.before(a.createExtSelect(this.fieldData.ext,g)):(g=this.fieldData.ext[this.fieldValue[d].ext]||g,0<m.parents(".ext").size()?m.before(a.htmlentities(g)):m.before(c('<span class="hint" style="align-self: flex-end;"></span>').text(" "+g))));"edit"==b&&m.before(this.deleteSubfieldButton(f));
m.remove();return f.parentEditorData.domElement=h},newInlineFieldElement:null,newFieldElement:function(b){var d=this;this.fieldData.read_only&&(b="view");for(var f=c('<div class="multifield-subfields"></div>'),g="function"==typeof this.subfieldFactory.newInlineFieldElement,h=!0,m=0;m<this.subfieldEditors.length;m++){var n=this.newSubFieldElement(b,m);n.data("subfieldEditor",this.subfieldEditors[m]);"edit"===b&&n.prepend('<span class="sort sort-handler custom-mr-16 custom-mt-8 custom-mt-0-mobile"><i class="fas fa-grip-vertical text-light-gray"></i></span>');
f.append(n);h=h&&this.subfieldEditors[m].parentEditorData.empty}if(h&&!this.fieldData.show_empty)return c('<div style="display: none;" class="field" data-field-id="'+this.fieldData.id+'"></div>');h=g?c('<div class="value"></div>').append(f):c('<div class="field" data-field-id="'+this.fieldData.id+'"></div>').append(f);"edit"==b&&(m=g?c('<div class="value multifield-subfields-add-another"><span class="replace-me-with-value"></span></div>'):a.wrapper('<span class="replace-me-with-value"></span>'),d=
this,m.find(".replace-me-with-value").replaceWith(c('<a href="javascript:void(0)" class="button rounded outlined small light-gray custom-mb-16"><i class="fas fa-plus"></i> '+$_("Add another")+"</a>").click(function(l){var p=d.subfieldFactory.createEditor(this.contactType);l=d.subfieldEditors.length;var t={value:p.getValue(),temp:!0};"undefined"!=typeof d.fieldData.ext&&(t.ext="");d.fieldValue[l]=t;d.subfieldEditors[l]=p;"null"!=d.currentMode&&p.setMode(d.currentMode);p=d.newSubFieldElement(b,l);p.data("subfieldEditor",
d.subfieldEditors[l]);p.prepend('<span class="sort sort-handler custom-mr-16 custom-mt-8 custom-mt-0-mobile"><i class="fas fa-grip-vertical text-light-gray"></i></span>');f.append(p);a.dialog.resize()})),h.append(m),this.fieldData.multi&&c.fn.sortable?h.find(".multifield-subfields").sortable({direction:"vertical",handle:".sort-handler",animation:150,onEnd:function(l){var p=0;c(l.item).closest(".multifield-subfields").find("[data-multifield-index]").each(function(){var t=c(this);d.subfieldEditors[p]=
t.parent().data("subfieldEditor");t.data("subfieldIndex",p).attr("data-multifield-index",p);p++})}}):console.log(["$.fn.sortable available?",!!c.fn.sortable]));g&&(h=a.wrapper(h,this.fieldData.name+"").attr("data-field-id",this.fieldData.id));return h},setMode:function(b,d){"undefined"==typeof d&&(d=!0);if("view"!=b&&"edit"!=b)throw Error("Unknown mode: "+b);if(this.currentMode!=b){if("view"==b&&"edit"==this.currentMode&&this.origFieldValue)this.setValue(this.origFieldValue);else if("view"==this.currentMode&&
!this.origFieldValue){this.origFieldValue=[];for(var f=0;f<this.fieldValue.length;f++)this.origFieldValue.push(c.extend({},this.fieldValue[f]))}this.currentMode=b;d&&(d=this.domElement,this.domElement=this.newFieldElement(b),null!==d&&d.replaceWith(this.domElement))}for(f=0;f<this.subfieldEditors.length;f++)this.subfieldEditors[f].setMode(b,!1);return this.domElement}});a.factoryTypes.Composite=c.extend({},a.baseFieldType,{subfieldEditors:null,initializeFactory:function(b,d){this.fieldData=b;if(this.fieldData.required){for(var f in this.fieldData.required)if(this.fieldData.required[f]){this.fieldData.required=
!0;break}!0!==this.fieldData.required&&(this.fieldData.required=!1)}this.options=d||{}},initialize:function(){var b={data:{},value:""};this.subfieldEditors={};this.fieldData.subfields=this.fieldData.fields;for(var d in this.fieldData.subfields){var f=c.extend({},a.factoryTypes[this.fieldData.subfields[d].type]),g=this.fieldData.fields[d];this.fieldData.required&&this.fieldData.required[d]&&(g.required=!0);g=c.extend({},g,{id:null,multi:!1});f.initializeFactory(g,this.options);f.parentEditor=this;
f.parentEditorData={};f.initialize();f.parentEditorData.sfid=d;f.parentEditorData.parent=this;this.subfieldEditors[d]=f;b.data[d]=f.getValue()}this.fieldValue=b},setValue:function(b){if(b){this.fieldValue=b;for(var d in this.subfieldEditors){var f=this.subfieldEditors[d];"undefined"==typeof b.data?(f.initialize(),f.setValue(f.getValue())):"undefined"!=typeof b.data[d]?f.setValue(b.data[d]):f.setValue(f.getValue())}}},getValue:function(){if("null"==this.currentMode)return c.extend({},this.fieldValue.data);
var b={},d;for(d in this.subfieldEditors)b[d]=this.subfieldEditors[d].getValue();return b},isModified:function(){for(var b in this.subfieldEditors)if(this.subfieldEditors[b].isModified())return!0;return!1},validate:function(b){var d={},f=!1,g;for(g in this.subfieldEditors){var h=this.subfieldEditors[g].validate(b);h&&(d[g]=h,f=!0)}return f?d:null},showValidationErrors:function(b){if(null!==this.domElement)for(var d in this.subfieldEditors){var f=this.subfieldEditors[d];null!==b&&"undefined"!=typeof b[d]?
f.showValidationErrors(b[d]):f.showValidationErrors(null)}},newInlineFieldElement:null,newFieldElement:function(b){this.fieldData.read_only&&(b="view");if("view"==b&&!this.fieldValue.value&&!this.fieldData.show_empty)return c('<div style="display: none;" class="field" data-field-id="'+this.fieldData.id+'"></div>');var d=c('<div class="composite '+b+'" data-field-id="'+this.fieldData.id+'"></div>').append(a.wrapper('<span style="display:none" class="replace-with-ext"></span>',this.fieldData.name,"hdr")),
f;for(f in this.subfieldEditors){var g=this.subfieldEditors[f],h=g.newFieldElement(b);h.attr("data-field-id",f);h.data("fieldId",f);g.domElement=h;d.append(h)}return d},setMode:function(b,d){"undefined"==typeof d&&(d=!0);if("view"!=b&&"edit"!=b)throw Error("Unknown mode: "+b);this.currentMode!=b&&(this.currentMode=b,d&&(d=this.domElement,this.domElement=this.newFieldElement(b),null!==d&&d.replaceWith(this.domElement)));for(var f in this.subfieldEditors)this.subfieldEditors[f].setMode(b,!1);return this.domElement}});
a.factoryTypes.Address=c.extend({},a.factoryTypes.Composite,{showValidationErrors:function(b){if(null!==this.domElement&&(this.domElement.find(".state-error-hint").remove(),this.domElement.find(".val").removeClass("state-error"),b))for(var d in this.subfieldEditors)"undefined"!=typeof b[d]&&this.subfieldEditors[d].domElement.find(".val").addClass("state-error").parents(".address-subfield").append(c('<p class="state-error-hint custom-mt-8">'+b[d]+"</p>"))},newInlineFieldElement:function(b){if("view"==
b){if(!this.fieldValue.value)return null;var d=this.fieldValue.for_map.map_url||"";return d=c('<div class="address-field width-100-mobile"></div>').append('<span class="small">'+this.fieldValue.value+"</span>").append('<span style="display:none" class="replace-with-ext"></span> ').append('<a target="_blank" href="'+d+'" class="map-link small">'+$_("map")+'<i class="fas fa-external-link-alt small custom-ml-4"></i></a>')}b=c('<div class="address-field width-100-mobile"></div>');b.append('<span style="display:none" class="replace-with-ext"></span>');
for(d in this.subfieldEditors){var f=this.subfieldEditors[d],g=f.newInlineFieldElement("edit");f.domElement=g;"Hidden"!==f.fieldData.type?b.append(c('<div class="address-subfield custom-mt-12"></div>').append(g)):b.append(c('<div class="address-subfield"></div>').append(g));"Hidden"!==f.fieldData.type&&(f=f.fieldData.name+(f.fieldData.required?" ("+$_("required")+")":""),g.find("input.val,textarea.val").attr("placeholder",f).attr("title",f).addClass("small width-100-mobile"))}return b}});a.factoryTypes.Birthday=
c.extend({},a.baseFieldType,{newInlineFieldElement:function(b){this.fieldValue=this.fieldValue||{};if("view"==b&&!this.fieldValue.value)return null;var d=this.fieldValue.data||{};if("edit"==b){b=c('<div class="wa-select small"></div>');var f=c('<select class="val" data-part="day"><option data=""></option></select>'),g=[].concat($jscomp.arrayFromIterable(Array(32).keys())).slice(1);g=$jscomp.makeIterator(g);for(var h=g.next();!h.done;h=g.next()){h=h.value;var m=c('<option data="'+h+'" value="'+h+'">'+
h+"</option>");h===+d.day&&m.attr("selected",!0);f.append(m)}b.append(f);f=c('<div class="wa-select small"></div>');g=c('<select class="val" data-part="month"><option data=""></option></select>');h="January February March April May June July August September October November December".split(" ");m=$jscomp.makeIterator(h.entries());for(var n=m.next();!n.done;n=m.next()){n=$jscomp.makeIterator(n.value);var l=n.next().value;n.next();n=l+1;l=$_(h[l]);l=c('<option data="'+n+'" value="'+n+'">'+l+"</option>");
n===+d.month&&l.attr("selected",!0);g.append(l)}f.append(g);g=c('<input type="text" data-part="year" class="val small" style="min-width: 54px; width: 54px;" placeholder="'+$_("year")+'">');d.year&&g.val(d.year);d=c("<span></span>").append(b).append(" ").append(f).append(" ").append(g)}else d=c('<span class="val small"></span>').text(this.fieldValue.value);return d},getValue:function(){var b=this.fieldValue;if("edit"==this.currentMode&&null!==this.domElement){var d=this.domElement.find(".val");0<d.length&&
(b={value:{day:null,month:null,year:null}},d.each(function(){var f=c(this),g=f.data("part");b.value[g]=parseInt(f.val(),10)||null}))}return b},setValue:function(b){this.fieldValue=b;if("null"!=this.currentMode&&null!==this.domElement)if("edit"==this.currentMode)b&&b.data&&this.domElement.find(".val").each(function(){var f=c(this),g=f.data("part");f.val(b.data[g]||"")});else{var d=this.fieldValue;"object"===typeof this.fieldValue&&this.fieldValue.value&&(d=this.fieldValue.value);this.domElement.find(".val").html(c.wa.encodeHTML(d))}}});
a.factoryTypes.Date=c.extend({},a.factoryTypes.String,{initializeFactory:function(b,d){this.fieldData=b||{};this.options=d||{};this.fieldData.input_height=1},setValue:function(b){this.fieldValue=b;"null"!=this.currentMode&&null!==this.domElement&&("edit"==this.currentMode?this.domElement.find("input:text").datepicker("setDate",this.fieldValue):this.domElement.find(".val").html(c.wa.encodeHTML(this.fieldValue)))},newInlineFieldElement:function(b){var d=a.factoryTypes.String.newInlineFieldElement.call(this,
b);if("edit"==b){var f=this,g=d.addClass("state-with-inner-icon right").find("input:text").addClass("js-datepicker").removeClass("val"),h=c('<input type="hidden" class="val">').insertAfter(g);c('<span class="icon cursor-pointer js-datepicker-trigger"><i class="fas fa-calendar-alt"></i></span>').insertAfter(g);(function(m){g.datepicker?m():c.wa.loadFiles([c.wa.contactEditor.wa_backend_url+"wa-content/js/jquery-ui/jquery.ui.core.min.js",c.wa.contactEditor.wa_backend_url+"wa-content/js/jquery-ui/jquery.ui.datepicker.min.js"]).then(m)})(function(){g.datepicker({altField:h,
altFormat:"yy-mm-dd",dateFormat:f.fieldData.format,changeMonth:!0,changeYear:!0,shortYearCutoff:2,showOtherMonths:!0,selectOtherMonths:!0,stepMonths:2,numberOfMonths:2,beforeShow:function(m,n){setTimeout(function(){return n.dpDiv.css({"z-index":"1051"})})}});f.fieldValue&&g.datepicker("setDate",f.fieldValue);(function(m){var n=null;g.keydown(function(){n&&clearTimeout(n);n=setTimeout(function(){m()},250)});g.change(m)})(function(){0>=c.trim(g.val()).length&&(g.datepicker("setDate",null),f.fieldValue=
null)})});d.on("click",".js-datepicker-trigger",function(){g.trigger("focus")})}return d}});a.factoryTypes.IM=c.extend({},a.baseFieldType,{setValue:function(b){"undefined"==typeof b&&(b="");c.isPlainObject(b)?(this.fieldValue=b.data,this.viewValue=b.value):this.fieldValue=this.viewValue=b;"null"!=this.currentMode&&this.domElement&&("edit"==this.currentMode?this.domElement.find("input.val").val(this.fieldValue):this.domElement.find(".val").html(this.viewValue))},newInlineFieldElement:function(b){if("view"==
b&&!this.fieldValue)return null;"edit"==b?(b=c('<span class="width-100-mobile custom-mr-0-mobile"><input class="val small width-100-mobile" type="text"></span>'),b.find(".val").val(this.fieldValue)):b=c('<span class="val small custom-mt-12-mobile"></span>').html(this.viewValue);return b}});a.factoryTypes.SocialNetwork=c.extend({},a.baseFieldType,{setValue:function(b){"undefined"==typeof b&&(b="");c.isPlainObject(b)?(this.fieldValue=b.data,this.viewValue=b.value):this.fieldValue=this.viewValue=b;"null"!=
this.currentMode&&this.domElement&&("edit"==this.currentMode?this.domElement.find("input.val").val(this.fieldValue):this.domElement.find(".val").html(this.viewValue))},newInlineFieldElement:function(b){if("view"==b&&!this.fieldValue)return null;"edit"==b?(b=c('<span class="width-100-mobile custom-mr-0-mobile"><input class="val small width-100-mobile" type="text"></span>'),b.find(".val").val(this.fieldValue)):b=c('<span class="val small nowrap custom-mt-12-mobile"></span>').html(this.viewValue);return b}});
a.factoryTypes.Url=c.extend({},a.factoryTypes.IM,{validate:function(b){var d=c.trim(this.getValue());if(!b&&this.fieldData.required&&!d)return $_("This field is required.");if(!d)return null;/^(https?|ftp|gopher|telnet|file|notes|ms-help)/.test(d)||(d="http://"+d,this.setValue(d));b=/^(https?|ftp|gopher|telnet|file|notes|ms-help):((\/\/)|(\\\\))+[^`!\[\]{}'"<>\u00ab\u00bb\u201c\u201d\u2018\u2019\s]*$/i;return!b.test(d)||/^(http|ftp)/.test(d.toLowerCase())&&(b=/^(https?|ftp):((\/\/)|(\\\\))+((?:[^`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019\s+]+\.)+[^`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019\s+]{2,6})((\/|\\|#)[^`!\[\]{}'"<>\u00ab\u00bb\u201c\u201d\u2018\u2019\s]*)?$/i,
!b.test(d))?$_("Incorrect URL format."):null}});a.factoryTypes.Email=c.extend({},a.factoryTypes.Url,{validate:function(b){var d=c.trim(this.getValue());return b||!this.fieldData.required||d?d?/^([^@\s]+)@[^\s@]+\.[^\s@\.]{2,}$/i.test(d)?null:$_("Incorrect email address format."):null:$_("This field is required.")}});a.factoryTypes.Checkbox=c.extend({},a.baseFieldType,{setValue:function(b){this.fieldValue=parseInt(b);"null"!=this.currentMode&&this.domElement&&("edit"==this.currentMode?this.domElement.find("input.val").attr("checked",
!!this.fieldValue):this.domElement.find(".val").text(this.fieldValue?$_("Yes"):$_("No")))},newInlineFieldElement:function(b){"edit"==b?(b=c('<label>\n                    <span class="wa-checkbox">\n                        <input class="val" type="checkbox" value="1" checked="checked">\n                        <span>\n                            <span class="icon">\n                                <i class="fas fa-check"></i>\n                            </span>\n                        </span>\n                    </span>\n                </label>'),
this.fieldValue||b.find(".val").removeAttr("checked")):b=c('<span class="val small"></span>').text(this.fieldValue?$_("Yes"):$_("No"));return b}});a.factoryTypes.Number=c.extend({},a.baseFieldType,{validate:function(b){var d=c.trim(this.getValue());return b||!this.fieldData.required||d||0===d?d&&!/^-?[0-9]+([\.,][0-9]+$)?/.test(d)?$_("Must be a number."):null:$_("This field is required.")}});return a.factoryTypes};c.wa.contactEditorFactory=function(a){a=c.extend({contact_id:null,current_user_id:null,
contactType:"person",baseFieldType:null,saveUrl:"?module=profile&action=save",saveGeocoordsUrl:"?module=contacts&action=saveGeocoords",regionsUrl:"?module=backend&action=regions&country=",el:"#contact-info-block",update_title:!0,dialog:{}},a);var e=c.extend({wa_app_url:"",fields:{},fieldsOrder:[],fieldsValues:{},factoryTypes:{},editorFactories:{},fieldEditors:{},initFactories:function(b,d){var f=this;this.fields=b;this.fieldsOrder=d;this.editorFactories={};this.fieldEditors={};this.fieldsOrder=c.each(d,
function(g,h){try{if("object"!=typeof b[h]||!b[h].type)throw Error("Field data error for "+h);if("undefined"==typeof f.factoryTypes[b[h].type])throw Error("Unknown factory type: "+b[h].type);f.editorFactories[h]=b[h].multi?c.extend({},f.factoryTypes.Multifield):c.extend({},f.factoryTypes[b[h].type]);f.editorFactories[h].initializeFactory(b[h]);return h}catch(m){console.log("Unable to init field "+h),console.log(m),b[h]=void 0,delete b[h]}}).filter(function(g){return!!g})},resetFieldEditors:function(){for(var b=
0;b<this.fieldsOrder.length;b+=1){var d=this.fieldsOrder[b];"undefined"==typeof this.fieldEditors[d]?this.fieldEditors[d]=this.editorFactories[d].createEditor(this.contactType,d):this.fieldEditors[d].reinit()}},initFieldEditors:function(b){if(!(b instanceof Array)){this.fieldsValues=b;for(var d=0;d<this.fieldsOrder.length;d+=1){var f=this.fieldsOrder[d];if("undefined"==typeof this.editorFactories[f]){c.wa.controller.contactAction([this.contact_id]);break}try{"undefined"==typeof this.fieldEditors[f]&&
(this.fieldEditors[f]=this.editorFactories[f].createEditor(this.contactType)),this.fieldEditors[f].setValue(b[f])}catch(g){console.log("Unable to initialize editor "+f),console.log(g)}}}},initContactInfoBlock:function(b){this.switchMode(b,!0)},getSaveUrl:function(){return this.saveUrl},getSaveGeocoordsUrl:function(){return c.wa.contactEditor.wa_backend_url+"?module=profile&action=saveGeocoords"},getRegionsUrl:function(){return c.wa.contactEditor.wa_backend_url+"?module=profile&action=regions&country="},
switchMode:function(b,d){var f=c(this.el),g=this;d&&(f.html(""),f.removeClass("edit-mode view-mode"),f.off("click.map",".map-link").on("click.map",".map-link",function(){var p=c(this).parent().data("multifield-index");void 0!==p&&g.geocodeAddress(g.fieldEditors.address.fieldValue,p)}));if("edit"!=b||!f.hasClass("edit-mode"))if("view"!=b||!f.hasClass("view-mode")){c(this).trigger("before_switch_mode",[b,this]);f.find(".buttons").remove();for(var h=[],m=0;m<this.fieldsOrder.length;m+=1){var n=this.fieldsOrder[m];
h.push(n);try{var l=this.fieldEditors[n].setMode(b);c(this).trigger("set_mode",[{mode:b,el:f,field_id:n,field:this.fieldEditors[n]}]);d&&f.append(l)}catch(p){console.log("Error initializing field",n,p)}}"edit"==b?(f.addClass("edit-mode"),f.removeClass("view-mode"),f.find(".subname").wrapAll('<div class="subname-wrapper custom-mt-0"></div>'),f.find(".jobtitle-company").wrapAll('<div class="jobtitle-company-wrapper custom-mt-16"></div>'),d=this.inplaceEditorButtons(h,function(p){if("undefined"!=typeof p&&
!p)return!1;if("undefined"!=typeof g.justCreated&&g.justCreated)throw p=c("#all-users-sidebar-link .count"),p.text(1+parseInt(p.text())),Error("!!! Not implemented because never used. Redirect to contact_id="+g.contact_id);g.dialog.hide()}),null===g.contact_id&&d.find(".cancel").remove(),g.dialog.$body.find(".dialog-footer").append(d)):(f.addClass("view-mode"),f.removeClass("edit-mode"),f.find(".subname-wrapper").length&&f.find(".subname").unwrap(),f.find(".jobtitle-company-wrapper").length&&f.find(".jobtitle-company").unwrap());
c(this).trigger("after_switch_mode",[b,this])}},saveFields:function(b,d){function f(x,y,C){if(C)for(var A=0;A<C.length;A+=1){if(x[C[A]]&&y[C[A]]&&x[C[A]]!=y[C[A]])return!1}else{for(A in x)if(x.hasOwnProperty(A)&&x[A]&&y[A]&&x[A]!=y[A])return!1;for(A in y)if(y.hasOwnProperty(A)&&x[A]&&y[A]&&x[A]!=y[A])return!1}return!0}function g(x){x=void 0===x?!0:x;c.post(l.getSaveUrl(),{data:JSON.stringify(n),type:l.contactType,id:null!=l.contact_id?l.contact_id:0},function(y){if("ok"!==y.status){if(y.errors.length){y=
y.errors["0"];c(".buttons .loading").hide();c("#validation-notice").text(y.text);return}throw new Exception("AJAX error:",y);}c("#validation-notice").text("");var C=l.fieldsValues||{};y=y.data;var A=null;y.data&&y.data.top&&(A=y.data.top);y.data.top=void 0;delete y.data.top;null!=l.contact_id&&l.initFieldEditors(y.data);var D=!1,B;for(B in l.fieldEditors)if("undefined"!=typeof y.errors[B]){if(l.fieldEditors[B].showValidationErrors(y.errors[B]),!D)for(D=l.fieldEditors[B].domElement;!D.is(":visible");)D=
D.parent()}else"edit"==l.fieldEditors[B].currentMode&&l.fieldEditors[B].showValidationErrors(null);D||(l.contact_id&&y.data.reload?window.profileTab?window.profileTab.rootWindow.location.reload():window.location.reload():(null===l.contact_id&&(l.justCreated=!0),l.contact_id=y.data.id,!D&&x&&h(C,y),d(!D),D||(c(e).trigger("contact_saved",y.data),A&&c(e).trigger("top_fields_updated",{data:A}),c.team.content.reload(!0))))},"json")}function h(x,y){var C=c.storage.get("contacts/last_geocoding")||0;if(3600<
(new Date).getTime()-C&&(c.storage.del("contacts/last_geocoding"),y=y.data.address,!c.isEmptyObject(y))){var A=[],D=[];for(C=0;C<y.length;C+=1){var B=!0;n.address[C]&&(B=!f(y[C].data,(x.address[C]||{}).data||{},["city","country","region","street","zip"]));B&&(A.push(l.sendGeocodeRequest(y[C].for_map)),D.push(C))}if(A.length){var G=function(z,F){if("OK"===z.status){var k=z.lng||"";n.address[F].value.lat=z.lat||"";n.address[F].value.lng=k}else"OVER_QUERY_LIMIT"===z.status&&c.storage.set("contacts/last_geocoding",
(new Date).getTime()/1E3)};c.when.apply(c,A).then(function(){if(1>=A.length&&"success"===arguments[1])G(arguments[0],D[0]);else for(var z=0;z<arguments.length;z+=1)"success"===arguments[z][1]&&G(arguments[z][0],D[z]);g(!1)})}}}if(!b){b=[];for(var m in this.fields)this.fields.hasOwnProperty(m)&&b.push(m)}var n={},l=this;m=!1;for(var p=0;p<b.length;p++){var t=b[p],v=this.fieldEditors[t].validate();if(v){if(!m)for(m=this.fieldEditors[t].domElement;!m.is(":visible");)m=m.parent();this.fieldEditors[t].showValidationErrors(v)}else this.fieldEditors[t].showValidationErrors(null);
n[t]=this.fieldEditors[t].getValue()}m?d(!1):g(!0)},createExtSelect:function(b,d){var f="",g=!0,h;for(h in b){var m="";if(b[h]===d||h===d)m=' selected="selected"',g=!1;var n=this.htmlentities(b[h]);f+='<option value="'+("undefined"===typeof b.length?h:n)+'"'+m+">"+n+"</option>"}if(g){f+='<option value="%custom" selected="selected">'+$_("other")+"...</option>";var l='<input type="text" class="shorter small ext width-100-mobile custom-mt-12-mobile">'}else f+='<option value="%custom">'+$_("other")+"...</option>",
l='<input type="text" class="shorter small empty ext width-100-mobile custom-mt-12-mobile">';f=c('<div class="wa-select small width-100-mobile custom-mr-12 custom-mt-12-mobile"><select class="ext">'+f+'</select></div><span class="width-100-mobile custom-mr-12 custom-mr-0-mobile">'+l+"</span>");var p=f.children("select");l=f.find("input");l.val(d);"%custom"!==p.val()&&l.hide();d=$_("which?");var t=function(){l.val()||l.hasClass("empty")||(l.val(d),l.addClass("empty"))};l.blur(t);l.focus(function(){l.hasClass("empty")&&
(l.val(""),l.removeClass("empty"))});p.change(function(){var v=p.val();"%custom"===v?(l.hasClass("empty")&&l.val(d),l.show()):(l.hide(),l.addClass("empty"),l.val(v||""));t()});l[0].getExtValue=function(){return"%custom"===p.val()&&l.hasClass("empty")?"":l.val()};l[0].setExtValue=function(v){b[v]?p.val(v):p.val("%custom");l.val(v)};return f},inplaceEditorButtons:function(b,d){var f=c('<div class="field buttons"><div class="value"><p class="state-error-hint custom-mt-8" id="validation-notice"></p></div></div>'),
g=this,h=function(){c(".buttons .loading").show();g.saveFields(b,function(l){c(".buttons .loading").hide();d(l)});return!1};c("#tc-contact").off("keyup.contact_save").on("keyup.contact_save",'#contact-info-block.edit-mode input[type="text"]',function(l){13!=l.keyCode||c(l.currentTarget).data("autocomplete")&&c(l.currentTarget).data("contact_id")||h()});var m=c('<input type="submit" class="button" value="'+$_("Save")+'" />').click(h);g=this;var n=c('<a href="javascript:void(0)" class="cancel button light-gray js-close-dialog">'+
$_("Cancel")+"</a>");n.on("click",function(l){l.preventDefault();c("#validation-notice").text("");c(".buttons .loading").hide();g.fieldEditors.name.showValidationErrors(null)});f.children(".value").append(m).append(n).append(c('<i class="fas fa-spinner fa-spin loading custom-ml-16 wa-animation-spin speed-1000" style="display: none;"></i>'));return f},destroy:function(){c(this.el).html("")},dialogInstance:function(b){this.dialog=b},wrapper:function(b,d,f){f=c('<div class="field'+("undefined"!=typeof f&&
f?" "+f:"")+'"></div>');"undefined"!=typeof d&&d&&(c(this).on("set_mode",function(g,h){"Checkbox"===h.field.fieldData.type?h.field.domElement.find(".name").toggleClass("for-checkbox","edit"==h.mode):h.field.domElement.find(".name").toggleClass("for-input","edit"==h.mode)}),f.append('<div class="name'+(c(this.el).closest(".dialog-content").length?" for-input":"")+'">'+c.wa.encodeHTML(d)+"</div>"));if("object"!=typeof b||!(b instanceof jQuery)||0>=b.find("div.value").size())b=c('<div class="value custom-mb-12"></div>').append(b);
f.append(b);return f},htmlentities:function(b){var d=document.createElement("div");b=document.createTextNode(b);d.appendChild(b);return d.innerHTML},geocodeAddress:function(b,d){var f=this;b[d].data.lat&&b[d].data.lng||this.sendGeocodeRequest(b[d].for_map||b[d].value,function(g){b[d].data.lat=g.lat;b[d].data.lng=g.lng;c.post(f.getSaveGeocoordsUrl(),{id:f.contact_id,lat:g.lat,lng:g.lng,sort:d})})},sendGeocodeRequest:function(b,d){var f=[];"string"===typeof b?f.push(b):b.with_street&&b.without_street&&
b.with_street===b.without_street?f.push(b.with_street):(b.with_street&&f.push(b.with_street),b.without_street&&f.push(b.without_street));var g=c.Deferred();b=this.geocoding||{};var h=function(n){c.ajax({url:"https://maps.googleapis.com/maps/api/geocode/json",data:{sensor:!1,key:n,address:f[0]},dataType:"json",success:function(l){if(l)if("OK"===l.status){for(var p=l.results.length,t=!1,v=0;v<p;v+=1)if(!l.results[v].partial_match){var x=l.results[v].geometry.location.lat||"";var y=l.results[v].geometry.location.lng||
"";d instanceof Function&&d({lat:x,lng:y});t=!0;break}t||(x=l.results[0].geometry.location.lat||"",y=l.results[0].geometry.location.lng||"",d instanceof Function&&d({lat:x,lng:y}));g.resolve([{lat:x,lng:y,status:l.status},"success"])}else g.resolve([{status:l.status},"success"]);else g.resolve([{status:"FAIL"},"error"])},error:function(l){g.resolve([{status:l.status},"error"])}})},m=function(n){c.ajax({url:"https://geocode-maps.yandex.ru/1.x/?format=json",data:{apikey:n,geocode:f[0]},dataType:"json",
success:function(l){var p,t;l.response&&l.response.GeoObjectCollection&&l.response.GeoObjectCollection.featureMember?(c.each(l.response.GeoObjectCollection.featureMember,function(v,x){if(x.GeoObject&&x.GeoObject.Point&&x.GeoObject.Point.pos&&"string"===typeof x.GeoObject.Point.pos&&(v=x.GeoObject.Point.pos.split(" "),2===v.length))return t=v[0],p=v[1],d instanceof Function&&d({lat:p,lng:t}),g.resolve([{lat:p,lng:t,status:"OK"},"success"]),!1}),p&&t||g.resolve([{status:"FAIL"},"error"])):g.resolve([{status:"FAIL"},
"error"])},error:function(l){g.resolve([{status:"FAIL"},"error"])}})};"google"===b.type&&b.key?h(b.key):"yandex"===b.type&&b.key?m(b.key):g.resolve([{geocoding:b},"error"]);return g},initCheckboxList:function(b){b=c(b);var d=function(f,g){f=c(g||this);f.is(":checked")?f.parent().addClass("access-highlighted"):f.parent().removeClass("access-highlighted")};b.find('input[type="checkbox"]').click(d).each(d);return b}},a);c.wa.fieldTypesFactory(e);return e};c.wa.contactEditor=c.wa.contactEditorFactory()})(jQuery);var AccessPage=function(c){var a=function(b){a=function(d){this.$wrapper=d.$wrapper;this.$accessWrapper=this.$wrapper.find(".t-access-wrapper");this.$accessSlider=this.$wrapper.find(".t-access-slider");this.$headerApps=this.$wrapper.find(".t-header-apps");this.$headerList=this.$headerApps.find(".t-apps-list");this.$apps=this.$headerList.find(".t-app-item");this.item_count=this.$apps.length;this.type_class=!1;this.items_left=this.left=0;this.item_w=this.access_slider_w=this.access_wrapper_w=!1;this.initClass()};
a.prototype.initClass=function(){function d(){b.contains(document,f.$wrapper[0])?f.reset():b(window).off("resize",d)}var f=this;f.detectSliderWidth();f.showArrows();f.setWrapMaxWidth();b(window).on("resize",b.proxy(f.setWrapMaxWidth,f));b(window).on("resize",d);f.$wrapper.on("click",".t-action",function(){var g=b(this);g.hasClass("left")&&f.moveSlider(!1);g.hasClass("right")&&f.moveSlider(!0)})};a.prototype.setWrapMaxWidth=function(){var d=window.innerWidth-document.documentElement.offsetWidth;d=
document.body.scrollHeight>window.innerHeight?window.innerWidth-d-this.$wrapper.offset().left:window.innerWidth-this.$wrapper.offset().left;this.$wrapper[0].style.setProperty("max-width",d+"px");b("body")[0].style.setProperty("overflow-x","hidden")};a.prototype.detectSliderWidth=function(){this.access_wrapper_w=this.$accessWrapper.outerWidth();this.access_slider_w=this.$accessSlider.outerWidth();this.item_w=this.$apps.first().outerWidth()};a.prototype.showArrows=function(){function d(g){f.type_class&&
(f.$accessWrapper.removeClass(f.type_class),f.$headerApps.removeClass(f.type_class));g&&(f.$accessWrapper.addClass(g),f.$headerApps.addClass(g),f.type_class=g)}var f=this;0<=f.left?f.access_wrapper_w<f.access_slider_w?d("type-1"):d():f.access_wrapper_w<f.access_slider_w-Math.abs(f.left)?d("type-2"):d("type-3")};a.prototype.setLeft=function(d){this.$headerList.css({left:d});this.$accessSlider.css({left:d});this.left=d};a.prototype.moveSlider=function(d){var f=this.items_left;d?d=f+1:(d=f-1,0>d&&(d=
0));f=d*this.item_w;f>-(this.access_wrapper_w-this.access_slider_w)&&(f=-(this.access_wrapper_w-this.access_slider_w));this.items_left=d;this.setLeft(-f);this.showArrows()};a.prototype.reset=function(){this.items_left=0;this.setLeft(0);this.detectSliderWidth();this.showArrows()};return a}(c),e=function(b){e=function(d){this.$wrapper=d.$wrapper;this.$header=this.$wrapper.find(".t-elastic-header");this.wrapper_offset=this.$wrapper.offset();this.header_w=this.$header.outerWidth();this.header_h=this.$header.outerHeight();
this.fixed_class="is-fixed";this.is_fixed=!1;this.initClass()};e.prototype.initClass=function(){function d(){if(b.contains(document,g.$header[0]))g.onScroll(h.scrollTop());else h.off("scroll",d)}function f(){if(b.contains(document,g.$header[0]))g.onResize();else h.off("resize",f)}var g=this,h=b(window);h.on("scroll",d).on("resize",f)};e.prototype.onScroll=function(d){d>this.wrapper_offset.top?(this.$header.addClass(this.fixed_class).css({left:this.wrapper_offset.left,width:this.header_w}),this.is_fixed=
!0):(this.$header.removeClass(this.fixed_class).removeAttr("style"),this.is_fixed=!1)};e.prototype.onResize=function(){this.header_w=this.$wrapper.outerWidth();this.is_fixed&&this.$header.width(this.header_w)};return e}(jQuery);AccessPage=function(b){this.$wrapper=b.$wrapper;this.slider=!1;this.dialogs=[];this.initClass()};AccessPage.prototype.initClass=function(){this.initAccessSlider();this.initElasticHeader();this.initHover();this.bindEvents()};AccessPage.prototype.bindEvents=function(){var b=
this;b.$wrapper.on("click",".t-access-status",function(f){f.preventDefault();f=c(this);f.hasClass("is-admin")&&!b.dialogs.length?c.team.content.load(f.data("uri")):showAccessDialog(f,f.data("app-id"),f.data("user-id"))});var d;c(document).on("team_access_level_changed",d=function(f,g){c.contains(document.body,b.$wrapper[0])?b.$wrapper.find('table.t-access-table tr[data-user-id="'+g.contact_id+'"] .t-access-status[data-app-id="'+g.app_id+'"]').removeClass("type-no type-limited type-full type-"+g.prev_level).addClass("type-"+
g.new_level):c(document).off("team_access_level_changed",d)})};AccessPage.prototype.initAccessSlider=function(){this.slider||(this.slider=new a({$wrapper:this.$wrapper}))};AccessPage.prototype.initElasticHeader=function(){new e({$wrapper:this.$wrapper})};AccessPage.prototype.closeDialogs=function(){var b=!1;this.dialogs.length&&(c.each(this.dialogs,function(d,f){c.contains(document,f.$wrapper[0])&&(f.close(),b=!0)}),this.dialogs=[]);return b};AccessPage.prototype.initHover=function(){function b(){d&&
(d.removeClass("access-highlighted"),d=!1);f&&(f.removeClass("access-highlighted"),f=!1)}var d=!1,f=!1;this.$wrapper.on("mouseenter",".t-access-status",function(){var g=c(this),h=g.data("user-id");g=g.data("app-id");b();h&&g&&(h=c("#t-user-"+h),g=c("#t-app-"+g),h.length&&(h.addClass("access-highlighted"),d=h),g.length&&(g.addClass("access-highlighted"),f=g))});this.$wrapper.on("mouseleave",".t-access-status",b)};return AccessPage}(jQuery);
(function(c){window.AccessDialog=function(a){function e(d){this.$dialogWrapper=d.$wrapper;this.$wrapper=this.$dialogWrapper.find(".dialog-body");this.$limitedContent=this.$wrapper.find(".t-limited-access-form");this.$submit_btn=this.$wrapper.find('[type="submit"]');this.active_class="selected";this.disabled_class="disabled";this.wa_app_url=d.wa_app_url;this.app_id=d.app_id;this.contact_id=d.contact_id;this.teamDialog=this.$dialogWrapper.data("dialog")||!1;this.noticeToggle=b(this.$wrapper);this.$activeTab=
this.$wrapper.find(".t-access-item."+this.active_class);this.active_access_id=this.$activeTab.data("access-id");this.is_locked=!1;this.initClass()}function b(d){var f=d.find(".t-loading"),g=d.find(".t-success"),h,m;return h={loading:function(){g.removeClass("is-visible");f.addClass("is-visible")},success:function(){g.addClass("is-visible");f.removeClass("is-visible");m&&clearTimeout(m);m=setTimeout(function(){a.contains(document,g[0])&&h.hide()},2E3)},hide:function(){m&&clearTimeout(m);f.removeClass("is-visible");
g.removeClass("is-visible")}}}e.prototype.initClass=function(){this.bindEvents()};e.prototype.bindEvents=function(){var d=this;d.$wrapper.find(".t-access-list").waToggle({use_animation:!1,change:function(f,g,h){f=a(g);g=f.hasClass(d.disabled_class);d.$submit_btn.toggleClass("yellow",h.$active.data("access-id")!=d.active_access_id);g?g&&a.waDialog.alert({text:f.data("reason-disabled"),button_title:"Ok",onClose:function(m){h.$before.trigger("click");m.$wrapper.remove()}}):(d.changeTab(f),d.teamDialog&&
d.teamDialog.resize())}});d.$wrapper.on("click",'input[type="submit"]',function(f){f.stopPropagation();d.save()});d.$wrapper.on("change",'input[type!="hidden"], select',function(){d.$submit_btn.toggleClass("yellow",!!d.$limitedContent.find("tr[data-state-changed]").length)})};e.prototype.changeTab=function(d){var f=d.data("access-id"),g=this.$limitedContent,h=this.$wrapper.find(".js-access");this.$activeTab=d;h.addClass("hidden").filter("."+f).removeClass("hidden");this.$limitedContent.length&&g.toggleClass("hidden",
"limited"!==f)};e.prototype.save=function(){var d=this,f=d.$activeTab.data("access-id"),g=function(h){var m=!1,n={no:0,limited:1,full:2};n.hasOwnProperty(h)&&(m=n[h]);return m}(f);d.is_locked=!0;d.noticeToggle.loading();g=a.post(d.wa_app_url+"?module=accessSave&action=rights&id="+d.contact_id,{app_id:d.app_id,name:"backend",value:g},"json");"limited"===f&&(g=g.then(function(){var h=d.$limitedContent.find("form");return a.post(h.attr("action"),h.serialize(),"json")}));g.then(function(){var h=d.active_access_id;
a(document).trigger("team_access_level_changed",{app_id:d.app_id,contact_id:d.contact_id,prev_level:h,new_level:f});d.active_access_id=f;d.noticeToggle.success();d.is_locked=!1;d.teamDialog.close()})};return e}(c);window.ProfileAccessTab=function(a){function e(){c(".js-webasyst-id-auth").on("click",function(l){l.preventDefault();c("body").trigger("wa_webasyst_id_auth")})}function b(l,p){if(c.fn.iButton){var t=c(".basic-user-fields"),v=c(".js-block-user-reason-form");v.on("click",".js-block-user-cancel",
function(){v.hide()});v.on("submit",function(C){C.preventDefault();c.waDialog.confirm({title:'<i class="fas fa-exclamation-triangle smaller state-error"></i> '+x.data("alert"),success_button_title:n.blockUser||"Ok",success_button_class:"danger",cancel_button_title:n.cancel,cancel_button_class:"light-gray",onSuccess:function(){var A=v.find(".js-block-user-reason");A=c.trim(A.val());c(".c-shown-on-enabled").hide();var D=y.parent().find(".loading").show();c.post(h+"?module=accessSave&action=ban&id="+
g,{magic_word:"please",text:A},function(B){D.hide();v.hide();"ok"===B.status&&(t.addClass("gray"),c(".c-shown-on-disabled").show(),c("#tc-user-access-disabled").show().html(B.data.access_disable_msg),c.team.sidebar.reload())},"json")}})});var x=c("#c-access-link-block");x.on("click",function(C){C.preventDefault();v.show()});var y=c("#c-access-link-unblock").on("click",function(C){C.preventDefault();c.waDialog.confirm({title:'<i class="fas fa-exclamation-triangle smaller state-error"></i> '+y.data("alert"),
success_button_title:n.unblockUser||"Ok",success_button_class:"danger",cancel_button_title:n.cancel,cancel_button_class:"light-gray",onOpen:function(A,D){console.log(A,D)},onSuccess:function(){c(".c-shown-on-disabled").hide();var A=y.parent().find(".loading").show();c.post(h+"?module=accessSave&action=unban&id="+g,{magic_word:"please"},function(){A.hide();t.removeClass("gray");c(".c-shown-on-enabled").show();c("#tc-user-access-disabled").hide().html("");c(".t-sidebar-profile-dialog").data("dialog").resize();
c.team.sidebar.reload()})}})})}else c.ajax({cache:!0,dataType:"script",url:l+"wa-content/js/jquery-plugins/ibutton/jquery.ibutton.min.js?"+p,success:function(){b(l,p)}})}var d=a.login,f=a.password,g=a.contact_id,h=a.wa_app_url,m=a.url_change_api_token,n=a.loc;(function(){var l=c("#form-customize-groups");l.length&&(c("#open-customize-groups").on("click",function(p){p.preventDefault();c(this).hide();c("#form-customize-groups").toggle()}),c("#cancel-customize-groups").on("click",function(p){p.preventDefault();
p=c("#form-customize-groups").hide();c("#open-customize-groups").show();p.find(".loading").hide();p.find(".state-error-hint").remove()}),l.submit(function(){var p=c(this);p.find(".state-error-hint").remove();p.find(".loading").show();c.post(p.attr("action"),p.serialize(),function(t){if("ok"==t.status){try{c.team.sidebar.reload();c.team.content.reload();p.find(".loading").hide();p.hide();var v=c.team.profile.$profile_header_links.find('[data-section-id="access"]:first').attr("data-url"),x=p.closest(".dialog").data("dialog");
x.$content.css({position:"relative",overflow:"hidden"}).append('<div class="js-reload-spinner" style="position:absolute;top:0;bottom:0;left:0;right:0;display:grid;place-items:center;background:var(--background-color-blank);"><span class="spinner custom-p-16"></span></div>');c.post(v,{userId:c.team.profile.user.id},function(y){x.$content.css("overflow","auto").empty().html(y)}).always(function(){x.$content.css("overflow","auto").find(".js-reload-spinner").remove()})}catch(y){}window.hasOwnProperty("profileTab")&&
window.profileTab.reload()}else"fail"==t.status&&p.find(".c-checkbox-menu-container").after(c('<span class="state-error-hint">'+t.errors.join("<br />")+"</span>"))},"json");return!1}))})();(function(){c("#c-credentials-form").submit(function(){var l=c(this);l.find("input.state-error").removeClass("error");l.find(".state-error-hint").remove();var p=l.find(".c-login-input"),t=c.trim(p.val());if(!t)return p.addClass("error").after('<p class="state-error-hint custom-mt-4">'+n["Login is required"]+"</p>"),
!1;p=l.serializeArray();"1"===c("#c-access-rights-toggle").val()&&(p=p.concat([{name:"set_rights",value:"1"},{name:"app_id",value:"webasyst"},{name:"name",value:"backend"},{name:"value",value:1}]));c.post(l.attr("action"),p,function(v){if("ok"===v.status){l.hide();d=t;c("#c-login-block").show().find(".c-login-input").val(d).end().find(".c-login").text(d);try{c.team.sidebar.reload()}catch(x){}try{window.profileTab.reload()}catch(x){}}else"fail"===v.status&&l.find('input[type="submit"]').parent().prepend(c('<p class="state-error-hint custom-mt-4 custom-mb-8">'+
v.errors.join("<br>")+"</p>"))},"json");return!1}).find(".cancel").click(function(l){l.preventDefault();c("#c-credentials-block").hide();return!1})})();(function(){var l=c("#c-login-form"),p=l.find(".c-login-input");l.submit(function(){c(".dialog-footer .js-close-dialog").prop("disabled",!0);l.find("input.state-error").removeClass("error");l.find(".state-error-hint").remove();var t=c.trim(p.val());if(d===t)return!1;if(!t)return p.addClass("error").after('<p class="state-error-hint custom-mt-4">'+
n["Login is required."]+"</p>"),!1;l.find(".loading").show();c.post(l.attr("action"),l.serialize(),function(v){l.find(".loading").hide();if("ok"===v.status){c("#c-login-block").show();p.val(t);l.find(".c-login").text(t);l.find(".c-one-tab").show();l.find(".c-two-tab").hide();if(!d)try{window.profileTab.reload()}catch(x){}v=window.location.href.replace(d,t);d=t;window.location.assign(v)}else"fail"===v.status&&(c(".dialog-footer .js-close-dialog").prop("disabled",!1),l.find('input[type="submit"]').parent().prepend(c('<p class="state-error-hint custom-mt-4 custom-mb-8">'+
v.errors.join("\n<br>\n")+"</p>")))},"json");return!1});l.find(".c-tab-toggle").click(function(t){t.preventDefault();l.find(".c-one-tab,.c-two-tab").toggle();p.is(":visible")&&p.focus();return!1})})();(function(){var l=c("#c-password-form"),p=l.find(".c-password-input"),t=l.find(".c-confirm-password-input");l.submit(function(){l.find("input.state-error").removeClass("error");l.find(".state-error-hint").remove();if(p.val()!==t.val())return p.addClass("error"),t.after().after('<p class="state-error-hint custom-mt-4">'+
n["Passwords do not match."]+"</p>"),!1;l.find(".loading").show();c.post(l.attr("action"),l.serialize(),function(v){l.find(".loading").hide();"ok"===v.status?(f=!0,p.val(""),t.val(""),l.find(".c-one-tab").show(),l.find(".c-two-tab").hide(),c("#c-password-block").show()):"fail"===v.status&&t.after('<p class="state-error-hint custom-mt-4">'+v.errors.join("<br />")+"</p>")},"json");return!1});l.find(".c-tab-toggle").click(function(v){v.preventDefault();l.find(".c-one-tab,.c-two-tab").toggle();v=l.find(".c-password-input");
v.is(":visible")&&v.focus();return!1})})();(function(){var l=c("#tc-api-tokens-filed"),p=l.find(".js-api-tokens-list"),t=!1;l.on("click",".js-remove-api-token",function(v){v.preventDefault();var x=c(this).parents(".js-token-item"),y=x.find(".icon16");v=x.data("token");var C={action:"remove",token_id:v};!t&&v&&confirm(n.remove_ask)&&(t=!0,y.removeClass("no").addClass("loading"),c.post(m,C,function(A){A.status&&"ok"===A.status?(x.remove(),0===p.find(".js-token-item").length&&l.remove()):(t=!1,y.removeClass("loading").addClass("no"))}).always(function(){t=
!1;y.removeClass("loading").addClass("no")}))})})();a.is_own_profile||b(a.wa_url,a.wa_framework_version);a.is_own_profile&&e();(function(){c(".js-webasyst-id-unbind-auth").on("click",function(l){l.preventDefault();c(document).trigger("wa_waid_unbind_auth",{id:g})})})();(function(){c(".js-webasyst-id-help-link").on("click",function(l){l.preventDefault();c("body").trigger("wa_waid_help_link")})})();(function(l,p,t){function v(){x(!0)&&y()}function x(B){c("#c-access-rights-hint-warning").hide();c("#c-access-rights-hint-customize").hide();
var G=C.val();void 0===G&&(G="1");switch(G){case "remove":c("#c-credentials-block").hide();c("#c-login-block").hide();c("#c-password-block").hide();if(t){c("#c-access-rights-by-app").hide();c(".c-shown-on-access").hide();break}C.val(D||"0");c("#c-access-rights-hint-warning").show();return!1;case "0":if(d||f)if(d){var z=c("#c-access-rights-by-app");z.show();B&&z.find(".t-access-status").removeClass("type-no type-limited type-full").addClass("type-no");c(".c-shown-on-access").show();c("#c-login-block").show();
c("#c-password-block").show();break}else return c("#c-login-block").show().find(".cancel").one("click.access",function(){C.val(D);v()}).end().find(".c-tab-toggle:first").click(),c("#c-password-block").show(),!1;else return c("#c-credentials-block").show().find(".c-login-input").focus().end().find(".cancel").one("click.access",function(){C.val(D);v()}),!1;case "1":if(d||f)if(d){c("#c-access-rights-by-app").hide();c(".c-shown-on-access").show();c("#c-login-block").show();c("#c-password-block").show();
break}else return c("#c-login-block").show().find(".cancel").one("click.access",function(){C.val(D);v()}).end().find(".c-tab-toggle:first").click(),c("#c-password-block").show(),!1;else return c("#c-credentials-block").show().find(".c-login-input").focus().end().find(".cancel").one("click.access",function(){C.val(D);v()}),!1;default:return!1}l&&(c("#c-login-block").show(),c("#c-password-block").show());D=G;return!0}function y(){function B(z,F,k){return c.post(h+"?module=accessSave&action=rights&id="+
g,{app_id:z,name:F,value:k},"json")}var G=C.val();void 0===G&&(G="1");(function(){switch(G){case "0":return c.post(h+"?module=accessSave&action=makeuser",{id:g},"json").then(function(){return B("webasyst","backend",0)});case "1":return B("webasyst","backend",1);case "remove":return c.post(h+"?module=accessSave&action=revoke",{id:g},"json")}})().then(function(){t&&"0"==G?c("#c-access-rights-hint-customize").show():c("#c-access-rights-hint-warning").hide()})}var C=c("#c-access-rights-toggle"),A=c("#access-rights-toggle-confirm"),
D=C.val();p?c(".c-shown-on-access").hide():c(".c-shown-on-access").show();x();A.on("click",".cancel",function(){C.val(D);A.hide()});A.on("click",".button",function(){A.hide();v()});C.change(function(){if(d){c("#c-access-rights-hint-warning").hide();c("#c-access-rights-hint-customize").hide();var B=C.val();void 0===B&&(B="1");B===D?A.hide():A.show()}else x(!0)})})(a.is_own_profile,a.contact_no_access,a.contact_groups_no_access);new UserAccessTable({$wrapper:c("#c-access-rights-wrapper"),contact_id:g,
is_frame:!0})};window.UserAccessTable=function(a){var e=a.$wrapper,b=a.contact_id,d=a.is_frame||!1;e.on("click",".t-access-status",function(g){g.preventDefault();g=c(this);showAccessDialog(g,g.data("app-id"),b,!0,d)});var f;c(document).on("team_access_level_changed",f=function(g,h){c.contains(document.body,e[0])?e.find('.t-access-status[data-app-id="'+h.app_id+'"]').removeClass("type-no type-limited type-full type-"+h.prev_level).addClass("type-"+h.new_level):c(document).off("team_access_level_changed",
f)})};window.showAccessDialog=function(a,e,b,d,f){a.trigger("close");c.post(c.team.app_url+"?module=access&action=dialog",{user_id:b,app_id:e},function(g){g={html:g};f&&d&&(g.setPosition=function(h){var m=c(window).width();return{top:a.offset().top,left:parseInt((m-h.width)/2)}});c.waDialog(g)})}})(jQuery);var GroupPage=function(c){GroupPage=function(a){this.$wrapper=a.$wrapper;this.group_id=a.group_id;this.map_adapter=a.map_adapter;this.latitude=a.latitude;this.longitude=a.longitude;this.address=a.address;this.can_manage=a.can_manage;this.initClass()};GroupPage.prototype.initClass=function(){this.bindEvents();this.can_manage&&(this.initEditableName(),this.initEditableDescription());this.initInfoBlock();this.initMap()};GroupPage.prototype.bindEvents=function(){var a=this;a.$wrapper.on("click",".js-open-map-link",
function(){a.toggleMap()});a.$wrapper.on("click",".js-edit-group",function(e){e.preventDefault();a.group_id&&!GroupManage.is_locked&&GroupManage.prototype.showEditGroupDialog(a.group_id)});a.$wrapper.on("click",".js-delete-group",function(e){e.preventDefault();a.group_id&&!GroupManage.is_locked&&GroupManage.prototype.showDeleteDialog(a.group_id)})};GroupPage.prototype.toggleMap=function(){this.$wrapper.find(".t-map-wrapper").slideToggle(200)};GroupPage.prototype.initMap=function(){function a(){var b=
e.$wrapper.find("#t-location-map"),d=new TeamMap(b,e.map_adapter);""!==e.latitude&&""!==e.longitude?d.render(e.latitude,e.longitude):d.geocode(e.address,function(f,g){d.render(f,g)})}var e=this;"yandex"===e.map_adapter?ymaps.ready(a):a()};GroupPage.prototype.initEditableName=function(){var a=this.$wrapper.find(".js-name-editable").first();a&&new TeamEditable(a,{groupId:this.group_id,reloadSidebar:!0,api:{save:c.team.app_url+"?module=group&action=save"},target:"data[name]"})};GroupPage.prototype.initEditableDescription=
function(){var a=this.$wrapper.find(".js-desc-editable").first();a&&new TeamEditable(a,{groupId:this.group_id,api:{save:c.team.app_url+"?module=group&action=save"},target:"data[description]"})};GroupPage.prototype.initInfoBlock=function(){var a=this.$wrapper.find(".t-info-notice-wrapper"),e=a.find(".t-info-notice-toggle"),b=new c.store;b.get("team/empty_group_notice_hide")?a.hide():a.show();e.on("click",function(d){d.preventDefault();b.set("team/empty_group_notice_hide",1);a.remove()})};return GroupPage}(jQuery),
GroupManage=function(c){GroupManage=function(a){this.$wrapper=a.$wrapper;this.$groupUsersW=this.$wrapper.find(".t-users-list.is-used-list");this.$groupUsersHint=this.$wrapper.find(".t-empty-users-in-group");this.$otherUsersW=this.$wrapper.find(".t-users-list.is-unused-list");this.$otherUsersHint=this.$wrapper.find(".t-empty-users-outside-group");this.group_id=a.group_id;this.hidden_class="is-hidden";this.locales=a.locales;this.xhr=this.is_locked=this.$sidebarLink=!1;this.group_count=this.$groupUsersW.find(".t-user-wrapper").length;
this.other_count=this.$otherUsersW.find(".t-user-wrapper").length;this.initClass()};GroupManage.prototype.initClass=function(){this.bindEvents();this.initAutoComplete();this.initEditableName()};GroupManage.prototype.bindEvents=function(){var a=this;a.$wrapper.on("click",".js-edit-group",function(e){e.preventDefault();a.group_id&&!a.is_locked&&a.showEditGroupDialog()});a.$wrapper.on("click",".js-delete-group",function(e){e.preventDefault();a.group_id&&!a.is_locked&&a.showDeleteDialog()});a.$groupUsersW.on("click",
".js-move-user",function(e){e.preventDefault();a.is_locked||a.moveUser(c(this).closest(".t-user-wrapper"),!1)});a.$otherUsersW.on("click",".js-move-user",function(e){e.preventDefault();a.is_locked||a.moveUser(c(this).closest(".t-user-wrapper"),!0)})};GroupManage.prototype.showEditGroupDialog=function(a){var e=this;a={id:e.group_id||a};e.is_locked||(e.is_locked=!0,e.xhr&&(e.xhr.abort(),e.xhr=!1),e.xhr=c.get("?module=group&action=edit",a,function(b){c.waDialog({html:b});e.is_locked=!1}))};GroupManage.prototype.showDeleteDialog=
function(a){var e=this,b=c.team.app_url+"?module=group&action=deleteConfirm";a={id:e.group_id||a};e.is_locked||(e.is_locked=!0,e.xhr&&(e.xhr.abort(),e.xhr=!1),e.xhr=c.get(b,a,function(d){c.waDialog({html:d});e.is_locked=!1}))};GroupManage.prototype.moveUser=function(a,e){var b=this,d={user_id:a.data("user-id"),group_id:b.group_id};if(!b.is_locked){b.xhr&&(b.xhr.abort(),b.xhr=!1);var f=e?c.team.app_url+"?module=group&action=userAdd":c.team.app_url+"?module=group&action=userRemove";e?(b.$groupUsersW.append(a),
b.group_count++,b.other_count--):(b.$otherUsersW.prepend(a),b.group_count--,b.other_count++);0>=b.group_count?(b.$groupUsersW.addClass(b.hidden_class),b.$groupUsersHint.removeClass(b.hidden_class)):(b.$groupUsersW.removeClass(b.hidden_class),b.$groupUsersHint.addClass(b.hidden_class));0>=b.other_count?(b.$otherUsersW.addClass(b.hidden_class),b.$otherUsersHint.removeClass(b.hidden_class)):(b.$otherUsersW.removeClass(b.hidden_class),b.$otherUsersHint.addClass(b.hidden_class));b.setCount(b.group_count);
b.xhr=c.post(f,d,function(g){"ok"!==g.status&&console.error("Error while sending data on "+f,g);b.is_locked=!1})}};GroupManage.prototype.setCount=function(a){var e=c.team.app_url+"group/"+this.group_id+"/";this.$sidebarLink||(this.$sidebarLink=c.team.sidebar.$wrapper.find('a[href="'+e+'"] '));if(this.$sidebarLink.length){var b=this.$sidebarLink.closest("li");b.find(".indicator").remove();b.find(".count").text(a);c.team.sidebar.saveCount(e,a)}};GroupManage.prototype.initAutoComplete=function(){function a(){clearTimeout(g);
f.length&&(f.remove(),f=!1)}function e(h){f=c('<span class="t-hint"><i class="fas fa-check text-green custom-mr-4"></i>'+h+"</span>");d.after(f);g=setTimeout(a,1E3)}var b=this,d=b.$wrapper.find(".t-autocomplete-wrapper .t-input"),f=!1,g=0;d.autocomplete({source:function(h,m){var n=c.team.app_url+"?module=autocomplete&type=user";h={term:h.term};b.group_id&&(h.group_id=b.group_id);c.post(n,h,function(l){m(l)},"json")},minLength:2,open:function(){a()},focus:function(){return!1},select:function(h,m){m.item.id&&
(h=b.$otherUsersW.find('.t-user-wrapper[data-user-id="'+m.item.id+'"]'),h.length?(b.moveUser(h,!0),e(b.locales.added)):e(b.locales.in_group));d.val("");return!1}})};GroupManage.prototype.initEditableName=function(){var a=this.$wrapper.find(".js-name-editable").first();a&&new TeamEditable(a,{groupId:this.group_id,reloadSidebar:!0,api:{save:c.team.app_url+"?module=group&action=save"},target:"data[name]"})};return GroupManage}(jQuery),GroupEditDialog=function(c){GroupEditDialog=function(a){this.$wrapper=
a.$wrapper;this.$form=this.$block=this.$wrapper.find(".dialog-body");this.$iconToggle=this.$block.find(".t-icon-toggle");this.$addressToggle=this.$block.find(".t-address-toggle");this.$mapToggle=this.$block.find(".t-map-toggle");this.$submitButton=this.$form.find('input[type="submit"]');this.$groupType=this.$form.find('[name="data[type]"]');this.selected_class="selected";this.hidden_class="hidden";this.has_error_class="state-error";this.locales=a.locales;this.dialog=this.$wrapper.data("dialog");this.$activeIcon=
this.$iconToggle.find("."+this.selected_class);this.is_locked=!1;this.save_timeout=0;this.is_map_loading=!1;this.map_type=a.map_type||"google";this.map_key=a.map_key||null;this.teamMap=null;this.bindEvents()};GroupEditDialog.prototype.bindEvents=function(){var a=this;a.$block.find(".js-type-toggle").waToggle({ready:function(b){"location"===b.$active.data("type")&&!a.teamMap&&a.map_key&&setTimeout(function(){return a.teamMap=a.initMap(a.map_type,a.map_key)})},change:function(b,d){a.setType(c(d));"location"===
d.dataset.type&&!a.teamMap&&a.map_key&&(a.teamMap=a.initMap(a.map_type,a.map_key))}});a.$iconToggle.on("click",".t-icon-item",function(b){b.preventDefault();a.setIcon(c(this))});a.$form.on("submit",function(b){b.preventDefault();a.is_locked||a.save()});a.$form.find("input, textarea").on("mousedown",function(){var b=c(this),d=b.hasClass(a.has_error_class);a.$form.find(".js-submit-loading").remove();d&&b.removeClass(a.has_error_class).closest(".value").find(".state-error-hint").remove()});var e=a.$form.find(".t-icon-list");
e.find(".t-icon-item.selected").length||a.setIcon(e.find(".t-icon-item:eq(0)"))};GroupEditDialog.prototype.setType=function(a){var e="group"===a.data("type");this.$groupType.val(a.data("type"));this.$iconToggle.toggleClass(this.hidden_class,!e);this.$addressToggle.toggleClass(this.hidden_class,e);this.$mapToggle.toggleClass(this.hidden_class,e);this.dialog.resize()};GroupEditDialog.prototype.setIcon=function(a){var e=a.data("icon-class");if(a.hasClass(this.selected_class))return!1;this.$activeIcon.length&&
this.$activeIcon.removeClass(this.selected_class);this.$form.find('input[name="data[icon]"]').val(e).trigger("change");a.addClass(this.selected_class);this.$activeIcon=a};GroupEditDialog.prototype.save=function(a){function e(n){function l(v){b.$form.find(".state-error-hint").remove();c.each(v,function(x,y){x=b.$form.find("[name='"+y.field+"']");x.length&&x.addClass(b.has_error_class).after('<p class="state-error-hint custom-my-0">'+b.locales[y.locale]+"</p>")})}var p={},t=[];c.each(n,function(v,x){p[x.name]=
x.value});c.trim(p["data[name]"]).length||t.push({field:"data[name]",locale:"empty"});return t.length?(l(t),!1):p}var b=this,d;a=a||0;if(!b.is_locked)if(b.is_locked=!0,d=e(b.$form.serializeArray())){if(b.is_map_loading&&5>a)return b.is_locked=!1,b.save_timeout=setTimeout(function(){c.contains(document,b.$wrapper[0])&&b.save(a+1)},1E3),!1;b.$form.find(".js-submit-loading").remove();b.$submitButton.parent().append("<i class='fas fa-spin fa-spinner js-submit-loading wa-animation-spin speed-1000'></i>");
var f=function(){c.post("?module=group&action=save",d,function(n){"ok"==n.status&&(c.team.content.load(c.team.app_url+"group/"+n.data.id+"/manage/"),c.team.sidebar.reload(),n=c.team.sidebar.$body.find('[data-group-id="'+n.data.id+'"]'),c.team.sidebar.setItem(n),b.is_locked=!1,b.dialog.close())}).always(function(){b.$form.find(".js-submit-loading").remove()})},g=d["data[location][address]"],h=d["data[location][latitude]"],m=d["data[location][longitude]"];!g||h&&m||!b.teamMap?f():b.teamMap.geocode(g,
function(n,l){d["data[location][latitude]"]=n;d["data[location][longitude]"]=l;f()},function(){f()})}else b.is_locked=!1};GroupEditDialog.prototype.initMap=function(a){function e(t){function v(x,y){h.is(":hidden")&&h.show();p.render(x,y);g.val(x);f.val(y);b.dialog.resize()}clearTimeout(n);"string"===c.type(t)?(b.is_map_loading=!0,p.geocode(t,function(x,y){g.val(x);f.val(y);m.hide();v(x,y);b.is_map_loading=!1},function(){h.hide();f.val("");g.val("");m.show();b.is_map_loading=!1})):v(t.lat,t.lng)}var b=
this,d=b.$addressToggle.find(".f-location-edit-address-input"),f=b.$addressToggle.find(".t-location-longitude-input"),g=b.$addressToggle.find(".t-location-latitude-input"),h=b.$mapToggle.find(".t-location-edit-map"),m=b.$addressToggle.find(".t-map-hint"),n=0;if(0<d.length){var l=b.$form.find(".value").first().width();h.width(l);h.height(l/1.618)}var p=new TeamMap(h,a);a=f.val();l=g.val();a&&l&&e({lat:l,lng:a});d.on("change",function(){var t=c(this).val();t.length?e(t):(f.val(""),g.val(""),h.hide(400,
function(){return b.dialog.resize()}))});d.on("keyup",function(){clearTimeout(n);var t=c(this).val();t.length?(b.is_map_loading=!0,n=setTimeout(function(){e(t)},1E3)):(f.val(""),g.val(""),h.hide(400,function(){return b.dialog.resize()}))});return p};return GroupEditDialog}(jQuery),GroupDeleteDialog=function(c){GroupDeleteDialog=function(a){this.$wrapper=a.$wrapper;this.$block=this.$wrapper.find(".t-dialog-block");this.$deleteButton=this.$wrapper.find(".js-delete-event");this.api_enabled=window.history&&
window.history.replaceState;this.group_id=a.group_id;this.is_locked=!1;this.dialog={};this.initClass()};GroupDeleteDialog.prototype.initClass=function(){var a=this;setTimeout(function(){a.dialog=a.$wrapper.data("dialog")});if(!a.is_locked)a.$deleteButton.on("click",c.proxy(a.deleteFunction,a))};GroupDeleteDialog.prototype.deleteFunction=function(a){a.preventDefault();var e=this;a={id:e.group_id};e.is_locked=!0;c.post("?module=group&action=delete",a,function(b){"ok"==b.status&&(e.dialog.close(),e.api_enabled?
(history.state.content_uri=c.team.app_url,history.replaceState({reload:!0,content_uri:c.team.app_url},"",c.team.app_url),c.team.sidebar.reload(),c.team.content.reload()):location.href=c.team.app_url)},"json")};return GroupDeleteDialog}(jQuery);var SettingsPage=function(c){SettingsPage=function(a,e){this.$wrapper=a;this.$calendarToggle=this.$wrapper.find("#t-calendar-settings");this.$form=this.$wrapper.find("#calendar_settings");this.$submitButton=this.$wrapper.siblings(".bottombar").find('[type="submit"]');this.options=e;this.xhr=this.is_form_changed=this.is_locked=this.$notice=!1;this.initClass()};SettingsPage.prototype.initClass=function(){this.bindEvents();this.initSortable()};SettingsPage.prototype.bindEvents=function(){this.$calendarToggle.on("click",
".js-edit-calendar, .js-add-calendar",c.proxy(this.showEditDialog,this));this.$form.on("change","input, select, textarea",c.proxy(this.checkFormChanges,this));this.$form.on("submit",c.proxy(this.save,this))};SettingsPage.prototype.initSortable=function(){var a=this;a.$calendarToggle.sortable({animation:150,handle:".t-toggle",direction:"vertical",filter:".t-actions",onMove:function(e){if(e.related.classList.contains("t-actions"))return-1},onStart:function(){a.$notice&&(a.$notice.remove(),a.$notice=
!1)},onEnd:function(e){e.oldIndex!==e.newIndex&&a.saveCalendarsSort(e.item)}})};SettingsPage.prototype.checkFormChanges=function(){this.is_form_changed||(this.is_form_changed=!0,this.$submitButton.addClass("yellow"))};SettingsPage.prototype.showEditDialog=function(a){a.preventDefault();var e=this,b={};(a=parseInt(c(a.target).closest(".t-calendar-item").data("id")))&&(b.id=a);e.xhr&&(e.xhr.abort(),e.xhr=!1);e.xhr=c.post(e.options.api.editDialog,b,function(d){e.dialog=c.waDialog({html:d})})};SettingsPage.prototype.saveCalendarsSort=
function(a){function e(g){var h=c('<span class="t-notice state-success"><i class="fas fa-check-circle"></i></span>');h.appendTo(g);return h}var b=this,d=c(a);a=c.team.app_url+"?module=settings&action=calendarsSortSave";var f={calendars:function(){var g=[];b.$calendarToggle.find(".t-calendar-item").each(function(){var h=c(this).data("id");h&&0<h&&g.push(h)});return g}()};b.xhr&&(b.xhr.abort(),b.xhr=!1);b.$notice=function(g){var h=c('<span class="t-notice"><i class="fas fa-spin fa-spinner wa-animation-spin speed-1000"></i></span>');
h.appendTo(g);return h}(d);b.xhr=c.post(a,f,function(){b.$notice.remove();b.$notice=e(d);setTimeout(function(){b.$notice&&c.contains(document,b.$notice[0])&&b.$notice.remove()},1E3);b.xhr=!1})};SettingsPage.prototype.save=function(a){a.preventDefault();var e=this;e.is_form_changed&&!e.is_locked&&(a=e.$form.serializeArray(),e.$submitButton.append('<i class="fas fa-spinner wa-animation-spin speed-1000 custom-ml-4 js-profile-settings-spinner"></i>'),e.is_locked=!0,c.post(e.options.api.save,a,function(b){"ok"===
b.status&&(e.is_form_changed=!1,e.is_locked=!1,e.$submitButton.removeClass("yellow"),e.$submitButton.find(".js-profile-settings-spinner").remove())}))};return SettingsPage}(jQuery),CalendarEditDialog=function(c){CalendarEditDialog=function(a,e){this.$wrapper=a;this.$form=this.$block=this.$wrapper.find(".dialog-body");this.$styleWrapper=this.$block.find(".t-style-wrapper");this.$iconsWrapper=this.$block.find(".t-calendar-icons");this.$limitedToggle=this.$block.find(".t-limited-toggle");this.$limitedGroups=
this.$block.find(".t-hidden-content");this.$colorToggle=this.$block.find(".t-color-toggle");this.$nameField=this.$block.find('input[name="data[name]"]');this.$iconField=this.$block.find('input[name="data[icon]"]');this.$inputStatusBg=this.$block.find('input[name="data[status_bg_color]"]');this.$inputStatusFont=this.$block.find('input[name="data[status_font_color]"]');this.$inputEventBg=this.$block.find('input[name="data[bg_color]"]');this.$inputEventFont=this.$block.find('input[name="data[font_color]"]');
this.$pickerBgColor=this.$block.find(".js-bg-color");this.$badge_status=this.$block.find(".js-badge-preview.is-status");this.$badge_event=this.$block.find(".js-badge-preview.is-event");this.$badgeIcon=this.$block.find(".js-badge-icon");this.$badgeName=this.$block.find(".js-badge-name");this.$fields=this.$form.find("input, textarea");this.calendar_id=e.calendar_id;this.teamDialog=this.$wrapper.data("dialog");this.options=e;this.classes={selected_class:"is-selected",hidden_class:"is-hidden",has_error_class:"state-error"};
this.$selectedStyleButton=this.$styleWrapper.find("."+this.classes.selected_class);this.xhr=this.is_locked=!1;this.initClass()};CalendarEditDialog.prototype.initClass=function(){this.bindEvents();this.initColorPicker();this.checkCustomColor()};CalendarEditDialog.prototype.bindEvents=function(){this.$block.on("click",".js-delete-calendar",c.proxy(this.showDeleteConfirm,this));this.$styleWrapper.on("click",".t-style-item",c.proxy(this.setStyleToggle,this));this.$styleWrapper.on("click",".js-custom-color",
c.proxy(this.toggleCustomColor,this));this.$iconsWrapper.on("click",".t-calendar-icons--item",c.proxy(this.setBadgeIcon,this));this.$form.on("submit",c.proxy(this.save,this));this.$fields.on("mousedown",c.proxy(this.removeErrors,this));this.$nameField.on("change keyup",c.proxy(this.setPreviewName,this));this.$limitedToggle.on("change","input:radio",c.proxy(this.toggleLimitSection,this))};CalendarEditDialog.prototype.checkCustomColor=function(){this.$selectedStyleButton.length||(this.$styleWrapper.find(".js-custom-color-check").removeClass("hidden"),
this.$colorToggle.removeClass("hidden"))};CalendarEditDialog.prototype.setBadgeIcon=function(a){a.preventDefault();a=c(a.target);var e=a.find("svg");e=e.attr("data-prefix")+" fa-"+e.attr("data-icon");a.addClass(this.classes.selected_class).siblings().removeClass(this.classes.selected_class);this.$badgeIcon.html('<i class="'+e+'"></i>');this.$iconField.val(e)};CalendarEditDialog.prototype.toggleCustomColor=function(a){a.preventDefault();c(a.target).find(".js-custom-color-caret").toggleClass("fa-caret-down fa-caret-up");
this.$colorToggle.toggleClass("hidden");this.teamDialog.resize()};CalendarEditDialog.prototype.toggleLimitSection=function(a){a.target.value.length?this.$limitedGroups.show():this.$limitedGroups.hide();this.teamDialog.resize()};CalendarEditDialog.prototype.removeErrors=function(a){a=c(a.target);a.hasClass(this.classes.has_error_class)&&a.removeClass(this.classes.classes.has_error_class).closest(".value").find(".state-error-hint").remove()};CalendarEditDialog.prototype.setStyleToggle=function(a){a=
c(a.target);var e=a.css("color"),b=a.css("background-color"),d=this.colorConvert(b,-15).hex,f=this.colorConvert(b,40).hex;this.$selectedStyleButton.removeClass(this.classes.selected_class);this.setStyleData(e,b);a.addClass(this.classes.selected_class);this.$selectedStyleButton=a;this.$styleWrapper.find(".js-custom-color-check").addClass("hidden");this.$colorToggle.addClass("hidden");this.$badge_status.css({color:e,"background-color":b});this.$badge_event.css({color:d,"background-color":f})};CalendarEditDialog.prototype.setStyleData=
function(a,e){function b(d){d=d.split("(")[1].split(")")[0];d=d.split(",").splice(0,3);return"#"+d.map(function(f){f=parseInt(f).toString(16);return 1===f.length?"0"+f:f}).join("")}a.includes("#")||(a=b(a));e.includes("#")||(e=b(e));this.$badge_event[0].style.removeProperty("box-shadow");this.$inputStatusBg.val(e).trigger("change");this.$inputStatusFont.val(a).trigger("change");this.$inputEventBg.val(this.colorConvert(e,40).hex).trigger("change");this.$inputEventFont.val(this.colorConvert(e,-15).hex).trigger("change");
this.$pickerBgColor.css("background-color",e)};CalendarEditDialog.prototype.showDeleteConfirm=function(a){a.preventDefault();var e=this;e.is_locked||(a={id:e.calendar_id},e.is_locked=!0,e.xhr&&(e.xhr.abort(),e.xhr=!1),e.xhr=c.get(e.options.api.showDeleteConfirm,a,function(b){c.waDialog({html:b});e.is_locked=!1;e.teamDialog.close()}))};CalendarEditDialog.prototype.initColorPicker=function(){var a=this,e=function(){e=function(b){this.$wrapper=b.$wrapper;this.$field=this.$wrapper.querySelector(".t-color-field");
this.$pick_color_btn=this.$wrapper.querySelector(".js-show-color-picker");this.pickr_options={el:this.$pick_color_btn,theme:"classic",appClass:"wa-pcr-app small",lockOpacity:!0,position:"right-start",useAsButton:!0,container:a.$wrapper[0],default:this.$field.value||"#42445a",components:{palette:!0,hue:!0}};this.initClass()};e.prototype.initClass=function(){function b(f){f=f.hasOwnProperty("toHEXA")?f.toHEXA().toString(0):f.target.value;d.$field.value=f;d.$pick_color_btn.style.backgroundColor=f;d.$pick_color_btn.classList.contains("js-bg-color")&&
(a.$badge_status.css("background-color",f),a.$badge_event.css("background-color",a.colorConvert(f,40).hex),a.$badge_event.css("color",f),a.$form.find('[name="data[status_bg_color]"]').val(f),a.$form.find('[name="data[bg_color]"]').val(a.colorConvert(f,40).hex),a.$form.find('[name="data[font_color]"]').val(f));d.$pick_color_btn.classList.contains("js-font-color")&&(a.$badge_status.css("color",f),a.$form.find('[name="data[status_font_color]"]').val(f));a.$styleWrapper.find(".js-custom-color-check").removeClass("hidden");
a.$selectedStyleButton.removeClass(a.classes.selected_class)}var d=this;Pickr.create(d.pickr_options).on("change",function(f){return b(f)});d.$wrapper.dataset.colorPicker=d;d.$field.addEventListener("keyup",b,!1)};return e}();a.$styleWrapper.find(".t-color-toggle .t-toggle").each(function(){new e({$wrapper:this})})};CalendarEditDialog.prototype.setPreviewName=function(a){this.$badgeName.text(a.target.value.length?a.target.value:this.options.locales.preview)};CalendarEditDialog.prototype.colorConvert=
function(a,e){e=void 0===e?0:e;var b=0,d=0,f=0;a.includes("#")?4===a.length?(b="0x"+a[1]+a[1],d="0x"+a[2]+a[2],f="0x"+a[3]+a[3]):7===a.length&&(b="0x"+a[1]+a[2],d="0x"+a[3]+a[4],f="0x"+a[5]+a[6]):(f=a.split("(")[1].split(")")[0].split(",").splice(0,3),b=f[0],d=f[1],f=f[2]);b/=255;d/=255;f/=255;var g=Math.min(b,d,f),h=Math.max(b,d,f),m=h-g,n=0,l=a=0;n=0===m?0:h===b?(d-f)/m%6:h==d?(f-b)/m+2:(b-d)/m+4;n=Math.round(60*n);0>n&&(n+=360);l=(h+g)/2;a=0==m?0:m/(1-Math.abs(2*l-1));a=+(100*a).toFixed();l=+(100*
l).toFixed();0!==e&&(50<=l&&(l-=20),0<e?(l+=parseInt(e,10),100<=l&&(l-=10)):0>e&&(l+=parseInt(e,10)));e={hsl:"hsl("+n+","+a+"%,"+l+"%)"};l/=100;var p=a*Math.min(l,1-l)/100;b=function(t){t=(t+n/30)%12;return Math.round(255*(l-p*Math.max(Math.min(t-3,9-t,1),-1))).toString(16).padStart(2,"0")};e.hex="#"+b(0)+b(8)+b(4);return e};CalendarEditDialog.prototype.save=function(a){a.preventDefault();var e=this;e.is_locked||((a=function(b){function d(h){e.$form.find(".state-error-hint").remove();c.each(h,function(m,
n){m=e.$form.find('[name="'+n.field+'"]');m.length&&m.addClass(e.classes.has_error_class).after('<div class="state-error-hint custom-mt-4">'+e.options.locales[n.locale]+"</div>")})}var f={},g=[];c.each(b,function(h,m){f[m.name]=m.value});f["data[is_limited]"]||delete f["data[is_limited]"];c.trim(f["data[name]"]).length||g.push({field:"data[name]",locale:"empty"});return g.length?(d(g),!1):f}(e.$form.serializeArray()))?(e.is_locked=!0,c.post(e.options.api.save,a,function(b){"ok"!==b.status?console.warn(b):
(e.is_locked=!1,c.team.content.reload(),c.team.sidebar.reload(),e.teamDialog.close())})):(console.warn("have no data to save"),e.is_locked=!1,e.teamDialog.close()))};return CalendarEditDialog}(jQuery),CalendarDeleteDialog=function(c){CalendarDeleteDialog=function(a,e){this.$wrapper=a;this.$block=this.$wrapper.find(".dialog-body");this.$deleteButton=this.$block.find(".js-delete-calendar");this.options=e;this.is_locked=!1;this.initClass()};CalendarDeleteDialog.prototype.initClass=function(){this.$deleteButton.on("click",
c.proxy(this.deleteCalendar,this))};CalendarDeleteDialog.prototype.deleteCalendar=function(a){a.preventDefault();var e=this;e.is_locked||(a={id:e.options.calendar_id},e.is_locked=!0,c.post(e.options.api.delete,a,function(b){"ok"!==b.status?console.warn(b):(c.team.content.reload(),e.$wrapper.data("dialog").close())},"json"))};return CalendarDeleteDialog}(jQuery);var SiteApiTokenPage=function(c){SiteApiTokenPage=function(a){this.$wrapper=a.$wrapper;this.locale=a.locale;this.initClass()};SiteApiTokenPage.prototype.initClass=function(){this.initRemoveApiToken()};SiteApiTokenPage.prototype.initRemoveApiToken=function(){var a=this,e=a.$wrapper.find(".js-api-tokens-list"),b;a.$wrapper.on("click",".js-remove-api-token",function(d){d.preventDefault();d.stopImmediatePropagation();var f=c(this).closest(".js-token-item"),g=f.find("svg"),h=f.data("token");d=f.data("contact-id");
var m={action:"remove",token_id:h,contact_id:d};c.waDialog.confirm({title:a.locale.remove_ask,success_button_title:a.locale.delete,success_button_class:"danger",cancel_button_title:a.locale.cancel,cancel_button_class:"light-gray",onSuccess:function(){b&&!h?console.warn("System error. is_locked="+b+". token_id="+h):(b=!0,g.removeClass("fa-times").addClass("fa-spin fa-spinner wa-animation-spin speed-1000"),c.post("?module=apiTokensRemove",m,function(n){n.status&&"ok"===n.status?(f.remove(),e.find(".js-token-item")):
(b=!1,g.removeClass("fa-spin fa-spinner wa-animation-spin speed-1000").addClass("fa-times"))}).always(function(){b=!1;g.removeClass("fa-spin fa-spinner wa-animation-spin speed-1000").addClass("fa-times")}))}})})};return SiteApiTokenPage}(jQuery);var UserList=function(c){UserList=function(a){this.$wrapper=a.$wrapper;this.$items=this.$wrapper.find(".t-user-wrapper");this.$draggableItems=this.$wrapper.find(".js-move-user");this.initClass()};UserList.prototype.initClass=function(){this.initHightlight();this.initDraggable()};UserList.prototype.initDraggable=function(){var a;c(".js-move-user").mousedown(function(){document.activeElement.blur()});this.$draggableItems.draggable({helper:"clone",delay:200,handle:".userpic, .details",appendTo:document.body,
start:function(e,b){b.helper.addClass("is-clone align-center list").find(" > *:not(.userpic, .image)").addClass("hidden").end().find(" > a").css({border:"0.1875rem solid var(--thumbs-highlighted-color)","border-radius":"50%",display:"inline-block"});(a=c.team.sidebar.$wrapper.find(".js-drop-block"))&&a.addClass("t-drop-here")},stop:function(e,b){e=b.helper;var d=e.clone();d.insertAfter(e).fadeOut(270);setTimeout(function(){d.remove()},300);a&&a.removeClass("t-drop-here")}})};UserList.prototype.initHightlight=
function(){function a(b){return new Date(b.year,b.month-1,b.day,b.hours,b.minutes,b.seconds)}var e=c.team.sidebar.options.link_count_update_date;e&&(e=a(e),this.$items.each(function(){var b=c(this),d=b.data("update-datetime");if(d&&d.length){var f=d.split(" ");d=f[0].split("-");f=f[1].split(":");d={year:parseInt(d[0]),month:parseInt(d[1]),day:parseInt(d[2]),hours:parseInt(f[0]),minutes:parseInt(f[1]),seconds:parseInt(f[2])};a(d)>e&&b.find(".userpic").addClass("t-users-avatar-highlight")}}))};return UserList}(jQuery);var WelcomePage=function(c){WelcomePage=function(a){this.$wrapper=a.$wrapper;this.$inviteWrapper=this.$wrapper.find("#t-invite-wrapper");this.$inviteList=this.$inviteWrapper.find(".t-invite-list");this.locales=a.locales;this.error_class="state-error";this.is_locked=!1;this.switch_count=3;this.initClass()};WelcomePage.prototype.initClass=function(){c(document).on("ready",function(){c.team.content.is_enabled=!1});this.initWaToggle();this.bindEvents()};WelcomePage.prototype.bindEvents=function(){var a=
this;a.$wrapper.on("click",".js-skip-page",function(e){e.stopPropagation()});a.$wrapper.on("click",".js-send-invites",function(e){e.preventDefault();a.is_locked||a.sendInvites()});a.$inviteWrapper.on("click",".js-add-invite",function(e){e.preventDefault();a.addNewInvite()});a.$inviteWrapper.on("click",".js-remove-invite",function(e){e.preventDefault();c(this).closest("li").remove()});a.$inviteWrapper.on("click","."+a.error_class,function(){a.removeErrors(c(this))})};WelcomePage.prototype.initWaToggle=
function(){this.$inviteWrapper.find(".js-access-toggle").waToggle({change:function(a,e,b){b.$wrapper.find('[type="hidden"]').prop("checked","full"===e.dataset.type).attr("checked","full"===e.dataset.type)}})};WelcomePage.prototype.addNewInvite=function(){var a=this.$inviteWrapper.find(".t-invite-template").clone().html();a=c("<li>"+a+"</li>");this.switch_count+=1;a.find('[type="checkbox"]').attr("id","access_switch_"+this.switch_count);a.find("label").attr("for","access_switch_"+this.switch_count);
this.$inviteList.append(a);this.initWaToggle()};WelcomePage.prototype.sendInvites=function(){function a(g){var h=[];c.each(g,function(m,n){m=n.name;n=n.text;var l=parseInt(m.replace(/[^0-9]/g,""));l=e.$inviteList.find(".t-invite-item").eq(l).find('[type="email"]');(l.length||"general"==m)&&h.push({$field:l,name:m,locale:n})});e.displayErrors(h)}var e=this,b=c.team.app_url+"?module=welcome&action=save",d=function(){var g=[],h=[];e.$inviteList.find(".t-invite-item").each(function(m){var n=c(this).find('[type="email"]'),
l=c(this).find('[type="checkbox"]'),p=n.val();l=l.prop("checked");c.trim(p).length&&(p.match(".+@.+")?(g.push({name:"data["+m+"][email]",value:p}),g.push({name:"data["+m+"][access]",value:l})):h.push({$field:n,locale:e.locales.incorrect}))});return h.length?(e.displayErrors(h),!1):g.length?g:!1}(),f=e.$wrapper.find(".js-send-invites");e.is_locked=!0;f.attr("disabled",e.is_locked).find("svg").toggleClass("hidden",!e.is_locked);d?c.post(b,d,function(g){g.errors&&g.errors.length?a(g.errors):location.href=
c.team.app_url}).always(function(){e.is_locked=!1;f.attr("disabled",e.is_locked).find("svg").toggleClass("hidden",!e.is_locked)}):(e.is_locked=!1,f.attr("disabled",e.is_locked).find("svg").toggleClass("hidden",!e.is_locked))};WelcomePage.prototype.removeErrors=function(a){var e=this.error_class;a?(a.removeClass(e),a.closest(".t-invite-item").find(".state-error-hint").remove()):(this.$wrapper.find(".state-error-hint").remove(),this.$wrapper.find("."+e).removeClass(e))};WelcomePage.prototype.displayErrors=
function(a){var e=this,b=e.error_class;e.removeErrors();c.each(a,function(d,f){d='<span class="state-error-hint" style="display: block">'+f.locale+"</span>";"general"==f.name?e.$inviteWrapper.after(d):f.$field.addClass(b).closest(".t-invite-item").append(d)})};return WelcomePage}(jQuery);var LongActionProcess=function(c){var a="",e="",b=500,d=750,f=[],g={},h=null,m,n,l,p,t,v,x,y,C=!1,A=function(){for(;0<f.length;){var z=f.shift();z&&clearTimeout(z)}},D=function(){var z=c.extend(!0,{},g);z.processId=e;z.cleanup=1;c.post(a,z,function(F){m&&m(F)}).always(function(){A()})},B=function(z){C||(z=z||b,z=setTimeout(function(){var F=c.extend(!0,{},g);F.processId=e;c.post(a,F,function(k){k?k.ready?(n&&n.call(h,k),D()):k.error?p&&p.call(h,k):k.progress?(l&&l.call(h,k),B()):k.warning?(t&&t.call(h,
k),B()):B(d):B(d);y&&y.call(h,k)},"json").error(function(){B(d)})},z),f.push(z))},G=function(z){if(!z.url)throw Error("Url is required");a=z.url;b=z.step_delay||b;d=z.rest_delay||d;g=z.post_data||g;m=z.onCleanup;n=z.onReady;l=z.onProgress;p=z.onError;t=z.onWarning;v=z.onStart;x=z.onStop;y=z.onAlways;h=this};c.extend(G.prototype,{start:function(){v&&v();var z=c.extend(!0,{},g);c.post(a,z,function(F){F&&F.processId?(e=F.processId,B(100),B(200)):F&&F.error?p&&p.call(h,F):p&&p.call(h,"Server error")},
"json").error(function(){p&&p.call(h,"Server error")})},stop:function(){C=!0;x&&x.call(h);A()}});return G}(jQuery);var TeamMap=function(c){var a=function(e,b,d){if(!e)throw Error("DOM element is required");this.$map=c(e);(this.provider=b)&&0>["google","yandex","disabled"].indexOf(this.provider)&&console.error("Not supported map provider: %s".replace("%s",this.provider));this.map_info=null;this.initClass()};a.prototype.initClass=function(){};a.prototype.render=function(e,b){switch(this.provider){case "google":return this.googleRender(e,b);case "yandex":return this.yandexRender(e,b)}};a.prototype.googleRender=function(e,
b){var d=this;d.map_info=d.map_info||{};e=new google.maps.LatLng(e,b);d.map_info.map||(b={zoom:12,center:e,mapTypeId:google.maps.MapTypeId.ROADMAP},d.map_info.map=new google.maps.Map(d.$map.get(0),b));d.map_info.marker&&d.map_info.marker.setMap(null);d.map_info.marker=new google.maps.Marker({position:e,map:d.map_info.map});d.map_info.map.setCenter(e);a.google_error_html=a.google_error_html||"";setTimeout(function(){if(d.$map.find(".gm-err-container").length)d.$map.find(".gm-err-container").find(".gm-err-message").last().after('<div class="gm-err-message">'+
c.team.locales.map_check_your_key+"</div>"),a.google_error_html=d.$map.find(".gm-err-container").parent().html();else if(!d.$map.find(".gm-style").length)if(a.google_error_html)d.$map.children().html(a.google_error_html);else{var f='<div class="gm-err-container"><div class="gm-err-content"><div class="gm-err-icon"><img src="https://maps.gstatic.com/mapfiles/api-3/images/icon_error.png" draggable="false" style="user-select: none;"></div><div class="gm-err-title">:title:</div><div class="gm-err-message">:message1:</div><div class="gm-err-message">:message2:</div></div></div>'.replace(":title:",
c.team.locales.map_error_title);f=f.replace(":message1:",c.team.locales.map_error_message);f=f.replace(":message2:",c.team.locales.map_check_your_key);d.$map.children().html(f)}},5E3)};a.prototype.yandexRender=function(e,b){this.map_info=this.map_info||{};e=[e,b];this.map_info.map||(b={zoom:12,center:e,controls:["zoomControl","fullscreenControl"]},this.map_info.map=new ymaps.Map(this.$map.get(0),b));this.map_info.marker&&this.map_info.map.geoObjects.remove(this.map_info.marker);this.map_info.marker=
new ymaps.Placemark(e,null,{preset:"islands#redDotIcon"});this.map_info.map.geoObjects.add(this.map_info.marker);this.map_info.map.setCenter(e)};a.prototype.geocode=function(e,b,d){switch(this.provider){case "google":return this.googleGeocode(e,b,d);case "yandex":return this.yandexGeocode(e,b,d);default:d?d():b&&b()}};a.prototype.googleGeocode=function(e,b,d){var f=!1,g=!1;(new google.maps.Geocoder).geocode({address:e},function(h,m){f=!0;g||(m==google.maps.GeocoderStatus.OK?(h=h[0].geometry.location,
b(h.lat(),h.lng())):d&&d())});setTimeout(function(){f||(g=!0,d&&d(!0))},5E3)};a.prototype.yandexGeocode=function(e,b,d){ymaps.geocode(e,{results:1}).then(function(f){var g=1;f.metaData&&f.metaData.geocoder&&"found"in f.metaData.geocoder&&(g=f.metaData.geocoder.found);0>=g?d():(f=f.geoObjects.get(0).geometry.getCoordinates(),b(f[0],f[1]))},function(f){d(f)})};return a}(jQuery);var SwiperSlider=function(c){this.container=c.selector||".swiper-container";this.containerParent=document.querySelector(this.container).closest("#t-access-page");this.params=c.params||{};this.params.on=c.params.on||{};this.events=c.events||{};this.calculate_group_size=c.calculateGroupSize||!1;this.watch_nav=c.watchNav||!1;this.set_container_width=c.setContainerWidth||!1;this.swiper={};this.init()};
SwiperSlider.prototype.init=function(){var c=this;c.params.on.beforeInit=function(a){c.calculate_group_size&&(a.params.slidesPerGroup=c.calculateGroupSize(a),a.params.slidesPerView=c.calculateGroupSize(a));c.set_container_width&&c.setContainerWidth(a)};c.swiper=new Swiper(c.container,c.params);c.bindEvents();c.watch_nav&&c.showNavigation();c.set_container_width&&c.setContainerWidth(c.swiper)};
SwiperSlider.prototype.setContainerWidth=function(c){var a=this;c.onAny(function(){a.set_container_width.forEach(function(e){var b=document.body.clientWidth;b<=e?c.$el.css("width",b+"px"):c.$el.css("width","")})})};
SwiperSlider.prototype.showNavigation=function(){var c=this,a=c.swiper.navigation.prevEl,e=c.swiper.navigation.nextEl;if(c.containerParent)c.swiper.on("slideChange sliderMove",function(b){b.isEnd?(c.containerParent.classList.add("reachend"),e.children[0].classList.add("hidden")):b.isBeginning?(c.containerParent.classList.add("reachstart"),a.children[0].classList.add("hidden")):(c.containerParent.classList.remove("reachend"),c.containerParent.classList.remove("reachstart"),e.children[0].classList.remove("hidden"),
a.children[0].classList.remove("hidden"))});a&&e&&(a.classList.toggle("hidden",c.swiper.isLocked),e.classList.toggle("hidden",c.swiper.isLocked),c.swiper.on("lock unlock",function(){a.classList.toggle("hidden",c.swiper.isLocked);e.classList.toggle("hidden",c.swiper.isLocked)}))};
SwiperSlider.prototype.calculateGroupSize=function(c){var a=c.el.clientWidth-(c.params.slidesOffsetBefore||0)-(c.params.slidesOffsetAfter||0);c=c.wrapperEl.querySelector("."+c.params.slideClass).clientWidth;return Math.round(a/c)};SwiperSlider.prototype.bindEvents=function(){for(var c in this.events)if(this.events.hasOwnProperty(c))this.swiper.on(c,this.events[c])};
//# sourceMappingURL=team.min.js.map