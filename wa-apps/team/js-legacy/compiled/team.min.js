/*
 jquery-timepicker v1.11.5 - A jQuery timepicker plugin inspired by Google Calendar. It supports both mouse and keyboard navigation.
 Copyright (c) 2016 Jon Thornton - http://jonthornton.github.com/jquery-timepicker/
 License: MIT
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(e,a,d){e instanceof String&&(e=String(e));for(var b=e.length,c=0;c<b;c++){var f=e[c];if(a.call(d,f,c,e))return{i:c,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,a,d){if(e==Array.prototype||e==Object.prototype)return e;e[a]=d.value;return e};$jscomp.getGlobal=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var a=0;a<e.length;++a){var d=e[a];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(e,a){var d=$jscomp.propertyToPolyfillSymbol[a];if(null==d)return e[a];d=e[d];return void 0!==d?d:e[a]};
$jscomp.polyfill=function(e,a,d,b){a&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(e,a,d,b):$jscomp.polyfillUnisolated(e,a,d,b))};$jscomp.polyfillUnisolated=function(e,a,d,b){d=$jscomp.global;e=e.split(".");for(b=0;b<e.length-1;b++){var c=e[b];if(!(c in d))return;d=d[c]}e=e[e.length-1];b=d[e];a=a(b);a!=b&&null!=a&&$jscomp.defineProperty(d,e,{configurable:!0,writable:!0,value:a})};
$jscomp.polyfillIsolated=function(e,a,d,b){var c=e.split(".");e=1===c.length;b=c[0];b=!e&&b in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<c.length-1;f++){var k=c[f];if(!(k in b))return;b=b[k]}c=c[c.length-1];d=$jscomp.IS_SYMBOL_NATIVE&&"es6"===d?b[c]:null;a=a(d);null!=a&&(e?$jscomp.defineProperty($jscomp.polyfills,c,{configurable:!0,writable:!0,value:a}):a!==d&&(void 0===$jscomp.propertyToPolyfillSymbol[c]&&(d=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[c]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(c):$jscomp.POLYFILL_PREFIX+d+"$"+c),$jscomp.defineProperty(b,$jscomp.propertyToPolyfillSymbol[c],{configurable:!0,writable:!0,value:a})))};$jscomp.polyfill("Array.prototype.find",function(e){return e?e:function(a,d){return $jscomp.findInternal(this,a,d).v}},"es6","es3");
!function(e){"object"==typeof exports&&exports&&"object"==typeof module&&module&&module.exports===exports?e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){function a(g){g=g[0];return 0<g.offsetWidth&&0<g.offsetHeight}function d(g){if(g.minTime&&(g.minTime=y(g.minTime)),g.maxTime&&(g.maxTime=y(g.maxTime)),g.durationTime&&"function"!=typeof g.durationTime&&(g.durationTime=y(g.durationTime)),"now"==g.scrollDefault)g.scrollDefault=function(){return g.roundingFunction(y(new Date),
g)};else if(g.scrollDefault&&"function"!=typeof g.scrollDefault){var n=g.scrollDefault;g.scrollDefault=function(){return g.roundingFunction(y(n),g)}}else g.minTime&&(g.scrollDefault=function(){return g.roundingFunction(g.minTime,g)});if("string"===e.type(g.timeFormat)&&g.timeFormat.match(/[gh]/)&&(g._twelveHourTime=!0),!1===g.showOnFocus&&-1!=g.showOn.indexOf("focus")&&g.showOn.splice(g.showOn.indexOf("focus"),1),0<g.disableTimeRanges.length){for(var m in g.disableTimeRanges)g.disableTimeRanges[m]=
[y(g.disableTimeRanges[m][0]),y(g.disableTimeRanges[m][1])];g.disableTimeRanges=g.disableTimeRanges.sort(function(r,w){return r[0]-w[0]});for(m=g.disableTimeRanges.length-1;0<m;m--)g.disableTimeRanges[m][0]<=g.disableTimeRanges[m-1][1]&&(g.disableTimeRanges[m-1]=[Math.min(g.disableTimeRanges[m][0],g.disableTimeRanges[m-1][0]),Math.max(g.disableTimeRanges[m][1],g.disableTimeRanges[m-1][1])],g.disableTimeRanges.splice(m,1))}return g}function b(g){var n=g.data("timepicker-settings"),m=g.data("timepicker-list");
if(m&&m.length&&(m.remove(),g.data("timepicker-list",!1)),n.useSelect)var r=m=e("<select />",{"class":"ui-timepicker-select"});else m=e("<ul />",{"class":"ui-timepicker-list"}),r=e("<div />",{"class":"ui-timepicker-wrapper",tabindex:-1}),r.css({display:"none",position:"absolute"}).append(m);if(n.noneOption)if(!0===n.noneOption&&(n.noneOption=n.useSelect?"Time...":"None"),e.isArray(n.noneOption))for(var w in n.noneOption){if(parseInt(w,10)==w){var z=c(n.noneOption[w],n.useSelect);m.append(z)}}else z=
c(n.noneOption,n.useSelect),m.append(z);(n.className&&r.addClass(n.className),null===n.minTime&&null===n.durationTime||!n.showDuration)||("function"==typeof n.step?"function":n.step,r.addClass("ui-timepicker-with-duration"),r.addClass("ui-timepicker-step-"+n.step));z=n.minTime;"function"==typeof n.durationTime?z=y(n.durationTime()):null!==n.durationTime&&(z=n.durationTime);w=null!==n.minTime?n.minTime:0;var G=null!==n.maxTime?n.maxTime:w+C-1;w>G&&(G+=C);G===C-1&&"string"===e.type(n.timeFormat)&&n.show2400&&
(G=C);var K=n.disableTimeRanges,I=0,Q=K.length,N=n.step;"function"!=typeof N&&(N=function(){return n.step});for(var O=0;G>=w;O++,w+=60*N(O)){var L=w,M=D(L,n);if(n.useSelect)var J=e("<option />",{value:M});else J=e("<li />"),J.addClass(43200>L%86400?"ui-timepicker-am":"ui-timepicker-pm"),J.data("time",86400>=L?L:L%86400);J.text(M);if((null!==n.minTime||null!==n.durationTime)&&n.showDuration)if(M=H(w-z,n.step),n.useSelect)J.text(J.text()+" ("+M+")");else{var P=e("<span />",{"class":"ui-timepicker-duration"});
P.text(" ("+M+")");J.append(P)}Q>I&&(L>=K[I][1]&&(I+=1),K[I]&&L>=K[I][0]&&L<K[I][1]&&(n.useSelect?J.prop("disabled",!0):J.addClass("ui-timepicker-disabled")));m.append(J)}(r.data("timepicker-input",g),g.data("timepicker-list",r),n.useSelect)?(g.val()&&m.val(f(y(g.val()),n)),m.on("focus",function(){e(this).data("timepicker-input").trigger("showTimepicker")}),m.on("blur",function(){e(this).data("timepicker-input").trigger("hideTimepicker")}),m.on("change",function(){u(g,e(this).val(),"select")}),u(g,
m.val(),"initial"),g.hide().after(m)):(w=n.appendTo,"string"==typeof w?w=e(w):"function"==typeof w&&(w=w(g)),w.append(r),q(g,m),m.on("mousedown click","li",function(R){g.off("focus.timepicker");g.on("focus.timepicker-ie-hack",function(){g.off("focus.timepicker-ie-hack");g.on("focus.timepicker",F.show)});h(g)||g[0].focus();m.find("li").removeClass("ui-timepicker-selected");e(this).addClass("ui-timepicker-selected");A(g)&&(g.trigger("hideTimepicker"),m.on("mouseup.timepicker click.timepicker","li",
function(S){m.off("mouseup.timepicker click.timepicker");r.hide()}))}))}function c(g,n){var m,r,w;return"object"==typeof g?(m=g.label,r=g.className,w=g.value):"string"==typeof g?m=g:e.error("Invalid noneOption value"),n?e("<option />",{value:w,"class":r,text:m}):e("<li />",{"class":r,text:m}).data("time",String(w))}function f(g,n){return g=n.roundingFunction(g,n),null!==g?D(g,n):void 0}function k(g){g.target!=window&&(g=e(g.target),g.closest(".ui-timepicker-input").length||g.closest(".ui-timepicker-wrapper").length||
(F.hide(),e(document).unbind(".ui-timepicker"),e(window).unbind(".ui-timepicker")))}function h(g){g=g.data("timepicker-settings");return(window.navigator.msMaxTouchPoints||"ontouchstart"in document)&&g.disableTouchKeyboard}function l(g,n,m){if(!m&&0!==m)return!1;g=g.data("timepicker-settings");var r=!1;m=g.roundingFunction(m,g);return n.find("li").each(function(w,z){w=e(z);if("number"==typeof w.data("time"))return w.data("time")==m?(r=w,!1):void 0}),r}function q(g,n){n.find("li").removeClass("ui-timepicker-selected");
var m=y(t(g),g.data("timepicker-settings"));null!==m&&(g=l(g,n,m))&&(m=g.offset().top-n.offset().top,(m+g.outerHeight()>n.outerHeight()||0>m)&&n.scrollTop(n.scrollTop()+g.position().top-g.outerHeight()),g.addClass("ui-timepicker-selected"))}function p(g,n){if(""!==this.value&&"timepicker"!=n){var m=e(this);if(!m.is(":focus")||g&&"change"==g.type){g=m.data("timepicker-settings");var r=y(this.value,g);if(null===r)return void m.trigger("timeFormatError");var w=!1;if(null!==g.minTime&&null!==g.maxTime&&
(r<g.minTime||r>g.maxTime)&&(w=!0),e.each(g.disableTimeRanges,function(){return r>=this[0]&&r<this[1]?(w=!0,!1):void 0}),g.forceRoundTime){var z=g.roundingFunction(r,g);z!=r&&(r=z,n=null)}g=D(r,g);w?u(m,g,"error")&&m.trigger("timeRangeError"):u(m,g,n)}}}function t(g){return g.is("input")?g.val():g.data("ui-timepicker-value")}function u(g,n,m){if(g.is("input")){g.val(n);var r=g.data("timepicker-settings");r.useSelect&&"select"!=m&&"initial"!=m&&g.data("timepicker-list").val(f(y(n),r))}return g.data("ui-timepicker-value")!=
n?(g.data("ui-timepicker-value",n),"select"==m?g.trigger("selectTime").trigger("changeTime").trigger("change","timepicker"):-1==["error","initial"].indexOf(m)&&g.trigger("changeTime"),!0):(g.trigger("selectTime"),!1)}function v(g){switch(g.keyCode){case 13:case 9:break;default:g.preventDefault()}}function B(g){var n=e(this),m=n.data("timepicker-list");if(!m||!a(m)){if(40!=g.keyCode)return!0;F.show.call(n.get(0));m=n.data("timepicker-list");h(n)||n.focus()}switch(g.keyCode){case 13:return A(n)&&(p.call(n.get(0),
{type:"change"}),F.hide.apply(this)),g.preventDefault(),!1;case 38:var r=m.find(".ui-timepicker-selected");return r.length?r.is(":first-child")||(r.removeClass("ui-timepicker-selected"),r.prev().addClass("ui-timepicker-selected"),r.prev().position().top<r.outerHeight()&&m.scrollTop(m.scrollTop()-r.outerHeight())):(m.find("li").each(function(w,z){return 0<e(z).position().top?(r=e(z),!1):void 0}),r.addClass("ui-timepicker-selected")),!1;case 40:return r=m.find(".ui-timepicker-selected"),0===r.length?
(m.find("li").each(function(w,z){return 0<e(z).position().top?(r=e(z),!1):void 0}),r.addClass("ui-timepicker-selected")):r.is(":last-child")||(r.removeClass("ui-timepicker-selected"),r.next().addClass("ui-timepicker-selected"),r.next().position().top+2*r.outerHeight()>m.outerHeight()&&m.scrollTop(m.scrollTop()+r.outerHeight())),!1;case 27:m.find("li").removeClass("ui-timepicker-selected");F.hide();break;case 9:F.hide();break;default:return!0}}function E(g){var n=e(this),m=n.data("timepicker-list"),
r=n.data("timepicker-settings");if(!m||!a(m)||r.disableTextInput)return!0;switch(g.keyCode){case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 65:case 77:case 80:case 186:case 8:case 46:r.typeaheadHighlight?q(n,m):m.hide()}}function A(g){var n=g.data("timepicker-settings"),m=null,r=g.data("timepicker-list").find(".ui-timepicker-selected");return r.hasClass("ui-timepicker-disabled")?
!1:(r.length&&(m=r.data("time")),null!==m&&("string"!=typeof m&&(m=D(m,n)),u(g,m,"select")),!0)}function H(g,n){g=Math.abs(g);var m,r;g=Math.round(g/60);var w=[];return 60>g?w=[g,x.mins]:(m=Math.floor(g/60),r=g%60,30==n&&30==r&&(m+=x.decimal+5),w.push(m),w.push(1==m?x.hr:x.hrs),30!=n&&r&&(w.push(r),w.push(x.mins))),w.join(" ")}function D(g,n){if("number"!=typeof g)return null;var m=parseInt(g%60),r=parseInt(g/60%60),w=parseInt(g/3600%24);w=new Date(1970,0,2,w,r,m,0);if(isNaN(w.getTime()))return null;
if("function"===e.type(n.timeFormat))return n.timeFormat(w);for(var z="",G=0;G<n.timeFormat.length;G++)switch(m=n.timeFormat.charAt(G)){case "a":z+=11<w.getHours()?x.pm:x.am;break;case "A":z+=11<w.getHours()?x.PM:x.AM;break;case "g":m=w.getHours()%12;z+=0===m?"12":m;break;case "G":m=w.getHours();g===C&&(m=n.show2400?24:0);z+=m;break;case "h":m=w.getHours()%12;0!==m&&10>m&&(m="0"+m);z+=0===m?"12":m;break;case "H":m=w.getHours();g===C&&(m=n.show2400?24:0);z+=9<m?m:"0"+m;break;case "i":r=w.getMinutes();
z+=9<r?r:"0"+r;break;case "s":m=w.getSeconds();z+=9<m?m:"0"+m;break;case "\\":G++;z+=n.timeFormat.charAt(G);break;default:z+=m}return z}function y(g,n){if(""===g||null===g)return null;if("object"==typeof g)return 3600*g.getHours()+60*g.getMinutes()+g.getSeconds();if("string"!=typeof g)return g;g=g.toLowerCase().replace(/[\s\.]/g,"");"a"!=g.slice(-1)&&"p"!=g.slice(-1)||(g+="m");var m="("+x.am.replace(".","")+"|"+x.pm.replace(".","")+"|"+x.AM.replace(".","")+"|"+x.PM.replace(".","")+")?",r=g.match(new RegExp("^"+
m+"([0-9]?[0-9])\\W?([0-5][0-9])?\\W?([0-5][0-9])?"+m+"$"));if(!r)return null;g=parseInt(1*r[2],10);if(24<g){if(n&&!1===n.wrapHours)return null;g%=24}m=r[1]||r[5];var w=g;12>=g&&m&&(w=m==x.pm||m==x.PM,w=12==g?w?12:0:g+(w?12:0));r=3600*w+60*(1*r[3]||0)+(1*r[4]||0);12>g&&!m&&n&&n._twelveHourTime&&n.scrollDefault&&(n=r-n.scrollDefault(),0>n&&n>=C/-2&&(r=(r+C/2)%C));return r}var C=86400,x={am:"am",pm:"pm",AM:"AM",PM:"PM",decimal:".",mins:"mins",hr:"hr",hrs:"hrs"},F={init:function(g){return this.each(function(){var n=
e(this),m=[],r;for(r in e.fn.timepicker.defaults)n.data(r)&&(m[r]=n.data(r));m=e.extend({},e.fn.timepicker.defaults,m,g);if(m.lang&&(x=e.extend(x,m.lang)),m=d(m),n.data("timepicker-settings",m),n.addClass("ui-timepicker-input"),m.useSelect)b(n);else{if(n.prop("autocomplete","off"),m.showOn)for(var w in m.showOn)n.on(m.showOn[w]+".timepicker",F.show);n.on("change.timepicker",p);n.on("keydown.timepicker",B);n.on("keyup.timepicker",E);m.disableTextInput&&n.on("keydown.timepicker",v);p.call(n.get(0),
null,"initial")}})},show:function(g){var n=e(this),m=n.data("timepicker-settings");if(g&&g.preventDefault(),m.useSelect)return void n.data("timepicker-list").focus();h(n)&&n.blur();g=n.data("timepicker-list");if(!n.prop("readonly")&&(g&&0!==g.length&&"function"!=typeof m.durationTime||(b(n),g=n.data("timepicker-list")),!a(g))){n.data("ui-timepicker-value",n.val());q(n,g);F.hide();g.show();var r={};m.orientation.match(/r/)?r.left=n.offset().left+n.outerWidth()-g.outerWidth()+parseInt(g.css("marginLeft").replace("px",
""),10):r.left=n.offset().left+parseInt(g.css("marginLeft").replace("px",""),10);"t"==(m.orientation.match(/t/)?"t":m.orientation.match(/b/)?"b":n.offset().top+n.outerHeight(!0)+g.outerHeight()>e(window).height()+e(window).scrollTop()?"t":"b")?(g.addClass("ui-timepicker-positioned-top"),r.top=n.offset().top-g.outerHeight()+parseInt(g.css("marginTop").replace("px",""),10)):(g.removeClass("ui-timepicker-positioned-top"),r.top=n.offset().top+n.outerHeight()+parseInt(g.css("marginTop").replace("px",""),
10));g.offset(r);r=g.find(".ui-timepicker-selected");if(!r.length){var w=y(t(n));null!==w?r=l(n,g,w):m.scrollDefault&&(r=l(n,g,m.scrollDefault()))}r&&r.length?(r=g.scrollTop()+r.position().top-r.outerHeight(),g.scrollTop(r)):g.scrollTop(0);return m.stopScrollPropagation&&e(document).on("wheel.ui-timepicker",".ui-timepicker-wrapper",function(z){z.preventDefault();var G=e(this).scrollTop();e(this).scrollTop(G+z.originalEvent.deltaY)}),e(document).on("touchstart.ui-timepicker mousedown.ui-timepicker",
k),e(window).on("resize.ui-timepicker",k),m.closeOnWindowScroll&&e(document).on("scroll.ui-timepicker",k),n.trigger("showTimepicker"),this}},hide:function(g){g=e(this);var n=g.data("timepicker-settings");return n&&n.useSelect&&g.blur(),e(".ui-timepicker-wrapper").each(function(){var m=e(this);if(a(m)){var r=m.data("timepicker-input"),w=r.data("timepicker-settings");w&&w.selectOnBlur&&A(r);m.hide();r.trigger("hideTimepicker")}}),this},option:function(g,n){return"string"==typeof g&&"undefined"==typeof n?
e(this).data("timepicker-settings")[g]:this.each(function(){var m=e(this),r=m.data("timepicker-settings"),w=m.data("timepicker-list");"object"==typeof g?r=e.extend(r,g):"string"==typeof g&&(r[g]=n);r=d(r);m.data("timepicker-settings",r);w&&(w.remove(),m.data("timepicker-list",!1));r.useSelect&&b(m)})},getSecondsFromMidnight:function(){return y(t(this))},getTime:function(g){var n=t(this);if(!n)return null;n=y(n);if(null===n)return null;g||(g=new Date);g=new Date(g);return g.setHours(n/3600),g.setMinutes(n%
3600/60),g.setSeconds(n%60),g.setMilliseconds(0),g},isVisible:function(){var g=this.data("timepicker-list");return!(!g||!a(g))},setTime:function(g){var n=this.data("timepicker-settings"),m=n.forceRoundTime?f(y(g),n):D(y(g),n);return g&&null===m&&n.noneOption&&(m=g),u(this,m),this.data("timepicker-list")&&q(this,this.data("timepicker-list")),this},remove:function(){if(this.hasClass("ui-timepicker-input")){var g=this.data("timepicker-settings");return this.removeAttr("autocomplete","off"),this.removeClass("ui-timepicker-input"),
this.removeData("timepicker-settings"),this.off(".timepicker"),this.data("timepicker-list")&&this.data("timepicker-list").remove(),g.useSelect&&this.show(),this.removeData("timepicker-list"),this}}};e.fn.timepicker=function(g){return this.length?F[g]?this.hasClass("ui-timepicker-input")?F[g].apply(this,Array.prototype.slice.call(arguments,1)):this:"object"!=typeof g&&g?void e.error("Method "+g+" does not exist on jQuery.timepicker"):F.init.apply(this,arguments):this};e.fn.timepicker.defaults={appendTo:"body",
className:null,closeOnWindowScroll:!1,disableTextInput:!1,disableTimeRanges:[],disableTouchKeyboard:!1,durationTime:null,forceRoundTime:!1,maxTime:null,minTime:null,noneOption:!1,orientation:"l",roundingFunction:function(g,n){if(null===g)return null;if("number"!=typeof n.step)return g;var m=g%(60*n.step);return m>=30*n.step?g+=60*n.step-m:g-=m,g==C&&n.show2400?g:g%C},scrollDefault:null,selectOnBlur:!1,show2400:!1,showDuration:!1,showOn:["click","focus"],showOnFocus:!0,step:30,stopScrollPropagation:!1,
timeFormat:"g:ia",typeaheadHighlight:!0,useSelect:!1,wrapHours:!0}});(function(e){e.team={app_url:!1,content:!1,sidebar:!1,calendar:!1,title_pattern:"Team \u2014 %s",init:function(a){["is_debug","app_url","locales"].forEach(function(d){e.team[d]=a[d]});e(document).ajaxSend(function(d,b,c){c.crossDomain||"POST"!==(c.type||"").toUpperCase()||(d=(d=document.cookie.match(/(?:^|; )_csrf=([^;]*)/))?decodeURIComponent(d[1]):"",c.data=c.data||"","string"==typeof c.data?-1==c.data.indexOf("_csrf=")&&(c.data+=(0<c.data.length?"&":"")+"_csrf="+d,b.setRequestHeader("Content-type",
"application/x-www-form-urlencoded")):"object"==typeof c.data&&(c.data._csrf=d))});e.team.content=new ContentRouter({$content:e("#t-content")});e.team.setSync()},setTitle:function(a){if(a){var d=history.state;d&&(d.title=a);document.title=e.team.title_pattern.replace("%s",a)}},confirmContactDelete:function(a,d){e.post("?module=users&action=prepareDelete",{id:a},function(b){var c=new TeamDialog({html:b});if(d&&d.onInit)d.onInit();if(d&&d.onCancel)c.$wrapper.on("close",d.onCancel);if(d.onCancel||d.onDelete)c.$wrapper.on("contacts_deleted",
function(f,k){d&&d.onCancel&&c.$wrapper.off("close",d.onCancel);if(d&&d.onDelete)d.onDelete(k)})})},setSync:function(){function a(){console.log("send sync request");e.post(e.team.app_url+"?module=calendarExternal&action=sync&background_process=1").always(function(){setTimeout(a,d)}).error(function(){return!1})}var d=3E4+Math.floor(100*Math.random())/100*3E4;setTimeout(a,e.team.is_debug?100:d/2)}}})(jQuery);
var ContentRouter=function(e){ContentRouter=function(a){this.$window=e(window);this.$content=a.$content;this.api_enabled=window.history&&window.history.pushState;this.xhr=!1;this.is_enabled=!0;this.initClass()};ContentRouter.prototype.initClass=function(){this.bindEvents()};ContentRouter.prototype.bindEvents=function(){var a=this,d=window.location.origin+e.team.app_url;e(document).on("click","a",function(b){var c=a.is_enabled&&this.href.substr(0,d.length)==d;b.ctrlKey||b.shiftKey||b.metaKey||!c||
(b.preventDefault(),a.load(this.href))});e("#wa-app-team").on("click","a",function(b){b.stopPropagation()});a.api_enabled&&(window.onpopstate=function(b){b.stopPropagation();a.onPopState(b)})};ContentRouter.prototype.load=function(a,d){var b=this;if(!(0<=a.indexOf(e.team.app_url)))return alert("Determine the path error"),!1;b.animate(!0);b.xhr&&b.xhr.abort();e(document).trigger("wa_before_load",{content_uri:a});b.xhr=e.get(a,function(c){!d&&b.api_enabled&&history.pushState({reload:!0,content_uri:a},
"",a);b.setContent(c);b.animate(!1);b.xhr=!1;e(document).trigger("wa_loaded")})};ContentRouter.prototype.reload=function(){var a=this.api_enabled&&history.state&&history.state.content_uri?history.state.content_uri:!1;a&&this.load(a,!0)};ContentRouter.prototype.setContent=function(a){this.$content.html(a)};ContentRouter.prototype.onPopState=function(a){if(a=a.state||!1){if(!a.content_uri)return alert("Determine the path error"),!1;e(document).trigger("wa_before_load",{content_uri:a.content_uri});a.reload?
this.reload(a.content_uri):a.content&&this.setContent(a.content);a.title&&e.team.setTitle(a.title);e.team.sidebar.selectLink(a.content_uri);e(document).trigger("wa_loaded")}else location.reload()};ContentRouter.prototype.animate=function(a){var d=this.$content;e(".router-loading-indicator").remove();a&&(a=d.find(".t-content-header h1"),a.length&&a.append('<i class="icon16 loading router-loading-indicator"></i>'))};return ContentRouter}(jQuery),TeamDialog=function(e){TeamDialog=function(a){this.$wrapper=
e(a.html);this.$block=!1;if(this.is_full_screen=this.$wrapper.hasClass("is-full-screen"))this.$block=this.$wrapper.find(".t-dialog-block");this.position=a.position||!1;this.is_closed=!1;this.userPosition=a.setPosition||!1;this.onBgClick=a.onBgClick||!1;this.onOpen=a.onOpen||function(){};this.onClose=a.onClose||function(){};this.onRefresh=a.onRefresh||!1;this.onResize=a.onResize||!1;this.initClass()};TeamDialog.prototype.initClass=function(){this.$wrapper.data("teamDialog",this);this.show();this.bindEvents()};
TeamDialog.prototype.bindEvents=function(){var a=this,d=e(document),b=a.$block?a.$block:a.$wrapper;setTimeout(function(){function c(){a.is_closed||a.close();d.off("click",c);d.off("wa_before_load",c)}function f(){e.contains(document,a.$wrapper[0])?a.resize():e(window).off("resize",f)}d.on("click",c);d.on("wa_before_load",c);a.$wrapper.on("close",c);if(a.is_full_screen)a.$wrapper.on("click",".t-dialog-background",function(k){if(a.onBgClick)a.onBgClick(k);else k.stopPropagation()});b.on("click",function(k){k.stopPropagation()});
e(document).on("keyup",function(k){27===k.keyCode&&a.close()});b.on("click",".js-close-dialog",function(){c()});if(a.is_full_screen)e(window).on("resize",f)},0)};TeamDialog.prototype.show=function(){e("body").append(this.$wrapper);this.setPosition();this.onOpen(this.$wrapper,this)};TeamDialog.prototype.setPosition=function(){function a(l){return{left:parseInt((b-l.width)/2),top:parseInt((c-l.height)/2)}}var d=e(window),b=d.width(),c=this.is_full_screen?d.height():e(document).height();d=this.$block?
this.$block:this.$wrapper;var f=d.outerWidth(),k=d.outerHeight();var h=this.position?this.position:(this.userPosition?this.userPosition:a)({width:f,height:k});0<h.left&&h.left+f>b&&(h.left=b-f-10);0<h.top?h.top+k>c&&(h.top=c-k-10):(h.top=10,this.is_full_screen&&(f=d.find(".t-dialog-content"),f.hide(),k=d.outerHeight(),f.height(c-k-20).addClass("is-long-content").show()));d.css(h)};TeamDialog.prototype.close=function(){this.is_closed=!0;this.$wrapper.remove();this.onClose(this.$wrapper,this)};TeamDialog.prototype.refresh=
function(){this.onRefresh&&(this.onRefresh(),this.close())};TeamDialog.prototype.resize=function(){this.$block.addClass("is-animated");this.setPosition();if(this.onResize)this.onResize(this.$wrapper,this)};return TeamDialog}(jQuery),TeamEditable=function(e){TeamEditable=function(a){this.$wrapper=a.$wrapper;this.save=a.onSave||function(){};this.render=a.onRender||!1;this.text=(this.is_empty=this.$wrapper.hasClass("is-empty"))?"":this.$wrapper.text();this.is_edit=this.$field=!1;this.initClass()};TeamEditable.prototype.initClass=
function(){this.$field=this.renderField();this.bindEvents()};TeamEditable.prototype.bindEvents=function(){var a=this;a.$wrapper.on("click",function(){a.toggle()});a.$field.on("blur",function(){a.save(a)});a.$field.on("keyup",function(d){var b=27===d.keyCode;13===d.keyCode?a.save(a):b&&(a.$field.val(a.text),a.toggle("hide"))})};TeamEditable.prototype.renderField=function(){var a=this.$wrapper.text(),d=e('<input class="bold" type="text" name="" />');this.is_empty||d.val(a);var b=this.$wrapper.parent().width();
a=this.$wrapper.width();b=600<b?600:b-50;d.width(a>b?a:b).hide();this.$wrapper.after(d);this.render&&this.render(this,d);return d};TeamEditable.prototype.toggle=function(a){(a="hide"!==a)?(this.$wrapper.hide(),this.$field.show().focus()):(this.$wrapper.show(),this.$field.hide());this.is_edit=a};return TeamEditable}($);var Sidebar=function(e){var a=function(){a=function(d){this.$window=e(window);this.$wrapper=d.$wrapper;this.$block=d.$block;this.$content=d.$content;this.top_fix_class="fixed-to-top";this.bottom_fix_class="fixed-to-bottom";this.debug=!1;this.initClass()};a.prototype.log=function(d){this.debug&&console.log(d)};a.prototype.initClass=function(){function d(){if(e.contains(document,v[0])){var n=Math.floor(l.$content.outerHeight()),m=Math.floor(v.outerHeight()),r=Math.floor(u.height()),w=t.scrollTop(),
z=Math.floor(v.offset().top),G=F>w?1:-1,K=w-A;g=v.width();if(!(!H&&r>E&&760<=B)||n&&n<m)H?(z=Math.floor(u.height()),G=Math.floor(u.offset().top),G=z+G-E-w,K=m-E,H=!1,z>m&&w>A&&(K<G?f(0):k())):h();else{n=E>m+0;r=w<=A;var I=parseInt(z+m-w-E);m=0<I;I=0>=I;if(n)0<K+0?(D||y||!C)&&f(0):(D||C||y||x)&&h();else if(r){if(D||y||C)x?z<=A&&h():h()}else m?0<G?z>=0+w&&(D||!C||y)&&f():(!D||C||y)&&c(z-A):I?0<G?(!D||C||y)&&c(z-A):(D||C||!y)&&k():(!D||C||y)&&c(z-A)}F=w}else t.off("scroll",d)}function b(){e.contains(document,
v[0])?(B=Math.floor(t.width()),E=Math.floor(t.height()),h(),t.trigger("scroll")):t.off("scroll",b)}function c(n){l.log("Manual top scroll position");v.css("top",n).width(g).removeClass(q).removeClass(p);D=!0;C=y=x=!1}function f(n){l.log("Fixed to top scroll position");v.removeAttr("style").width(g).removeClass(p).addClass(q);n&&(x=!0,v.css("top",n));D=y=!1;C=!0}function k(){l.log("Fixed to bottom scroll position");v.removeAttr("style").width(g).removeClass(q).addClass(p);D=C=x=!1;y=!0}function h(){l.log("Default scroll position");
v.removeAttr("style").removeClass(p).removeClass(q);D=C=y=x=!1}var l=this,q=l.top_fix_class,p=l.bottom_fix_class,t=l.$window,u=l.$wrapper,v=l.$block,B=Math.floor(t.width()),E=Math.floor(t.height()),A=v.offset().top,H=!0,D=!1,y=!1,C=!1,x=!1,F=0,g;t.on("scroll",d).on("resize",b)};return a}();Sidebar=function(d){this.$wrapper=d.$wrapper;this.$groupsWrapper=this.$wrapper.find(".t-groups-list");this.$groups=this.$groupsWrapper.find("> li");this.$locationsWrapper=this.$wrapper.find(".t-locations-list");
this.$locations=this.$locationsWrapper.find("> li");this.$searchForm=this.$wrapper.find(".t-search-form");this.app_url=d.app_url;this.selected_class="selected";this.storage_count_name="team/sidebar_counts";this.can_sort=d.can_sort;this.link_count_update_date=!1;this.$activeMenuItem=this.$wrapper.find("li."+this.selected_class+":first")||!1;this.counters={};this.xhr=this.is_locked=this.storageCount=!1;this.timer=0;this.initClass()};Sidebar.prototype.initClass=function(){this.bindEvents();this.setCounts();
this.initElasticBlock();this.initUpdater();this.can_sort&&this.initSortable();this.initDroppable();this.$activeMenuItem.length||this.selectLink()};Sidebar.prototype.bindEvents=function(){var d=this;d.$wrapper.on("click","li > a",function(b){d.onLinkClick(e(this))});d.$wrapper.on("click",".js-add-user-group",function(b){b.preventDefault();d.showGroupDialog()});d.$wrapper.on("click",".js-add-user-location",function(b){b.preventDefault();d.showGroupDialog(!0)});d.$searchForm.on("submit",function(b){b.preventDefault();
(b=e.trim(d.$searchForm.find(".t-search-field").val()))&&d.showSearch(b)});e("#t-new-user-link").on("click",function(b){b.preventDefault();b.stopPropagation();d.showInviteDialog()})};Sidebar.prototype.onLinkClick=function(d){var b=d.attr("href");b&&"javascript:"!=b.substr(0,11)&&!d.hasClass("js-no-highlight")&&(this.setItem(d.closest("li")),e.team.setTitle(d.text()))};Sidebar.prototype.setItem=function(d){if(this.$activeMenuItem&&this.$activeMenuItem[0]==d[0])return!1;this.$activeMenuItem&&this.$activeMenuItem.removeClass(this.selected_class);
d.addClass(this.selected_class);this.$activeMenuItem=d};Sidebar.prototype.selectLink=function(d){if(d)var b=this.$wrapper.find('a[href="'+d+'"]:first');else if(!1===d)return this.$activeMenuItem&&(this.$activeMenuItem.removeClass(this.selected_class),this.$activeMenuItem=null),!1;if(b&&b.length)this.setItem(b.closest("li"));else{d=this.$wrapper.find("a[href^='"+this.app_url+"']");var c=location.pathname,f=0,k=0;d.each(function(h){var l=e(this).attr("href"),q=l.length;0<=c.indexOf(l)&&q>f&&(f=q,k=
h)});if(k||0===k)b=d.eq(k),this.setItem(b.closest("li"))}};Sidebar.prototype.reload=function(d){var b=this,c=b.app_url+"?module=sidebar";d&&(c+="&background_process=1");clearTimeout(b.timer);b.xhr&&b.xhr.abort();b.xhr=e.get(c,function(f){b.xhr=!1;b.$wrapper.replaceWith(f)})};Sidebar.prototype.showInviteDialog=function(){var d=this;d.is_locked||(d.is_locked=!0,e.get(e.team.app_url+"?module=users&action=inviteform",function(b){d.is_locked=!1;new TeamDialog({html:b})}))};Sidebar.prototype.showGroupDialog=
function(d){var b=this,c=e.team.app_url+"?module=group&action=edit";d={type:d?"location":"group"};b.is_locked||(b.is_locked=!0,e.get(c,d,function(f){new TeamDialog({html:f});b.is_locked=!1}))};Sidebar.prototype.setCounts=function(){function d(h,l,q,p){if(0<=h.indexOf(c.app_url)){var t=c.$wrapper.find('a[href="'+h+'"]');if(t.length){q=l-q;var u=e('<strong class="small highlighted t-indicator '+(0<=q?"is-green":"is-red")+'">'+q+"</strong>");0<=q&&(t.append(u),t.one("click",function(v){v.preventDefault();
u.remove();c.saveCount(h,l);c.link_count_update_date=p;e(document).one("wa_loaded",function(){c.link_count_update_date=!1})}))}}}function b(){var h=new Date,l=parseInt(h.getUTCDate()),q=parseInt(h.getUTCMonth())+1,p=parseInt(h.getUTCFullYear()),t=parseInt(h.getUTCHours()),u=parseInt(h.getUTCMinutes());h=parseInt(h.getUTCSeconds());return result={year:p,month:q,day:l,hours:t,minutes:u,seconds:h}}var c=this,f=function(){var h={},l=c.$wrapper.find("li .js-count"),q=b();l.each(function(){var p=e(this),
t=parseInt(p.text()),u=p.closest("li").find("> a");0<=t&&(c.counters[u.attr("href")]=p,h[u.attr("href")]={count:t,date:q})});return h}(),k=function(h){var l={};(h=localStorage.getItem(h))&&(l=JSON.parse(h));return l}(c.storage_count_name);c.storageCount=e.extend(!0,{},f);k&&e.each(k,function(h,l){var q=h in f&&0<=f[h].count&&f[h].count!=l.count;0<=l.count&&q&&(c.storageCount[h].count=l.count,c.storageCount[h].date=l.date,d(h,f[h].count,l.count,l.date))});c.setStorage()};Sidebar.prototype.saveCount=
function(d,b){d in this.storageCount&&(this.storageCount[d].count=b);this.setStorage()};Sidebar.prototype.updateCount=function(d,b){if(!d||!b&&0!==b)return!1;var c=this.counters[d]||!1;this.saveCount(d,b);c.length?c.text(b):this.reload()};Sidebar.prototype.setStorage=function(){localStorage.setItem(this.storage_count_name,JSON.stringify(this.storageCount))};Sidebar.prototype.initElasticBlock=function(){var d=this;e(document).ready(function(){new a({$wrapper:e("#wa-app"),$block:d.$wrapper,$content:e("#t-content")});
var b=e(window);0<b.scrollTop()&&b.trigger("scroll")})};Sidebar.prototype.initUpdater=function(){var d=this;d.timer=setTimeout(function(){e.contains(document,d.$wrapper[0])&&d.reload(!0)},3E5)};Sidebar.prototype.initSortable=function(){function d(p){var t=[];p.find("> li").each(function(){var u=e(this).data("group-id");u&&0<u&&t.push(u)});return t}function b(p,t){q&&(q.abort(),q=!1);q=e.post(p,t,function(){q=!1})}var c=this.$groupsWrapper,f=this.$locationsWrapper,k=this.$locations,h=this.app_url+
"?module=group&action=sortSave",l,q=!1;1<this.$groups.length&&c.sortable({items:"> li",axis:"y",delay:200,tolerance:"pointer",start:function(p,t){l=t.item.index()},stop:function(p,t){t.item.removeAttr("style");if(l!=t.item.index()){p=d(c);var u=[];e.each(p,function(v,B){u.push({name:"groups[]",value:B})});b(h,u)}}});1<k.length&&f.sortable({items:"> li",axis:"y",delay:200,tolerance:"pointer",start:function(p,t){l=t.item.index()},stop:function(p,t){t.item.removeAttr("style");l!=t.item.index()&&(p=d(f),
b(h,{locations:p}))}})};Sidebar.prototype.initDroppable=function(){function d(c,f){c=parseInt(c.data("group-id"));var k=parseInt(f.data("user-id"));f=e.team.app_url+"?module=group&action=userAdd";if(!(0<c&&0<k))return!1;c={user_id:k,group_id:c};b&&b.abort();b=e.post(f,c,function(h){"ok"==h.status&&e.team.sidebar.reload();b=!1})}var b=!1;this.$groups.each(function(){var c=e(this);c.hasClass("js-drop-place")&&c.droppable({tolerance:"pointer",hoverClass:"is-hovered",over:function(f,k){k.draggable.hasClass("ui-draggable")||
c.removeClass("is-hovered")},drop:function(f,k){d(e(this),k.draggable)}})});this.$locations.each(function(){var c=e(this);c.hasClass("js-drop-place")&&c.droppable({tolerance:"pointer",hoverClass:"is-hovered",over:function(f,k){k.draggable.hasClass("ui-draggable")||c.removeClass("is-hovered")},drop:function(f,k){d(e(this),k.draggable)}})})};Sidebar.prototype.showSearch=function(d){d=encodeURIComponent(d);e.team.content.load(this.app_url+"search/"+d+"/")};return Sidebar}(jQuery);var CalendarPage=function(e){var a=function(d){a=function(b){this.$wrapper=b.$wrapper;this.$monthSelect=this.$wrapper.find(".month");this.$yearSelect=this.$wrapper.find(".year");this.filters_href=b.filters_href;this.month=parseInt(this.$monthSelect.val());this.year=parseInt(this.$yearSelect.val());this.initClass()};a.prototype.initClass=function(){var b=this;b.$monthSelect.on("change",function(){var c=d(this).val();c&&(b.month=parseInt(c));b.useFilter();return!1});b.$yearSelect.on("change",function(){var c=
d(this).val();c&&(b.year=parseInt(c));b.useFilter();return!1});b.$wrapper.on("click",".t-arrow",function(){var c=d(this);c.hasClass("left")&&b.changeMonth(!1);c.hasClass("right")&&b.changeMonth(!0);b.useFilter();return!1})};a.prototype.changeMonth=function(b){b?12<=this.month?(this.month=1,this.year++):this.month++:1>=this.month?(this.month=12,this.year--):this.month--};a.prototype.useFilter=function(){var b="start="+(this.year+"-"+(9<this.month?this.month:"0"+this.month)+"-01"),c=this.filters_href.split("?"),
f=c[0];c=c[1]||"";c=0<=c.indexOf("&")?c.split("&"):[c];var k=!1;c.length&&d.each(c,function(h,l){"start"==l.split("=")[0]&&(k=h)});k||0===k?c[k]=b:c.push(b);b=f+"?"+c.join("&");d.team.content.load(b)};return a}(jQuery);CalendarPage=function(d){this.$wrapper=d.$wrapper;this.$dateFilter=d.$dateFilter;this.filters_href=d.filters_href;this.user_id=d.user_id;this.local_storage=new e.store;this.initClass()};CalendarPage.prototype.initClass=function(){new a({$wrapper:this.$dateFilter,filters_href:this.filters_href});
this.initInfoBlock()};CalendarPage.prototype.initInfoBlock=function(){var d=this.$wrapper.find(".t-info-notice-wrapper"),b=this.local_storage;b.get("team/calendar_info_warn_block_hide")?d.hide():d.show();d.find(".t-info-notice-toggle").on("click",function(){b.set("team/calendar_info_warn_block_hide",1);d.hide()})};return CalendarPage}(jQuery),TeamCalendar=function(e){function a(d){var b=[];d.each(function(){var c=[];e(this).find(".t-day-ornament").each(function(){c.push(e(this))});b.push(c)});return b}
TeamCalendar=function(d){this.$wrapper=d.$wrapper;this.$rows=this.$wrapper.find(".t-week-row");this.days_count=7;this.weeks_count=this.$rows.length;this.selected_class="is-selected";this.active_class="is-active";this.locales=d.locales;this.is_profile=d.is_profile;this.event_view_uri="?module=schedule&action=eventView";this.event_edit_uri="?module=schedule&action=eventEdit";this.day_uri="?module=schedule&action=day";this.user_id=d.user_id;this.has_right_to_change=d.has_right_to_change;this.selected_user_id=
d.selected_user_id;this.selected_calendar_id=d.selected_calendar_id;this.period_start=d.period_start;this.period_end=d.period_end;this.daysArray=a(this.$rows);this.wrapper_o=this.$wrapper.offset();this.wrapper_w=this.$wrapper.width();this.wrapper_h=this.$wrapper.height();this.day_h=this.day_w=0;this.dialogs=[];this.end=this.start=this.xhr=!1;this.$selectedDays=[];this.is_locked=!1;this.bindEvents();this.initHoverOnDay();this.initMove()};TeamCalendar.prototype.bindEvents=function(){function d(h){e.contains(document,
f.$wrapper[0])?27===h.keyCode&&f.deselectDays():e(document).off("keydown",d)}function b(h){f.is_locked||(f.is_locked=!0,f.onMouseMove(h),setTimeout(function(){f.is_locked=!1},10));return!1}function c(){f.onMouseUp();f.$wrapper.off("mousemove",b);k.off("mouseup",c);return!1}var f=this,k=e(document);f.has_right_to_change&&(f.$wrapper.find(".show-full-days-events, .t-event-wrapper").on("mousedown",function(h){h.stopPropagation();f.clearSelection()}),k.on("mousedown",function(){f.clearSelection()}),f.$wrapper.on("mousedown",
function(h){h.stopPropagation();f.closeDialogs()||(f.onMouseDown(h),f.$wrapper.on("mousemove",b),k.on("mouseup",c));return!1}));f.$wrapper.on("click",".show-full-days-events",function(h){h.preventDefault();f.closeDialogs()||f.showFullDayEvents(e(this))});f.$wrapper.on("click",".t-event-block.js-view-event",function(h){h.preventDefault();f.closeDialogs()||f.showEventDetails(e(this).closest(".t-event-wrapper"))});e(document).on("keydown",d)};TeamCalendar.prototype.showFullDayEvents=function(d){var b=
this,c=d.data("events-id").split(",");c={date:d.data("date"),id:c};b.xhr&&(b.xhr.abort(),b.xhr=!1);b.xhr=e.post(b.day_uri,c,function(f){var k=d.closest(".t-action-wrapper"),h=k.closest(".t-week-row"),l=h.offset().top,q=k.offset().left,p=k.outerWidth(),t=h.outerHeight();f=new TeamDialog({html:f,setPosition:function(u){var v=u.width,B=(v-p)/2;u=(u.height-t)/2;u=l-(0<u?u:0);B=q-(0<B?B:0);v=e(window).width()-(B+v);0>v&&(B-=Math.abs(v)+10);return{top:u,left:B}}});b.addDialog(f)})};TeamCalendar.prototype.showEventDetails=
function(d){var b=this;d={"data[id]":d.data("id")};b.xhr&&(b.xhr.abort(),b.xhr=!1);b.xhr=e.post(b.event_view_uri,d,function(c){c=new TeamDialog({html:c});b.addDialog(c)})};TeamCalendar.prototype.createEvent=function(){var d=this,b=d.daysArray[d.end.week-1][d.end.day-1],c=d.daysArray[d.start.week-1][d.start.day-1].data("date");b=b.data("date");var f={"data[start]":!1,"data[end]":!1,"data[contact_id]":d.selected_user_id||d.user_id},k=(new Date).getHours();f["data[start]"]=c.replace("00:00:00",23<=k?
"23:59:59":k+1+":00:00");f["data[end]"]=b.replace("00:00:00",22<=k?"23:59:59":k+2+":00:00");d.selected_calendar_id&&(f["data[calendar_id]"]=d.selected_calendar_id);d.xhr&&(d.xhr.abort(),d.xhr=!1);d.xhr=e.post(d.event_edit_uri,f,function(h){h=new TeamDialog({html:h});d.addDialog(h)})};TeamCalendar.prototype.onMouseDown=function(d){this.end=this.start=this.getDayPosition(d);this.markDays()};TeamCalendar.prototype.onMouseMove=function(d){d=this.getDayPosition(d);this.end&&this.end.week==d.week&&this.end.day==
d.day||(this.end=d,this.markDays())};TeamCalendar.prototype.initHoverOnDay=function(d){function b(){f&&f.removeClass("is-highlighted");f=!1}var c=this,f=!1;c.$wrapper.on("mousemove",function(k){var h=c.getDayPosition(k),l=c.daysArray,q=!1;l[h.week-1]&&l[h.week-1][h.day-1]&&(q=l[h.week-1][h.day-1]);h=q;k=e(k.target);if(k.hasClass("t-event-block")||k.closest(".t-event-block").length||c.start||!h)return b(),!1;if(h.hasClass("is-highlighted"))return!1;f&&b();h.addClass("is-highlighted");f=h}).on("mouseleave",
function(){b()})};TeamCalendar.prototype.onMouseUp=function(){if(this.start.week>this.end.week||this.start.week==this.end.week&&this.start.day>this.end.day){var d={week:this.start.week,day:this.start.day};this.start={week:this.end.week,day:this.end.day};this.end=d}this.createEvent();this.end=this.start=!1};TeamCalendar.prototype.initMove=function(){function d(q){q=c.getDayPosition(q);var p=c.daysArray[q.week-1][q.day-1];if(!p)return console&&console.log&&console.log("error: date is not exist"),!1;
q=e.team.app_url+"?module=schedule&action=eventMove";p={id:parseInt(k.data("id")),start:p.data("date").replace(" 00:00:00","")};l&&l.abort();l=e.post(q,p,function(t){"ok"==t.status&&c.reload()},"json")}function b(q){var p=f.offset(),t=[p.left,p.left+f.outerWidth()];p=[p.top,p.top+f.outerHeight()];c.clearSelection();if(q.pageX<=t[0]||q.pageX>=t[1]||q.pageY<=p[0]||q.pageY>=p[1])return!1;t=parseInt(k.data("day-count")||k.closest(".t-column").attr("colspan"));c.start=c.getDayPosition(q);q=c.daysArray;
var u=c.start;p={week:u.week,day:u.day};u=7-u.day;--t;t<=u?p.day+=t:(p.week+=1,p.day=t-u,p.week>q.length&&(p={week:q.length,day:7}));c.end=p;c.markDays()}var c=this,f=c.$wrapper,k=!1,h=!1,l;f.find(".js-move-event").draggable({helper:"clone",appendTo:"body",cursor:"move",delay:200,cursorAt:{top:11,left:16},start:function(q,p){q=e(p.helper.context);p=p.helper;k=q;var t=parseInt(k.closest(".t-column").attr("colspan")),u=q.data("move-hint")||!1;u&&p.find(".t-event-block").append("<span class='t-day-count'>("+
u+")</span>");p.addClass("is-clone").css({minWidth:parseInt(q.width()/t)+"px",height:q.height()+"px"})},drag:function(q,p){h||(h=!0,setTimeout(function(){h=!1},100),b(q))},stop:function(q,p){c.clearSelection();k=!1}});f.droppable({drop:function(q){d(q)}})};TeamCalendar.prototype.markDays=function(){this.deselectDays();var d=e.extend({},this.start),b=e.extend({},this.end);d.week>b.week&&(d=e.extend({},this.end),b=e.extend({},this.start));for(var c=d.week,f=b.week,k=c;k<=f;k++){if(c==f){var h=d.day;
var l=b.day;h>l&&(h=b.day,l=d.day)}else k==c?(h=d.day,l=this.days_count):k==f?(h=1,l=b.day):(h=1,l=this.days_count);for(;h<=l;h++)if(0<k&&0<h){var q=this.daysArray[k-1][h-1];q.length?(q.addClass(this.selected_class),this.$selectedDays.push(q)):console.log("Error: Day isn't exist")}}};TeamCalendar.prototype.getDayPosition=function(d){this.wrapper_o=this.$wrapper.offset();this.wrapper_w=this.$wrapper.width();this.wrapper_h=this.$wrapper.height();this.day_w=this.wrapper_w/this.days_count;this.day_h=
this.wrapper_h/this.weeks_count;var b=d.pageY-this.wrapper_o.top;d=d.pageX-this.wrapper_o.left;b=parseInt(b/this.day_h)+(0<b%this.day_h?1:0);d=parseInt(d/this.day_w)+(0<d%this.day_w?1:0);return{week:b,day:d}};TeamCalendar.prototype.deselectDays=function(){var d=this;d.$selectedDays.length&&(e.each(d.$selectedDays,function(){e(this).removeClass(d.selected_class)}),d.$selectedDays=[])};TeamCalendar.prototype.clearSelection=function(){this.deselectDays();this.end=this.start=!1};TeamCalendar.prototype.reload=
function(){var d=this,b={};d.closeDialogs();d.selected_user_id&&(b.user=d.selected_user_id);d.selected_calendar_id&&(b.calendar=d.selected_calendar_id);d.period_start&&(b.start=d.period_start);d.period_end&&(b.end=d.period_end);d.is_profile&&(b.period=1);e.get("?module=schedule&action=inc",b,function(c){e.team.calendar=!1;d.$wrapper.closest(".t-calendar-wrapper").replaceWith(c)})};TeamCalendar.prototype.addDialog=function(d){this.dialogs.push(d)};TeamCalendar.prototype.closeDialogs=function(){var d=
!1;this.dialogs.length&&(e.each(this.dialogs,function(b,c){e.contains(document,c.$wrapper[0])&&(c.close(),d=!0)}),this.dialogs=[]);e("#ui-datepicker-div").length&&e(document).trigger("mousedown");return d};return TeamCalendar}(jQuery),DayEventsDialog=function(e){DayEventsDialog=function(a){this.$wrapper=a.$wrapper;this.event_view_uri="?module=schedule&action=eventView";this.xhr=this.dialog=!1;this.initClass()};DayEventsDialog.prototype.initClass=function(){var a=this;a.$wrapper.on("click",".t-event-block.js-view-event",
function(d){d.preventDefault();a.showEventDetails(e(this).closest(".t-event-wrapper"))})};DayEventsDialog.prototype.showEventDetails=function(a){var d=this;a={"data[id]":a.data("id")};d.xhr&&(d.xhr.abort(),d.xhr=!1);d.xhr=e.post(d.event_view_uri,a,function(b){d.dialog=new TeamDialog({html:b})})};return DayEventsDialog}(jQuery),EventEditDialog=function(e){function a(b){var c={};b.find(".menu-v li").each(function(){var f=e(this),k=f.find(".userpic20"),h=f.data("calendar-id");c[h]={id:h,default_status:f.data("default-status"),
name:e.trim(e("<div />").html(f.text()).text()).toLowerCase(),font_color:k.css("color"),bg_color:k.css("background-color")}});return c}function d(b){var c={};b.find(".menu-v li").each(function(){var f=e(this),k=f.find(".userpic20"),h=f.data("user-id");c[h]={id:h,$icon:k,name:e.trim(e("<div />").html(e.wa.encodeHTML(f.text())).text())}});return c}EventEditDialog=function(b){this.$wrapper=b.$wrapper;this.$form=this.$wrapper.find("form");this.$statusToggle=this.$wrapper.find(".t-status-toggle");this.$calendarToggle=
this.$wrapper.find(".t-calendar-toggle");this.$typeToggle=this.$wrapper.find(".t-type-toggle");this.$userToggle=this.$wrapper.find(".t-user-toggle");this.$startAltField=this.$wrapper.find("input[name='data[start_alt]']");this.$endAltField=this.$wrapper.find("input[name='data[end_alt]']");this.$summaryField=this.$form.find("input[name='data[summary]']");this.teamDialog=this.$wrapper.data("teamDialog");this.active_class="is-active";this.extended_class="is-extended";this.selected_class="selected";this.has_error_class=
"error";this.locales=b.locales;this.event_id=b.event_id;this.calendars=a(this.$calendarToggle);this.users=d(this.$userToggle);this.$activeStatusToggle=this.$statusToggle.find("."+this.active_class)||!1;this.is_status=b.is_status;this.is_changed=this.is_locked=!1;this.user_id=b.user_id;this.calendar_id=b.calendar_id;this.summary=b.summary;this.summary_type=b.summary_type;this.end_date_locale=this.start_date_locale=!1;this.initClass()};EventEditDialog.prototype.initClass=function(){this.initDatePicker();
this.initTimePicker();this.bindEvents();this.setStatusLocale();this.is_status&&(this.generateStatusTypes(),this.generatePreview())};EventEditDialog.prototype.bindEvents=function(){var b=this;b.$form.on("submit",function(c){c.preventDefault();b.is_locked||b.save(b.$form);return!1});b.$form.on("click",".js-delete-event",function(c){c.preventDefault();b.is_locked||b.showDeleteConfirm()});b.$statusToggle.on("click",".t-toggle-button",function(){b.changeStatus(e(this));return!1});b.$calendarToggle.on("click",
".menu-v a",function(c){c.preventDefault();b.changeCalendar(e(this))});b.$startAltField.on("change",function(){b.setStatusLocale();b.generateStatusTypes();b.generatePreview()});b.$endAltField.on("change",function(){b.setStatusLocale();b.generateStatusTypes();b.generatePreview()});b.$summaryField.on("change",function(){b.summary=e(this).val();b.summary_type="custom"});b.$form.on("change","input[name='data[status_summary]']",function(){b.summary=e(this).val();b.$summaryField.val(b.summary)});b.$form.on("change",
'textarea[name="data[description]"]',function(){var c=e(this).val();b.$form.find('textarea[name="data[status_description]"]').val(c)});b.$form.on("change",'textarea[name="data[status_description]"]',function(){var c=e(this).val();b.$form.find('textarea[name="data[description]"]').val(c)});b.$form.on("summaryChange",function(){b.$summaryField.val(b.summary)});if(b.$userToggle.length)b.$userToggle.on("click",".menu-v a",function(c){c.preventDefault();b.changeUser(e(this))});b.$form.on("change",".js-extended-date",
function(){b.dateToggle(e(this));return!1});b.$form.find("input").on("mousedown",function(){var c=e(this);c.hasClass(b.has_error_class)&&c.removeClass(b.has_error_class).closest(".value").find(".t-error").remove()})};EventEditDialog.prototype.initDatePicker=function(){this.$wrapper.find(".js-datepicker").each(function(){var b=e(this),c=b.closest(".t-date-wrapper").find("input[type='hidden']");b.datepicker({altField:c,altFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,shortYearCutoff:2,showOtherMonths:!0,
selectOtherMonths:!0,stepMonths:2,numberOfMonths:2,beforeShow:function(f,k){k.dpDiv.on("click",function(h){h.stopPropagation()});e(f).on("click",function(h){var l=!1,q=e("#ui-datepicker-div");q.length&&"none"!=q.css("display")&&(l=q);l&&(h.stopPropagation(),e(document).trigger("mousedown"),e(this).blur())})}})})};EventEditDialog.prototype.initTimePicker=function(){this.$wrapper.find(".js-timepicker").each(function(){var b=e(this),c=!1;b.timepicker();b.on("showTimepicker",function(){var f=b.data("timepicker-list");
c||(f.on("click",function(h){h.stopPropagation()}),c=!0);var k=parseInt(b.offset().top)+parseInt(b.outerHeight())-parseInt(e(window).scrollTop());f.css({position:"fixed",top:k})})})};EventEditDialog.prototype.showDeleteConfirm=function(){var b=this,c={id:b.event_id};b.is_locked=!0;b.xhr&&(b.xhr.abort(),b.xhr=!1);b.xhr=e.get("?module=schedule&action=eventDeleteConfirm",c,function(f){new TeamDialog({html:f});b.is_locked=!1;b.close()})};EventEditDialog.prototype.changeStatus=function(b){if(!b.hasClass(this.active_class)){var c=
b.data("status-id");this.$activeStatusToggle&&this.$activeStatusToggle.removeClass(this.active_class);b.addClass(this.active_class);this.$activeStatusToggle=b;this.$form.find('input[name="data[is_status]"]').val(c).trigger("change");(this.is_status=b=1==c)?(this.$wrapper.removeClass("is-event").addClass("is-status"),b=this.$form.find(".js-extended-date"),"checked"!=b.attr("checked")&&b.click()):this.$wrapper.removeClass("is-status").addClass("is-event");this.generateStatusTypes();this.generatePreview();
this.teamDialog.resize()}};EventEditDialog.prototype.changeCalendar=function(b){var c=this,f=b.closest("li"),k=f.data("calendar-id");if(!f.hasClass(c.selected_class)&&!c.is_locked){c.is_locked=!0;c.calendar_id=k;c.$calendarToggle.find("."+c.selected_class).removeClass(c.selected_class);c.$calendarToggle.find(".t-selected-item").html(b.html());c.$form.find('input[name="data[calendar_id]"]').val(k).trigger("change");var h=c.$calendarToggle.find(".menu-v");h.hide();setTimeout(function(){h.removeAttr("style");
c.is_locked=!1},500);c.generateStatusTypes();c.generatePreview()}};EventEditDialog.prototype.changeUser=function(b){var c=this,f=b.closest("li"),k=f.data("user-id");if(!f.hasClass(c.selected_class)&&!c.is_locked){c.is_locked=!0;c.user_id=k;c.$userToggle.find("."+c.selected_class).removeClass(c.selected_class);c.$userToggle.find(".t-selected-item").html(b.html());c.$form.find('input[name="data[contact_id]"]').val(k).trigger("change");var h=c.$userToggle.find(".menu-v");h.hide();setTimeout(function(){h.removeAttr("style");
c.is_locked=!1},200);c.generatePreview()}};EventEditDialog.prototype.save=function(b){var c=this;b=function(f){function k(t){var u=t.split("-");t=parseInt(u[0]);var v=parseInt(u[1]);u=parseInt(u[2]);return 0<t&&0<v&&0<u?new Date(t,v-1,u):!1}function h(t){c.$form.find(".t-error").remove();e.each(t,function(u,v){u=c.$form.find("[name='"+v.field+"']");u.length&&u.addClass(c.has_error_class).after('<span class="t-error">'+c.locales[v.locale]+"</span>")})}var l={},q=[];e.each(f,function(t,u){l[u.name]=
u.value});l["data[summary_type]"]||(l["data[summary_type]"]="custom");if(f=c.is_status)l["data[description]"]=l["data[status_description]"]?l["data[status_description]"]:"",delete l["data[status_description]"],l["data[summary]"]=c.summary,delete l["data[status_summary]"];e.trim(l["data[summary]"]).length||(f?q.push({field:"data[status_summary]",locale:"empty"}):q.push({field:"data[summary]",locale:"empty"}));l["data[start]"].match(/^(\d){4}-(\d){2}-(\d){2}$/)||q.push({field:"data[end]",locale:"date"});
l["data[end]"].match(/^(\d){4}-(\d){2}-(\d){2}$/)||q.push({field:"data[end]",locale:"date"});f=k(l["data[start]"]);var p=k(l["data[end]"]);f>p&&(q.push({field:"data[start_alt]",locale:"period"}),q.push({field:"data[end_alt]",locale:"period"}));if(q.length)return h(q),!1;l["data[start_time]"].length||(l["data[start_time]"]="00:00");l["data[end_time]"].length||(l["data[end_time]"]="00:00");l["data[start]"]=l["data[start]"]+" "+l["data[start_time]"];l["data[end]"]=l["data[end]"]+" "+l["data[end_time]"];
l["data[is_allday]"]=l["data[is_allday]"]?1:0;delete l["data[start_time]"];delete l["data[end_time]"];delete l["data[start_alt]"];delete l["data[end_alt]"];return l}(b.serializeArray());c.is_locked=!0;b?e.post("?module=schedule&action=eventSave",b,function(f){if("ok"==f.status)f.data&&f.data.message&&alert(f.data.message),c.reloadCalendar();else if(f.errors){var k=null;e.each(f.errors,function(h,l){"redirect"===l[0]&&(k=l[1])});k&&(location.href=k)}c.close();c.is_locked=!1},"json"):c.is_locked=!1};
EventEditDialog.prototype.reloadCalendar=function(){e.team.calendar.reload()};EventEditDialog.prototype.dateToggle=function(b){b="checked"==b.attr("checked");var c=this.$form.find(".t-date-wrapper");b?c.removeClass(this.extended_class):c.addClass(this.extended_class)};EventEditDialog.prototype.generatePreview=function(){var b=this.$wrapper.find(".t-preview-block"),c=this.calendars[this.calendar_id],f=c.bg_color,k=c.font_color,h=this.users[this.user_id];c=h.$icon.clone();h=e.wa.encodeHTML(h.name);
f=e("<span class='t-type'>"+(this.summary?this.summary:this.locales.empty_type)+"</span>").css({background:f,color:k});b.html("").append(c).append("<span class='t-user-name'>"+h+"</span>").append(f)};EventEditDialog.prototype.generateStatusTypes=function(){var b=this,c=b.$typeToggle,f=function(){var k=c.find(".is-template li"),h=k.eq(0),l=k.eq(1);k=e("<ul class='menu-v'></ul>");var q=b.calendars[b.calendar_id];if(q.default_status){var p=h.clone();p.find(".t-type").text(q.default_status);p.find("input:radio").val("default");
k.append(p)}p=h.clone();p.find(".t-type").text(q.name);p.find("input:radio").val("calendar");k.append(p);p=h.clone();p.find(".t-type").text((q.default_status?q.default_status:q.name)+" "+b.locales.till+" "+b.end_date_locale);p.find("input:radio").val("till");k.append(p);h=h.clone();h.find(".t-type").text((q.default_status?q.default_status:q.name)+" "+b.locales.from+" "+b.start_date_locale+" "+b.locales.till+" "+b.end_date_locale);h.find("input:radio").val("interval");k.append(h);h=l.clone();h.find("input:radio").val("custom");
b.summary&&h.find("input:text").val(b.summary);k.append(h);c.find(".value").html("").append(k);return k}();(function(k){k.on("change","input:radio",function(){var h=e(this),l="checked"==h.attr("checked"),q=h.closest("li").find(".t-type"),p=h.closest("li").find("input:text");if(l){if(q.length)b.summary=q.text();else if(p.length)b.summary=p.val();else return!1;b.summary_type=h.val();b.$form.trigger("summaryChange");b.generatePreview()}});k.on("focus set","input:text",function(){var h=e(this),l=h.closest("li").find("input:radio");
"checked"!=l.attr("checked")&&l.attr("checked","checked").trigger("change");h.hasClass(b.has_error_class)&&h.removeClass(b.has_error_class).closest(".value").find(".t-error").remove()});k.on("focus change keyup","input:text",function(){var h=e(this),l=h.val();b.summary=e("<div />").html(h.val()).text();l.length&&(b.summary_type="custom",b.summary=l);b.generatePreview()})})(f);(function(k){!b.summary_type&&b.summary&&(b.summary_type="custom");if(b.summary_type){var h=k.find("input:radio[value='"+b.summary_type+
"']");h.length?(h.click(),"custom"!==b.summary_type&&k.find("input:text").val("")):"default"==b.summary_type?k.find("input[value='calendar']").click():k.find("input:text").val(b.summary?b.summary:"").trigger("change")}else k.find("input:radio:first").click()})(f)};EventEditDialog.prototype.setStatusLocale=function(){function b(h){var l=h.val().split(" ")[0].split("-");h=parseInt(l[2]);var q=parseInt(l[1]);l=parseInt(l[0]);var p=(new Date).getFullYear(),t=c.locales.status_type.months[q];h=e.datepicker.formatDate(c.locales.status_type.format,
new Date(l,q-1,h));h=h.replace("f",t);p==l&&(h=h.replace(", "+l,"").replace(" "+l,"").replace(l+" ",""));return h}var c=this,f=c.$wrapper.find("input[name='data[start]']"),k=c.$wrapper.find("input[name='data[end]']");c.start_date_locale=b(f);c.end_date_locale=b(k)};EventEditDialog.prototype.close=function(){this.$wrapper.trigger("close")};return EventEditDialog}(jQuery),EventViewDialog=function(e){EventViewDialog=function(a){this.$dialogWrapper=a.$wrapper;this.$wrapper=this.$dialogWrapper.find(".t-dialog-block");
this.event_id=a.event_id;this.event_edit_uri="?module=schedule&action=eventEdit";this.xhr=!1;this.initClass()};EventViewDialog.prototype.initClass=function(){var a=this;a.$wrapper.on("click",".js-edit-event",function(d){d.preventDefault();a.showEditForm()})};EventViewDialog.prototype.showEditForm=function(){var a=this,d={"data[id]":a.event_id};a.xhr&&(a.xhr.abort(),a.xhr=!1);a.xhr=e.post(a.event_edit_uri,d,function(b){a.$wrapper.offset();var c=e.team.calendar;a.close();b=new TeamDialog({html:b});
c.addDialog(b)})};EventViewDialog.prototype.close=function(){this.$wrapper.trigger("close")};return EventViewDialog}(jQuery),EventDeleteDialog=function(e){EventDeleteDialog=function(a){this.$wrapper=a.$wrapper;this.$block=this.$wrapper.find(".t-dialog-block");this.event_id=a.event_id;this.is_locked=!1;this.initClass()};EventDeleteDialog.prototype.initClass=function(){var a=this;a.$block.on("click",".js-delete-event",function(d){d.preventDefault();if(!a.is_locked)a["delete"]()})};EventDeleteDialog.prototype["delete"]=
function(){var a=this,d={id:a.event_id};a.is_locked=!0;e.post("?module=schedule&action=eventDelete",d,function(b){"ok"==b.status&&(b.data&&b.data.message&&alert(b.data.message),a.$wrapper.trigger("close"),e.team.calendar.reload())})};return EventDeleteDialog}(jQuery);var Profile=function(e){Profile=function(a){this.$wrapper=a.$wrapper;this.$tabs=this.$wrapper.find(".t-profile-tabs");this.$tabContentPlace=this.$wrapper.find(".t-dynamic-content");this.$calendarPlace=this.$wrapper.find(".t-calendar-place");this.api_enabled=window.history&&window.history.pushState;this.user=a.user||{id:0};this.photo_dialog_url=a.photo_dialog_url;this.is_own_profile=a.is_own_profile||!1;this.wa_app_url=a.wa_app_url||"";this.backend_url=a.backend_url||"";this.wa_url=a.wa_url||"";this.wa_version=
a.wa_version||"";this.webasyst_id_auth_url=a.webasyst_id_auth_url||"";this.xhr=this.is_locked=!1;this.dialogs=[];this.initClass()};Profile.prototype.initClass=function(){this.initEditableJobtitle();this.bindEvents();e.team&&e.team.sidebar&&e.team.sidebar.selectLink(!1);new ProfileWebasystID({is_own_profile:this.is_own_profile,user:this.user,backend_url:this.backend_url,wa_url:this.wa_url,wa_version:this.wa_version,webasyst_id_auth_url:this.webasyst_id_auth_url})};Profile.prototype.bindEvents=function(){var a=
this;a.$tabs.on("click",".t-tab a",function(){a.changeTab(e(this));return!1});a.$calendarPlace.on("click",".js-calendar-toggle",function(c){c.preventDefault();a.calendarToggle(e(this))});a.$calendarPlace.on("click",".js-show-outer-calendar-manager",function(c){c.stopPropagation();a.showOuterDialogDialog()});a.$wrapper.on("photo_updated photo_deleted",function(c,f){a.$wrapper.find(".t-userpic").attr("src",f.url)});a.$wrapper.find(".photo-change-link a").click(function(){e("#contact-photo-crop-dialog").remove();
e('<div id="contact-photo-crop-dialog">').appendTo(a.$wrapper).waDialog({"class":"large",url:a.photo_dialog_url,onLoad:function(c){c=e(this);c.find(".dialog-buttons-gradient").append(c.find(".dialog-content-indent .buttons"))}})});var d=a.$wrapper.find(".profile-header-links");d.on("click",".edit-link",function(){a.switchToTab("info",function(c){return"function"===typeof c[0].contentWindow.$.wa.contactEditor.switchMode}).then(function(c){c[0].contentWindow.$.wa.contactEditor.switchMode("edit")})});
d.on("click",".delete-link",function(){var c=e(this).find("i");c.is(".loading")||(c.toggleClass("delete loading"),e.team.confirmContactDelete([a.user.id],{onInit:function(){c.toggleClass("delete loading")},onDelete:function(){e.team.content.load(e.team.app_url)}}))});d=a.$wrapper.find(".t-profile-tabs-iframes");var b=e("#contact-info-top");d.on("contact_saved",function(c,f){c=b.closest(".t-profile-page").find(".profile .details h1").first();c.children(".contact-name:first").text(f.name);c.children(".title:first").text(f.title);
c=c.closest(".details").find(".jobtitle-company");c.children(".company").text(f.company);c.children(".title").text(f.jobtitle)});d.on("top_fields_updated",function(c,f){c="";for(var k=0;k<f.length;k++){var h=f[k];c+="<li>"+("im"!=h.id?h.icon?'<i class="icon16 '+h.id+'"></i>':"":"")+h.value+"</li>"}b.html(c)});e("#header-customize-groups-link").click(function(){a.switchToTab("access",function(c){return"function"===typeof c[0].contentWindow.ProfileAccessTab}).then(function(c){c[0].contentWindow.$("#form-customize-groups",
c[0].contentWindow.body).is(":not(:visible)")&&c[0].contentWindow.$("#open-customize-groups",c[0].contentWindow.body).click()})})};Profile.prototype.switchToTab=function(a,d){function b(){var l=c.children().filter(function(){return a==e(this).data("tab-id")}).first();try{l[0].contentWindow&&d(l)&&(setTimeout(function(){k.resolve(l)},0),f.off("tab_content_updated",b),h&&clearInterval(h),h=null)}catch(q){}}var c=this.$wrapper.find(".t-profile-tabs-iframes"),f=this.$wrapper.find('.t-tab a[data-tab-id="'+
a+'"]'),k=e.Deferred();f.on("tab_content_updated",b);var h=setInterval(b,100);f.closest(".t-tab").hasClass("is-selected")?b():f.click();f.length&&e("html, body").animate({scrollTop:f.offset().top},500);return k.promise()};Profile.prototype.changeTab=function(a){if(this.api_enabled){a=a.data("tab-id");var d=window.location.href.match(/^.*\/(id|u)\/[^\/]+/);d&&a&&(a=d[0]+"/"+a+"/",history.replaceState({reload:!0,content_uri:a},"",a))}};Profile.prototype.calendarToggle=function(a){var d=a.find(".t-calendar-toggle .text");
this.$calendarPlace.hasClass("is-short")?(d.text(a.data("hide-text")),this.$calendarPlace.removeClass("is-short")):(d.text(a.data("show-text")),this.$calendarPlace.addClass("is-short"))};Profile.prototype.showOuterDialogDialog=function(){function a(){e.post(b,c,function(f){new TeamDialog({html:f,onRefresh:a})}).always(function(){d.is_locked=!1})}var d=this,b="?module=schedule&action=settings",c={};0<d.user.id&&(b+="&id="+d.user.id);d.is_locked||(d.is_locked=!0,a())};Profile.prototype.initEditableJobtitle=
function(){var a=this,d=a.$wrapper.find(".js-jobtitle-editable").first();d.length&&new TeamEditable({$wrapper:d,onSave:function(b){var c=b.$field.val(),f=!c.length;if(b.text!==c){var k=e.team.app_url+"?module=profile&action=save",h={id:a.user.id,data:JSON.stringify({jobtitle:c})};b.$field.attr("disabled",!0);var l=e('<i class="icon16 loading"></i>').css("margin","0 0 0 4px").insertAfter(b.$field);e.post(k,h,function(){b.$field.attr("disabled",!1);l.remove();b.is_empty=f;b.text=c;b.$wrapper.text(c);
b.toggle("hide");f&&b.$wrapper.parent().find(".at").hide()})}else b.toggle("hide")}})};return Profile}(jQuery),ActivityLazyLoading=function(e){ActivityLazyLoading=function(a){this.list_name=a.names.list;this.items_name=a.names.items;this.pagind_name=a.names.paging;this.user_id=a.user_id;this.$wrapper=a.$wrapper||!1;this.$list=this.$wrapper.find(this.list_name);this.$window=e(window);this.onLoad=a.onLoad||function(){};this.$paging=this.$wrapper.find(this.pagind_name);this.is_locked=this.xhr=!1;this.addWatcher()};
ActivityLazyLoading.prototype.addWatcher=function(){function a(){var c=window&&e.contains(document,d.$paging[0]);c&&b&&window.frameElement&&(c=e.contains(b.document,window.frameElement));if(c)try{d.onScroll()}catch(f){c=!1}c||(d.$window.off("scroll",a),e(b).off("scroll",a))}var d=this,b=window.parent;d.$window.on("scroll",a);if(b&&window.frameElement)e(b).on("scroll",a)};ActivityLazyLoading.prototype.onScroll=function(){var a=this.$window,d=a.scrollTop();a=a.height();var b=this.$paging.offset().top;
if(window.parent&&window.frameElement){var c=e(window.parent);a=c.height();d+=c.scrollTop();b+=e(window.frameElement).offset().top}d+a>=b&&!this.is_locked&&(this.is_locked=!0,this.loadNextPage())};ActivityLazyLoading.prototype.loadNextPage=function(){var a=this,d=e.team.app_url+"?module=profile&action=activity",b={max_id:a.$paging.data("max-id"),id:a.user_id,timestamp:a.$list.find(a.items_name).last().data("timestamp")};a.xhr&&(a.xhr.abort(),a.xhr=!1);a.xhr=e.get(d,b,function(c){var f=e(c);c=f.find(a.list_name+
" "+a.items_name);f=f.find(a.pagind_name);a.$list.append(c);a.$paging.after(f);a.$paging.remove();a.$paging=f;a.is_locked=!1;a.onLoad()})};return ActivityLazyLoading}(jQuery),OutsideCalendarsDialog=function(e){OutsideCalendarsDialog=function(a){this.$dialogWrapper=a.$wrapper;this.$wrapper=this.$dialogWrapper.find(".t-dialog-block");this.$form=this.$wrapper.find("form");this.xhr=this.is_locked=!1;this.initClass()};OutsideCalendarsDialog.prototype.initClass=function(){this.bindEvents()};OutsideCalendarsDialog.prototype.bindEvents=
function(){var a=this;a.$wrapper.on("click",".t-external-calendar-unmount",function(){a.deleteExternalCalendar(e(this).data("id"))});a.$wrapper.find(".js-add-external-calendar").on("click",function(d){d.preventDefault();a.close();(d=e(this).attr("href"))&&e.team.content.load(d)})};OutsideCalendarsDialog.prototype.deleteExternalCalendar=function(a){e.get("?module=calendarExternal&action=DeleteConfirm",{id:a},function(d){new TeamDialog({html:d,onOpen:function(b){b.bind("afterDelete",function(){e.team.content.reload()})}})})};
OutsideCalendarsDialog.prototype.close=function(){this.$wrapper.trigger("close")};return OutsideCalendarsDialog}(jQuery);var AccessPage=function(e){var a=function(b){a=function(c){this.$wrapper=c.$wrapper;this.$accessWrapper=this.$wrapper.find(".t-access-wrapper");this.$accessSlider=this.$wrapper.find(".t-access-slider");this.$headerApps=this.$wrapper.find(".t-header-apps");this.$headerList=this.$headerApps.find(".t-apps-list");this.$apps=this.$headerList.find(".t-app-item");this.item_count=this.$apps.length;this.type_class=!1;this.items_left=this.left=0;this.item_w=this.access_slider_w=this.access_wrapper_w=!1;this.initClass()};
a.prototype.initClass=function(){function c(){b.contains(document,f.$wrapper[0])?f.reset():b(window).off("resize",c)}var f=this;f.detectSliderWidth();f.showArrows();b(window).on("resize",c);f.$wrapper.on("click",".t-action",function(){var k=b(this);k.hasClass("left")&&f.moveSlider(!1);k.hasClass("right")&&f.moveSlider(!0)})};a.prototype.detectSliderWidth=function(){this.access_wrapper_w=this.$accessWrapper.outerWidth();this.access_slider_w=this.$accessSlider.outerWidth();this.item_w=this.$apps.first().outerWidth()};
a.prototype.showArrows=function(){function c(k){f.type_class&&(f.$accessWrapper.removeClass(f.type_class),f.$headerApps.removeClass(f.type_class));k&&(f.$accessWrapper.addClass(k),f.$headerApps.addClass(k),f.type_class=k)}var f=this;0<=f.left?f.access_wrapper_w<f.access_slider_w?c("type-1"):c():f.access_wrapper_w<f.access_slider_w-Math.abs(f.left)?c("type-2"):c("type-3")};a.prototype.setLeft=function(c){this.$headerList.css({left:c});this.$accessSlider.css({left:c});this.left=c};a.prototype.moveSlider=
function(c){var f=this.items_left;c?c=f+1:(c=f-1,0>c&&(c=0));f=c*this.item_w;f>-(this.access_wrapper_w-this.access_slider_w)&&(f=-(this.access_wrapper_w-this.access_slider_w));this.items_left=c;this.setLeft(-f);this.showArrows()};a.prototype.reset=function(){this.items_left=0;this.setLeft(0);this.detectSliderWidth();this.showArrows()};return a}(e),d=function(b){d=function(c){this.$wrapper=c.$wrapper;this.$header=this.$wrapper.find(".t-elastic-header");this.wrapper_offset=this.$wrapper.offset();this.header_w=
this.$header.outerWidth();this.header_h=this.$header.outerHeight();this.fixed_class="is-fixed";this.is_fixed=!1;this.initClass()};d.prototype.initClass=function(){function c(){if(b.contains(document,k.$header[0]))k.onScroll(h.scrollTop());else h.off("scroll",c)}function f(){if(b.contains(document,k.$header[0]))k.onResize();else h.off("resize",f)}var k=this,h=b(window);h.on("scroll",c).on("resize",f)};d.prototype.onScroll=function(c){c>this.wrapper_offset.top?(this.$header.addClass(this.fixed_class).css({top:0,
left:this.wrapper_offset.left,width:this.header_w}),this.is_fixed=!0):(this.$header.removeClass(this.fixed_class).removeAttr("style"),this.is_fixed=!1)};d.prototype.onResize=function(){this.header_w=this.$wrapper.outerWidth();this.is_fixed&&this.$header.width(this.header_w)};return d}(jQuery);AccessPage=function(b){this.$wrapper=b.$wrapper;this.slider=!1;this.dialogs=[];this.initClass()};AccessPage.prototype.initClass=function(){this.initAccessSlider();this.initElasticHeader();this.initHover();this.bindEvents()};
AccessPage.prototype.bindEvents=function(){var b=this;b.$wrapper.on("click",".t-access-status",function(f){f.preventDefault();f=e(this);f.hasClass("is-admin")&&!b.dialogs.length?e.team.content.load(f.data("uri")):showAccessDialog(f,f.data("app-id"),f.data("user-id"))});var c;e(document).on("team_access_level_changed",c=function(f,k){e.contains(document.body,b.$wrapper[0])?b.$wrapper.find('table.t-access-table tr[data-user-id="'+k.contact_id+'"] .t-access-status[data-app-id="'+k.app_id+'"]').removeClass("type-no type-limited type-full type-"+
k.prev_level).addClass("type-"+k.new_level):e(document).off("team_access_level_changed",c)})};AccessPage.prototype.initAccessSlider=function(){this.slider||(this.slider=new a({$wrapper:this.$wrapper}))};AccessPage.prototype.initElasticHeader=function(){new d({$wrapper:this.$wrapper})};AccessPage.prototype.closeDialogs=function(){var b=!1;this.dialogs.length&&(e.each(this.dialogs,function(c,f){e.contains(document,f.$wrapper[0])&&(f.close(),b=!0)}),this.dialogs=[]);return b};AccessPage.prototype.initHover=
function(){function b(){c&&(c.removeClass("highlighted"),c=!1);f&&(f.removeClass("highlighted"),f=!1)}var c=!1,f=!1;this.$wrapper.on("mouseenter",".t-access-status",function(){var k=e(this),h=k.data("user-id");k=k.data("app-id");b();h&&k&&(h=e("#t-user-"+h),k=e("#t-app-"+k),h.length&&(h.addClass("highlighted"),c=h),k.length&&(k.addClass("highlighted"),f=k))});this.$wrapper.on("mouseleave",".t-access-status",b)};return AccessPage}(jQuery);
(function(e){window.AccessDialog=function(a){function d(c){this.$dialogWrapper=c.$wrapper;this.$wrapper=this.$dialogWrapper.find(".t-dialog-block");this.$limitedContent=this.$wrapper.find(".t-limited-access-form");this.active_class="is-active";this.disabled_class="is-disabled";this.wa_app_url=c.wa_app_url;this.app_id=c.app_id;this.contact_id=c.contact_id;this.teamDialog=this.$dialogWrapper.data("teamDialog")||!1;this.noticeToggle=b(this.$wrapper);this.$activeTab=this.$wrapper.find(".t-access-item."+
this.active_class);this.active_access_id=this.$activeTab.data("access-id");this.is_locked=!1;this.initClass()}function b(c){var f=c.find(".t-loading"),k=c.find(".t-success"),h,l;return h={loading:function(){k.removeClass("is-visible");f.addClass("is-visible")},success:function(){k.addClass("is-visible");f.removeClass("is-visible");l&&clearTimeout(l);l=setTimeout(function(){a.contains(document,k[0])&&h.hide()},2E3)},hide:function(){l&&clearTimeout(l);f.removeClass("is-visible");k.removeClass("is-visible")}}}
d.prototype.initClass=function(){this.bindEvents()};d.prototype.bindEvents=function(){var c=this;c.$wrapper.on("click",".t-access-item",function(){var f=a(this),k=f.hasClass(c.active_class),h=f.hasClass(c.disabled_class);c.is_locked||k||h?h&&alert(f.data("reason-disabled")):(c.changeTab(f),c.teamDialog&&c.teamDialog.resize())});c.$wrapper.on("click",'input[type="submit"]',function(f){f.stopPropagation();c.save()})};d.prototype.changeTab=function(c){var f=c.data("access-id"),k=this.$limitedContent;
this.$activeTab.length&&this.$activeTab.removeClass(this.active_class);c.addClass(this.active_class);this.$activeTab=c;this.$wrapper.find(".t-hint").hide();"no"==f?this.$wrapper.find(".t-hint.js-access-no").show():"full"==f&&this.$wrapper.find(".t-hint.js-access-full").show();this.$limitedContent.length&&("limited"==f?k.show():k.hide())};d.prototype.save=function(){var c=this,f=c.$activeTab.data("access-id"),k=function(h){var l=!1,q={no:0,limited:1,full:2};q.hasOwnProperty(h)&&(l=q[h]);return l}(f);
c.is_locked=!0;c.noticeToggle.loading();k=a.post(c.wa_app_url+"?module=accessSave&action=rights&id="+c.contact_id,{app_id:c.app_id,name:"backend",value:k},"json");"limited"===f&&(k=k.then(function(){var h=c.$limitedContent.find("form");return a.post(h.attr("action"),h.serialize(),"json")}));k.then(function(){var h=c.active_access_id;a(document).trigger("team_access_level_changed",{app_id:c.app_id,contact_id:c.contact_id,prev_level:h,new_level:f});c.active_access_id=f;c.noticeToggle.success();c.is_locked=
!1;c.teamDialog.close()})};return d}(e);window.ProfileAccessTab=function(a){function d(){e(".js-webasyst-id-auth").on("click",function(p){p.preventDefault();window.top.$("body").trigger("wa_webasyst_id_auth")})}function b(p,t){if(e.fn.iButton){var u=e(".basic-user-fields"),v=e(".js-block-user-reason-form");v.on("click",".js-block-user-cancel",function(){v.hide()});v.on("submit",function(A){A.preventDefault();if(confirm(B.data("alert"))){A=v.find(".js-block-user-reason");A=e.trim(A.val());e(".c-shown-on-enabled").hide();
var H=E.parent().find(".loading").show();e.post(h+"?module=accessSave&action=ban&id="+k,{magic_word:"please",text:A},function(D){H.hide();v.hide();"ok"===D.status&&(u.addClass("gray"),e(".c-shown-on-disabled").show(),e("#tc-user-access-disabled").show().html(D.data.access_disable_msg))},"json")}});var B=e("#c-access-link-block").click(function(){v.show()}),E=e("#c-access-link-unblock").click(function(){if(!confirm(E.data("alert")))return!1;e(".c-shown-on-disabled").hide();var A=E.parent().find(".loading").show();
e.post(h+"?module=accessSave&action=unban&id="+k,{magic_word:"please"},function(){A.hide();u.removeClass("gray");e(".c-shown-on-enabled").show();e("#tc-user-access-disabled").hide().html("")})})}else e.ajax({cache:!0,dataType:"script",url:p+"wa-content/js/jquery-plugins/ibutton/jquery.ibutton.min.js?"+t,success:function(){b(p,t)}})}var c=a.login,f=a.password,k=a.contact_id,h=a.wa_app_url,l=a.url_change_api_token,q=a.loc;(function(){var p=e("#form-customize-groups");p.length&&(function(t){function u(v,
B){v=e(B||this);v.prop("checked")?v.parent().addClass("highlighted"):v.parent().removeClass("highlighted")}t.find('input[type="checkbox"]').click(u).each(u);return t}(e("#form-customize-groups .c-checkbox-menu")),e("#open-customize-groups").click(function(){e("#form-customize-groups").toggle()}),e("#cancel-customize-groups").click(function(){var t=e("#form-customize-groups").hide();t.find(".loading").hide();t.find(".errormsg").remove();return!1}),p.submit(function(){var t=e(this);t.find(".errormsg").remove();
t.find(".loading").show();e.post(t.attr("action"),t.serialize(),function(u){if("ok"==u.status){try{window.parent.$.team.sidebar.reload()}catch(v){}window.hasOwnProperty("profileTab")&&window.profileTab.reload()}else"fail"==u.status&&t.find(".c-checkbox-menu-container").after(e('<em class="errormsg">'+u.errors.join("<br />")+"</em>"))},"json");return!1}))})();(function(){e("#c-credentials-form").submit(function(){var p=e(this);p.find("input.error").removeClass("error");p.find(".errormsg").remove();
var t=p.find(".c-login-input"),u=e.trim(t.val());if(!u)return t.addClass("error").after('<em class="errormsg">'+q["Login is required"]+"</em>"),!1;t=p.serializeArray();"1"===e("#c-access-rights-toggle").val()&&(t=t.concat([{name:"set_rights",value:"1"},{name:"app_id",value:"webasyst"},{name:"name",value:"backend"},{name:"value",value:1}]));e.post(p.attr("action"),t,function(v){if("ok"===v.status){p.hide();c=u;e("#c-login-block").show().find(".c-login-input").val(c).end().find(".c-login").text(c);
try{window.parent.$.team.sidebar.reload()}catch(B){}try{window.profileTab.reload()}catch(B){}}else"fail"===v.status&&p.find('input[type="submit"]').parent().prepend(e('<em class="errormsg" style="margin-bottom:10px">'+v.errors.join("<br>")+"</em>"))},"json");return!1}).find(".cancel").click(function(){e("#c-credentials-block").hide();return!1})})();(function(){var p=e("#c-login-form"),t=p.find(".c-login-input");p.submit(function(){p.find("input.error").removeClass("error");p.find(".errormsg").remove();
var u=e.trim(t.val());if(c===u)return!1;if(!u)return t.addClass("error").after('<em class="errormsg">'+q["Login is required."]+"</em>"),!1;p.find(".loading").show();e.post(p.attr("action"),p.serialize(),function(v){p.find(".loading").hide();if("ok"===v.status){e("#c-login-block").show();t.val(u);p.find(".c-login").text(u);p.find(".c-one-tab").show();p.find(".c-two-tab").hide();if(!c)try{window.profileTab.reload()}catch(B){}c=u}else"fail"===v.status&&p.find('input[type="submit"]').parent().prepend(e('<em class="errormsg" style="margin-bottom:10px">'+
v.errors.join("\n<br>\n")+"</em>"))},"json");return!1});p.find(".c-tab-toggle").click(function(){p.find(".c-one-tab,.c-two-tab").toggle();t.is(":visible")&&t.focus();return!1})})();(function(){var p=e("#c-password-form"),t=p.find(".c-password-input"),u=p.find(".c-confirm-password-input");p.submit(function(){p.find("input.error").removeClass("error");p.find(".errormsg").remove();if(t.val()!==u.val())return t.addClass("error"),u.after().after('<em class="errormsg">'+q["Passwords do not match."]+"</em>"),
!1;p.find(".loading").show();e.post(p.attr("action"),p.serialize(),function(v){p.find(".loading").hide();"ok"===v.status?(f=!0,t.val(""),u.val(""),p.find(".c-one-tab").show(),p.find(".c-two-tab").hide(),e("#c-password-block").show()):"fail"===v.status&&u.after('<em class="errormsg">'+v.errors.join("<br />")+"</em>")},"json");return!1});p.find(".c-tab-toggle").click(function(){p.find(".c-one-tab,.c-two-tab").toggle();var v=p.find(".c-password-input");v.is(":visible")&&v.focus();return!1})})();(function(){var p=
e("#tc-api-tokens-filed"),t=p.find(".js-api-tokens-list"),u=!1;p.on("click",".js-remove-api-token",function(v){v.preventDefault();var B=e(this).parents(".js-token-item"),E=B.find(".icon16");v=B.data("token");var A={action:"remove",token_id:v};!u&&v&&confirm(q.remove_ask)&&(u=!0,E.removeClass("no").addClass("loading"),e.post(l,A,function(H){H.status&&"ok"===H.status?(B.remove(),0===t.find(".js-token-item").length&&p.remove()):(u=!1,E.removeClass("loading").addClass("no"))}).always(function(){u=!1;
E.removeClass("loading").addClass("no")}))})})();a.is_own_profile||b(a.wa_url,a.wa_framework_version);a.is_own_profile&&d();(function(){e(".js-webasyst-id-unbind-auth").on("click",function(p){p.preventDefault();window.top.$(".js-webasyst-id-unbind-auth").trigger("wa_waid_unbind_auth",{id:k})})})();(function(){e(".js-webasyst-id-help-link").on("click",function(p){p.preventDefault();window.top.$("body").trigger("wa_waid_help_link")})})();(function(p,t,u){function v(){B(!0)&&E()}function B(y){e("#c-access-rights-hint-warning").hide();
e("#c-access-rights-hint-customize").hide();var C=A.val();void 0===C&&(C="1");switch(C){case "remove":e("#c-credentials-block").hide();e("#c-login-block").hide();e("#c-password-block").hide();if(u){e("#c-access-rights-by-app").hide();e(".c-shown-on-access").hide();break}A.val(D||"0");e("#c-access-rights-hint-warning").show();return!1;case "0":if(c||f)if(c){var x=e("#c-access-rights-by-app");x.show();y&&x.find(".t-access-status").removeClass("type-no type-limited type-full").addClass("type-no");e(".c-shown-on-access").show();
e("#c-login-block").show();e("#c-password-block").show();break}else return e("#c-login-block").show().find(".cancel").one("click.access",function(){A.val(D);v()}).end().find(".c-tab-toggle:first").click(),e("#c-password-block").show(),!1;else return e("#c-credentials-block").show().find(".c-login-input").focus().end().find(".cancel").one("click.access",function(){A.val(D);v()}),!1;case "1":if(c||f)if(c){e("#c-access-rights-by-app").hide();e(".c-shown-on-access").show();e("#c-login-block").show();
e("#c-password-block").show();break}else return e("#c-login-block").show().find(".cancel").one("click.access",function(){A.val(D);v()}).end().find(".c-tab-toggle:first").click(),e("#c-password-block").show(),!1;else return e("#c-credentials-block").show().find(".c-login-input").focus().end().find(".cancel").one("click.access",function(){A.val(D);v()}),!1;default:return!1}p&&(e("#c-login-block").show(),e("#c-password-block").show());D=C;return!0}function E(){function y(x,F,g){return e.post(h+"?module=accessSave&action=rights&id="+
k,{app_id:x,name:F,value:g},"json")}var C=A.val();void 0===C&&(C="1");(function(){switch(C){case "0":return e.post(h+"?module=accessSave&action=makeuser",{id:k},"json").then(function(){return y("webasyst","backend",0)});case "1":return y("webasyst","backend",1);case "remove":return e.post(h+"?module=accessSave&action=revoke",{id:k},"json")}})().then(function(){u&&"0"==C?e("#c-access-rights-hint-customize").show():e("#c-access-rights-hint-warning").hide()})}var A=e("#c-access-rights-toggle"),H=e("#access-rights-toggle-confirm"),
D=A.val();t?e(".c-shown-on-access").hide():e(".c-shown-on-access").show();B();H.on("click",".cancel",function(){A.val(D);H.hide()});H.on("click",".button",function(){H.hide();v()});A.change(function(){if(c){e("#c-access-rights-hint-warning").hide();e("#c-access-rights-hint-customize").hide();var y=A.val();void 0===y&&(y="1");y===D?H.hide():H.show()}else B(!0)})})(a.is_own_profile,a.contact_no_access,a.contact_groups_no_access);new UserAccessTable({$wrapper:e("#c-access-rights-wrapper"),contact_id:k,
is_frame:!0})};window.UserAccessTable=function(a){var d=a.$wrapper,b=a.contact_id,c=a.is_frame||!1;d.on("click",".t-access-status",function(k){k.preventDefault();k=e(this);showAccessDialog(k,k.data("app-id"),b,!0,c)});var f;e(document).on("team_access_level_changed",f=function(k,h){e.contains(document.body,d[0])?d.find('.t-access-status[data-app-id="'+h.app_id+'"]').removeClass("type-no type-limited type-full type-"+h.prev_level).addClass("type-"+h.new_level):e(document).off("team_access_level_changed",
f)})};window.showAccessDialog=function(a,d,b,c,f){a.trigger("close");e.post(e.team.app_url+"?module=access&action=dialog",{user_id:b,app_id:d},function(k){k={html:k};f&&c&&(k.setPosition=function(h){var l=e(window).width();return{top:a.offset().top,left:parseInt((l-h.width)/2)}});new TeamDialog(k)})}})(jQuery);var GroupPage=function(e){GroupPage=function(a){this.$wrapper=a.$wrapper;this.group_id=a.group_id;this.map_adapter=a.map_adapter;this.latitude=a.latitude;this.longitude=a.longitude;this.can_manage=a.can_manage;this.map_is_shown=this.map_is_render=!1;this.initClass()};GroupPage.prototype.initClass=function(){this.bindEvents();this.can_manage&&(this.initEditableName(),this.initEditableDescription());this.initInfoBlock()};GroupPage.prototype.bindEvents=function(){var a=this;if(a.map_adapter&&a.latitude&&
a.longitude)a.$wrapper.on("click",".js-open-map-link",function(){a.showMap()})};GroupPage.prototype.showMap=function(){var a=this.$wrapper.find(".t-map-wrapper");this.map_is_shown?a.slideUp(200):this.map_is_render?a.slideDown(200):(a.show(),this.initMap(),this.map_is_render=!0);this.map_is_shown=!this.map_is_shown};GroupPage.prototype.initMap=function(){var a=this.$wrapper.find("#t-location-map");(new TeamMap(a,this.map_adapter)).render(this.latitude,this.longitude)};GroupPage.prototype.initEditableName=
function(){var a=this,d=a.$wrapper.find(".js-name-editable").first();d.length&&new TeamEditable({$wrapper:d,onSave:function(b){var c=b.$field.val();if(c.length&&b.text!==c){var f=e.team.app_url+"?module=group&action=save",k={"data[id]":a.group_id,"data[name]":c};b.$field.attr("disabled",!0);var h=e('<i class="icon16 loading"></i>').css("margin","0 0 0 4px").insertAfter(b.$field);e.post(f,k,function(){b.$field.attr("disabled",!1);h.remove();b.text=c;b.$wrapper.text(c);b.toggle("hide");e.team.sidebar.reload()})}else c.length||
b.$field.val(b.text),b.toggle("hide")}})};GroupPage.prototype.initEditableDescription=function(){var a=this,d=a.$wrapper.find(".js-desc-editable").first();d.length&&new TeamEditable({$wrapper:d,onSave:function(b){var c=b.$field.val(),f=!c.length;if(b.text!==c){var k=e.team.app_url+"?module=group&action=save",h={"data[id]":a.group_id,"data[description]":c};b.$field.attr("disabled",!0);var l=e('<i class="icon16 loading"></i>').css("margin","0 0 0 4px").insertAfter(b.$field);e.post(k,h,function(){b.$field.attr("disabled",
!1);l.remove();b.is_empty=f;b.text=c;b.$wrapper.text(c);b.toggle("hide");f&&e.team.content.reload()})}else b.toggle("hide")}})};GroupPage.prototype.initInfoBlock=function(){var a=this.$wrapper.find(".t-info-notice-wrapper"),d=new e.store;d.get("team/empty_group_notice_hide")?a.hide():a.show();a.find(".t-info-notice-toggle").on("click",function(){d.set("team/empty_group_notice_hide",1);a.hide()})};return GroupPage}(jQuery),GroupManage=function(e){GroupManage=function(a){this.$wrapper=a.$wrapper;this.$groupUsersW=
this.$wrapper.find(".t-users-list.is-used-list");this.$groupUsersHint=this.$wrapper.find(".t-empty-users-in-group");this.$otherUsersW=this.$wrapper.find(".t-users-list.is-unused-list");this.$otherUsersHint=this.$wrapper.find(".t-empty-users-outside-group");this.group_id=a.group_id;this.hidden_class="is-hidden";this.locales=a.locales;this.xhr=this.is_locked=this.$sidebarLink=!1;this.group_count=this.$groupUsersW.find(".t-user-wrapper").length;this.other_count=this.$otherUsersW.find(".t-user-wrapper").length;
this.initClass()};GroupManage.prototype.initClass=function(){this.bindEvents();this.initAutoComplete();this.initEditableName()};GroupManage.prototype.bindEvents=function(){var a=this;a.$wrapper.on("click",".js-edit-group",function(d){d.preventDefault();a.group_id&&!a.is_locked&&a.showEditGroupDialog()});a.$wrapper.on("click",".js-delete-group",function(d){d.preventDefault();a.group_id&&!a.is_locked&&a.showDeleteDialog()});a.$groupUsersW.on("click",".js-move-user",function(d){d.preventDefault();a.is_locked||
a.moveUser(e(this).closest(".t-user-wrapper"),!1)});a.$otherUsersW.on("click",".js-move-user",function(d){d.preventDefault();a.is_locked||a.moveUser(e(this).closest(".t-user-wrapper"),!0)})};GroupManage.prototype.showEditGroupDialog=function(){var a=this,d={id:a.group_id};a.is_locked||(a.is_locked=!0,a.xhr&&(a.xhr.abort(),a.xhr=!1),a.xhr=e.get("?module=group&action=edit",d,function(b){new TeamDialog({html:b});a.is_locked=!1}))};GroupManage.prototype.showDeleteDialog=function(){var a=this,d=e.team.app_url+
"?module=group&action=deleteConfirm",b={id:a.group_id};a.is_locked||(a.is_locked=!0,a.xhr&&(a.xhr.abort(),a.xhr=!1),a.xhr=e.get(d,b,function(c){new TeamDialog({html:c});a.is_locked=!1;a.$wrapper.trigger("close")}))};GroupManage.prototype.moveUser=function(a,d){var b=this,c={user_id:a.data("user-id"),group_id:b.group_id};if(!b.is_locked){b.xhr&&(b.xhr.abort(),b.xhr=!1);var f=d?e.team.app_url+"?module=group&action=userAdd":e.team.app_url+"?module=group&action=userRemove";b.xhr=e.post(f,c,function(k){"ok"==
k.status&&(d?(b.$groupUsersW.append(a),b.group_count++,b.other_count--):(b.$otherUsersW.prepend(a),b.group_count--,b.other_count++),0>=b.group_count?(b.$groupUsersW.addClass(b.hidden_class),b.$groupUsersHint.removeClass(b.hidden_class)):(b.$groupUsersW.removeClass(b.hidden_class),b.$groupUsersHint.addClass(b.hidden_class)),0>=b.other_count?(b.$otherUsersW.addClass(b.hidden_class),b.$otherUsersHint.removeClass(b.hidden_class)):(b.$otherUsersW.removeClass(b.hidden_class),b.$otherUsersHint.addClass(b.hidden_class)),
b.setCount(b.group_count));b.is_locked=!1})}};GroupManage.prototype.setCount=function(a){var d=e.team.app_url+"group/"+this.group_id+"/";this.$sidebarLink||(this.$sidebarLink=e.team.sidebar.$wrapper.find('a[href="'+d+'"] '));if(this.$sidebarLink.length){var b=this.$sidebarLink.closest("li");b.find(".indicator").remove();b.find(".count").text(a);e.team.sidebar.saveCount(d,a)}};GroupManage.prototype.initAutoComplete=function(){function a(){clearTimeout(k);f.length&&(f.remove(),f=!1)}function d(h){f=
e('<span class="t-hint"><i class="icon16 yes"></i>'+h+"</span>");c.after(f);k=setTimeout(a,1E3)}var b=this,c=b.$wrapper.find(".t-autocomplete-wrapper .t-input"),f=!1,k=0;c.autocomplete({source:function(h,l){var q=e.team.app_url+"?module=autocomplete&type=user";h={term:h.term};b.group_id&&(h.group_id=b.group_id);e.post(q,h,function(p){l(p)},"json")},minLength:2,open:function(){a()},focus:function(){return!1},select:function(h,l){l.item.id&&(h=b.$otherUsersW.find('.t-user-wrapper[data-user-id="'+l.item.id+
'"]'),h.length?(h.find(".js-move-user").click(),d(b.locales.added)):d(b.locales.in_group));c.val("");return!1}})};GroupManage.prototype.initEditableName=function(){var a=this,d=a.$wrapper.find(".js-name-editable").first();d.length&&new TeamEditable({$wrapper:d,onSave:function(b){var c=b.$field.val();if(c.length&&b.text!==c){var f=e.team.app_url+"?module=group&action=save",k={"data[id]":a.group_id,"data[name]":c};b.$field.attr("disabled",!0);var h=e('<i class="icon16 loading"></i>').css("margin","0 0 0 4px").insertAfter(b.$field);
e.post(f,k,function(){b.$field.attr("disabled",!1);h.remove();b.text=c;b.$wrapper.text(c);b.toggle("hide");e.team.sidebar.reload()})}else c.length||b.$field.val(b.text),b.toggle("hide")}})};return GroupManage}(jQuery),GroupEditDialog=function(e){GroupEditDialog=function(a){this.$wrapper=a.$wrapper;this.$block=this.$wrapper.find(".t-dialog-block");this.$form=this.$block.find("form");this.$iconToggle=this.$block.find(".t-icon-toggle");this.$addressToggle=this.$block.find(".t-address-toggle");this.$mapToggle=
this.$block.find(".t-map-toggle");this.$submitButton=this.$form.find('input[type="submit"]');this.selected_class="is-selected";this.hidden_class="is-hidden";this.has_error_class="error";this.locales=a.locales;this.dialog=this.$wrapper.data("teamDialog");this.$activeType=this.$block.find(".t-type-toggle ."+this.selected_class);this.$activeIcon=this.$iconToggle.find("."+this.selected_class);this.is_locked=!1;this.save_timeout=0;this.is_map_loading=!1;this.bindEvents();this.teamMap=this.initMap(a.map_type||
"google")};GroupEditDialog.prototype.bindEvents=function(){var a=this;a.$block.on("click",".t-type-toggle .t-toggle-item",function(d){d.stopPropagation();a.setType(e(this))});a.$iconToggle.on("click",".t-icon-item",function(d){d.preventDefault();a.setIcon(e(this))});a.$form.on("submit",function(d){d.preventDefault();a.is_locked||(a.$form.find(".js-submit-loading").remove(),a.$submitButton.parent().append("<i class='icon16 loading js-submit-loading'></i>"),a.save())});a.$form.find("input, textarea").on("mousedown",
function(){var d=e(this),b=d.hasClass(a.has_error_class);a.$form.find(".js-submit-loading").remove();b&&d.removeClass(a.has_error_class).closest(".value").find(".t-error").remove()})};GroupEditDialog.prototype.setType=function(a){var d=a.data("type");if(a.hasClass(this.selected_class))return!1;this.$activeType.length&&this.$activeType.removeClass(this.selected_class);"group"==d?(this.$iconToggle.removeClass(this.hidden_class),this.$addressToggle.addClass(this.hidden_class),this.$mapToggle.addClass(this.hidden_class)):
(this.$iconToggle.addClass(this.hidden_class),this.$addressToggle.removeClass(this.hidden_class),this.$mapToggle.removeClass(this.hidden_class));a.addClass(this.selected_class);this.$activeType=a;this.dialog.resize()};GroupEditDialog.prototype.setIcon=function(a){var d=a.data("icon-class");if(a.hasClass(this.selected_class))return!1;this.$activeIcon.length&&this.$activeIcon.removeClass(this.selected_class);this.$form.find('input[name="data[icon]"]').val(d).trigger("change");a.addClass(this.selected_class);
this.$activeIcon=a};GroupEditDialog.prototype.save=function(a){function d(q){function p(v){b.$form.find(".t-error").remove();e.each(v,function(B,E){B=b.$form.find("[name='"+E.field+"']");B.length&&B.addClass(b.has_error_class).after('<span class="t-error">'+b.locales[E.locale]+"</span>")})}var t={},u=[];e.each(q,function(v,B){t[B.name]=B.value});e.trim(t["data[name]"]).length||u.push({field:"data[name]",locale:"empty"});return u.length?(p(u),!1):t}var b=this,c;a=a||0;if(!b.is_locked)if(b.is_locked=
!0,c=d(b.$form.serializeArray())){if(b.is_map_loading&&5>a)return b.is_locked=!1,b.save_timeout=setTimeout(function(){e.contains(document,b.$wrapper[0])&&b.save(a+1)},1E3),!1;var f=function(){e.post("?module=group&action=save",c,function(q){"ok"==q.status&&(e.team.content.load(e.team.app_url+"group/"+q.data.id+"/manage/"),e.team.sidebar.reload(),b.is_locked=!1)})},k=c["data[location][address]"],h=c["data[location][latitude]"],l=c["data[location][longitude]"];!k||h&&l||!b.teamMap?f():b.teamMap.geocode(k,
function(q,p){c["data[location][latitude]"]=q;c["data[location][longitude]"]=p;f()},function(){f()})}else b.is_locked=!1};GroupEditDialog.prototype.initMap=function(a){function d(v){function B(E,A){l.is(":hidden")&&(l.show(),c.data("top",c.offset().top),c.css("top",c.data("top")-l.height()/2));u.render(E,A);h.val(E);k.val(A)}clearTimeout(p);"string"===e.type(v)?(b.is_map_loading=!0,u.geocode(v,function(E,A){h.val(E);k.val(A);q.hide();B(E,A);b.is_map_loading=!1},function(){l.hide();k.val("");h.val("");
q.show();b.is_map_loading=!1})):B(v.lat,v.lng)}var b=this,c=b.$block,f=b.$addressToggle.find(".f-location-edit-address-input"),k=b.$addressToggle.find(".t-location-longitude-input"),h=b.$addressToggle.find(".t-location-latitude-input"),l=b.$mapToggle.find(".t-location-edit-map"),q=b.$addressToggle.find(".t-map-hint"),p=0;if(0<f.length){var t=b.$form.find(".value").first().width();l.width(t);l.height(t/1.618)}var u=new TeamMap(l,a);a=k.val();t=h.val();a&&t&&d({lat:t,lng:a});f.on("change",function(){var v=
e(this).val();v.length?d(v):(k.val(""),h.val(""),l.hide())});f.on("keyup",function(){clearTimeout(p);var v=e(this).val();v.length?(b.is_map_loading=!0,p=setTimeout(function(){d(v)},1E3)):(k.val(""),h.val(""),l.hide())});return u};return GroupEditDialog}(jQuery),GroupDeleteDialog=function(e){GroupDeleteDialog=function(a){this.$wrapper=a.$wrapper;this.$block=this.$wrapper.find(".t-dialog-block");this.api_enabled=window.history&&window.history.replaceState;this.group_id=a.group_id;this.is_locked=!1;
this.initClass()};GroupDeleteDialog.prototype.initClass=function(){var a=this;a.$block.on("click",".js-delete-event",function(d){d.preventDefault();if(!a.is_locked)a["delete"]()})};GroupDeleteDialog.prototype["delete"]=function(){var a=this,d={id:a.group_id};a.is_locked=!0;e.post("?module=group&action=delete",d,function(b){"ok"==b.status&&(a.$wrapper.trigger("close"),a.api_enabled?(history.state.content_uri=e.team.app_url,history.replaceState({reload:!0,content_uri:e.team.app_url},"",e.team.app_url),
e.team.sidebar.reload(),e.team.content.reload()):location.href=e.team.app_url)},"json")};return GroupDeleteDialog}(jQuery);var SettingsPage=function(e){SettingsPage=function(a){this.$wrapper=a.$wrapper;this.$calendarToggle=this.$wrapper.find("#t-calendar-settings");this.$form=this.$wrapper.find("form");this.$submitButton=this.$form.find('input[type="submit"]');this.locales=a.locales;this.xhr=this.is_form_changed=this.is_locked=this.$notice=!1;this.initClass()};SettingsPage.prototype.initClass=function(){this.bindEvents();this.initSortable()};SettingsPage.prototype.bindEvents=function(){var a=this;a.$calendarToggle.on("click",
".js-edit-calendar",function(d){d.preventDefault();(d=parseInt(e(this).closest(".t-calendar-item").data("id")))&&a.showEditDialog(d)});a.$calendarToggle.on("click",".js-add-calendar",function(d){d.preventDefault();a.showEditDialog()});a.$form.on("submit",function(d){d.preventDefault();a.is_form_changed&&a.save(a.$form)});a.$form.on("change","input, select, textarea",function(){a.is_form_changed||(a.is_form_changed=!0,a.$submitButton.removeClass("green").addClass("yellow"))})};SettingsPage.prototype.initSortable=
function(){var a=this,d;a.$calendarToggle.find("ul").sortable({handle:".t-toggle",items:"> .t-calendar-item",axis:"y",start:function(b,c){d=c.item.index();a.$notice&&(a.$notice.remove(),a.$notice=!1)},stop:function(b,c){d!=c.item.index()&&a.saveCalendarsSort(c)}})};SettingsPage.prototype.showEditDialog=function(a){var d=this,b=e.team.app_url+"?module=calendar",c={};a&&(c.id=a);d.xhr&&(d.xhr.abort(),d.xhr=!1);d.xhr=e.post(b,c,function(f){d.dialog=new TeamDialog({html:f})})};SettingsPage.prototype.saveCalendarsSort=
function(a){function d(k){var h=e('<span class="t-notice"><i class="icon16 yes"></i>'+(b.locales.saved||"")+"</span>");h.appendTo(k);return h}var b=this,c=a.item;a=e.team.app_url+"?module=settings&action=calendarsSortSave";var f={calendars:function(){var k=[];b.$calendarToggle.find(".t-calendar-item").each(function(){var h=e(this).data("id");h&&0<h&&k.push(h)});return k}()};b.xhr&&(b.xhr.abort(),b.xhr=!1);b.$notice=function(k){var h=e('<span class="t-notice"><i class="icon16 loading"></i>'+(b.locales.saving||
"")+"</span>");h.appendTo(k);return h}(c);b.xhr=e.post(a,f,function(k){b.$notice.remove();b.$notice=d(c);setTimeout(function(){b.$notice&&e.contains(document,b.$notice[0])&&b.$notice.remove()},1E3);b.xhr=!1})};SettingsPage.prototype.save=function(a){var d=this,b=e.team.app_url+"?module=settings&action=save";a=a.serializeArray();var c=e('<i class="icon16 loading" style="margin: 0 4px;"></i>');c.insertAfter(d.$submitButton);d.is_locked||(d.is_locked=!0,e.post(b,a,function(f){d.is_form_changed=!1;d.$submitButton.removeClass("yellow").addClass("green");
"ok"===f.status&&("google"===f.data.map_info.adapter?e.getScript("https://maps.googleapis.com/maps/api/js?sensor=false&key="+(f.data.map_info.settings.key||"")+"&lang="+f.data.lang):"yandex"===f.data.map_info.adapter&&e.getScript("https://api-maps.yandex.ru/2.1/?lang="+f.data.lang))}).always(function(){c.remove();d.is_locked=!1}))};return SettingsPage}(jQuery),CalendarEditDialog=function(e){CalendarEditDialog=function(a){this.$wrapper=a.$wrapper;this.$block=this.$wrapper.find(".t-dialog-block");this.$form=
this.$block.find("form");this.$styleWrapper=this.$block.find(".t-style-wrapper");this.$limitedToggle=this.$block.find(".t-limited-toggle");this.$nameField=this.$block.find('input[name="data[name]"]');this.calendar_id=a.calendar_id;this.selected_class="is-selected";this.hidden_class="is-hidden";this.has_error_class="error";this.locales=a.locales;this.teamDialog=this.$wrapper.data("teamDialog");this.$selectedStyleButton=this.$styleWrapper.find("."+this.selected_class);this.xhr=this.is_locked=!1;this.initClass()};
CalendarEditDialog.prototype.initClass=function(){this.bindEvents();this.initColorPicker()};CalendarEditDialog.prototype.bindEvents=function(){var a=this;a.$block.on("click",".js-delete-calendar",function(d){d.preventDefault();a.is_locked||a.showDeleteConfirm()});a.$styleWrapper.on("click",".t-style-item",function(d){d.preventDefault();a.setStyleToggle(e(this))});a.$form.on("submit",function(d){d.preventDefault();a.locked||a.save()});a.$form.on("change",".t-color-field",function(){a.$selectedStyleButton.length&&
(a.$selectedStyleButton.removeClass(a.selected_class),a.$selectedStyleButton=!1)});a.$form.find("input, textarea").on("mousedown",function(){var d=e(this);d.hasClass(a.has_error_class)&&d.removeClass(a.has_error_class).closest(".value").find(".t-error").remove()});a.$nameField.on("change keyup",function(){var d=e(this).val();d=d.length?d:a.locales.preview;a.setPreviewName(d)});a.$limitedToggle.on("change","input:radio",function(){var d=a.$limitedToggle.find(".t-hidden-content");e(this).val().length?
d.show():d.hide();a.teamDialog.resize()})};CalendarEditDialog.prototype.setStyleToggle=function(a){var d=a.css("background-color"),b=a.css("color");this.$selectedStyleButton.length&&this.$selectedStyleButton.removeClass(this.selected_class);this.setStyleData(d,b);a.addClass(this.selected_class);this.$selectedStyleButton=a};CalendarEditDialog.prototype.setStyleData=function(a,d){function b(c){c=c.split("(")[1].split(")")[0];c=c.split(",").splice(0,3);return"#"+c.map(function(f){f=parseInt(f).toString(16);
return 1==f.length?"0"+f:f}).join("")}a=b(a);d=b(d);this.$form.find('[name="data[bg_color]"]').val(a).trigger("change");this.$form.find('[name="data[font_color]"]').val(d).trigger("change")};CalendarEditDialog.prototype.showDeleteConfirm=function(){var a=this,d={id:a.calendar_id};a.is_locked=!0;a.xhr&&(a.xhr.abort(),a.xhr=!1);a.xhr=e.get("?module=calendar&action=deleteConfirm",d,function(b){new TeamDialog({html:b});a.is_locked=!1;a.$wrapper.trigger("close")})};CalendarEditDialog.prototype.initColorPicker=
function(){var a=this,d=function(b){d=function(c){this.$wrapper=c.$wrapper;this.$field=this.$wrapper.find(".t-color-field");this.$icon=this.$wrapper.find(".js-show-color-picker");this.$colorPicker=this.$wrapper.find(".t-color-picker");this.farbtastic=this.is_opened=!1;this.initClass()};d.prototype.initClass=function(){var c=this;c.farbtastic=b.farbtastic(c.$colorPicker,function(f){c.$field.val(f).change()});c.$wrapper.data("colorPicker",c);c.bindEvents()};d.prototype.bindEvents=function(){function c(){f.$wrapper.siblings().each(function(){var k=
b(this).data("colorPicker");k&&k.is_opened&&k.displayToggle(!1)})}var f=this;f.$field.on("change keyup",function(){var k=b(this).val();f.$icon.css("background-color",k);f.farbtastic.setColor(k)});f.$icon.on("click",function(k){k.preventDefault();c();f.displayToggle(!f.is_opened)});f.$wrapper.on("click",function(k){k.preventDefault();k.stopPropagation()});f.$field.on("focus",function(){f.is_opened||(c(),f.displayToggle(!0))});a.$wrapper.find(".t-dialog-background").on("click",function(){f.is_opened&&
f.displayToggle(!1)});a.$block.on("click",function(){f.is_opened&&f.displayToggle(!1)})};d.prototype.displayToggle=function(c){var f=this.$colorPicker;c?(f.removeClass("is-hidden"),this.is_opened=!0):(f.addClass("is-hidden"),this.is_opened=!1)};return d}(jQuery);a.$styleWrapper.find(".t-color-toggle .t-toggle").each(function(){new d({$wrapper:e(this)})})};CalendarEditDialog.prototype.setPreviewName=function(a){this.$styleWrapper.find(".t-style-item").text(a)};CalendarEditDialog.prototype.save=function(){var a=
this,d=function(b){function c(h){a.$form.find(".t-error").remove();e.each(h,function(l,q){l=a.$form.find("[name='"+q.field+"']");l.length&&l.addClass(a.has_error_class).after('<span class="t-error">'+a.locales[q.locale]+"</span>")})}var f={},k=[];e.each(b,function(h,l){f[l.name]=l.value});f["data[is_limited]"]||delete f["data[is_limited]"];e.trim(f["data[name]"]).length||k.push({field:"data[name]",locale:"empty"});return k.length?(c(k),!1):f}(a.$form.serializeArray());a.is_locked||(a.is_locked=!0,
d?e.post("?module=calendar&action=save",d,function(b){"ok"==b.status&&(e.team.content.reload(),e.team.sidebar.reload(),a.is_locked=!1)}):a.is_locked=!1)};return CalendarEditDialog}(jQuery),CalendarDeleteDialog=function(e){CalendarDeleteDialog=function(a){this.$wrapper=a.$wrapper;this.$block=this.$wrapper.find(".t-dialog-block");this.calendar_id=a.calendar_id;this.is_locked=!1;this.initClass()};CalendarDeleteDialog.prototype.initClass=function(){var a=this;a.$block.on("click",".js-delete-calendar",
function(d){d.preventDefault();if(!a.is_locked)a["delete"]()})};CalendarDeleteDialog.prototype["delete"]=function(){var a=this,d={id:a.calendar_id};a.is_locked=!0;e.post("?module=calendar&action=delete",d,function(b){"ok"==b.status&&(e.team.content.reload(),a.$wrapper.trigger("close"))},"json")};return CalendarDeleteDialog}(jQuery);var SiteApiTokenPage=function(e){SiteApiTokenPage=function(a){this.$wrapper=a.$wrapper;this.locale=a.locale;this.initClass()};SiteApiTokenPage.prototype.initClass=function(){this.initRemoveApiToken()};SiteApiTokenPage.prototype.initRemoveApiToken=function(){var a=this,d=a.$wrapper.find(".js-api-tokens-list"),b;a.$wrapper.on("click",".js-remove-api-token",function(c){c.preventDefault();var f=e(this).parents(".js-token-item"),k=f.find(".icon16");c=f.data("token");var h=f.data("contact-id");h={action:"remove",
token_id:c,contact_id:h};!b&&c&&confirm(a.locale.remove_ask)&&(b=!0,k.removeClass("no").addClass("loading"),e.post("?module=apiTokensRemove",h,function(l){l.status&&"ok"===l.status?(f.remove(),d.find(".js-token-item")):(b=!1,k.removeClass("loading").addClass("no"))}).always(function(){b=!1;k.removeClass("loading").addClass("no")}))})};return SiteApiTokenPage}(jQuery);var UserList=function(e){UserList=function(a){this.$wrapper=a.$wrapper;this.$items=this.$wrapper.find(".t-user-wrapper");this.xhr=this.is_locked=!1;this.initClass()};UserList.prototype.initClass=function(){this.initHightlight();this.bindEvents()};UserList.prototype.bindEvents=function(){var a=!1;this.$wrapper.find(".js-move-user").draggable({helper:"clone",delay:200,cursorAt:{top:10,left:20},start:function(d,b){b.helper.addClass("is-clone");a=e.team.sidebar.$wrapper.find(".js-drop-block");a.length&&
a.addClass("t-drop-here")},stop:function(d,b){d=b.helper;var c=d.clone();c.insertAfter(d).fadeOut(270);setTimeout(function(){c.remove()},300);a.length&&a.removeClass("t-drop-here")}})};UserList.prototype.initHightlight=function(){function a(b){return new Date(b.year,b.month-1,b.day,b.hours,b.minutes,b.seconds)}var d=e.team.sidebar.link_count_update_date;d&&(d=a(d),this.$items.each(function(){var b=e(this),c=b.data("update-datetime");if(c&&c.length){var f=c.split(" ");c=f[0].split("-");f=f[1].split(":");
c={year:parseInt(c[0]),month:parseInt(c[1]),day:parseInt(c[2]),hours:parseInt(f[0]),minutes:parseInt(f[1]),seconds:parseInt(f[2])};a(c)>d&&b.addClass("highlighted")}}))};return UserList}(jQuery);var WelcomePage=function(e){WelcomePage=function(a){this.$wrapper=a.$wrapper;this.$inviteWrapper=this.$wrapper.find("#t-invite-wrapper");this.$inviteList=this.$inviteWrapper.find(".t-invite-list");this.locales=a.locales;this.error_class="error";this.is_locked=!1;this.initClass()};WelcomePage.prototype.initClass=function(){var a=this;e(document).on("ready",function(){e.team.content.is_enabled=!1});a.$inviteList.find("input:checkbox").each(function(){a.initIButton(e(this))});a.bindEvents()};WelcomePage.prototype.bindEvents=
function(){var a=this;a.$wrapper.on("click",".js-skip-page",function(d){d.stopPropagation()});a.$wrapper.on("click",".js-send-invites",function(d){d.preventDefault();a.is_locked||a.sendInvites()});a.$inviteWrapper.on("click",".js-add-invite",function(d){d.preventDefault();a.addNewInvite()});a.$inviteWrapper.on("click",".js-remove-invite",function(d){d.preventDefault();e(this).closest("li").remove()});a.$inviteWrapper.on("click","."+a.error_class,function(){a.removeErrors(e(this))})};WelcomePage.prototype.initIButton=
function(a){a.iButton({labelOn:"",labelOff:"",classContainer:"t-ibutton ibutton-container mini"})};WelcomePage.prototype.addNewInvite=function(){var a=this.$inviteWrapper.find(".t-invite-template").clone().html();a=e("<li>"+a+"</li>");this.$inviteList.append(a);a=a.find("input:checkbox");this.initIButton(a)};WelcomePage.prototype.sendInvites=function(){function a(f){var k=[];e.each(f,function(h,l){h=l.text;l=parseInt(l.name.replace("data[","").replace("][email]",""));l=d.$inviteList.find(".t-invite-item").eq(l).find(".t-field");
l.length&&k.push({$field:l,locale:h})});d.displayErrors(k)}var d=this,b=e.team.app_url+"?module=welcome&action=save",c=function(){var f=[],k=[];d.$inviteList.find(".t-invite-item").each(function(h){var l=e(this).find("input:text"),q=e(this).find("input:checkbox"),p=l.val();q="checked"==q.attr("checked");e.trim(p).length&&(p.match(".+@.+")?(f.push({name:"data["+h+"][email]",value:p}),f.push({name:"data["+h+"][access]",value:q})):k.push({$field:l,locale:d.locales.incorrect}))});return k.length?(d.displayErrors(k),
!1):f.length?f:!1}();d.is_locked=!0;c?e.post(b,c,function(f){f.errors&&f.errors.length?a(f.errors):location.href=e.team.app_url}).always(function(){d.is_locked=!1}):d.is_locked=!1};WelcomePage.prototype.removeErrors=function(a){var d=this.error_class;a?(a.removeClass(d),a.parent().find(".t-error").remove()):(this.$inviteList.find(".t-error").remove(),this.$inviteList.find("."+d).removeClass(d))};WelcomePage.prototype.displayErrors=function(a){var d=this.error_class;this.removeErrors();e.each(a,function(b,
c){b='<span class="t-error">'+c.locale+"</span>";c.$field.addClass(d).before(b)})};return WelcomePage}(jQuery);var LongActionProcess=function(e){var a="",d="",b=500,c=750,f=[],k={},h=null,l,q,p,t,u,v,B,E,A=!1,H=function(){for(;0<f.length;){var x=f.shift();x&&clearTimeout(x)}},D=function(){var x=e.extend(!0,{},k);x.processId=d;x.cleanup=1;e.post(a,x,function(F){l&&l(F)}).always(function(){H()})},y=function(x){A||(x=x||b,x=setTimeout(function(){var F=e.extend(!0,{},k);F.processId=d;e.post(a,F,function(g){g?g.ready?(q&&q.call(h,g),D()):g.error?t&&t.call(h,g):g.progress?(p&&p.call(h,g),y()):g.warning?(u&&u.call(h,
g),y()):y(c):y(c);E&&E.call(h,g)},"json").error(function(){y(c)})},x),f.push(x))},C=function(x){if(!x.url)throw Error("Url is required");a=x.url;b=x.step_delay||b;c=x.rest_delay||c;k=x.post_data||k;l=x.onCleanup;q=x.onReady;p=x.onProgress;t=x.onError;u=x.onWarning;v=x.onStart;B=x.onStop;E=x.onAlways;h=this};e.extend(C.prototype,{start:function(){v&&v();var x=e.extend(!0,{},k);e.post(a,x,function(F){F&&F.processId?(d=F.processId,y(100),y(200)):F&&F.error?t&&t.call(h,F):t&&t.call(h,"Server error")},
"json").error(function(){t&&t.call(h,"Server error")})},stop:function(){A=!0;B&&B.call(h);H()}});return C}(jQuery);var TeamMap=function(e){var a=function(d,b,c){if(!d)throw Error("DOM element is required");this.$map=e(d);(this.provider=b)&&0>["google","yandex","disabled"].indexOf(this.provider)&&console.error("Not supported map provider: %s".replace("%s",this.provider));this.map_info=null;this.initClass()};a.prototype.initClass=function(){};a.prototype.render=function(d,b){switch(this.provider){case "google":return this.googleRender(d,b);case "yandex":return this.yandexRender(d,b)}};a.prototype.googleRender=function(d,
b){var c=this;c.map_info=c.map_info||{};d=new google.maps.LatLng(d,b);c.map_info.map||(b={zoom:12,center:d,mapTypeId:google.maps.MapTypeId.ROADMAP},c.map_info.map=new google.maps.Map(c.$map.get(0),b));c.map_info.marker&&c.map_info.marker.setMap(null);c.map_info.marker=new google.maps.Marker({position:d,map:c.map_info.map});c.map_info.map.setCenter(d);a.google_error_html=a.google_error_html||"";setTimeout(function(){if(c.$map.find(".gm-err-container").length)c.$map.find(".gm-err-container").find(".gm-err-message").last().after('<div class="gm-err-message">'+
e.team.locales.map_check_your_key+"</div>"),a.google_error_html=c.$map.find(".gm-err-container").parent().html();else if(!c.$map.find(".gm-style").length)if(a.google_error_html)c.$map.children().html(a.google_error_html);else{var f='<div class="gm-err-container"><div class="gm-err-content"><div class="gm-err-icon"><img src="https://maps.gstatic.com/mapfiles/api-3/images/icon_error.png" draggable="false" style="user-select: none;"></div><div class="gm-err-title">:title:</div><div class="gm-err-message">:message1:</div><div class="gm-err-message">:message2:</div></div></div>'.replace(":title:",
e.team.locales.map_error_title);f=f.replace(":message1:",e.team.locales.map_error_message);f=f.replace(":message2:",e.team.locales.map_check_your_key);c.$map.children().html(f)}},5E3)};a.prototype.yandexRender=function(d,b){this.map_info=this.map_info||{};d=[d,b];this.map_info.map||(b={zoom:12,center:d,controls:["zoomControl","fullscreenControl"]},this.map_info.map=new ymaps.Map(this.$map.get(0),b));this.map_info.marker&&this.map_info.map.geoObjects.remove(this.map_info.marker);this.map_info.marker=
new ymaps.Placemark(d);this.map_info.map.geoObjects.add(this.map_info.marker);this.map_info.map.setCenter(d)};a.prototype.geocode=function(d,b,c){switch(this.provider){case "google":return this.googleGeocode(d,b,c);case "yandex":return this.yandexGeocode(d,b,c);default:c?c():b&&b()}};a.prototype.googleGeocode=function(d,b,c){var f=!1,k=!1;(new google.maps.Geocoder).geocode({address:d},function(h,l){f=!0;k||(l==google.maps.GeocoderStatus.OK?(h=h[0].geometry.location,b(h.lat(),h.lng())):c&&c())});setTimeout(function(){f||
(k=!0,c&&c(!0))},5E3)};a.prototype.yandexGeocode=function(d,b,c){ymaps.geocode(d,{results:1}).then(function(f){var k=1;f.metaData&&f.metaData.geocoder&&"found"in f.metaData.geocoder&&(k=f.metaData.geocoder.found);0>=k?c():(f=f.geoObjects.get(0).geometry.getCoordinates(),b(f[0],f[1]))},function(f){c(f)})};return a}(jQuery);
//# sourceMappingURL=team.min.js.map