/*
 (c) 2008-2009 Benjamin Arthur Lupton {@link http://www.balupton.com}
 @license GNU Affero General Public License - {@link http://www.gnu.org/licenses/agpl.html}
 @example Visit {@link http://jquery.com/plugins/project/jquery_history_bal} for more information.


 I would like to take this space to thank the following projects, blogs, articles and people:
 - jQuery {@link http://jquery.com/}
 - jQuery UI History - Klaus Hartl {@link http://www.stilbuero.de/jquery/ui_history/}
 - Really Simple History - Brian Dillard and Brad Neuberg {@link http://code.google.com/p/reallysimplehistory/}
 - jQuery History Plugin - Taku Sano (Mikage Sawatari) {@link http://www.mikage.to/jquery/jquery_history.html}
 - jQuery History Remote Plugin - Klaus Hartl {@link http://stilbuero.de/jquery/history/}
 - Content With Style: Fixing the back button and enabling bookmarking for ajax apps - Mike Stenhouse {@link http://www.contentwithstyle.co.uk/Articles/38/fixing-the-back-button-and-enabling-bookmarking-for-ajax-apps}
 - Bookmarks and Back Buttons {@link http://ajax.howtosetup.info/options-and-efficiencies/bookmarks-and-back-buttons/}
 - Ajax: How to handle bookmarks and back buttons - Brad Neuberg {@link http://dev.aol.com/ajax-handling-bookmarks-and-back-button}

*
**
 CHANGELOG
*
 v1.0.1-final, July 11, 2009
 - Restructured a little bit
 - Documented
 - Cleaned go/request

 v1.0.0-final, June 19, 2009
 - Been stable for over a year now, pushing live.

 v0.1.0-dev, July 24, 2008
 - Initial Release

*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var e=0;return function(){return e<a.length?{done:!1,value:a[e++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,g){if(a==Array.prototype||a==Object.prototype)return a;a[e]=g.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var e=0;e<a.length;++e){var g=a[e];if(g&&g.Math==Math)return g}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,e){var g=$jscomp.propertyToPolyfillSymbol[e];if(null==g)return a[e];g=a[g];return void 0!==g?g:a[e]};
$jscomp.polyfill=function(a,e,g,k){e&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,e,g,k):$jscomp.polyfillUnisolated(a,e,g,k))};$jscomp.polyfillUnisolated=function(a,e,g,k){g=$jscomp.global;a=a.split(".");for(k=0;k<a.length-1;k++){var h=a[k];if(!(h in g))return;g=g[h]}a=a[a.length-1];k=g[a];e=e(k);e!=k&&null!=e&&$jscomp.defineProperty(g,a,{configurable:!0,writable:!0,value:e})};
$jscomp.polyfillIsolated=function(a,e,g,k){var h=a.split(".");a=1===h.length;k=h[0];k=!a&&k in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var b=0;b<h.length-1;b++){var c=h[b];if(!(c in k))return;k=k[c]}h=h[h.length-1];g=$jscomp.IS_SYMBOL_NATIVE&&"es6"===g?k[h]:null;e=e(g);null!=e&&(a?$jscomp.defineProperty($jscomp.polyfills,h,{configurable:!0,writable:!0,value:e}):e!==g&&(void 0===$jscomp.propertyToPolyfillSymbol[h]&&(g=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[h]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(h):$jscomp.POLYFILL_PREFIX+g+"$"+h),$jscomp.defineProperty(k,$jscomp.propertyToPolyfillSymbol[h],{configurable:!0,writable:!0,value:e})))};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(a){if(a)return a;var e=function(b,c){this.$jscomp$symbol$id_=b;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:c})};e.prototype.toString=function(){return this.$jscomp$symbol$id_};var g="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",k=0,h=function(b){if(this instanceof h)throw new TypeError("Symbol is not a constructor");return new e(g+(b||"")+"_"+k++,b)};return h},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var e="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),g=0;g<e.length;g++){var k=$jscomp.global[e[g]];"function"===typeof k&&"function"!=typeof k.prototype[a]&&$jscomp.defineProperty(k.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,e){a.raw=e;return a};$jscomp.makeIterator=function(a){var e="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return e?e.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var e,g=[];!(e=a.next()).done;)g.push(e.value);return g};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.findInternal=function(a,e,g){a instanceof String&&(a=String(a));for(var k=a.length,h=0;h<k;h++){var b=a[h];if(e.call(g,b,h,a))return{i:h,v:b}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(e,g){return $jscomp.findInternal(this,e,g).v}},"es6","es3");$jscomp.owns=function(a,e){return Object.prototype.hasOwnProperty.call(a,e)};
$jscomp.assign=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(a,e){for(var g=1;g<arguments.length;g++){var k=arguments[g];if(k)for(var h in k)$jscomp.owns(k,h)&&(a[h]=k[h])}return a};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");
$jscomp.iteratorFromArray=function(a,e){a instanceof String&&(a+="");var g=0,k=!1,h={next:function(){if(!k&&g<a.length){var b=g++;return{value:e(b,a[b]),done:!1}}k=!0;return{done:!0,value:void 0}}};h[Symbol.iterator]=function(){return h};return h};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(e){return e})}},"es6","es3");
$jscomp.polyfill("Array.from",function(a){return a?a:function(e,g,k){g=null!=g?g:function(f){return f};var h=[],b="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];if("function"==typeof b){e=b.call(e);for(var c=0;!(b=e.next()).done;)h.push(g.call(k,b.value,c++))}else for(b=e.length,c=0;c<b;c++)h.push(g.call(k,e[c],c));return h}},"es6","es3");
$jscomp.polyfill("Promise",function(a){function e(){this.batch_=null}function g(c){return c instanceof h?c:new h(function(f,m){f(c)})}if(a&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof $jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return a;e.prototype.asyncExecute=function(c){if(null==this.batch_){this.batch_=[];var f=this;this.asyncExecuteFunction(function(){f.executeBatch_()})}this.batch_.push(c)};
var k=$jscomp.global.setTimeout;e.prototype.asyncExecuteFunction=function(c){k(c,0)};e.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var c=this.batch_;this.batch_=[];for(var f=0;f<c.length;++f){var m=c[f];c[f]=null;try{m()}catch(q){this.asyncThrow_(q)}}}this.batch_=null};e.prototype.asyncThrow_=function(c){this.asyncExecuteFunction(function(){throw c;})};var h=function(c){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=!1;var f=this.createResolveAndReject_();
try{c(f.resolve,f.reject)}catch(m){f.reject(m)}};h.prototype.createResolveAndReject_=function(){function c(q){return function(p){m||(m=!0,q.call(f,p))}}var f=this,m=!1;return{resolve:c(this.resolveTo_),reject:c(this.reject_)}};h.prototype.resolveTo_=function(c){if(c===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(c instanceof h)this.settleSameAsPromise_(c);else{a:switch(typeof c){case "object":var f=null!=c;break a;case "function":f=!0;break a;default:f=!1}f?this.resolveToNonPromiseObj_(c):
this.fulfill_(c)}};h.prototype.resolveToNonPromiseObj_=function(c){var f=void 0;try{f=c.then}catch(m){this.reject_(m);return}"function"==typeof f?this.settleSameAsThenable_(f,c):this.fulfill_(c)};h.prototype.reject_=function(c){this.settle_(2,c)};h.prototype.fulfill_=function(c){this.settle_(1,c)};h.prototype.settle_=function(c,f){if(0!=this.state_)throw Error("Cannot settle("+c+", "+f+"): Promise already settled in state"+this.state_);this.state_=c;this.result_=f;2===this.state_&&this.scheduleUnhandledRejectionCheck_();
this.executeOnSettledCallbacks_()};h.prototype.scheduleUnhandledRejectionCheck_=function(){var c=this;k(function(){if(c.notifyUnhandledRejection_()){var f=$jscomp.global.console;"undefined"!==typeof f&&f.error(c.result_)}},1)};h.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var c=$jscomp.global.CustomEvent,f=$jscomp.global.Event,m=$jscomp.global.dispatchEvent;if("undefined"===typeof m)return!0;"function"===typeof c?c=new c("unhandledrejection",{cancelable:!0}):
"function"===typeof f?c=new f("unhandledrejection",{cancelable:!0}):(c=$jscomp.global.document.createEvent("CustomEvent"),c.initCustomEvent("unhandledrejection",!1,!0,c));c.promise=this;c.reason=this.result_;return m(c)};h.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var c=0;c<this.onSettledCallbacks_.length;++c)b.asyncExecute(this.onSettledCallbacks_[c]);this.onSettledCallbacks_=null}};var b=new e;h.prototype.settleSameAsPromise_=function(c){var f=this.createResolveAndReject_();
c.callWhenSettled_(f.resolve,f.reject)};h.prototype.settleSameAsThenable_=function(c,f){var m=this.createResolveAndReject_();try{c.call(f,m.resolve,m.reject)}catch(q){m.reject(q)}};h.prototype.then=function(c,f){function m(u,x){return"function"==typeof u?function(B){try{q(u(B))}catch(y){p(y)}}:x}var q,p,t=new h(function(u,x){q=u;p=x});this.callWhenSettled_(m(c,q),m(f,p));return t};h.prototype.catch=function(c){return this.then(void 0,c)};h.prototype.callWhenSettled_=function(c,f){function m(){switch(q.state_){case 1:c(q.result_);
break;case 2:f(q.result_);break;default:throw Error("Unexpected state: "+q.state_);}}var q=this;null==this.onSettledCallbacks_?b.asyncExecute(m):this.onSettledCallbacks_.push(m);this.isRejectionHandled_=!0};h.resolve=g;h.reject=function(c){return new h(function(f,m){m(c)})};h.race=function(c){return new h(function(f,m){for(var q=$jscomp.makeIterator(c),p=q.next();!p.done;p=q.next())g(p.value).callWhenSettled_(f,m)})};h.all=function(c){var f=$jscomp.makeIterator(c),m=f.next();return m.done?g([]):new h(function(q,
p){function t(B){return function(y){u[B]=y;x--;0==x&&q(u)}}var u=[],x=0;do u.push(void 0),x++,g(m.value).callWhenSettled_(t(u.length-1),p),m=f.next();while(!m.done)})};return h},"es6","es3");
(function(a){"undefined"===typeof console&&(console="undefined"!==typeof window.console?window.console:{});console.log=console.log||function(){};console.debug=console.debug||console.log;console.warn=console.warn||console.log;console.error=console.error||function(){for(var e=[],g=0;g<arguments.length;g++)e.push(arguments[g]);alert(e.join("\n"))};console.trace=console.trace||console.log;console.group=console.group||console.log;console.groupEnd=console.groupEnd||console.log;console.profile=console.profile||
console.log;console.profileEnd=console.profileEnd||console.log;a.History={options:{debug:!1},state:"",$window:null,$iframe:null,handlers:{generic:[],specific:{}},format:function(e){return e=e.replace(/^.+?#/g,"").replace(/^#?\/?|\/?$/g,"")},getState:function(){return a.History.state},setState:function(e){var g=a.History;e=g.format(e);g.state=e;return g.state},getHash:function(){var e=parent&&!a.browser.msie?parent.window.location.hash:window.location.hash||location.hash;return e=a.History.format(e)},
setHash:function(e){e=a.History.format(e);e=e.replace(/^\/?|\/?(\?)|\/?$/g,"/$1");"undefined"===typeof window.location.hash&&(location.hash=e);a.browser.msie&&8>parseInt(a.browser.version,10)&&(a.History.$iframe.contentWindow.document.open(),a.History.$iframe.contentWindow.document.close())},go:function(e){var g=a.History;e=g.format(e);g.getHash()!==e?g.setHash(e):(g.setState(e),g.trigger());return!0},hashchange:function(e){var g=a.History;g.options.debug&&console.debug("History.hashchange",this,
arguments);var k=g.getHash(),h=g.getState();if(!g.$iframe&&h===k||g.$iframe&&g.hash===g.$iframe.contentWindow.document.location.hash||h===k)return!1;g.setState(k);g.trigger();return!0},bind:function(e,g){var k=a.History;g?("undefined"===typeof k.handlers.specific[e]&&(k.handlers.specific[e]=[]),k.handlers.specific[e].push(g)):k.handlers.generic.push(e);return!0},trigger:function(e){var g=a.History;"undefined"===typeof e&&(e=g.getState());var k;if("undefined"!==typeof g.handlers.specific[e]){var h=
g.handlers.specific[e];var b=0;for(k=h.length;b<k;++b){var c=h[b];c(e)}}h=g.handlers.generic;b=0;for(k=h.length;b<k;++b)c=h[b],c(e);return!0},construct:function(){var e=a.History;a(document).ready(function(){e.domReady()});return!0},configure:function(e){var g=a.History;g.options=a.extend(g.options,e);return!0},domReadied:!1,domReady:function(){var e=a.History;if(!e.domRedied)return e.domRedied=!0,e.$window=a(window),e.$window.bind("hashchange",this.hashchange),setTimeout(e.hashchangeLoader,200),
!0},hashchangeLoader:function(){var e=a.History;if(a.browser.msie&&8<=parseInt(a.browser.version))(g=e.getHash())&&e.$window.trigger("hashchange");else{if(a.browser.msie){e.$iframe=a('<iframe id="jquery-history-iframe" style="display: none;"></$iframe>').prependTo(document.body)[0];e.$iframe.contentWindow.document.open();e.$iframe.contentWindow.document.close();var g=e.getHash();g&&(e.$iframe.contentWindow.document.location.hash=g);g=function(){var k=e.format(e.$iframe.contentWindow.document.location.hash);
e.getState()!==k&&e.setHash(e.$iframe.contentWindow.document.location.hash);k=e.getHash();e.getState()!==k&&e.go(k)}}else g=function(){var k=e.getHash();e.getState()!==k&&e.go(k)};a.browser.msie&&8>parseInt(a.browser.version)?setInterval(g,1500):setInterval(g,200)}return!0}};a.History.construct()})(jQuery);jQuery.JSON={useHasOwn:{}.hasOwnProperty?!0:!1,pad:function(a){return 10>a?"0"+a:a},m:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},encodeString:function(a){return/["\\\x00-\x1f]/.test(a)?'"'+a.replace(/([\x00-\x1f\\"])/g,function(e,g){if(e=jQuery.JSON.m[g])return e;e=g.charCodeAt();return"\\u00"+Math.floor(e/16).toString(16)+(e%16).toString(16)})+'"':'"'+a+'"'},encodeArray:function(a){var e=["["],g,k=a.length;for(g=0;g<k;g+=1){var h=a[g];switch(typeof h){case "undefined":case "function":case "unknown":break;
default:b&&e.push(",");e.push(null===h?"null":this.encode(h));var b=!0}}e.push("]");return e.join("")},encodeDate:function(a){return'"'+a.getFullYear()+"-"+pad(a.getMonth()+1)+"-"+pad(a.getDate())+"T"+pad(a.getHours())+":"+pad(a.getMinutes())+":"+pad(a.getSeconds())+'"'},encode:function(a){if("undefined"==typeof a||null===a)return"null";if(a instanceof Array)return this.encodeArray(a);if(a instanceof Date)return this.encodeDate(a);if("string"==typeof a)return this.encodeString(a);if("number"==typeof a)return isFinite(a)?
String(a):"null";if("boolean"==typeof a)return String(a);var e=["{"],g;for(g in a)if(!this.useHasOwn||a.hasOwnProperty(g)){var k=a[g];switch(typeof k){case "undefined":case "function":case "unknown":break;default:h&&e.push(",");e.push(this.encode(g),":",null===k?"null":this.encode(k));var h=!0}}e.push("}");return e.join("")},decode:function(a){return eval("("+a+")")}};(function(a,e){a.store=function(g,k){var h=this;if("string"==typeof g)if(a.store.drivers[g])this.driver=a.store.drivers[g];else throw Error("Unknown driver "+g);else if("object"==typeof g){if(!(a.isFunction(g.init)&&a.isFunction(g.get)&&a.isFunction(g.set)&&a.isFunction(g.del)&&a.isFunction(g.flush)))throw Error("The specified driver does not fulfill the API requirements");this.driver=g}else a.each(a.store.drivers,function(){if(!a.isFunction(this.available)||!this.available())return!0;h.driver=this;
return!1===h.driver.init()?(h.driver=null,!0):!1});k||(k=a.store.serializers);this.serializers={};a.each(k,function(b,c){if(!a.isFunction(this.init))return!0;h.serializers[b]=this;h.serializers[b].init(h.encoders,h.decoders)})};a.extend(a.store.prototype,{get:function(g){g=this.driver.get(g);return this.driver.encodes?g:this.unserialize(g)},set:function(g,k){this.driver.set(g,this.driver.encodes?k:this.serialize(k))},del:function(g){this.driver.del(g)},flush:function(){this.driver.flush()},driver:e,
encoders:[],decoders:[],serialize:function(g){var k=this;a.each(this.encoders,function(){var h=k.serializers[this+""];if(!h||!h.encode)return!0;try{g=h.encode(g)}catch(b){}});return g},unserialize:function(g){var k=this;if(!g)return g;a.each(this.decoders,function(){var h=k.serializers[this+""];if(!h||!h.decode)return!0;g=h.decode(g)});return g}});a.store.drivers={localStorage:{ident:"$.store.drivers.localStorage",scope:"browser",available:function(){try{return!!window.localStorage}catch(g){return!1}},
init:a.noop,get:function(g){return window.localStorage.getItem(g)},set:function(g,k){window.localStorage.setItem(g,k)},del:function(g){window.localStorage.removeItem(g)},flush:function(){window.localStorage.clear()}},userData:{ident:"$.store.drivers.userData",element:null,nodeName:"userdatadriver",scope:"browser",initialized:!1,available:function(){try{return!(!document.documentElement||!document.documentElement.addBehavior)}catch(g){return!1}},init:function(){if(!this.initialized)try{this.element=
document.createElement(this.nodeName),document.documentElement.insertBefore(this.element,document.getElementsByTagName("title")[0]),this.element.addBehavior("#default#userData"),this.initialized=!0}catch(g){return!1}},get:function(g){this.element.load(this.nodeName);return this.element.getAttribute(g)},set:function(g,k){this.element.setAttribute(g,k);this.element.save(this.nodeName)},del:function(g){this.element.removeAttribute(g);this.element.save(this.nodeName)},flush:function(){this.element.expires=
(new Date).toUTCString();this.element.save(this.nodeName)}},windowName:{ident:"$.store.drivers.windowName",scope:"window",cache:{},encodes:!0,available:function(){return!0},init:function(){this.load()},save:function(){window.name=a.store.serializers.json.encode(this.cache)},load:function(){try{this.cache=a.store.serializers.json.decode(window.name+""),"object"!=typeof this.cache&&(this.cache={})}catch(g){this.cache={},window.name="{}"}},get:function(g){return this.cache[g]},set:function(g,k){this.cache[g]=
k;this.save()},del:function(g){try{delete this.cache[g]}catch(k){this.cache[g]=e}this.save()},flush:function(){window.name="{}"}}};a.store.serializers={json:{ident:"$.store.serializers.json",init:function(g,k){g.push("json");k.push("json")},encode:"object"==typeof JSON?JSON.stringify:a.JSON.stringify,decode:"object"==typeof JSON?JSON.parse:a.JSON.parse},xml:{ident:"$.store.serializers.xml",init:function(g,k){g.unshift("xml");k.push("xml")},isXML:function(g){return(g=(g?g.ownerDocument||g:0).documentElement)?
"html"!==g.nodeName.toLowerCase():!1},encode:function(g){if(!g||g._serialized||!this.isXML(g))return g;var k={_serialized:this.ident,value:g};try{return k.value=(new XMLSerializer).serializeToString(g),k}catch(h){try{return k.value=g.xml,k}catch(b){}}return g},decode:function(g){if(!g||!g._serialized||g._serialized!=this.ident)return g;var k="DOMParser"in window&&(new DOMParser).parseFromString;!k&&window.ActiveXObject&&(k=function(h){var b=new ActiveXObject("Microsoft.XMLDOM");b.async="false";b.loadXML(h);
return b});if(!k)return e;g.value=k.call("DOMParser"in window&&new DOMParser||window,g.value,"text/xml");return this.isXML(g.value)?g.value:e}}}})(jQuery);(function(a){function e(k,h){this.path=k;"undefined"!==typeof h&&null!==h?(this.at_2x_path=h,this.perform_check=!1):(this.at_2x_path=k.replace(/\.\w+$/,function(b){return"@2x"+b}),this.perform_check=!0)}function g(k){if(!/@2x\.\w+$/.test(a(k).attr("src"))){this.el=k;this.path=new e(a(k).attr("src"),a(k).attr("data-at2x"));var h=this;this.path.check_2x_variant(function(b){b&&h.swap()})}}a.fn.retina=function(k){if(a.Retina.isRetina())return a.Retina.opts=a.extend(a.Retina.opts,k),this.each(function(){a(this).is("img")&&
new g(this)})};a.Retina=function(){};a.Retina.opts={check_mime_type:!0,force_original_dimensions:!0};a.Retina.isRetina=function(){return 1<window.devicePixelRatio||window.matchMedia&&window.matchMedia("(-webkit-min-device-pixel-ratio: 1.5),(min--moz-device-pixel-ratio: 1.5),(-o-min-device-pixel-ratio: 3/2),(min-resolution: 1.5dppx)").matches?!0:!1};e.confirmed_paths=[];e.prototype.is_external=function(){return!(!this.path.match(/^(https?:|\/\/)/i)||this.path.match("//"+document.domain+"/"))};e.prototype.check_2x_variant=
function(k){var h=this;if(this.is_external()||!this.perform_check&&"undefined"!==typeof this.at_2x_path&&null!==this.at_2x_path||this.at_2x_path in e.confirmed_paths)return k(!0);var b=new XMLHttpRequest;b.open("HEAD",this.at_2x_path);b.onreadystatechange=function(){if(4==b.readyState&&200<=b.status&&399>=b.status){if(a.Retina.opts.check_mime_type){var c=b.getResponseHeader("Content-Type");if(null===c||!c.match(/^image/i))return k(!1)}e.confirmed_paths.push(h.at_2x_path);return k(!0)}return k(!1)};
b.send()};a.RetinaImage=g;g.prototype.swap=function(k){function h(){if(b.el.complete){a.Retina.opts.force_original_dimensions&&(b.el.setAttribute("width",b.el.offsetWidth),b.el.setAttribute("height",b.el.offsetHeight));var c=b.el.src;b.el.setAttribute("src",k);a(b.el).one("error",function(){b.el.setAttribute("src",c)})}else setTimeout(h,5)}"undefined"==typeof k&&(k=this.path.at_2x_path);var b=this;h()}})(jQuery);(function(a){a.fn.extend({autocomplete:function(e,g){var k="string"==typeof e;g=a.extend({},a.Autocompleter.defaults,{url:k?e:null,data:k?null:e,delay:k?a.Autocompleter.defaults.delay:10,max:g&&!g.scroll?10:150},g);g.highlight=g.highlight||function(h){return h};g.formatMatch=g.formatMatch||g.formatItem;return this.each(function(){new a.Autocompleter(this,g)})},result:function(e){return this.bind("result",e)},search:function(e){return this.trigger("search",[e])},flushCache:function(){return this.trigger("flushCache")},
setOptions:function(e){return this.trigger("setOptions",[e])},unautocomplete:function(){return this.trigger("unautocomplete")}});a.Autocompleter=function(e,g){function k(){var E=H.selected();if(!E)return!1;var K=E.result;x=K;if(g.multiple){var R=b(t.val());if(1<R.length){var V=g.multipleSeparator.length,ja=a(e).selection().start,X,ea=0;a.each(R,function(qa,ra){ea+=ra.length;if(ja<=ea)return X=qa,!1;ea+=V});R[X]=K;K=R.join(g.multipleSeparator)}K+=g.multipleSeparator}t.val(K);f();t.trigger("result",
[E.data,E.value]);return!0}function h(E,K){if(A==p.DEL)H.hide();else if(E=t.val(),K||E!=x)x=E,E=c(E),E.length>=g.minChars?(t.addClass(g.loadingClass),g.matchCase||(E=E.toLowerCase()),q(E,m,f)):(t.removeClass(g.loadingClass),H.hide())}function b(E){return E?g.multiple?a.map(E.split(g.multipleSeparator),function(K){return a.trim(E).length?a.trim(K):null}):[a.trim(E)]:[""]}function c(E){if(!g.multiple)return E;var K=b(E);if(1==K.length)return K[0];K=a(e).selection().start;K=K==E.length?b(E):b(E.replace(E.substring(K),
""));return K[K.length-1]}function f(){H.visible();H.hide();clearTimeout(u);t.removeClass(g.loadingClass);g.mustMatch&&t.search(function(E){E||(g.multiple?(E=b(t.val()).slice(0,-1),t.val(E.join(g.multipleSeparator)+(E.length?g.multipleSeparator:""))):(t.val(""),t.trigger("result",null)))})}function m(E,K){K&&K.length&&y?(t.removeClass(g.loadingClass),H.display(K,E),K=K[0].value,g.autoFill&&c(t.val()).toLowerCase()==E.toLowerCase()&&A!=p.BACKSPACE&&(t.val(t.val()+K.substring(c(x).length)),a(e).selection(x.length,
x.length+K.length)),H.show()):f()}function q(E,K,R){g.matchCase||(E=E.toLowerCase());var V=B.load(E);if(V&&V.length)K(E,V);else if("string"==typeof g.url&&0<g.url.length){var ja={timestamp:+new Date};a.each(g.extraParams,function(X,ea){ja[X]="function"==typeof ea?ea():ea});a.ajax({mode:"abort",port:"autocomplete"+e.name,dataType:g.dataType,url:g.url,data:a.extend({q:c(E),limit:g.max},ja),success:function(X){var ea;if(!(ea=g.parse&&g.parse(X))){ea=[];X=X.split("\n");for(var qa=0;qa<X.length;qa++){var ra=
a.trim(X[qa]);ra&&(ra=ra.split("|"),ea[ea.length]={data:ra,value:ra[0],result:g.formatResult&&g.formatResult(ra,ra[0])||ra[0]})}}B.add(E,ea);K(E,ea)}})}else H.emptyList(),R(E)}var p={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8},t=a(e).attr("autocomplete","off").addClass(g.inputClass),u,x="",B=a.Autocompleter.Cache(g),y=0,A,C={mouseDownOnSelect:!1},H=a.Autocompleter.Select(g,e,k,C),M;a.browser.opera&&a(e.form).bind("submit.autocomplete",function(){if(M)return M=
!1});t.bind((a.browser.opera?"keypress":"keydown")+".autocomplete",function(E){y=1;A=E.keyCode;switch(E.keyCode){case p.UP:E.preventDefault();H.visible()?H.prev():h(0,!0);break;case p.DOWN:E.preventDefault();H.visible()?H.next():h(0,!0);break;case p.PAGEUP:E.preventDefault();H.visible()?H.pageUp():h(0,!0);break;case p.PAGEDOWN:E.preventDefault();H.visible()?H.pageDown():h(0,!0);break;case g.multiple&&","==a.trim(g.multipleSeparator)&&p.COMMA:case p.TAB:case p.RETURN:if(k())return E.preventDefault(),
M=!0,!1;break;case p.ESC:H.hide();break;default:clearTimeout(u),u=setTimeout(h,g.delay)}}).focus(function(){y++}).blur(function(){y=0;C.mouseDownOnSelect||(clearTimeout(u),u=setTimeout(f,200))}).click(function(){1<y++&&!H.visible()&&h(0,!0)}).bind("search",function(){function E(R,V){if(V&&V.length)for(var ja=0;ja<V.length;ja++)if(V[ja].result.toLowerCase()==R.toLowerCase()){var X=V[ja];break}"function"==typeof K?K(X):t.trigger("result",X&&[X.data,X.value])}var K=1<arguments.length?arguments[1]:null;
a.each(b(t.val()),function(R,V){q(V,E,E)})}).bind("flushCache",function(){B.flush()}).bind("setOptions",function(E,K){a.extend(g,K);"data"in K&&B.populate()}).bind("unautocomplete",function(){H.unbind();t.unbind();a(e.form).unbind(".autocomplete")})};a.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:1,delay:400,matchCase:!1,matchSubset:!0,matchContains:!1,cacheLength:10,max:100,mustMatch:!1,extraParams:{},selectFirst:!0,formatItem:function(e){return e[0]},
formatMatch:null,autoFill:!1,width:0,multiple:!1,multipleSeparator:", ",highlight:function(e,g){return e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+g.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:!0,scrollHeight:180};a.Autocompleter.Cache=function(e){function g(m,q){e.matchCase||(m=m.toLowerCase());var p=m.indexOf(q);"word"==e.matchContains&&(p=m.toLowerCase().search("\\b"+q.toLowerCase()));return-1==p?!1:0==p||e.matchContains}
function k(m,q){f>e.cacheLength&&b();c[m]||f++;c[m]=q}function h(){if(!e.data)return!1;var m={},q=0;e.url||(e.cacheLength=1);m[""]=[];for(var p=0,t=e.data.length;p<t;p++){var u=e.data[p];u="string"==typeof u?[u]:u;var x=e.formatMatch(u,p+1,e.data.length);if(!1!==x){var B=x.charAt(0).toLowerCase();m[B]||(m[B]=[]);u={value:x,data:u,result:e.formatResult&&e.formatResult(u)||x};m[B].push(u);q++<e.max&&m[""].push(u)}}a.each(m,function(y,A){e.cacheLength++;k(y,A)})}function b(){c={};f=0}var c={},f=0;setTimeout(h,
25);return{flush:b,add:k,populate:h,load:function(m){if(!e.cacheLength||!f)return null;if(!e.url&&e.matchContains){var q=[],p;for(p in c)if(0<p.length){var t=c[p];a.each(t,function(u,x){g(x.value,m)&&q.push(x)})}return q}if(c[m])return c[m];if(e.matchSubset)for(p=m.length-1;p>=e.minChars;p--)if(t=c[m.substr(0,p)])return q=[],a.each(t,function(u,x){g(x.value,m)&&(q[q.length]=x)}),q;return null}}};a.Autocompleter.Select=function(e,g,k,h){function b(){x&&(B=a("<div/>").hide().addClass(e.resultsClass).css("position",
"absolute").appendTo(document.body),y=a("<ul/>").appendTo(B).mouseover(function(A){c(A).nodeName&&"LI"==c(A).nodeName.toUpperCase()&&(p=a("li",y).removeClass(m.ACTIVE).index(c(A)),a(c(A)).addClass(m.ACTIVE))}).click(function(A){a(c(A)).addClass(m.ACTIVE);k();g.focus();return!1}).mousedown(function(){h.mouseDownOnSelect=!0}).mouseup(function(){h.mouseDownOnSelect=!1}),0<e.width&&B.css("width",e.width),x=!1)}function c(A){for(A=A.target;A&&"LI"!=A.tagName;)A=A.parentNode;return A?A:[]}function f(A){q.slice(p,
p+1).removeClass(m.ACTIVE);p+=A;0>p?p=q.size()-1:p>=q.size()&&(p=0);A=q.slice(p,p+1).addClass(m.ACTIVE);if(e.scroll){var C=0;q.slice(0,p).each(function(){C+=this.offsetHeight});C+A[0].offsetHeight-y.scrollTop()>y[0].clientHeight?y.scrollTop(C+A[0].offsetHeight-y.innerHeight()):C<y.scrollTop()&&y.scrollTop(C)}}var m={ACTIVE:"ac_over"},q,p=-1,t,u="",x=!0,B,y;return{display:function(A,C){b();t=A;u=C;y.empty();A=t.length;A=e.max&&e.max<A?e.max:A;for(C=0;C<A;C++)if(t[C]){var H=e.formatItem(t[C].data,C+
1,A,t[C].value,u);!1!==H&&(H=a("<li/>").html(e.highlight(H,u)).addClass(0==C%2?"ac_even":"ac_odd").appendTo(y)[0],a.data(H,"ac_data",t[C]))}q=y.find("li");e.selectFirst&&(q.slice(0,1).addClass(m.ACTIVE),p=0);a.fn.bgiframe&&y.bgiframe()},next:function(){f(1)},prev:function(){f(-1)},pageUp:function(){0!=p&&0>p-8?f(-p):f(-8)},pageDown:function(){p!=q.size()-1&&p+8>q.size()?f(q.size()-1-p):f(8)},hide:function(){B&&B.hide();q&&q.removeClass(m.ACTIVE);p=-1},visible:function(){return B&&B.is(":visible")},
current:function(){return this.visible()&&(q.filter("."+m.ACTIVE)[0]||e.selectFirst&&q[0])},show:function(){var A=a(g).offset();B.css({width:"string"==typeof e.width||0<e.width?e.width:a(g).width(),top:A.top+g.offsetHeight,left:A.left}).show();if(e.scroll&&(y.scrollTop(0),y.css({maxHeight:e.scrollHeight,overflow:"auto"}),a.browser.msie&&"undefined"===typeof document.body.style.maxHeight)){var C=0;q.each(function(){C+=this.offsetHeight});A=C>e.scrollHeight;y.css("height",A?e.scrollHeight:C);A||q.width(y.width()-
parseInt(q.css("padding-left"))-parseInt(q.css("padding-right")))}},selected:function(){var A=q&&q.filter("."+m.ACTIVE).removeClass(m.ACTIVE);return A&&A.length&&a.data(A[0],"ac_data")},emptyList:function(){y&&y.empty()},unbind:function(){B&&B.remove()}}};a.fn.selection=function(e,g){if(void 0!==e)return this.each(function(){if(this.createTextRange){var f=this.createTextRange();void 0===g||e==g?f.move("character",e):(f.collapse(!0),f.moveStart("character",e),f.moveEnd("character",g));f.select()}else this.setSelectionRange?
this.setSelectionRange(e,g):this.selectionStart&&(this.selectionStart=e,this.selectionEnd=g)});var k=this[0];if(k.createTextRange){var h=document.selection.createRange(),b=k.value,c=h.text.length;h.text="<->";h=k.value.indexOf("<->");k.value=b;this.selection(h,h+c);return{start:h,end:h+c}}if(void 0!==k.selectionStart)return{start:k.selectionStart,end:k.selectionEnd}}})(jQuery);/*
 Sortable 1.13.0 - MIT | git://github.com/SortableJS/Sortable.git */
!function(a,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(a=a||self).Sortable=e()}(this,function(){function a(l){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(l)}function e(){return(e=Object.assign||function(l){for(var n=1;n<arguments.length;n++){var r=arguments[n],
v;for(v in r)Object.prototype.hasOwnProperty.call(r,v)&&(l[v]=r[v])}return l}).apply(this,arguments)}function g(l){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{},v=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(v=v.concat(Object.getOwnPropertySymbols(r).filter(function(w){return Object.getOwnPropertyDescriptor(r,w).enumerable})));v.forEach(function(w){var z=r[w];w in l?Object.defineProperty(l,w,{value:z,enumerable:!0,configurable:!0,writable:!0}):l[w]=
z})}return l}function k(l,n){if(null==l)return{};var r;if(null==l)var v={};else{v={};var w=Object.keys(l);for(r=0;r<w.length;r++){var z=w[r];0<=n.indexOf(z)||(v[z]=l[z])}}if(Object.getOwnPropertySymbols)for(w=Object.getOwnPropertySymbols(l),r=0;r<w.length;r++)z=w[r],0<=n.indexOf(z)||Object.prototype.propertyIsEnumerable.call(l,z)&&(v[z]=l[z]);return v}function h(l){if(!(l=function(n){if(Array.isArray(n)){for(var r=0,v=Array(n.length);r<n.length;r++)v[r]=n[r];return v}}(l)||function(n){if(Symbol.iterator in
Object(n)||"[object Arguments]"===Object.prototype.toString.call(n))return Array.from(n)}(l)))throw new TypeError("Invalid attempt to spread non-iterable instance");return l}function b(l){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(l)}function c(l,n,r){l.addEventListener(n,r,!Da&&Lb)}function f(l,n,r){l.removeEventListener(n,r,!Da&&Lb)}function m(l,n){if(n){if(">"===n[0]&&(n=n.substring(1)),l)try{if(l.matches)return l.matches(n);if(l.msMatchesSelector)return l.msMatchesSelector(n);
if(l.webkitMatchesSelector)return l.webkitMatchesSelector(n)}catch(r){}return!1}}function q(l,n,r,v){if(l){r=r||document;do{if(null!=n&&(">"===n[0]?l.parentNode===r&&m(l,n):m(l,n))||v&&l===r)return l;if(l===r)break}while(l=(w=l).host&&w!==document&&w.host.nodeType?w.host:w.parentNode)}var w;return null}function p(l,n,r){if(l&&n)if(l.classList)l.classList[r?"add":"remove"](n);else{var v=(" "+l.className+" ").replace(Mb," ").replace(" "+n+" "," ");l.className=(v+(r?" "+n:"")).replace(Mb," ")}}function t(l,
n,r){var v=l&&l.style;if(v){if(void 0===r)return document.defaultView&&document.defaultView.getComputedStyle?r=document.defaultView.getComputedStyle(l,""):l.currentStyle&&(r=l.currentStyle),void 0===n?r:r[n];n in v||-1!==n.indexOf("webkit")||(n="-webkit-"+n);v[n]=r+("string"==typeof r?"":"px")}}function u(l,n){var r="";if("string"==typeof l)r=l;else{do{var v=t(l,"transform");v&&"none"!==v&&(r=v+" "+r)}while(!n&&(l=l.parentNode))}return(l=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||
window.MSCSSMatrix)&&new l(r)}function x(l,n,r){if(l){l=l.getElementsByTagName(n);n=0;var v=l.length;if(r)for(;n<v;n++)r(l[n],n);return l}return[]}function B(){return document.scrollingElement||document.documentElement}function y(l,n,r,v,w){if(l.getBoundingClientRect||l===window){var z,D,F,G,L,I,O;if(O=l!==window&&l.parentNode&&l!==B()?(D=(z=l.getBoundingClientRect()).top,F=z.left,G=z.bottom,L=z.right,I=z.height,z.width):(F=D=0,G=window.innerHeight,L=window.innerWidth,I=window.innerHeight,window.innerWidth),
(n||r)&&l!==window&&(w=w||l.parentNode,!Da)){do if(w&&w.getBoundingClientRect&&("none"!==t(w,"transform")||r&&"static"!==t(w,"position"))){G=w.getBoundingClientRect();D-=G.top+parseInt(t(w,"border-top-width"));F-=G.left+parseInt(t(w,"border-left-width"));G=D+z.height;L=F+z.width;break}while(w=w.parentNode)}v&&l!==window&&(v=(l=u(w||l))&&l.a,w=l&&l.d,l&&(G=(D/=w)+(I/=w),L=(F/=v)+(O/=v)));return{top:D,left:F,bottom:G,right:L,width:O,height:I}}}function A(l,n,r){var v=K(l,!0);for(l=y(l)[n];v;){n=y(v)[r];
if(!("top"===r||"left"===r?n<=l:l<=n))return v;if(v===B())break;v=K(v,!1)}return!1}function C(l,n,r){for(var v=0,w=0,z=l.children;w<z.length;){if("none"!==z[w].style.display&&z[w]!==N.ghost&&z[w]!==N.dragged&&q(z[w],r.draggable,l,!1)){if(v===n)return z[w];v++}w++}return null}function H(l,n){for(l=l.lastElementChild;l&&(l===N.ghost||"none"===t(l,"display")||n&&!m(l,n));)l=l.previousElementSibling;return l||null}function M(l,n){var r=0;if(!l||!l.parentNode)return-1;for(;l=l.previousElementSibling;)"TEMPLATE"===
l.nodeName.toUpperCase()||l===N.clone||n&&!m(l,n)||r++;return r}function E(l){var n=0,r=0,v=B();if(l){do{var w=u(l),z=w.d;n+=l.scrollLeft*w.a;r+=l.scrollTop*z}while(l!==v&&(l=l.parentNode))}return[n,r]}function K(l,n){if(!l||!l.getBoundingClientRect)return B();var r=!1;do if(l.clientWidth<l.scrollWidth||l.clientHeight<l.scrollHeight){var v=t(l);if(l.clientWidth<l.scrollWidth&&("auto"==v.overflowX||"scroll"==v.overflowX)||l.clientHeight<l.scrollHeight&&("auto"==v.overflowY||"scroll"==v.overflowY)){if(!l.getBoundingClientRect||
l===document.body)break;if(r||n)return l;r=!0}}while(l=l.parentNode);return B()}function R(l,n){return Math.round(l.top)===Math.round(n.top)&&Math.round(l.left)===Math.round(n.left)&&Math.round(l.height)===Math.round(n.height)&&Math.round(l.width)===Math.round(n.width)}function V(l,n){return function(){if(!Ua){var r=arguments;1===r.length?l.call(this,r[0]):l.apply(this,r);Ua=setTimeout(function(){Ua=void 0},n)}}}function ja(l,n,r){l.scrollLeft+=n;l.scrollTop+=r}function X(l){var n=window.Polymer,
r=window.jQuery||window.Zepto;return n&&n.dom?n.dom(l).cloneNode(!0):r?r(l).clone(!0)[0]:l.cloneNode(!0)}function ea(l,n){t(l,"position","absolute");t(l,"top",n.top);t(l,"left",n.left);t(l,"width",n.width);t(l,"height",n.height)}function qa(l){t(l,"position","");t(l,"top","");t(l,"left","");t(l,"width","");t(l,"height","")}function ra(){var l,n=[];return{captureAnimationState:function(){n=[];this.options.animation&&[].slice.call(this.el.children).forEach(function(r){if("none"!==t(r,"display")&&r!==
N.ghost){n.push({target:r,rect:y(r)});var v=g({},n[n.length-1].rect);if(r.thisAnimationDuration){var w=u(r,!0);w&&(v.top-=w.f,v.left-=w.e)}r.fromRect=v}})},addAnimationState:function(r){n.push(r)},removeAnimationState:function(r){var v=n,w=v.splice;a:{var z=n;r={target:r};for(var D in z)if(z.hasOwnProperty(D))for(var F in r)if(r.hasOwnProperty(F)&&r[F]===z[D][F]){z=Number(D);break a}z=-1}w.call(v,z,1)},animateAll:function(r){var v=this;if(!this.options.animation)return clearTimeout(l),void("function"==
typeof r&&r());var w=!1,z=0;n.forEach(function(D){var F=0,G=D.target,L=G.fromRect,I=y(G),O=G.prevFromRect,U=G.prevToRect;D=D.rect;var Y=u(G,!0);Y&&(I.top-=Y.f,I.left-=Y.e);G.toRect=I;G.thisAnimationDuration&&R(O,I)&&!R(L,I)&&(D.top-I.top)/(D.left-I.left)==(L.top-I.top)/(L.left-I.left)&&(F=Math.sqrt(Math.pow(O.top-D.top,2)+Math.pow(O.left-D.left,2))/Math.sqrt(Math.pow(O.top-U.top,2)+Math.pow(O.left-U.left,2))*v.options.animation);R(I,L)||(G.prevFromRect=L,G.prevToRect=I,F||(F=v.options.animation),
v.animate(G,D,I,F));F&&(w=!0,z=Math.max(z,F),clearTimeout(G.animationResetTimer),G.animationResetTimer=setTimeout(function(){G.animationTime=0;G.prevFromRect=null;G.fromRect=null;G.prevToRect=null;G.thisAnimationDuration=null},F),G.thisAnimationDuration=F)});clearTimeout(l);w?l=setTimeout(function(){"function"==typeof r&&r()},z):"function"==typeof r&&r();n=[]},animate:function(r,v,w,z){if(z){t(r,"transition","");t(r,"transform","");var D=u(this.el),F=(v.left-w.left)/(D&&D.a||1);v=(v.top-w.top)/(D&&
D.d||1);r.animatingX=!!F;r.animatingY=!!v;t(r,"transform","translate3d("+F+"px,"+v+"px,0)");this.forRepaintDummy=r.offsetWidth;t(r,"transition","transform "+z+"ms"+(this.options.easing?" "+this.options.easing:""));t(r,"transform","translate3d(0,0,0)");"number"==typeof r.animated&&clearTimeout(r.animated);r.animated=setTimeout(function(){t(r,"transition","");t(r,"transform","");r.animated=!1;r.animatingX=!1;r.animatingY=!1},z)}}}}function Va(l){var n=l.sortable,r=l.rootEl,v=l.name,w=l.targetEl,z=l.cloneEl,
D=l.toEl,F=l.fromEl,G=l.oldIndex,L=l.newIndex,I=l.oldDraggableIndex,O=l.newDraggableIndex,U=l.originalEvent,Y=l.putSortable,sa=l.extraEventProperties;if(n=n||r&&r[ma]){var Z;l=n.options;var fa="on"+v.charAt(0).toUpperCase()+v.substr(1);!window.CustomEvent||Da||Wa?(Z=document.createEvent("Event")).initEvent(v,!0,!0):Z=new CustomEvent(v,{bubbles:!0,cancelable:!0});Z.to=D||r;Z.from=F||r;Z.item=w||r;Z.clone=z;Z.oldIndex=G;Z.newIndex=L;Z.oldDraggableIndex=I;Z.newDraggableIndex=O;Z.originalEvent=U;Z.pullMode=
Y?Y.lastPutMode:void 0;v=g({},sa,Xa.getEventProperties(v,n));for(var S in v)Z[S]=v[S];r&&r.dispatchEvent(Z);l[fa]&&l[fa].call(n,Z)}}function ta(l,n,r){var v=2<arguments.length&&void 0!==r?r:{},w=v.evt;v=k(v,["evt"]);Xa.pluginEvent.bind(N)(l,n,g({dragEl:J,parentEl:ha,ghostEl:Q,rootEl:ba,nextEl:Ia,lastDownEl:ib,cloneEl:ca,cloneHidden:Ea,dragStarted:Ya,putSortable:ka,activeSortable:N.active,originalEvent:w,oldIndex:Oa,oldDraggableIndex:Za,newIndex:va,newDraggableIndex:Fa,hideGhostForTarget:Nb,unhideGhostForTarget:Ob,
cloneNowHidden:function(){Ea=!0},cloneNowShown:function(){Ea=!1},dispatchSortableEvent:function(z){oa({sortable:n,name:z,originalEvent:w})}},v))}function oa(l){Va(g({putSortable:ka,cloneEl:ca,targetEl:J,rootEl:ba,oldIndex:Oa,oldDraggableIndex:Za,newIndex:va,newDraggableIndex:Fa},l))}function Ja(l){if(J){var n=function(w,z){var D;return jb.some(function(F){if(!H(F)){var G=y(F),L=F[ma].options.emptyInsertThreshold,I=w>=G.left-L&&w<=G.right+L;G=z>=G.top-L&&z<=G.bottom+L;return L&&I&&G?D=F:void 0}}),
D}((l=l.touches?l.touches[0]:l).clientX,l.clientY);if(n){var r={},v;for(v in l)l.hasOwnProperty(v)&&(r[v]=l[v]);r.target=r.rootEl=n;r.preventDefault=void 0;r.stopPropagation=void 0;n[ma]._onDragOver(r)}}}function Yb(l){J&&J.parentNode[ma]._isOutsideThisEl(l.target)}function N(l,n){if(!l||!l.nodeType||1!==l.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(l));this.el=l;this.options=n=e({},n);l[ma]=this;var r={group:null,sort:!0,disabled:!1,store:null,handle:null,
draggable:/^[uo]l$/i.test(l.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Pb(l,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(z,D){z.setData("Text",D.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?
Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==N.supportPointer&&"PointerEvent"in window&&!$a,emptyInsertThreshold:5},v;for(v in Xa.initializePlugins(this,l,r),r)v in n||(n[v]=r[v]);for(var w in Qb(n),this)"_"===w.charAt(0)&&"function"==typeof this[w]&&(this[w]=this[w].bind(this));(this.nativeDraggable=!n.forceFallback&&Zb)&&(this.options.touchStartThreshold=
1);n.supportPointer?c(l,"pointerdown",this._onTapStart):(c(l,"mousedown",this._onTapStart),c(l,"touchstart",this._onTapStart));this.nativeDraggable&&(c(l,"dragover",this),c(l,"dragenter",this));jb.push(this.el);n.store&&n.store.get&&this.sort(n.store.get(this)||[]);e(this,ra())}function xb(l,n,r,v,w,z,D,F){var G,L,I=l[ma],O=I.options.onMove;return!window.CustomEvent||Da||Wa?(G=document.createEvent("Event")).initEvent("move",!0,!0):G=new CustomEvent("move",{bubbles:!0,cancelable:!0}),G.to=n,G.from=
l,G.dragged=r,G.draggedRect=v,G.related=w||n,G.relatedRect=z||y(n),G.willInsertAfter=F,G.originalEvent=D,l.dispatchEvent(G),O&&(L=O.call(I,G,D)),L}function yb(l){l.draggable=!1}function $b(){zb=!1}function kb(l){return setTimeout(l,0)}function lb(){ia.forEach(function(l){clearInterval(l.pid)});ia=[]}function Rb(l){var n=l.originalEvent,r=l.putSortable,v=l.dragEl,w=l.activeSortable,z=l.dispatchSortableEvent,D=l.hideGhostForTarget;l=l.unhideGhostForTarget;n&&(w=r||w,D(),n=n.changedTouches&&n.changedTouches.length?
n.changedTouches[0]:n,n=document.elementFromPoint(n.clientX,n.clientY),l(),w&&!w.el.contains(n)&&(z("spill"),this.onSpill({dragEl:v,putSortable:r})))}function Ab(){}function Bb(){}function Sb(l,n){wa.forEach(function(r,v){(v=n.children[r.sortableIndex+(l?Number(v):0)])?n.insertBefore(r,v):n.appendChild(r)})}function mb(){P.forEach(function(l){l!==aa&&l.parentNode&&l.parentNode.removeChild(l)})}var Da=b(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Wa=b(/Edge/i),Tb=b(/firefox/i),$a=b(/safari/i)&&
!b(/chrome/i)&&!b(/android/i),ab=b(/iP(ad|od|hone)/i),ac=b(/chrome/i)&&b(/android/i),Lb={capture:!1,passive:!1},Ua,Mb=/\s+/g,ma="Sortable"+(new Date).getTime(),Pa=[],Cb={initializeByDefault:!0},Xa={mount:function(l){for(var n in Cb)!Cb.hasOwnProperty(n)||n in l||(l[n]=Cb[n]);Pa.forEach(function(r){if(r.pluginName===l.pluginName)throw"Sortable: Cannot mount plugin ".concat(l.pluginName," more than once");});Pa.push(l)},pluginEvent:function(l,n,r){var v=this;this.eventCanceled=!1;r.cancel=function(){v.eventCanceled=
!0};var w=l+"Global";Pa.forEach(function(z){n[z.pluginName]&&(n[z.pluginName][w]&&n[z.pluginName][w](g({sortable:n},r)),n.options[z.pluginName]&&n[z.pluginName][l]&&n[z.pluginName][l](g({sortable:n},r)))})},initializePlugins:function(l,n,r,v){for(var w in Pa.forEach(function(z){var D=z.pluginName;if(l.options[D]||z.initializeByDefault)z=new z(l,n,l.options),z.sortable=l,z.options=l.options,l[D]=z,e(r,z.defaults)}),l.options)l.options.hasOwnProperty(w)&&(v=this.modifyOption(l,w,l.options[w]),void 0!==
v&&(l.options[w]=v))},getEventProperties:function(l,n){var r={};return Pa.forEach(function(v){"function"==typeof v.eventProperties&&e(r,v.eventProperties.call(n[v.pluginName],l))}),r},modifyOption:function(l,n,r){var v;return Pa.forEach(function(w){l[w.pluginName]&&w.optionListeners&&"function"==typeof w.optionListeners[n]&&(v=w.optionListeners[n].call(l[w.pluginName],r))}),v}},J,ha,Q,ba,Ia,ib,ca,Ea,Oa,va,Za,Fa,nb,ka,Ka,za,Db,Eb,Ub,Vb,Ya,Qa,bb,ob,na,Ra=!1,pb=!1,jb=[],cb=!1,qb=!1,Fb=[],zb=!1,rb=[],
sb="undefined"!=typeof document,Wb=Wa||Da?"cssFloat":"float",Zb=sb&&!ac&&!ab&&"draggable"in document.createElement("div"),Xb=function(){if(sb){if(Da)return!1;var l=document.createElement("x");return l.style.cssText="pointer-events:auto","auto"===l.style.pointerEvents}}(),Pb=function(l,n){var r=t(l),v=parseInt(r.width)-parseInt(r.paddingLeft)-parseInt(r.paddingRight)-parseInt(r.borderLeftWidth)-parseInt(r.borderRightWidth),w=C(l,0,n);l=C(l,1,n);var z=w&&t(w);n=l&&t(l);var D=z&&parseInt(z.marginLeft)+
parseInt(z.marginRight)+y(w).width,F=n&&parseInt(n.marginLeft)+parseInt(n.marginRight)+y(l).width;return"flex"===r.display?"column"===r.flexDirection||"column-reverse"===r.flexDirection?"vertical":"horizontal":"grid"===r.display?1>=r.gridTemplateColumns.split(" ").length?"vertical":"horizontal":w&&z.float&&"none"!==z.float?(r="left"===z.float?"left":"right",!l||"both"!==n.clear&&n.clear!==r?"horizontal":"vertical"):w&&("block"===z.display||"flex"===z.display||"table"===z.display||"grid"===z.display||
v<=D&&"none"===r[Wb]||l&&"none"===r[Wb]&&v<D+F)?"vertical":"horizontal"},Qb=function(l){function n(w,z){return function(D,F,G,L){var I=D.options.group.name&&F.options.group.name&&D.options.group.name===F.options.group.name;if(null==w&&(z||I))return!0;if(null==w||!1===w)return!1;if(z&&"clone"===w)return w;if("function"==typeof w)return n(w(D,F,G,L),z)(D,F,G,L);D=(z?D:F).options.group.name;return!0===w||"string"==typeof w&&w===D||w.join&&-1<w.indexOf(D)}}var r={},v=l.group;v&&"object"==a(v)||(v={name:v});
r.name=v.name;r.checkPull=n(v.pull,!0);r.checkPut=n(v.put);r.revertClone=v.revertClone;l.group=r},Nb=function(){!Xb&&Q&&t(Q,"display","none")},Ob=function(){!Xb&&Q&&t(Q,"display","")};sb&&document.addEventListener("click",function(l){if(pb)return l.preventDefault(),l.stopPropagation&&l.stopPropagation(),l.stopImmediatePropagation&&l.stopImmediatePropagation(),pb=!1},!0);N.prototype={constructor:N,_isOutsideThisEl:function(l){this.el.contains(l)||l===this.el||(Qa=null)},_getDirection:function(l,n){return"function"==
typeof this.options.direction?this.options.direction.call(this,l,n,J):this.options.direction},_onTapStart:function(l){if(l.cancelable){var n=this,r=this.el,v=this.options,w=v.preventOnFilter,z=l.type,D=l.touches&&l.touches[0]||l.pointerType&&"touch"===l.pointerType&&l,F=(D||l).target,G=l.target.shadowRoot&&(l.path&&l.path[0]||l.composedPath&&l.composedPath()[0])||F,L=v.filter;if(function(I){rb.length=0;I=I.getElementsByTagName("input");for(var O=I.length;O--;){var U=I[O];U.checked&&rb.push(U)}}(r),
!(J||/mousedown|pointerdown/.test(z)&&0!==l.button||v.disabled||G.isContentEditable||!this.nativeDraggable&&$a&&F&&"SELECT"===F.tagName.toUpperCase()||(F=q(F,v.draggable,r,!1))&&F.animated||ib===F)){if(Oa=M(F),Za=M(F,v.draggable),"function"==typeof L){if(L.call(this,l,F,this))return oa({sortable:n,rootEl:G,name:"filter",targetEl:F,toEl:r,fromEl:r}),ta("filter",n,{evt:l}),void(w&&l.cancelable&&l.preventDefault())}else if(L&&(L=L.split(",").some(function(I){if(I=q(G,I.trim(),r,!1))return oa({sortable:n,
rootEl:I,name:"filter",targetEl:F,fromEl:r,toEl:r}),ta("filter",n,{evt:l}),!0})))return void(w&&l.cancelable&&l.preventDefault());v.handle&&!q(G,v.handle,r,!1)||this._prepareDragStart(l,D,F)}}},_prepareDragStart:function(l,n,r){var v=this,w=v.el,z=v.options,D=w.ownerDocument;if(r&&!J&&r.parentNode===w){var F=y(r);if(ba=w,ha=(J=r).parentNode,Ia=J.nextSibling,ib=r,nb=z.group,Ka={target:N.dragged=J,clientX:(n||l).clientX,clientY:(n||l).clientY},Ub=Ka.clientX-F.left,Vb=Ka.clientY-F.top,this._lastX=(n||
l).clientX,this._lastY=(n||l).clientY,J.style["will-change"]="all",r=function(){ta("delayEnded",v,{evt:l});N.eventCanceled?v._onDrop():(v._disableDelayedDragEvents(),!Tb&&v.nativeDraggable&&(J.draggable=!0),v._triggerDragStart(l,n),oa({sortable:v,name:"choose",originalEvent:l}),p(J,z.chosenClass,!0))},z.ignore.split(",").forEach(function(G){x(J,G.trim(),yb)}),c(D,"dragover",Ja),c(D,"mousemove",Ja),c(D,"touchmove",Ja),c(D,"mouseup",v._onDrop),c(D,"touchend",v._onDrop),c(D,"touchcancel",v._onDrop),
Tb&&this.nativeDraggable&&(this.options.touchStartThreshold=4,J.draggable=!0),ta("delayStart",this,{evt:l}),!z.delay||z.delayOnTouchOnly&&!n||this.nativeDraggable&&(Wa||Da))r();else{if(N.eventCanceled)return void this._onDrop();c(D,"mouseup",v._disableDelayedDrag);c(D,"touchend",v._disableDelayedDrag);c(D,"touchcancel",v._disableDelayedDrag);c(D,"mousemove",v._delayedDragTouchMoveHandler);c(D,"touchmove",v._delayedDragTouchMoveHandler);z.supportPointer&&c(D,"pointermove",v._delayedDragTouchMoveHandler);
v._dragStartTimer=setTimeout(r,z.delay)}}},_delayedDragTouchMoveHandler:function(l){l=l.touches?l.touches[0]:l;Math.max(Math.abs(l.clientX-this._lastX),Math.abs(l.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){J&&yb(J);clearTimeout(this._dragStartTimer);this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var l=this.el.ownerDocument;f(l,"mouseup",this._disableDelayedDrag);
f(l,"touchend",this._disableDelayedDrag);f(l,"touchcancel",this._disableDelayedDrag);f(l,"mousemove",this._delayedDragTouchMoveHandler);f(l,"touchmove",this._delayedDragTouchMoveHandler);f(l,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(l,n){n=n||"touch"==l.pointerType&&l;!this.nativeDraggable||n?this.options.supportPointer?c(document,"pointermove",this._onTouchMove):c(document,n?"touchmove":"mousemove",this._onTouchMove):(c(J,"dragend",this),c(ba,"dragstart",this._onDragStart));
try{document.selection?kb(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch(r){}},_dragStarted:function(l,n){if(Ra=!1,ba&&J){ta("dragStarted",this,{evt:n});this.nativeDraggable&&c(document,"dragover",Yb);var r=this.options;l||p(J,r.dragClass,!1);p(J,r.ghostClass,!0);N.active=this;l&&this._appendGhost();oa({sortable:this,name:"start",originalEvent:n})}else this._nulling()},_emulateDragOver:function(){if(za){this._lastX=za.clientX;this._lastY=za.clientY;Nb();for(var l=
document.elementFromPoint(za.clientX,za.clientY),n=l;l&&l.shadowRoot&&(l=l.shadowRoot.elementFromPoint(za.clientX,za.clientY))!==n;)n=l;if(J.parentNode[ma]._isOutsideThisEl(l),n){do{if(n[ma]&&n[ma]._onDragOver({clientX:za.clientX,clientY:za.clientY,target:l,rootEl:n})&&!this.options.dragoverBubble)break;l=n}while(n=n.parentNode)}Ob()}},_onTouchMove:function(l){if(Ka){var n=this.options,r=n.fallbackTolerance,v=n.fallbackOffset;n=l.touches?l.touches[0]:l;var w=Q&&u(Q,!0),z=Q&&w&&w.a,D=Q&&w&&w.d,F=ab&&
na&&E(na);z=(n.clientX-Ka.clientX+v.x)/(z||1)+(F?F[0]-Fb[0]:0)/(z||1);v=(n.clientY-Ka.clientY+v.y)/(D||1)+(F?F[1]-Fb[1]:0)/(D||1);if(!N.active&&!Ra){if(r&&Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))<r)return;this._onDragStart(l,!0)}Q&&(w?(w.e+=z-(Db||0),w.f+=v-(Eb||0)):w={a:1,b:0,c:0,d:1,e:z,f:v},r="matrix(".concat(w.a,",").concat(w.b,",").concat(w.c,",").concat(w.d,",").concat(w.e,",").concat(w.f,")"),t(Q,"webkitTransform",r),t(Q,"mozTransform",r),t(Q,"msTransform",
r),t(Q,"transform",r),Db=z,Eb=v,za=n);l.cancelable&&l.preventDefault()}},_appendGhost:function(){if(!Q){var l=this.options.fallbackOnBody?document.body:ba,n=y(J,!0,ab,!0,l),r=this.options;if(ab){for(na=l;"static"===t(na,"position")&&"none"===t(na,"transform")&&na!==document;)na=na.parentNode;na!==document.body&&na!==document.documentElement?(na===document&&(na=B()),n.top+=na.scrollTop,n.left+=na.scrollLeft):na=B();Fb=E(na)}p(Q=J.cloneNode(!0),r.ghostClass,!1);p(Q,r.fallbackClass,!0);p(Q,r.dragClass,
!0);t(Q,"transition","");t(Q,"transform","");t(Q,"box-sizing","border-box");t(Q,"margin",0);t(Q,"top",n.top);t(Q,"left",n.left);t(Q,"width",n.width);t(Q,"height",n.height);t(Q,"opacity","0.8");t(Q,"position",ab?"absolute":"fixed");t(Q,"zIndex","100000");t(Q,"pointerEvents","none");N.ghost=Q;l.appendChild(Q);t(Q,"transform-origin",Ub/parseInt(Q.style.width)*100+"% "+Vb/parseInt(Q.style.height)*100+"%")}},_onDragStart:function(l,n){var r=this,v=l.dataTransfer,w=r.options;ta("dragStart",this,{evt:l});
N.eventCanceled?this._onDrop():(ta("setupClone",this),N.eventCanceled||((ca=X(J)).draggable=!1,ca.style["will-change"]="",this._hideClone(),p(ca,this.options.chosenClass,!1),N.clone=ca),r.cloneId=kb(function(){ta("clone",r);N.eventCanceled||(r.options.removeCloneOnHide||ba.insertBefore(ca,J),r._hideClone(),oa({sortable:r,name:"clone"}))}),n||p(J,w.dragClass,!0),n?(pb=!0,r._loopId=setInterval(r._emulateDragOver,50)):(f(document,"mouseup",r._onDrop),f(document,"touchend",r._onDrop),f(document,"touchcancel",
r._onDrop),v&&(v.effectAllowed="move",w.setData&&w.setData.call(r,v,J)),c(document,"drop",r),t(J,"transform","translateZ(0)")),Ra=!0,r._dragStartId=kb(r._dragStarted.bind(r,n,l)),c(document,"selectstart",r),Ya=!0,$a&&t(document.body,"user-select","none"))},_onDragOver:function(l){function n(T,la){ta(T,S,g({evt:l,isOwner:sa,axis:G?"vertical":"horizontal",revert:F,dragRect:z,targetRect:D,canSort:Z,fromSortable:fa,target:I,completed:v,onMove:function(W,ya){return xb(ba,L,J,z,W,y(W),l,ya)},changed:w},
la))}function r(){n("dragOverAnimationCapture");S.captureAnimationState();S!==fa&&fa.captureAnimationState()}function v(T){return n("dragOverCompleted",{insertion:T}),T&&(sa?Y._hideClone():Y._showClone(S),S!==fa&&(p(J,ka?ka.options.ghostClass:Y.options.ghostClass,!1),p(J,O.ghostClass,!0)),ka!==S&&S!==N.active?ka=S:S===N.active&&ka&&(ka=null),fa===S&&(S._ignoreWhileAnimating=I),S.animateAll(function(){n("dragOverAnimationComplete");S._ignoreWhileAnimating=null}),S!==fa&&(fa.animateAll(),fa._ignoreWhileAnimating=
null)),(I===J&&!J.animated||I===L&&!I.animated)&&(Qa=null),O.dragoverBubble||l.rootEl||I===document||(J.parentNode[ma]._isOutsideThisEl(l.target),T||Ja(l)),!O.dragoverBubble&&l.stopPropagation&&l.stopPropagation(),Ca=!0}function w(){va=M(J);Fa=M(J,O.draggable);oa({sortable:S,name:"change",toEl:L,newIndex:va,newDraggableIndex:Fa,originalEvent:l})}var z,D,F,G,L=this.el,I=l.target,O=this.options,U=O.group,Y=N.active,sa=nb===U,Z=O.sort,fa=ka||Y,S=this,Ca=!1;if(!zb){if(void 0!==l.preventDefault&&l.cancelable&&
l.preventDefault(),I=q(I,O.draggable,L,!0),n("dragOver"),N.eventCanceled)return Ca;if(J.contains(l.target)||I.animated&&I.animatingX&&I.animatingY||S._ignoreWhileAnimating===I)return v(!1);if(pb=!1,Y&&!O.disabled&&(sa?Z||(F=!ba.contains(J)):ka===this||(this.lastPutMode=nb.checkPull(this,Y,J,l))&&U.checkPut(this,Y,J,l))){if(G="vertical"===this._getDirection(l,I),z=y(J),n("dragOverValid"),N.eventCanceled)return Ca;if(F)return ha=ba,r(),this._hideClone(),n("revert"),N.eventCanceled||(Ia?ba.insertBefore(J,
Ia):ba.appendChild(J)),v(!0);U=H(L,O.draggable);if(!U||function(T,la,W){W=y(H(W.el,W.options.draggable));return la?T.clientX>W.right+10||T.clientX<=W.right&&T.clientY>W.bottom&&T.clientX>=W.left:T.clientX>W.right&&T.clientY>W.top||T.clientX<=W.right&&T.clientY>W.bottom+10}(l,G,this)&&!U.animated){if(U===J)return v(!1);if(U&&L===l.target&&(I=U),I&&(D=y(I)),!1!==xb(ba,L,J,z,I,D,l,!!I))return r(),L.appendChild(J),ha=L,w(),v(!0)}else if(I.parentNode===L){D=y(I);var La,da;var pa=J.parentNode!==L;var ua=
!function(T,la,W){var ya=W?T.left:T.top,db=W?T.right:T.bottom;T=W?T.width:T.height;var Ma=W?la.left:la.top,tb=W?la.right:la.bottom;la=W?la.width:la.height;return ya===Ma||db===tb||ya+T/2===Ma+la/2}(J.animated&&J.toRect||z,I.animated&&I.toRect||D,G);U=G?"top":"left";var Ga=A(I,"top","top")||A(J,"top","top"),ub=Ga?Ga.scrollTop:void 0;if(Qa!==I&&(La=D[U],cb=!1,qb=!ua&&O.invertSwap||pa),0!==(pa=function(T,la,W,ya,db,Ma,tb,bc){T=ya?T.clientY:T.clientX;var Ha=ya?W.height:W.width,eb=ya?W.top:W.left;W=ya?
W.bottom:W.right;ya=!1;if(!tb)if(bc&&ob<Ha*db)if(!cb&&(1===bb?eb+Ha*Ma/2<T:T<W-Ha*Ma/2)&&(cb=!0),cb)ya=!0;else{if(1===bb?T<eb+ob:W-ob<T)return-bb}else if(eb+Ha*(1-db)/2<T&&T<W-Ha*(1-db)/2)return M(J)<M(la)?1:-1;return(ya||tb)&&(T<eb+Ha*Ma/2||W-Ha*Ma/2<T)?eb+Ha/2<T?1:-1:0}(l,I,D,G,ua?1:O.swapThreshold,null==O.invertedSwapThreshold?O.swapThreshold:O.invertedSwapThreshold,qb,Qa===I)))for(ua=M(J);ua-=pa,(da=ha.children[ua])&&("none"===t(da,"display")||da===Q););if(0===pa||da===I)return v(!1);bb=pa;da=
(Qa=I).nextElementSibling;ua=!1;pa=xb(ba,L,J,z,I,D,l,ua=1===pa);if(!1!==pa)return 1!==pa&&-1!==pa||(ua=1===pa),zb=!0,setTimeout($b,30),r(),ua&&!da?L.appendChild(J):I.parentNode.insertBefore(J,ua?da:I),Ga&&ja(Ga,0,ub-Ga.scrollTop),ha=J.parentNode,void 0===La||qb||(ob=Math.abs(La-y(I)[U])),w(),v(!0)}if(L.contains(J))return v(!1)}return!1}},_ignoreWhileAnimating:null,_offMoveEvents:function(){f(document,"mousemove",this._onTouchMove);f(document,"touchmove",this._onTouchMove);f(document,"pointermove",
this._onTouchMove);f(document,"dragover",Ja);f(document,"mousemove",Ja);f(document,"touchmove",Ja)},_offUpEvents:function(){var l=this.el.ownerDocument;f(l,"mouseup",this._onDrop);f(l,"touchend",this._onDrop);f(l,"pointerup",this._onDrop);f(l,"touchcancel",this._onDrop);f(document,"selectstart",this)},_onDrop:function(l){var n=this.el,r=this.options;va=M(J);Fa=M(J,r.draggable);ta("drop",this,{evt:l});ha=J&&J.parentNode;va=M(J);Fa=M(J,r.draggable);N.eventCanceled||(cb=qb=Ra=!1,clearInterval(this._loopId),
clearTimeout(this._dragStartTimer),clearTimeout(this.cloneId),clearTimeout(this._dragStartId),this.nativeDraggable&&(f(document,"drop",this),f(n,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),$a&&t(document.body,"user-select",""),t(J,"transform",""),l&&(Ya&&(l.cancelable&&l.preventDefault(),r.dropBubble||l.stopPropagation()),Q&&Q.parentNode&&Q.parentNode.removeChild(Q),(ba===ha||ka&&"clone"!==ka.lastPutMode)&&ca&&ca.parentNode&&ca.parentNode.removeChild(ca),J&&(this.nativeDraggable&&
f(J,"dragend",this),yb(J),J.style["will-change"]="",Ya&&!Ra&&p(J,ka?ka.options.ghostClass:this.options.ghostClass,!1),p(J,this.options.chosenClass,!1),oa({sortable:this,name:"unchoose",toEl:ha,newIndex:null,newDraggableIndex:null,originalEvent:l}),ba!==ha?(0<=va&&(oa({rootEl:ha,name:"add",toEl:ha,fromEl:ba,originalEvent:l}),oa({sortable:this,name:"remove",toEl:ha,originalEvent:l}),oa({rootEl:ha,name:"sort",toEl:ha,fromEl:ba,originalEvent:l}),oa({sortable:this,name:"sort",toEl:ha,originalEvent:l})),
ka&&ka.save()):va!==Oa&&0<=va&&(oa({sortable:this,name:"update",toEl:ha,originalEvent:l}),oa({sortable:this,name:"sort",toEl:ha,originalEvent:l})),N.active&&(null!=va&&-1!==va||(va=Oa,Fa=Za),oa({sortable:this,name:"end",toEl:ha,originalEvent:l}),this.save()))));this._nulling()},_nulling:function(){ta("nulling",this);ba=J=ha=Q=Ia=ca=ib=Ea=Ka=za=Ya=va=Fa=Oa=Za=Qa=bb=ka=nb=N.dragged=N.ghost=N.clone=N.active=null;rb.forEach(function(l){l.checked=!0});rb.length=Db=Eb=0},handleEvent:function(l){switch(l.type){case "drop":case "dragend":this._onDrop(l);
break;case "dragenter":case "dragover":J&&(this._onDragOver(l),l.dataTransfer&&(l.dataTransfer.dropEffect="move"),l.cancelable&&l.preventDefault());break;case "selectstart":l.preventDefault()}},toArray:function(){for(var l,n=[],r=this.el.children,v=0,w=r.length,z=this.options;v<w;v++)if(q(l=r[v],z.draggable,this.el,!1)){var D=n,F=D.push,G;if(!(G=l.getAttribute(z.dataIdAttr))){l=l.tagName+l.className+l.src+l.href+l.textContent;G=l.length;for(var L=0;G--;)L+=l.charCodeAt(G);G=L.toString(36)}F.call(D,
G)}return n},sort:function(l,n){var r={},v=this.el;this.toArray().forEach(function(w,z){z=v.children[z];q(z,this.options.draggable,v,!1)&&(r[w]=z)},this);n&&this.captureAnimationState();l.forEach(function(w){r[w]&&(v.removeChild(r[w]),v.appendChild(r[w]))});n&&this.animateAll()},save:function(){var l=this.options.store;l&&l.set&&l.set(this)},closest:function(l,n){return q(l,n||this.options.draggable,this.el,!1)},option:function(l,n){var r=this.options;if(void 0===n)return r[l];var v=Xa.modifyOption(this,
l,n);r[l]=void 0!==v?v:n;"group"===l&&Qb(r)},destroy:function(){ta("destroy",this);var l=this.el;l[ma]=null;f(l,"mousedown",this._onTapStart);f(l,"touchstart",this._onTapStart);f(l,"pointerdown",this._onTapStart);this.nativeDraggable&&(f(l,"dragover",this),f(l,"dragenter",this));Array.prototype.forEach.call(l.querySelectorAll("[draggable]"),function(n){n.removeAttribute("draggable")});this._onDrop();this._disableDelayedDragEvents();jb.splice(jb.indexOf(this.el),1);this.el=l=null},_hideClone:function(){Ea||
(ta("hideClone",this),N.eventCanceled)||(t(ca,"display","none"),this.options.removeCloneOnHide&&ca.parentNode&&ca.parentNode.removeChild(ca),Ea=!0)},_showClone:function(l){"clone"===l.lastPutMode?Ea&&(ta("showClone",this),!N.eventCanceled)&&(J.parentNode!=ba||this.options.group.revertClone?Ia?ba.insertBefore(ca,Ia):ba.appendChild(ca):ba.insertBefore(ca,J),this.options.group.revertClone&&this.animate(J,ca),t(ca,"display",""),Ea=!1):this._hideClone()}};sb&&c(document,"touchmove",function(l){(N.active||
Ra)&&l.cancelable&&l.preventDefault()});N.utils={on:c,off:f,css:t,find:x,is:function(l,n){return!!q(l,n,l,!1)},extend:function(l,n){if(l&&n)for(var r in n)n.hasOwnProperty(r)&&(l[r]=n[r]);return l},throttle:V,closest:q,toggleClass:p,clone:X,index:M,nextTick:kb,cancelNextTick:function(l){return clearTimeout(l)},detectDirection:Pb,getChild:C};N.get=function(l){return l[ma]};N.mount=function(){for(var l=arguments.length,n=Array(l),r=0;r<l;r++)n[r]=arguments[r];n[0].constructor===Array&&(n=n[0]);n.forEach(function(v){if(!v.prototype||
!v.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(v));v.utils&&(N.utils=g({},N.utils,v.utils));Xa.mount(v)})};N.create=function(l,n){return new N(l,n)};var fb,Gb,Hb,Ib,vb,Sa,ia=[],Jb=!(N.version="1.13.0"),Aa,Kb=V(function(l,n,r,v){if(n.scroll){var w,z=(l.touches?l.touches[0]:l).clientX,D=(l.touches?l.touches[0]:l).clientY,F=n.scrollSensitivity,G=n.scrollSpeed,L=B(),I=!1;Gb!==r&&(Gb=r,lb(),fb=n.scroll,w=n.scrollFn,!0===fb&&(fb=K(r,
!0)));r=0;var O=fb;do{var U=O,Y=y(U),sa=Y.top,Z=Y.bottom,fa=Y.left,S=Y.right,Ca=Y.width;Y=Y.height;var La=void 0,da=void 0,pa=U.scrollWidth,ua=U.scrollHeight;da=t(U);var Ga=U.scrollLeft,ub=U.scrollTop;da=U===L?(La=Ca<pa&&("auto"===da.overflowX||"scroll"===da.overflowX||"visible"===da.overflowX),Y<ua&&("auto"===da.overflowY||"scroll"===da.overflowY||"visible"===da.overflowY)):(La=Ca<pa&&("auto"===da.overflowX||"scroll"===da.overflowX),Y<ua&&("auto"===da.overflowY||"scroll"===da.overflowY));fa=La&&
(Math.abs(S-z)<=F&&Ga+Ca<pa)-(Math.abs(fa-z)<=F&&!!Ga);sa=da&&(Math.abs(Z-D)<=F&&ub+Y<ua)-(Math.abs(sa-D)<=F&&!!ub);if(!ia[r])for(Z=0;Z<=r;Z++)ia[Z]||(ia[Z]={});ia[r].vx==fa&&ia[r].vy==sa&&ia[r].el===U||(ia[r].el=U,ia[r].vx=fa,ia[r].vy=sa,clearInterval(ia[r].pid),0==fa&&0==sa||(I=!0,ia[r].pid=setInterval(function(){v&&0===this.layer&&N.active._onTouchMove(vb);var T=ia[this.layer].vy?ia[this.layer].vy*G:0,la=ia[this.layer].vx?ia[this.layer].vx*G:0;"function"==typeof w&&"continue"!==w.call(N.dragged.parentNode[ma],
la,T,l,vb,ia[this.layer].el)||ja(ia[this.layer].el,la,T)}.bind({layer:r}),24)));r++}while(n.bubbleScroll&&O!==L&&(O=K(O,!1)));Jb=I}},30);Ab.prototype={startIndex:null,dragStart:function(l){this.startIndex=l.oldDraggableIndex},onSpill:function(l){var n=l.dragEl;l=l.putSortable;this.sortable.captureAnimationState();l&&l.captureAnimationState();var r=C(this.sortable.el,this.startIndex,this.options);r?this.sortable.el.insertBefore(n,r):this.sortable.el.appendChild(n);this.sortable.animateAll();l&&l.animateAll()},
drop:Rb};e(Ab,{pluginName:"revertOnSpill"});Bb.prototype={onSpill:function(l){var n=l.dragEl;l=l.putSortable||this.sortable;l.captureAnimationState();n.parentNode&&n.parentNode.removeChild(n);l.animateAll()},drop:Rb};e(Bb,{pluginName:"removeOnSpill"});var gb,Ba,aa,Na,wb,P=[],wa=[],hb=!1,xa=!1,Ta=!1;return N.mount(new function(){function l(){for(var n in this.defaults={scroll:!0,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===n.charAt(0)&&"function"==typeof this[n]&&(this[n]=this[n].bind(this))}
return l.prototype={dragStarted:function(n){n=n.originalEvent;this.sortable.nativeDraggable?c(document,"dragover",this._handleAutoScroll):this.options.supportPointer?c(document,"pointermove",this._handleFallbackAutoScroll):n.touches?c(document,"touchmove",this._handleFallbackAutoScroll):c(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(n){n=n.originalEvent;this.options.dragOverBubble||n.rootEl||this._handleAutoScroll(n)},drop:function(){this.sortable.nativeDraggable?
f(document,"dragover",this._handleAutoScroll):(f(document,"pointermove",this._handleFallbackAutoScroll),f(document,"touchmove",this._handleFallbackAutoScroll),f(document,"mousemove",this._handleFallbackAutoScroll));clearInterval(Sa);lb();clearTimeout(Ua);Ua=void 0},nulling:function(){vb=Gb=fb=Jb=Sa=Hb=Ib=null;ia.length=0},_handleFallbackAutoScroll:function(n){this._handleAutoScroll(n,!0)},_handleAutoScroll:function(n,r){var v=this,w=(n.touches?n.touches[0]:n).clientX,z=(n.touches?n.touches[0]:n).clientY,
D=document.elementFromPoint(w,z);if(vb=n,r||Wa||Da||$a){Kb(n,this.options,D,r);var F=K(D,!0);!Jb||Sa&&w===Hb&&z===Ib||(Sa&&clearInterval(Sa),Sa=setInterval(function(){var G=K(document.elementFromPoint(w,z),!0);G!==F&&(F=G,lb());Kb(n,v.options,G,r)},10),Hb=w,Ib=z)}else{if(!this.options.bubbleScroll||K(D,!0)===B())return void lb();Kb(n,this.options,K(D,!1),!1)}}},e(l,{pluginName:"scroll",initializeByDefault:!0})}),N.mount(Bb,Ab),N.mount(new function(){function l(){this.defaults={swapClass:"sortable-swap-highlight"}}
return l.prototype={dragStart:function(n){Aa=n.dragEl},dragOverValid:function(n){var r=n.completed,v=n.target,w=n.onMove,z=n.changed,D=n.cancel;if(n.activeSortable.options.swap){var F=this.sortable.el;n=this.options;v&&v!==F&&(F=Aa,Aa=!1!==w(v)?(p(v,n.swapClass,!0),v):null,F&&F!==Aa&&p(F,n.swapClass,!1));z();r(!0);D()}},drop:function(n){var r=n.activeSortable,v=n.putSortable;n=n.dragEl;var w=v||this.sortable,z=this.options;Aa&&p(Aa,z.swapClass,!1);if(Aa&&(z.swap||v&&v.options.swap)&&n!==Aa){w.captureAnimationState();
w!==r&&r.captureAnimationState();v=Aa;var D=n.parentNode,F=v.parentNode;if(D&&F&&!D.isEqualNode(v)&&!F.isEqualNode(n)){z=M(n);var G=M(v);D.isEqualNode(F)&&z<G&&G++;D.insertBefore(v,D.children[z]);F.insertBefore(n,F.children[G])}w.animateAll();w!==r&&r.animateAll()}},nulling:function(){Aa=null}},e(l,{pluginName:"swap",eventProperties:function(){return{swapItem:Aa}}})}),N.mount(new function(){function l(n){for(var r in this)"_"===r.charAt(0)&&"function"==typeof this[r]&&(this[r]=this[r].bind(this));
n.options.supportPointer?c(document,"pointerup",this._deselectMultiDrag):(c(document,"mouseup",this._deselectMultiDrag),c(document,"touchend",this._deselectMultiDrag));c(document,"keydown",this._checkKeyDown);c(document,"keyup",this._checkKeyUp);this.defaults={selectedClass:"sortable-selected",multiDragKey:null,setData:function(v,w){var z="";P.length&&Ba===n?P.forEach(function(D,F){z+=(F?", ":"")+D.textContent}):z=w.textContent;v.setData("Text",z)}}}return l.prototype={multiDragKeyDown:!1,isMultiDrag:!1,
delayStartGlobal:function(n){aa=n.dragEl},delayEnded:function(){this.isMultiDrag=~P.indexOf(aa)},setupClone:function(n){var r=n.sortable;n=n.cancel;if(this.isMultiDrag){for(var v=0;v<P.length;v++)wa.push(X(P[v])),wa[v].sortableIndex=P[v].sortableIndex,wa[v].draggable=!1,wa[v].style["will-change"]="",p(wa[v],this.options.selectedClass,!1),P[v]===aa&&p(wa[v],this.options.chosenClass,!1);r._hideClone();n()}},clone:function(n){var r=n.sortable,v=n.rootEl,w=n.dispatchSortableEvent;n=n.cancel;this.isMultiDrag&&
(this.options.removeCloneOnHide||P.length&&Ba===r&&(Sb(!0,v),w("clone"),n()))},showClone:function(n){var r=n.cloneNowShown,v=n.rootEl;n=n.cancel;this.isMultiDrag&&(Sb(!1,v),wa.forEach(function(w){t(w,"display","")}),r(),wb=!1,n())},hideClone:function(n){var r=this,v=(n.sortable,n.cloneNowHidden);n=n.cancel;this.isMultiDrag&&(wa.forEach(function(w){t(w,"display","none");r.options.removeCloneOnHide&&w.parentNode&&w.parentNode.removeChild(w)}),v(),wb=!0,n())},dragStartGlobal:function(n){n.sortable;!this.isMultiDrag&&
Ba&&Ba.multiDrag._deselectMultiDrag();P.forEach(function(r){r.sortableIndex=M(r)});P=P.sort(function(r,v){return r.sortableIndex-v.sortableIndex});Ta=!0},dragStarted:function(n){var r=this;n=n.sortable;if(this.isMultiDrag){if(this.options.sort&&(n.captureAnimationState(),this.options.animation)){P.forEach(function(w){w!==aa&&t(w,"position","absolute")});var v=y(aa,!1,!0,!0);P.forEach(function(w){w!==aa&&ea(w,v)});hb=xa=!0}n.animateAll(function(){hb=xa=!1;r.options.animation&&P.forEach(function(w){qa(w)});
r.options.sort&&mb()})}},dragOver:function(n){var r=n.target,v=n.completed;n=n.cancel;xa&&~P.indexOf(r)&&(v(!1),n())},revert:function(n){var r=n.fromSortable,v=n.rootEl,w=n.sortable,z=n.dragRect;1<P.length&&(P.forEach(function(D){w.addAnimationState({target:D,rect:xa?y(D):z});qa(D);D.fromRect=z;r.removeAnimationState(D)}),xa=!1,function(D,F){P.forEach(function(G,L){(L=F.children[G.sortableIndex+(D?Number(L):0)])?F.insertBefore(G,L):F.appendChild(G)})}(!this.options.removeCloneOnHide,v))},dragOverCompleted:function(n){var r=
n.sortable,v=n.isOwner,w=n.activeSortable,z=n.parentEl,D=n.putSortable,F=this.options;if(n.insertion){if(v&&w._hideClone(),hb=!1,F.animation&&1<P.length&&(xa||!v&&!w.options.sort&&!D)){var G=y(aa,!1,!0,!0);P.forEach(function(L){L!==aa&&(ea(L,G),z.appendChild(L))});xa=!0}v||((xa||mb(),1<P.length)?(n=wb,w._showClone(r),w.options.animation&&!wb&&n&&wa.forEach(function(L){w.addAnimationState({target:L,rect:Na});L.fromRect=Na;L.thisAnimationDuration=null})):w._showClone(r))}},dragOverAnimationCapture:function(n){var r=
n.dragRect,v=n.isOwner;n=n.activeSortable;if(P.forEach(function(w){w.thisAnimationDuration=null}),n.options.animation&&!v&&n.multiDrag.isMultiDrag)Na=e({},r),r=u(aa,!0),Na.top-=r.f,Na.left-=r.e},dragOverAnimationComplete:function(){xa&&(xa=!1,mb())},drop:function(n){var r=n.originalEvent,v=n.rootEl,w=n.parentEl,z=n.sortable,D=n.dispatchSortableEvent,F=n.oldIndex,G=(n=n.putSortable)||this.sortable;if(r){var L=this.options,I=w.children;if(!Ta)if(L.multiDragKey&&!this.multiDragKeyDown&&this._deselectMultiDrag(),
p(aa,L.selectedClass,!~P.indexOf(aa)),~P.indexOf(aa))P.splice(P.indexOf(aa),1),gb=null,Va({sortable:z,rootEl:v,name:"deselect",targetEl:aa,originalEvt:r});else{if(P.push(aa),Va({sortable:z,rootEl:v,name:"select",targetEl:aa,originalEvt:r}),r.shiftKey&&gb&&z.el.contains(gb)){var O;var U=M(gb);var Y=M(aa);if(~U&&~Y&&U!==Y)for(U=U<Y?(O=U,Y):(O=Y,U+1);O<U;O++)~P.indexOf(I[O])||(p(I[O],L.selectedClass,!0),P.push(I[O]),Va({sortable:z,rootEl:v,name:"select",targetEl:I[O],originalEvt:r}))}else gb=aa;Ba=G}if(Ta&&
this.isMultiDrag){if((w[ma].options.sort||w!==v)&&1<P.length){var sa=y(aa),Z=M(aa,":not(."+this.options.selectedClass+")");if(!hb&&L.animation&&(aa.thisAnimationDuration=null),G.captureAnimationState(),!hb&&(L.animation&&(aa.fromRect=sa,P.forEach(function(S){if(S.thisAnimationDuration=null,S!==aa){var Ca=xa?y(S):sa;S.fromRect=Ca;G.addAnimationState({target:S,rect:Ca})}})),mb(),P.forEach(function(S){I[Z]?w.insertBefore(S,I[Z]):w.appendChild(S);Z++}),F===M(aa))){var fa=!1;P.forEach(function(S){S.sortableIndex===
M(S)||(fa=!0)});fa&&D("update")}P.forEach(function(S){qa(S)});G.animateAll()}Ba=G}(v===w||n&&"clone"!==n.lastPutMode)&&wa.forEach(function(S){S.parentNode&&S.parentNode.removeChild(S)})}},nullingGlobal:function(){this.isMultiDrag=Ta=!1;wa.length=0},destroyGlobal:function(){this._deselectMultiDrag();f(document,"pointerup",this._deselectMultiDrag);f(document,"mouseup",this._deselectMultiDrag);f(document,"touchend",this._deselectMultiDrag);f(document,"keydown",this._checkKeyDown);f(document,"keyup",
this._checkKeyUp)},_deselectMultiDrag:function(n){if(!(void 0!==Ta&&Ta||Ba!==this.sortable||n&&q(n.target,this.options.draggable,this.sortable.el,!1)||n&&0!==n.button))for(;P.length;){var r=P[0];p(r,this.options.selectedClass,!1);P.shift();Va({sortable:this.sortable,rootEl:this.sortable.el,name:"deselect",targetEl:r,originalEvt:n})}},_checkKeyDown:function(n){n.key===this.options.multiDragKey&&(this.multiDragKeyDown=!0)},_checkKeyUp:function(n){n.key===this.options.multiDragKey&&(this.multiDragKeyDown=
!1)}},e(l,{pluginName:"multiDrag",utils:{select:function(n){var r=n.parentNode[ma];r&&r.options.multiDrag&&!~P.indexOf(n)&&(Ba&&Ba!==r&&(Ba.multiDrag._deselectMultiDrag(),Ba=r),p(n,r.options.selectedClass,!0),P.push(n))},deselect:function(n){var r=n.parentNode[ma],v=P.indexOf(n);r&&r.options.multiDrag&&~v&&(p(n,r.options.selectedClass,!1),P.splice(v,1))}},eventProperties:function(){var n=this,r=[],v=[];return P.forEach(function(w){r.push({multiDragElement:w,index:w.sortableIndex});var z=xa&&w!==aa?
-1:xa?M(w,":not(."+n.options.selectedClass+")"):M(w);v.push({multiDragElement:w,index:z})}),{items:h(P),clones:[].concat(wa),oldIndicies:r,newIndicies:v}},optionListeners:{multiDragKey:function(n){return"ctrl"===(n=n.toLowerCase())?n="Control":1<n.length&&(n=n.charAt(0).toUpperCase()+n.substr(1)),n}}})}),N});!function(a){function e(){if(!k)throw Error("jQuery is required for jquery-sortablejs");if(!g)throw Error("SortableJS is required for jquery-sortablejs (https://github.com/SortableJS/Sortable)");}if("function"==typeof define&&define.amd)try{define(["sortablejs","jquery"],function(h,b){g=h;k=b;e();a(h,b)})}catch(h){e()}else{if("object"==typeof exports)try{var g=require("sortablejs");var k=require("jquery")}catch(h){}"function"!=typeof jQuery&&"function"!=typeof $||(k=jQuery||$);"undefined"!=typeof Sortable&&
(g=Sortable);e();a(g,k)}}(function(a,e){e.fn.sortable=function(g){var k,h=arguments;return this.each(function(){var b=e(this),c=b.data("sortable");c||!(g instanceof Object)&&g?c&&("destroy"===g?(c.destroy(),b.removeData("sortable")):"widget"===g?k=c:"function"==typeof c[g]?k=c[g].apply(c,[].slice.call(h,1)):g in c.options&&(k=c.option.apply(c,h))):(c=new a(this,g),b.data("sortable",c))}),void 0===k?this:k}});(function(a){a.photos_sidebar={width:200,options:{},init:function(e){var g=this;this.options=e||{};e.width&&(this.width=e.width);g.wa2=e.wa2||!1;g.wa2?(g.$wrapper=e.$wrapper,this.initCollapsibleWa2(),this.initHandlers()):(this.initCollapsible(),this.initHandlers(),this.initView(),setTimeout(function(){g.initFixedSidebar()},1E3))},initFixedSidebar:function(){var e=a(window),g=a("#wa-app"),k=g.find(".p-sidebar-wrapper"),h=g.find(".p-sidebar-block"),b=e.height(),c=h.offset().top,f=!1,m=!1,q=!1,p=0;e.on("scroll",
function(){var t=e.scrollTop(),u=h.outerHeight(),x=g.height(),B=h.offset().top,y=p>t?1:-1,A=t-c,C=h.width(),H=u+parseInt(k.css("padding-top"))+parseInt(k.css("padding-bottom"))>=x;if(x>b&&!H)if(u<b)0<A?((f||!m||q)&&h.removeAttr("style").width(C).addClass("fixed-to-top"),q=!0):h.removeAttr("style").removeClass("fixed-to-bottom").removeClass("fixed-to-top");else if(t<=c){if(f||m||q)h.removeAttr("style").removeClass("fixed-to-bottom").removeClass("fixed-to-top"),f=m=q=!1}else if(t<=B&&B>=c)if(0<y){if(f||
!q||m)h.removeAttr("style").width(C).removeClass("fixed-to-bottom").addClass("fixed-to-top"),f=m=!1,q=!0}else{if(!f||q||m)h.css("top",B-c).removeClass("fixed-to-top").removeClass("fixed-to-bottom"),f=!0,q=m=!1}else if(t+b>=B+u)if(0<y){if(!f||q||m)h.css("top",B-c).removeClass("fixed-to-top").removeClass("fixed-to-bottom"),f=!0,q=m=!1}else{if(f||q||!m)h.removeAttr("style").width(C).removeClass("fixed-to-top").addClass("fixed-to-bottom"),f=q=!1,m=!0}else{if(!f||q||m)h.css("top",B-c).removeClass("fixed-to-top").removeClass("fixed-to-bottom"),
f=!0,q=m=!1}else if(f||q||m)h.removeAttr("style").removeClass("fixed-to-bottom").removeClass("fixed-to-top"),f=q=m=!1;p=t})},initView:function(){var e=a("#p-sidebar"),g=a("#p-sidebar-width-control");g.find("a.arrow").unbind("click").bind("click",function(){var k=e.attr("class"),h=0,b=k.match(/left([\d]{2,3})px/);if(b&&b[1]&&(h=parseInt(b[1]))&&(b=h+(a(this).is(".right")?50:-50),b=Math.max(Math.min(b,400),200),b!=h)){g.css({width:b.toString()+"px"});h=["left"+h+"px","left"+b+"px"];e.attr("class",k.replace(h[0],
h[1]));e.css("width","");var c=a("#p-content");c.length&&(k=c.attr("class"),c.attr("class",k.replace(h[0],h[1])),c.css("margin-left",""));a.photos_sidebar.width=b;a.post("?action=sidebarSaveWidth",{width:b},"json")}return!1})},initCollapsible:function(){a("#p-sidebar").off("click",".collapse-handler").on("click",".collapse-handler",function(){a.photos_sidebar._collapseSidebarSection(this,"toggle")});a("#p-sidebar .collapse-handler").each(function(){a.photos_sidebar._collapseSidebarSection(this,"restore")});
a("#album-list-container").off("uncollapse_section").on("uncollapse_section",function(e,g){g=a(g);e=a(this).find(">.collapse-handler");var k=g.find(">i.collapse-handler");a.photos_sidebar._collapseSidebarSection(k,"uncollapse");for(g=g.parent().parent();g.length&&g.get(0)!=this;){k=g.find(">i.collapse-handler");if(!k.length)break;a.photos_sidebar._collapseSidebarSection(k,"uncollapse");g=g.parent().parent()}a.photos_sidebar._collapseSidebarSection(e,"uncollapse")})},initCollapsibleWa2:function(){function e(b,
c){var f="photos/sidebar/collapsed_albums";"section"===c&&(f="photos/sidebar/collapsed_sections");return!!k(f)[b]}function g(b,c){var f=b.data("id"),m=b.hasClass("is-collapsed"),q="photos/sidebar/collapsed_albums";"section"===c&&(q="photos/sidebar/collapsed_sections");c=k(q);f&&(m?delete c[f]:c[f]=!0);localStorage.setItem(q,JSON.stringify(c));b.toggleClass("is-collapsed")}function k(b){return(b=localStorage.getItem(b))?JSON.parse(b):{}}var h=this.$wrapper.find(".p-sidebar-section");this.$wrapper.find(".js-album-list li").each(function(){var b=
a(this),c=b.data("id"),f=b.find(".caret");f.length&&(f.on("click",function(m){m.preventDefault();b.trigger("collapse_a")}),b.on("collapse_a",function(m){m.preventDefault();g(b,"album")}),c&&e(c,"album")&&b.trigger("collapse_a"))});h.each(function(){var b=a(this),c=b.data("id"),f=b.find(".heading .caret");f.length&&(f.on("click",function(m){m.preventDefault();b.trigger("collapse_s")}),b.on("collapse_s",function(m){m.preventDefault();g(b,"section")}),c&&e(c,"section")&&b.trigger("collapse_s"))})},initHandlers:function(){a("#p-upload-link").on("click",
function(e){e.preventDefault();e=a("#p-uploader");e.length?a.waDialog({$wrapper:e,onOpen:function(g,k){a.photos.onUploadDialog(g,k)},onClose:function(g){var k=g.$wrapper;g.animate?g.animateDialog(!1).then(function(){g.$wrapper.hide()}):g.$wrapper.hide();g.lock_body_scroll&&document.querySelector("body").classList.remove("is-locked");a.photos.dialogClearSteps.call(k);return!1}}):a.photos.uploadDialog()});a("#album-list-container").off("click",".p-new-album").on("click",".p-new-album",function(){var e=
a(this),g=0;e.is("#p-new-album")||(g=parseInt(e.parents("li:first").attr("rel"),10)||0);e=a("#album-create-dialog-acceptor");e.length||(e=a("<div id='album-create-dialog-acceptor'></div>"),a("body").append(e));e.load("?module=dialog&action=createAlbum&parent_id="+g,function(){a.waDialog({$wrapper:a("#album-create-dialog"),onOpen:function(k,h){k.find("input[type=text]").val("");var b=k.find("form");b.find(".js-privacy-settings-link").on("click",function(){a(window).resize()});b.on("submit",function(c){c.preventDefault();
a.post(b.attr("action"),b.serialize(),function(f){"ok"==f.status&&(a.photos.onCreateAlbum(f.data,g),h.close(),f.data.id&&a.photos.goToHash("/album/"+f.data.id))},"json")})}})});return!1})},countSubtree:function(e){var g=e.find(">.count:not(.subtree)"),k=e.find(">.subtree");k.length||(k=g.clone().addClass("subtree").hide(),g.after(k));var h=parseInt(g.text(),10)||0;e.find("li.static>.count:not(.subtree)").each(function(){var b=parseInt(a(this).text(),10)||0;h+=b});k.hasClass("never-recount")||k.text(h);
k.show();g.hide();return h},countItem:function(e){var g=e.find(">.count:not(.subtree)").show();e.find(">.subtree").hide();return parseInt(g.text(),10)||0},_collapseSidebarSection:function(e,g){g||(g="coollapse");e=a(e);if(e.length){var k=e.hasClass("darr")||e.hasClass("rarr")?e:e.find(".darr, .rarr");if(k.length){var h=e.parent(),b=h.find(".hierarchical:first");b.length||(b=h.find(".collapsible-content:first"));b.length||(b=h.find("ul:first"));var c;e=e.attr("id")||e.parent().attr("id");var f=k.hasClass("darr")?
"shown":"hidden",m=function(){b.hide();k.removeClass("darr").addClass("rarr");a.photos_sidebar.countSubtree(h);c="hidden"},q=function(){b.show();k.removeClass("rarr").addClass("darr");a.photos_sidebar.countItem(h);c="shown"};switch(g){case "toggle":"shown"==f?m():q();break;case "restore":e&&("hidden"==a.storage.get("photos/collapsible/"+e)?m():q());break;case "uncollapse":q();break;default:m()}e&&c&&a.storage.set("photos/collapsible/"+e,c)}}}}})(jQuery);(function(a){function e(){var k=a.photos.getAlbum();return k&&k.type===Album.TYPE_STATIC&&!1!==k.edit_rights?!0:!1}function g(){a("#hint-menu-block").hide().children().hide()}a.photos_dragndrop={helper_shift:20,init:function(){var k=document.querySelector("#album-list"),h={forceFallback:!0,ghostClass:"p-sortable-ghost",chosenClass:"p-sortable-chosen",dragClass:"p-sortable-drag",fallbackClass:"p-sortable-fallback",waHighlightClass:"p-sortable-nested",group:"nested",draggable:">*:not(a)",animation:150,
fallbackOnBody:!1,swapThreshold:.45,dragoverBubble:!0,onAdd:function(c){(c=c.to.closest("li"))&&!c.querySelector(".caret")&&c.querySelector("a").insertAdjacentHTML("afterbegin",'<span class="caret"><i class="fas fa-caret-down"></i></span>')},onRemove:function(c){c=c.from;c.classList.contains("js-root-menu")||0!==c.childElementCount||(c=c.closest("li").querySelector(".caret"))&&c.remove()},onMove:function(c){var f,m,q=null!=(m=null==(f=this.options)?void 0:f.waHighlightClass)?m:"bg-light-gray",p;b.forEach(function(t){return null==
(p=t.closest("li"))?void 0:p.classList.remove(q)});c=c.related.parentElement;c.classList.toggle(q,"LI"===c.tagName)},onUpdate:function(c){},onEnd:function(c){var f,m,q=null!=(m=null==(f=this.options)?void 0:f.waHighlightClass)?m:"bg-light-gray",p;b.forEach(function(t){return null==(p=t.closest("li"))?void 0:p.classList.remove(q)});m=a(c.item);f=m.parent("ul").parent("li");c=m.data("id")||m.attr("rel");m=m.next().data("id")||null;f=f.length?f.data("id"):0;a.post("?module=album&action=move",{id:c,before_id:m,
parent_id:f},function(t){var u=a.photos.getAlbum(),x=t.data.album,B=t.data.counters;0>=x.status&&a.photos_dragndrop.privateDescendants(x.id)&&a.photos.dispatch("album/"+x.id+"/");u&&u.id==x.id&&((t=t.data.frontend_link)&&a("#photo-list-frontend-link").attr("href",t).text(t),x.type==Album.TYPE_DYNAMIC&&a.photos.load("?module=album&action=photos&id="+x.id,a.photos.onLoadPhotoList));if(!a.isEmptyObject(B))for(var y in B)B.hasOwnProperty(y)&&a(k).find("li[rel="+y+"]").find(".count:first").text(B[y])},
"json")}},b=Array.from(k.querySelectorAll("ul"));b.forEach(function(c){return new Sortable(c,h)})},_initDragPhotos:function(){var k={opacity:.75,zIndex:9999,distance:5,appendTo:"body",cursor:"move",refreshPositions:!0,start:function(c,f){document.ondragstart=function(){return!1};f.helper.data("scrollTop",a(document).scrollTop());a(document).bind("scroll",a.photos_dragndrop._scrolHelper);a("#album-list-container").addClass("p-drag-active")},stop:function(c,f){document.ondragstart=null;a(document).unbind("scroll",
a.photos_dragndrop._scrolHelper);a("#album-list-container").removeClass("p-drag-active");g()},drag:function(c,f){c=c.originalEvent;f.position.left=c.pageX-a.photos_dragndrop.helper_shift;f.position.top=c.pageY}},h=k.start,b=k.stop;void 0!=a.support.touch&&1!=a.support.touch&&a("img",a("#photo-list")).liveDraggable(a.extend({},k,{containment:[0,0,a(window).width(),{toString:function(){return a(document).height()}}],helper:function(c){c=a(this).parents("li:first");var f=a("#photo-list > li.selected"),
m=f.length?f.length:1,q=[c.attr("data-photo-id")],p=!1,t=c.get(0);f.each(function(){this!=t?q.push(a(this).attr("data-photo-id")):p=!0});!p&&f.length&&(c.addClass("selected").find("input:first").trigger("select",!0),++m);c.data("photo_ids",q);return'<div id="helper"><span class="indicator red">'+m+'</span><i class="icon10 no-bw" style="display:none;"></i></div>'},handle:".p-image",start:function(c,f){h.apply(this,[c,f]);c=a(this).parents("li:first");1==c.data("photo_ids").length&&c.addClass("selected")},
stop:function(c,f){b.apply(this,[c,f]);c=a(this).parents("li:first");1==c.data("photo_ids").length&&c.removeClass("selected")}}));a("#photo").liveDraggable(a.extend({},k,{containment:"body",start:function(c,f){if(!a(c.target).hasClass("ui-draggable"))return!1},helper:function(){return'<div id="helper"><span class="indicator red">1</span><i class="icon10 no-bw" style="display:none;"></i></div>'}}))},_initDropPhotos:function(){a("li",a("#photo-list")).liveDroppable({disabled:!1,greedy:!0,tolerance:"pointer",
over:function(k,h){if(h.draggable.hasClass("dr"))return!1;if(e())g();else if(k=a.photos.getOption("sort_method"))h=a("#hint-menu-block").show(),h.children().hide(),h.find("."+k).show();a.photos_dragndrop._activatePhotoListItem.call(this)},out:function(k,h){a.photos_dragndrop._unactivatePhotoListItem.call(this)},drop:function(k,h){k=e();var b=a.photos.getAlbum();h=h.draggable.parents("li:first");var c=a(this);if(h.get(0)==this||c.hasClass("selected"))return a.photos_dragndrop._unactivatePhotoListItem.call(this),
!1;var f=a("#photo-list > li.selected");f.length||(f=h);a.photos_dragndrop._unactivatePhotoListItem.call(this);a.photos_dragndrop._unactivatePhotoListItem.call(h);if(!k)return!1;var m=parseInt(c.attr("data-photo-id"));c.hasClass("last")?(m=null,c.after(f),c.removeClass("last"),a("#photo-list > li:last").addClass("last")):(c.before(f),h.hasClass("last")&&(h.removeClass("last"),a("#photo-list > li:last").addClass("last")));f.trigger("select",!1);var q=[];f.each(function(){q.push(parseInt(a(this).attr("data-photo-id")))});
a.post("?module=album&action=photoMove",{photo_id:q,album_id:b.id,before_id:m},function(p){"ok"==p.status&&a.photos.photo_stream_cache.move(q,m)},"json")}})},_initDragAlbums:function(){var k=a("#js-app-sidebar"),h=k.position(),b=k.width();k=k.height();a("#album-list").find("li.dr").liveDraggable({containment:[h.left,h.top,h.left+b+.25*b,h.top+k],refreshPositions:!0,revert:"invalid",helper:function(){var c=a(this).clone().addClass("ui-draggable").css({position:"absolute"}).prependTo("#album-list > ul");
c.find("a:first").append('<i class="fas fa-times" style="margin-left: 0; margin-right: 0; display:none;"></i>');return c},cursor:"move",cursorAt:{left:5},opacity:.75,zIndex:9999,distance:5,start:function(c,f){document.ondragstart=function(){return!1}},stop:function(){document.ondragstart=null}})},_initDropAlbums:function(){this._initDropBetweenAlbums();this._initDropInsideAlbums()},_initDropBetweenAlbums:function(){a("#album-list").find("li.drag-newposition").liveDroppable({accept:"li.dr",greedy:!0,
tolerance:"pointer",over:function(k,h){if("IMG"==h.draggable.get(0).tagName)return!1;a(this).addClass("active").parent().parent().addClass("drag-active")},out:function(k,h){a(this).removeClass("active").parent().parent().removeClass("drag-active")},deactivate:function(k,h){var b=a(this);(b.is(":animated")||b.hasClass("dragging"))&&b.stop().animate({height:"0px"},300,null,function(){b.removeClass("dragging")});a(this).removeClass("active").parent().parent().removeClass("drag-active")},drop:function(k,
h){if("IMG"==h.draggable.get(0).tagName)return!1;var b=a(this).parent("ul");h=a(h.draggable);k=h.attr("rel");var c=a(this).prev("li");if(c.length&&c.attr("rel")==k&&!c.hasClass("ui-draggable")||this==h.next().get(0))return!1;b=b.parent("li").length?b.parent("li").attr("rel"):0;c=a(this).next();var f=null;c.length&&(f=c.attr("rel"));a.post("?module=album&action=move",{id:k,before_id:f,parent_id:b},function(m){var q=a.photos.getAlbum(),p=m.data.album,t=m.data.counters;0>=p.status&&a.photos_dragndrop.privateDescendants(p.id)&&
a.photos.dispatch("album/"+p.id+"/");q&&q.id==p.id&&((m=m.data.frontend_link)&&a("#photo-list-frontend-link").attr("href",m).text(m),p.type==Album.TYPE_DYNAMIC&&a.photos.load("?module=album&action=photos&id="+p.id,a.photos.onLoadPhotoList));if(!a.isEmptyObject(t))for(var u in t)t.hasOwnProperty(u)&&album_list.find("li[rel="+u+"]").find(".count:first").text(t[u])},"json");b=h.parent("ul");k=b.children("li.dr[rel!="+k+"]").length;h.next().insertAfter(a(this));h.insertAfter(a(this));k||(b.parent("li").children("i").remove(),
b.remove())}})},privateDescendants:function(k,h){h="boolean"===typeof h?h:!0;k=a("#album-list").find("li[rel="+k+"]");h=h?k:a();changed=!1;h.add(k.find("li")).each(function(){var b=a(this).find(">a");if(!b.find(".fa-lock").length){var c=a(this).filter(".images").next();c.length?(changed=!0,c.find("count:first").prepend('<span class="hint"><i class="fas fa-lock"></i></span>&nbsp;')):b.find("count:first").prepend('<span class="hint"><i class="fas fa-lock"></i></span>&nbsp;')}});return changed},_initDropInsideAlbums:function(){a("li.dr a",
a("#album-list")).liveDroppable({accept:function(k){return k.is("li.dr, img#photo")||k.closest("li[data-photo-id]").length?!0:!1},tolerance:"custom",greedy:!0,out:function(k,h){a(this).parent().removeClass("drag-newparent");h.helper.find("span").show().end().find("i").hide()},over:function(k,h){k=a(this).parent();var b=!1;h.draggable=a.photos_dragndrop._fixUiDraggable(h.draggable);if(h.draggable.parents("#photo-list").length||h.draggable.is("#photo"))k.hasClass("static")?h.helper.find("span").show().end().find("i").hide():
h.helper.find("span").hide().end().find("i").show(),b=!0;k.addClass("drag-newparent");if(b)return!1;if(h.draggable.hasClass("static")&&!k.hasClass("static"))return h.helper.find("i.no-bw").show(),!1;h.helper.find("i.no-bw").hide();var c='.dr[rel!="'+a(h.draggable).attr("rel")+'"]',f=a(),m=function(p,t){if(0>=t.length)return p;p=p.add(t.nextUntil(c).filter("li.drag-newposition"));return 0<t.nextAll(c).length?p:m(p,t.parent().closest("li"))};h=k.prevAll(c).first();0<h.length?(b=h.find(c),f=0<b.length?
m(f,b.last()):m(f,h)):f=f.add(k.prevUntil(c).filter("li.drag-newposition"));f=0<k.children("ul").children(c).length?f.add(k.children("ul").children("li.drag-newposition:first")):m(f,k);var q=a(".drag-newposition:animated, .drag-newposition.dragging").not(f);q.stop().animate({height:"0px"},300,null,function(){q.removeClass("dragging")});f.stop().animate({height:"10px"},300,null,function(){f.addClass("dragging")})},drop:function(k,h){k=a(this).parent().removeClass("drag-newparent");h.draggable=a.photos_dragndrop._fixUiDraggable(h.draggable);
if(h.draggable.parents("#photo-list").length||h.draggable.is("#photo")){var b=this.href.match(/.*#\/album\/([\d]+)/);if(null===b||!parseInt(b[1],10)){console&&console.log("Link: "+this.href+" is not correct");return}b=parseInt(b[1],10);var c=null;k.hasClass("static")&&(c=h.draggable.is("#photo")?[a.photos.photo_stream_cache.getCurrent().id]:h.draggable.data("photo_ids"));c&&(a.photos.addToAlbums({photo_id:c,album_id:b}),a("#photo-list > li.selected").trigger("select",!1));return!1}if(h.draggable.hasClass("static")&&
!k.hasClass("static"))return!1;b=a(h.draggable);if(k.attr("rel")==b.attr("rel"))return!1;k.hasClass("drag-newposition")?h=k.parent("ul"):k.children("ul").length?h=k.children("ul"):(h=a('<ul class="menu dr"><li class="drag-newposition"></li></ul>').appendTo(k),h.find(".drag-newposition").mouseover(),a('<i class="icon16 darr overhanging"></i>').insertBefore(k.children("a")));c=b.attr("rel");k=k.attr("rel");if(k==b.parent("ul").parent("li.dr").attr("rel"))return!1;a.post("?module=album&action=move",
{id:c,parent_id:k},function(m){var q=a.photos.getAlbum(),p=m.data.album,t=m.data.counters;0>=p.status&&a.photos_dragndrop.privateDescendants(p.id)&&a.photos.dispatch("album/"+p.id+"/");q&&q.id==p.id&&((m=m.data.frontend_link)&&a("#photo-list-frontend-link").attr("href",m).text(m),p.type==Album.TYPE_DYNAMIC&&a.photos.load("?module=album&action=photos&id="+p.id,a.photos.onLoadPhotoList));p=a("#album-list");if(!a.isEmptyObject(t))for(var u in t)t.hasOwnProperty(u)&&p.find("li[rel="+u+"]").find(".count:first").text(t[u])},
"json");k=b.parent("ul");c=k.children("li.dr[rel!="+c+"]").length;var f=b.next();b.appendTo(h);f.appendTo(h);c||(k.parent("li").children("i").remove(),k.remove())}})},_scrolHelper:function(k){k=a("#helper");var h=k.data("scrollTop"),b=a(document).scrollTop();h=h?b-h:50;k.css("top",k.position().top+h+"px");k.data("scrollTop",b)},_dropAnimation:function(k,h){var b=[];k.each(function(){var c=a(this),f=c.offset(),m=c.clone().css({"z-index":10,position:"absolute",top:f.top,left:f.left}).insertAfter(c);
c.css({opacity:0});b.push(c.hide(300).promise());b.push(m.animate({top:f.top,left:f.left},300).promise().done(function(){a(this).remove()}))});a.when.apply(a,b).done(function(){"function"===typeof h&&h()})},_shiftToLeft:function(k){if("left"!==k.data("shifted")){var h=k.find(".p-wrapper");if(!h.length){var b=k.children();h=a("<div class='p-wrapper' style='position:relative;'></div>").appendTo(k);h.append(b)}h.stop().animate({left:-15},200);k.data("shifted","left")}},_shiftToRight:function(k){if("right"!==
k.data("shifted")){var h=k.find(".p-wrapper");if(!h.length){var b=k.children();h=a("<div class='p-wrapper' style='position:relative;'></div>").appendTo(k);h.append(b)}h.stop().animate({left:15},200);k.data("shifted","right")}},_shiftAtPlace:function(k){if(k.data("shifted")){var h=k.find(".p-wrapper");if(h.length){var b=h.children();h.stop().css({left:0});k.append(b);h.remove()}k.data("shifted","")}},_bindExtDragActivate:function(k,h){a(document).bind("mousemove.ext_drag_activate",function(b){a.photos_dragndrop._extDragActivate(b,
k,h)})},_unbindExtDragActivate:function(){a(document).unbind("mousemove.ext_drag_activate")},_activatePhotoListItem:function(){var k=a(this),h=e(),b=h?"drag-active":"drag-active-disabled";h&&a.photos_dragndrop._shiftToRight(k);k.hasClass("last")?a.photos_dragndrop._bindExtDragActivate(k,b):k.addClass(b)},_unactivatePhotoListItem:function(k){k=a(this);var h=e(),b=h?"drag-active":"drag-active-disabled",c=b+"-last";k.hasClass("last")&&a.photos_dragndrop._unbindExtDragActivate();k.removeClass(b+" "+c);
h&&a.photos_dragndrop._shiftAtPlace(k)},_extDragActivate:function(k,h,b){var c=b+"-last";if(h.hasClass("last")){var f=k.pageX;k=k.pageY;var m=h.width(),q=h.height(),p=h.position();"template-photo-thumbs"==a.photos.list_template?f>p.left+.5*m&&f<=p.left+m?(h.removeClass(b).addClass(c),a.photos_dragndrop._shiftToLeft(h)):f>p.left&&f<=p.left+.5*m?(h.removeClass(c).addClass(b),a.photos_dragndrop._shiftToRight(h)):a.photos_dragndrop._shiftAtPlace(h):"template-photo-descriptions"==a.photos.list_template&&
(k>p.top+.5*q?h.removeClass(b).addClass(c):k>p.top&&h.removeClass(c).addClass(b));(k<p.top||k>p.top+q||f<p.left||f>p.left+m)&&h.removeClass(b).removeClass(c)}else h.addClass(b)},_fixUiDraggable:function(k){if(k.is("#photo"))return k;"IMG"==k.get(0).tagName&&(k=k.parents("li:first"));return k},_extendJqueryUIDragAndDrop:function(){a.fn.liveDraggable=function(h){this.each(function(c,f){c=a(this);c.data("init_draggable")&&c.off("mouseover",c.data("init_draggable"))});var b;this.on("mouseover",b=function(){var c=
a(this);c.data("init_draggable")||c.data("init_draggable",b).draggable(h)})};a.fn.liveDroppable=function(h){this.each(function(c,f){c=a(this);c.data("init_droppable")&&c.off("mouseover",c.data("init_droppable"))});var b=function(){var c=a(this);c.data("init_droppable")||(c.data("init_droppable",b).droppable(h),c.mouseover())};b.call(this);this.off("mouseover",b).on("mouseover",b);this.on("mouseover",b)};var k=a.ui.intersect;a.ui.intersect=function(h,b,c){a(h.element).is("#photo")||"custom"!=c||(c=
"pointer");if("custom"!=c)return k.call(a.ui,h,b,c);c=b.offset.left;var f=b.offset.top;h=h.helper.position();return a.ui.isOver(h.top,h.left+a.photos_dragndrop.helper_shift,f,c,b.proportions.height,b.proportions.width)}}}})(jQuery);(function(a){var e=function(g,k){var h=/[^\w\-\.:]/.test(g)?new Function(e.arg+",tmpl","var _e=tmpl.encode"+e.helper+",_s='"+g.replace(e.regexp,e.func)+"';return _s;"):e.cache[g]=e.cache[g]||e(e.load(g));return k?h(k,e):function(b){return h(b,e)}};e.cache={};e.load=function(g){var k=document.getElementById(g),h=/<\\\/(\w+)/g;!k&&console&&console.log("template with id="+g+" not found");return k?("textarea"==k.tagName.toLowerCase()?k.value:document.getElementById(g).innerHTML).replace(h,"</$1"):null};
e.regexp=/([\s'\\])(?![^%]*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(\{%)|(%\})/g;e.func=function(g,k,h,b,c,f){if(k)return{"\n":"\\n","\r":"\\r","\t":"\\t"," ":" "}[g]||"\\"+g;if(h)return"="===h?"'+_e("+b+")+'":"'+("+b+"||'')+'";if(c)return"';";if(f)return"_s+='"};e.encReg=/[<>&"'\x00]/g;e.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"};e.encode=function(g){return String(g||"").replace(e.encReg,function(k){return e.encMap[k]||""})};e.arg="o";e.helper=",print=function(s,e){_s+=e&&(s||'')||_e(s);},include=function(s,d){_s+=tmpl(s,d);}";
"function"===typeof define&&define.amd?define(function(){return e}):a.tmpl=e})(this);(function(a){a.fn.inlineEditable=function(e,g){function k(){p(a(this))||a(this).addClass(u.placeholderClass).text(u.placeholder)}function h(){p(a(this))==u.placeholder&&a(this).text("").removeClass(u.placeholderClass)}function b(A){return a(A).val()?!1:(a(this).text(u.placeholder).addClass(u.placeholderClass),!0)}function c(){B="edit";this.id=this.id||(""+Math.random()).slice(2);var A=this.id+"-input",C=a("#"+A);if(!C.length){var H=x,M=H.after;a:switch(u.inputType){case "textarea":var E='<textarea id="'+
A+'" style="display:none;"></textarea>';break a;default:E='<input type="text" id="'+A+'" style="display:none;">'}M.call(H,E);C=a("#"+A)}m(C,x);u.placeholder&&p(a(this))==u.placeholder&&h.call(x);u.beforeMakeEditable.call(this,C);y=u.truncate?x.data("real_text"):p(x);C.val(y).show().focus();x.hide();a(u.editLink).hide();if(!t){A=[];var K=[];H=0;for(M=u.makeReadableBy.length;H<M;++H)E=u.makeReadableBy[H],"blur"==E&&C.blur(function(){"read"!=B&&f.call(this)}),"enter"==E&&A.push(13),"esc"==E&&A.push(27);
H=0;for(M=u.updateBy.length;H<M;++H)E=u.updateBy[H],"alt+enter"==E&&K.push({ctrl:!1,alt:!0,shift:!1,key:13}),"ctrl+enter"==E&&K.push({ctrl:!0,alt:!1,shift:!1,key:13}),"ctrl+s"==E&&K.push({ctrl:!0,alt:!1,shift:!1,key:17});A.length&&function(R){C.keydown(function(V){!~R.indexOf(V.keyCode)||V.ctrlKey||V.altKey||V.shiftKey||"read"!=B&&f.call(this,27==V.keyCode?y:null);if(K.length)for(var ja in K){var X=K[ja];if(V.keyCode==X.key&&V.ctrlKey==X.ctrl&&V.altKey==X.alt&&V.shiftKey==X.shift){x.trigger("readable");
break}}})}(A);x.bind("readable",function(R,V){"read"!=B&&(R=a("#"+(this.id+"-input")),f.call(R,R.val(),V))});t=!0}}function f(A,C){C="undefined"===typeof C?!1:!0;void 0!=A&&null!=A?a(this).val(A):A=a(this).val();if(!1!==C||!1!==u.beforeBackReadable.call(x.get(0),this,{changed:A!=y,old_text:y,new_text:A})){B="read";if(!u.placeholder||!b.call(x,this))if(u.allowEmpty||A){if(u.truncate)x.data("real_text",A),x.text(A.length<u.truncate-3?A:A.substr(0,u.truncate-3)+"...");else{var H=x,M=A;u.html?H.html(M):
H.text(M)}A||k.call(this)}x.show();a(this).hide();a(u.editLink).show();!1===C&&u.afterBackReadable.call(x.get(0),this,{changed:A!=y,old_text:y})}}function m(A,C){var H=u.size.height||C.height();C=u.size.width||1.5*C.width();H=u.minSize.height&&H<u.minSize.height?u.minSize.height:H;C=u.minSize.width&&C<u.minSize.width?u.minSize.width:C;H=u.maxSize.height&&H>u.maxSize.height?u.maxSize.height:H;C=u.maxSize.width&&C>u.maxSize.width?u.maxSize.width:C;A.filter('[class*="short"]')||A.filter('[class*="long"]').length||
(A.height(H),A.width(C))}function q(A){return function(){return A}}function p(A){return u.html?A.html():A.text()}var t=!1;if("string"==typeof e){if("setOption"==e){var u=this.data("inlineEditableSettings")||{};a.extend(!0,u,g);"undefined"!==typeof g.hold&&"function"!==typeof g.hold&&(u.hold=q(u.hold));this.data("inlineEditableSettings",u)}return this}g=this.data("inlineEditableSettings");this.data("inlineEditableSettings",a.extend({inputType:"text",size:{height:null,width:null},minSize:{height:null,
width:null},maxSize:{height:null,width:null},editLink:null,editOnItself:!0,placeholder:null,makeReadableBy:["blur","enter","esc"],updateBy:["ctrl+enter","alt+enter"],beforeBackReadable:function(){},afterBackReadable:function(){},beforeMakeEditable:function(){},placeholderClass:"hint",truncate:!1,hold:!1,html:!1,allowEmpty:!1},g,e||{}));u=this.data("inlineEditableSettings");var x=this,B="read",y="";"function"!==typeof u.hold&&(u.hold=q(u.hold));(function(){if(!this.data("inited")){u.truncate&&"boolean"==
typeof u.truncate&&(u.truncate=255);if(u.truncate){var A=u.placeholder&&u.placeholder===this.text()?"":this.text();this.data("real_text",A);this.text(A.length<u.truncate-3?A:A.substr(0,u.truncate-3)+"...")}u.placeholder&&k.call(this);u.editLink&&a(u.editLink).click(function(){u.hold.call(x)||"edit"!=B&&c.call(x.get(0))});u.editOnItself&&this.click(function(){u.hold.call(x)||"edit"!=B&&c.call(this)});this.bind("editable",function(){u.hold.call(x)||"edit"!=B&&c.call(this)});this.bind("placeholder",
function(C,H){H&&u.placeholder&&k.call(this);H||a(this).removeClass(u.placeholderClass)});this.data("inited",!0)}}).call(this);return this}})(jQuery);(function(a){a.fn.activeMenu=function(e,g,k){if("string"==typeof e){if("disable"==e||"enable"==e)return a.isArray(g)||(g=[g]),this.find("li").each(function(){var c=a(this);~g.indexOf(c.attr("data-action"))&&("disable"==e?c.hide():c.show())}),this;if("setOption"==e){var h=this.data("activeMenuSettings");if(!h)return;if("string"===typeof g){var b={};b[g]=k;g=b}a.extend(h,g);return this}}if("string"==typeof e&&"fire"==e){h=this.data("activeMenuSettings");if(!h)return;h["on"+e.substr(0,1).toUpperCase()+
e.substr(1)].call(this);return this}this.data("activeMenuSettings",a.extend({beforeAnyAction:function(){},defaultAction:function(){},onInit:function(){},onFire:function(){}},e||{}));if(h=this.data("activeMenuSettings"))return function(){this.data("inited")||(this.on("click.photos-active-menu",function(c){for(var f=c.target;"LI"!=f.tagName;){if(f==this)return;f=a(f).parent().get(0)}f=a(f);var m=f.attr("data-action")||"default";m=m.split("-");for(var q=1;q<m.length;q++)m[q]=m[q][0].toUpperCase()+m[q].slice(1);
m=m.join("");m+="Action";h[m]&&"function"==typeof h[m]||(m="defaultAction");if(!1!==h.beforeAnyAction(f.attr("data-action")))h[m](f,c);c.preventDefault()}),h.onInit(this),this.data("inited",!0))}.call(this),this}})(jQuery);(function(a){a.fn.rateWidget=function(e,g,k){function h(m){var q=0;this.find("svg").addClass("text-light-gray").removeClass("fa-star-half text-yellow").each(function(){if(q==m)return!1;q++;q>m?.5==q-m&&a(this).removeClass("text-light-gray").addClass("fa-star-half text-yellow"):a(this).removeClass("text-light-gray").addClass("text-yellow")});this.attr("data-rate",m)}function b(m){return function(){return m}}if("string"==typeof e){if("getOption"==e&&"rate"==g)return parseInt(this.attr("data-rate"));
"setOption"==e&&("rate"==g&&(g=parseFloat(k)||0,h.call(this,Math.round(2*g)/2),g={rate:k}),"object"===typeof g&&g&&(k=this.data("rateWidgetSettings")||{},a.extend(k,g),"undefined"!==typeof g.hold&&"function"!==typeof g.hold&&(k.hold=b(k.hold))));return this}this.data("rateWidgetSettings",a.extend({onUpdate:function(){},rate:null,hold:!1,withClearAction:!0,alwaysUpdate:!1},e||{}));var c=this.data("rateWidgetSettings"),f=this;"function"!==typeof c.hold&&(c.hold=b(c.hold));(function(){if(!f.data("inited")){null!=
c.rate&&f.attr("data-rate",c.rate);f.find("svg:lt("+f.attr("data-rate")+")").removeClass("text-light-gray").addClass("text-yellow");f.mouseover(function(t){c.hold.call(f)||(t=t.target,"svg"!==t.tagName&&"path"!==t.tagName)||("path"===t.tagName&&(t=t.ownerSVGElement),t=a(t),t.prevAll().addBack().removeClass("fa-star-half text-light-gray").addClass("fa-star text-yellow"),t.nextAll().removeClass("fa-star-half text-yellow").addClass("fa-star text-light-gray"))}).mouseleave(function(){c.hold.call(f)||
h.call(f,f.attr("data-rate"))});f.on("click",function(t){if(!c.hold.call(f)&&(t=t.target,"svg"===t.tagName||"path"===t.tagName)){"path"===t.tagName&&(t=t.ownerSVGElement);var u=f.attr("data-rate"),x=a(t).attr("data-rate-value");u!=x&&f.find("svg").removeClass("fa-star-half").addClass("text-yellow").each(function(){a(this).addClass("text-yellow");if(a(this).attr("data-rate-value")==x){if(c.alwaysUpdate||u!=x)f.attr("data-rate",x),c.onUpdate(x);return!1}})}});if(c.withClearAction){var m="clear-"+a(this).attr("id"),
q=a("#"+m);q.length||(f.after('<a href="javascript:void(0);" class="p-rate-clear" id="'+m+'" style="display:none;">'+$_("clear")+"</a>"),q=a("#"+m));q.on("click",function(t){t.preventDefault();if(!c.hold.call(f)&&(t=f.attr("data-rate"),h.call(f,0),0!=t))c.onUpdate(0)});var p;f.parent().mousemove(function(){c.hold.call(f)||(p&&clearTimeout(p),q.show(0))}).mouseleave(function(){p=setTimeout(function(){c.hold.call(f)||q.hide(0)},150)})}this.data("inited",!0)}}).call(this);return this}})(jQuery);var PhotoStream=function(){var a=function(e){this._options=e||{};this._onClear=this._options.onClear||function(){};this._photo_stream=[]};$.extend(a.prototype,{getById:function(e){for(var g=0,k=this._photo_stream[0],h=this._photo_stream.length;g<h;k=this._photo_stream[++g])if(k&&k.id==e)return k;return null},updateById:function(e,g,k){if(e=this.getById(e))return $.extend(e,g),e;k&&this._photo_stream.push(g);return g},deleteById:function(e){$.isArray(e)||(e=[e]);var g=e,k=0,h=g.length;for(e=g[0];k<
h;e=g[++k])(e=this.getById(e))&&e.index&&delete this._photo_stream[e.index];g=[];var b=0;k=0;h=this._photo_stream.length;for(e=this._photo_stream[0];k<h;e=this._photo_stream[++k])e&&(e.index=b++,g.push(e));this._photo_stream=g;return this},replace:function(e,g){e=e.index;this._photo_stream[e]=g;g.index=e;return this},push:function(e){this._photo_stream.push(e);e.index=this._photo_stream.length-1;return this},getNext:function(e){e=e||this.current;"object"!=typeof e&&(e=this.getById(e));if(!e)return null;
e=e.index+1;return this._photo_stream[e]?this._photo_stream[e]:null},getPrev:function(e){e=e||this.current;"object"!=typeof e&&(e=this.getById(e));if(!e)return null;e=e.index-1;return this._photo_stream[e]?this._photo_stream[e]:null},setCurrent:function(e){if(!e.index&&(e=this.getById(e.id),!e||"number"!==typeof e.index&&!e.index))throw Error("This photo is not in stream");this.current=e;return this},setCurrentById:function(e){e=this.getById(e);"object"===typeof e&&e&&this.setCurrent(e);return this},
getCurrent:function(){return this.current},getCurrentId:function(){return"object"===typeof this.current&&this.current?this.current.id:null},set:function(e){this._photo_stream=[];this.append(e);this.isEmpty()||this.setCurrent(this.getFirst());return this},append:function(e){for(var g=0,k=e[g],h=this._photo_stream.length,b=e.length;g<b;k=e[++g],++h)k.index=h,this._photo_stream.push(k);return this},prepend:function(e){var g=this._photo_stream||[];this._photo_stream=[];for(var k=0,h=e[k],b=e.length;k<
b;h=e[++k])h.index=k,this._photo_stream.push(h);this.append(g);return this},clear:function(){this._photo_stream=[];this._onClear();return this},length:function(){return this._photo_stream.length},getAll:function(){return this._photo_stream},getFirst:function(){return this._photo_stream[0]},getLast:function(){return this._photo_stream[this._photo_stream.length-1]},isFirst:function(e){return e&&0==e.index},isLast:function(e){return e&&e.index==this._photo_stream.length-1},isEmpty:function(){return!this._photo_stream.length},
getCurrentIndex:function(){return this.current.index},slice:function(e,g){return this._photo_stream.slice(e,g)},move:function(e,g){var k=[],h=this._photo_stream;if($.isArray(e))for(var b=0,c=e.length;b<c;++b){var f=this.getById(e[b]);delete h[f.index];k.push(f)}else f=this.getById(e),delete h[f.index],k.push(f);if(k.length)for(f="undefined"===typeof g||null===g?this._photo_stream.length:(f=this.getById(g))?f.index:0,Array.prototype.splice.apply(h,[f,0].concat(k)),this.clear(),b=k=0,c=h.length;b<c;++b)f=
h[b],"object"===typeof f&&f&&(f.index=k++,this._photo_stream.push(f))}});return a}();Date.parseISO=function(a){var e=Date.parse(a);if(!isNaN(e))return e;a=a.match(/([0-9]{4})-([0-9]{2})-([0-9]{2}) ([0-9]{2}):([0-9]{2}):([0-9]{2})/);e=new Date(a[1],0,1);a[2]&&e.setMonth(a[2]-1);a[3]&&e.setDate(a[3]);a[4]&&e.setHours(a[4]);a[5]&&e.setMinutes(a[5]);a[6]&&e.setSeconds(a[6]);return+e};
function replaceImg(a,e,g,k){k=k||a.attr("id")||(""+Math.random()).slice(2);replaceImg.loading_map=replaceImg.loading_map||{};replaceImg.loading_map[k]=e;a.unbind("load");if(null===g){if(a.smallSize){a.attr({src:e,srcset:""});return}a.attr({src:e,srcset:a.proper_thumb?a.proper_thumb.url+" 1x, "+a.proper_thumb.url2x+" 2x":""})}else{if(a.smallSize){$("<img>").attr({src:e,srcset:""}).load(function(){replaceImg.loading_map[k]==e&&(a.attr({src:e,srcset:""}),"function"==typeof g&&g.call(a));$(this).remove()});
return}$("<img>").attr({src:e,srcset:a.proper_thumb?a.proper_thumb.url+" 1x, "+a.proper_thumb.url2x+" 2x":""}).load(function(){replaceImg.loading_map[k]==e&&(a.attr({src:e,srcset:a.proper_thumb?a.proper_thumb.url+" 1x, "+a.proper_thumb.url2x+" 2x":""}),"function"==typeof g&&g.call(a));$(this).remove()})}return k}String.prototype.truncate=function(a,e){var g="";if("undefined"===typeof e||e)g=this.replace(/<\/?[\s\S]+?\/?>/g,"");g.length>a-3&&3<a&&(g=g.substr(0,a-3)+"...");return g};
function parseSize(a){var e="unknown";a=(""+a).split("x");var g=a[0]&&0!=a[0]?a[0]:null,k=a[1]&&0!=a[1]?a[1]:null;1==a.length?(e="max",k=g):g==k?e="crop":g&&k?e="rectangle":null===g?e="height":null===k&&(e="width");return{type:e,width:g,height:k}}
function getRealSizesOfThumb(a,e){var g=parseInt(a.width,10),k=parseInt(a.height,10),h=g/k,b=k/g;if(isNaN(h)||isNaN(b))return null;var c="object"!==typeof e?parseSize(e):e;var f=c.width;e=c.height;switch(c.type){case "max":g>k?(h=f,b*=h):(b=f,h*=b);break;case "crop":h=b=f;break;case "rectangle":h=f;b=e;break;case "width":h=f;b*=h;break;case "height":b=e;h*=b;break;default:h=b=null}h=Math.round(h);b=Math.round(b);return g<h&&k<b?{width:a.width,height:a.height}:{width:h,height:b}};(function(a){a.fn.photoStreamSlider=function(e){var g=a.extend({duration:200},e||{}),k=this;(function(){function h(y){function A(){h.execution=!1;var R="on"+C.charAt(0).toUpperCase()+C.slice(1);R=g[R];"function"==typeof R&&R.call(k);R=y.fn;"function"==typeof R&&R.call(k)}"string"==typeof y&&(y={direction:y,animate:!0});var C=y.direction||"forward",H=y.steps||c.length;if(!h.execution){h.execution=!0;var M=c.filter(":first").outerWidth()*H,E=c.length;if("forward"==C){var K=c.filter(":last").nextAll(":lt("+
H+")");H=K.length;K=K.filter(":last");H&&(c.removeClass("visible"),K.prevAll(":lt("+(E-1)+")").addClass("visible"),K.addClass("visible"))}else K=c.filter(":first").prevAll(":lt("+H+")"),H=K.length,K=K.filter(":last"),H&&(c.removeClass("visible"),K.nextAll(":lt("+(E-1)+")").addClass("visible").show(),K.addClass("visible"));c=a("li.visible",b);E=b.position().left;"forward"==C?(H=q-m-u,E-=M,E=E>-H?E:-H):(E+=M,E=E<u?E:u);y.animate?b.animate({left:E},g.duration,A):(b.css({left:E}),A())}}var b=k.find(g.photoStream),
c=a("li.visible",b),f=a("li",b),m=c.filter(":first").outerWidth()*c.length,q=f.filter(":first").outerWidth()*f.length,p=f.filter(":first").outerHeight();b.parent().css({overflow:"hidden",height:p,position:"relative",padding:"4px 0",margin:0,width:m});p=b.find("li:first");var t=c.filter(":first"),u=(t.outerWidth()-t.width())/2,x=0,B=p.outerWidth();for(t=t.get(0);p.length&&p.get(0)!=t;)x+=B,p=p.next();b.css({position:"absolute",left:-(x-u),width:q});a(g.forwardLink).click(function(){h("forward");return!1});
a(g.backwardLink).click(function(){h("backward");return!1});k.bind("append prepend",function(y,A){if("append"==y.type){for(var C=b.find("li:last"),H=a();C.hasClass("dummy");)H=H.add(C),C=C.prev("li");H.remove();b.append(A)}else{C=a("<div></div>").html(A);A=C.find("li");var M=A.length*B;C.remove();C=b.find("li:first");for(H=a();C.hasClass("dummy");)H=H.add(C),C=C.next("li");H.remove();b.prepend(A)}f=b.find("li");q=f.filter(":first").outerWidth()*f.length;b.css("width",q);"prepend"==y.type&&(b.is(":animated")&&
b.stop(!1,!0),b.css("left",parseInt(b.css("left"))-M));b.find("li.selected").hasClass("visible")&&k.trigger("home",[null,!1])});k.bind("forward backward",function(y,A){h({direction:y.type,steps:A.steps,animate:"undefined"!==typeof A.animate?A.animate:!0,fn:A.fn});A=b.find("li.selected");y="forward"==y.type?A.next("li:not(.dummy)"):A.prev("li:not(.dummy)");y.length&&(A.removeClass("selected"),y.addClass("selected"))});k.bind("home",function(y,A,C){y=parseInt(c.length/2);y=c.filter(":eq("+y+")");var H=
y.nextAll(".selected:first"),M=y.prevAll(".selected:first"),E=0,K="";"function"!==typeof A&&(C=A);C="undefined"!==typeof C?C:!0;H.length?(K="forward",y.nextAll().each(function(){++E;if(a(this).hasClass("selected"))return!1})):M.length&&(K="backward",y.prevAll().each(function(){++E;if(a(this).hasClass("selected"))return!1}));K&&E?h({direction:K,steps:E,fn:A,animate:C}):"function"==typeof A&&A();return!1})})()}})(jQuery);(function(a){a.storage=new a.store;a.photos={namespace:".photos",load_from_hash:0,hash:"",raw_hash:"",options:{},shift_next:!1,anchor:"",album:null,total_count:null,photos_per_page:null,list_template:"template-photo-thumbs",photo_list_string:{},init:function(e){"undefined"!=typeof a.History&&(a.History.bind(function(){a.photos.dispatch()}),a.History.unbind=function(g,k){k?a.History.handlers.specific[g]&&a.each(a.History.handlers.specific[g],function(h,b){if(b===k)return a.History.handlers.specific[g].splice(h,
1),!1}):(k=g,a.each(a.History.handlers.generic,function(h,b){if(b===k)return a.History.handlers.generic.splice(h,1),!1}))},a.History.one=function(g,k){k||(k=g,g=null);var h=function(){k.call(this);a.History.unbind.apply(a.History,g?[g,h]:[h])};a.History.bind.apply(a.History,g?[g,h]:[h])});a.wa.errorHandler=function(g){a.storage.del("photos/hash");return 403===g.status?(a("#content").html('<div class="content left'+a.photos_sidebar.width+'px"><div class="block double-padded">'+g.responseText+"</div></div>"),
!1):a.photos.load_from_hash?(a.wa.setHash("#/"),!1):!0};this.options=e;(e=window.location.hash||a.storage.get("photos/hash"))&&e!=window.location.hash?(this.load_from_hash=2,a.wa.setHash("#/"+e)):this.dispatch();this.container=a("#content");this.containerWidth=this.container.width();this.containerHeight=this.container.height();a(document).on("close",function(g){a(g.target).hide()})},dispatch:function(e){if(a.photos.ignore_dispatch)a.photos.ignore_dispatch--;else if(a.photos.hash="",void 0==e&&(e=
window.location.hash),e=e.replace(/^[^#]*#\/*/,""),a.photos.raw_hash=e)if(e=e.split("/"),e[0]){for(var g="",k=e.length,h=0;h<e.length;h++){var b=e[h];if(2>h)if(0===h)g=b;else if("tag"==g||"search"==g||"plugins"==g||"pages"==g||"app"==g){k=h;break}else if(parseInt(b,10)!=b&&-1==b.indexOf("="))g+=b.substr(0,1).toUpperCase()+b.substr(1);else{k=h;break}else{k=h;break}}k=e.slice(k);a.photos.hash="/"+e.slice(0,2).join("/");~a.photos.hash.indexOf("photo")&&(a.photos.hash="");this.beforeAnyAction(g,k);this[g+
"Action"]?(this.load_from_hash&&this.load_from_hash--,this[g+"Action"].apply(this,k),a.storage.set("photos/hash",a.photos.hash)):(a.storage.del("photos/hash"),console&&console.log("Invalid action name:",g+"Action"))}else this.beforeAnyAction(),this.defaultAction();else this.beforeAnyAction(),this.defaultAction()},ignore_dispatch:0,forceHash:function(e){e!=window.location.hash&&(a.photos.ignore_dispatch=1,window.location.hash=e)},menu:{stack:{list:[],photo:[]},extend_stack:{list:[],photo:[]},register:function(e,
g,k){this.stack[e]&&this.stack[e].push(new ToolbarMenu(g,k))},get:function(e,g){if(this.stack[e]&&a.isArray(this.stack[e]))for(var k=0;k<this.stack[e].length;k++)if(this.stack[e][k].is(g))return this.stack[e][k];return null},init:function(e){var g;if(this.stack[e]){for(;g=this.extend_stack[e].shift();)for(var k=0;k<this.stack[e].length;k++)if(this.stack[e][k].is(g.selector)){for(var h in g.actions)this.stack[e][k].setAction(h,g.actions[h]);break}for(k=0;k<this.stack[e].length;k++)this.stack[e][k].init()}},
enable:function(e,g,k){g=g||"*";if(this.stack[e])for(var h=0;h<this.stack[e].length;h++){var b=this.stack[e][h];g&&!b.is(g)||b.enable(k)}},disable:function(e,g,k){g=g||"*";if(this.stack[e])for(var h=0;h<this.stack[e].length;h++){var b=this.stack[e][h];g&&!b.is(g)||b.disable(k)}},extend:function(e,g,k){this.stack[e]&&this.extend_stack[e].push({selector:g,actions:k});return this}},setOption:function(e,g){this.options[e]=g},getOption:function(e){return this.options[e]},beforeAnyAction:function(){},initClearance:function(){a.photos.removeHeaderToolbar();
a.photos.toggleFullScreen();a.photos.highlightSidebarItem();a.photos.hotkey_manager.unset();a.photos.unsetLazyLoad();a.photos.photo_stream_cache.clear();a.photos.photo_stack_cache.clear();delete a.photos.photo_stream_cache.hash},defaultAction:function(){window.location.hash||!a("#album-list ul li.dr").length?(a.storage.set("photos/hash","photos/"),this.photosAction()):(a.storage.set("photos/hash","albums/"),this.albumsAction())},photosAction:function(){a.photos.loadDispatch(arguments,function(){a.photos.load("?module=photo&action=list",
a.photos.onLoadPhotoList)})},albumsAction:function(){a.photos.loadDispatch(arguments,function(){a.photos.load("?action=albums")})},albumAction:function(e){a.photos.loadDispatch(arguments,function(){a.photos.load("?module=album&action=photos&id="+e,a.photos.onLoadPhotoList)})},searchAction:function(e){a.photos.loadDispatch(arguments,function(){a.photos.load("?module=search&action=photos",{q:e},a.photos.onLoadPhotoList)})},tagAction:function(e){a.photos.loadDispatch(arguments,function(){a.photos.load("?module=tag&action=photos&tag="+
e,a.photos.onLoadPhotoList)})},appAction:function(e){console.log("unused method");a.photos.loadDispatch(arguments,function(){a.photos.load("?module=photo&action=list&app_id="+e,a.photos.onLoadPhotoList)})},settingsAction:function(){a.photos.initClearance();a.photos.load("?module=settings",a.photos.onLoadSettings)},pagesAction:function(e){a("#wa-page-container").length?waLoadPage(e):(a.photos.initClearance(),a.photos.load("?module=pages",a.photos.onLoadPages,""))},designAction:function(e){a.photos.initClearance();
e?a("#wa-design-container").length?(a.photos.setTitle($_("Themes")),a.photos.scrollTop(),waDesignLoad()):a.photos.load("?module=design",function(){waDesignLoad(e);a.photos.setTitle($_("Themes"));a.photos.scrollTop()}):a.photos.load("?module=design",function(){waDesignLoad("");a.photos.setTitle($_("Design"));a.photos.scrollTop()})},designThemesAction:function(e){a.photos.initClearance();a("#wa-design-container").length?(a.photos.setTitle($_("Themes")),a.photos.scrollTop(),waDesignLoad()):a.photos.load("?module=design",
function(){waDesignLoad();a.photos.setTitle($_("Themes"));a.photos.scrollTop()},"")},pluginsAction:function(e){a.photos.initClearance();a("#js-app-sidebar li.selected").removeClass("selected");a("#js-app-sidebar #sidebar-plugins").addClass("selected");a("#wa-plugins-container").length?a.plugins.dispatch("#/plugins/"+e):a.photos.load("?module=plugins")},photoAction:function(e){a.photos.loadPhoto(e)},loadDispatch:function(e,g){for(var k=Array.prototype.slice.call(e,1),h=0;h<k.length;h++)if("photo"===
k[h]&&h<k.length-1){this.loadPhoto(k[h+1]);return}"function"==typeof g&&g(e[0]);a.photos.initClearance()},onLoadSettings:function(){a.photos.setTitle($_("Settings"));a.photos.scrollTop()},onLoadPlugins:function k(g){a.photos.setTitle($_("Plugins"));a("#plugins-settings-form").submit(function(){a("#plugins-settings-form-status").fadeIn(400);a("#plugins-settings-iframe").one("load",function(){var h=a.parseJSON(a(this).contents().find("body").html());a("#plugins-settings-form-status").fadeOut(200,function(){"ok"==
h.status?a.photos.loadPluginSettings(g,k):(a("#plugins-settings-form-status").html(h.errors?h.errors:h).css("color","red"),a("#plugins-settings-form-status").fadeIn("slow"))})})});a.photos.scrollTop()},onLoadPages:function(){a.photos.setTitle($_("Pages"));a.photos.scrollTop()},renderPhotoList:function(){var g=a("#photo-list");g.empty();a.photos.renderPhotoListChunk(g,0);a.photos.photo_stream_cache.length()&&(!a.photos.total_count||a.photos.total_count>a.photos.photo_stream_cache.length())&&a.photos.setLazyLoad()},
removeHeaderToolbar:function(){var g=a("#p-toolbar.rendered");g.length&&g.closest("#wa-header").removeClass("has-toolbar").end().remove()},renderPhotoListChunk:function(g,k,h,b){var c=a.photos.options.photo_list_render_chunk||10,f=a.photos.photo_stream_cache.length();h=h||{};h.hide_name||(h.hide_name=a.storage.get("photos/list/hide_name",!1));c=a.photos.photo_stream_cache.slice(k,k+=c);c={photos:c,hash:a.photos.hash,last_login_time:a.photos.options.last_login_time,options:h,selected:!!a("#selector-menu").find("[data-action=select-photos]").data("checked"),
view:(a.photos.list_template||"").replace("template-photo-","")};g.append(tmpl(a.photos.list_template,c));a("#content").trigger("photos_list_chunk_render",[c]);if(k<f)setTimeout(function(){a.photos.renderPhotoListChunk(g,k,h,b)},100);else if("function"==typeof b&&b(),c=h.string||a.photos.photo_list_string||!1)a(".lazyloading-wrapper").html(tmpl("template-photo-counter",{count:f,total_count:a.photos.total_count,string:c})),a.photos.photo_list_string=c},selectPhotoListView:function(g){g=g.replace(/-view$/,
"");a.photos.list_template="template-photo-"+g;var k=a.photos.getAlbum();k&&("thumbs"==g?a.storage.del("photos/list/view/"+k.id):a.storage.set("photos/list/view/"+k.id,g));a.photos.menu.enable("list","."+g+"-view-menu");a.photos.menu.disable("list",":not(."+g+"-view-menu)");k=a("#photo-list");k.removeClass(k.attr("class"));switch(g){case "thumbs":k.addClass("thumbs li300px");break;case "descriptions":k.addClass("p-descriptions")}a("#js-photos-view-toggle .selected").removeClass("selected");a('#js-photos-view-toggle [data-action="'+
g+'-view"]').addClass("selected");a(".js-toolbar-dropdown").toggleClass("is-descriptions","descriptions"===g)},onLoadPhotoList:function(){var g=a.photos.getAlbum(),k=null;if(g){k=a.storage.get("photos/list/view/"+g.id);"thumbs"!=k&&"descriptions"!=k&&(k="thumbs");var h=a("#album-list li[rel="+g.id+"]"),b=h.find(".count:first");b.text(g.count);0==g.status&&b.prepend('<span class="hint"><i class="fas fa-lock"></i></span>&nbsp;');h.find(".count-new:first").text("");a("#album-list-container").trigger("uncollapse_section",
h);if(g.edit_rights)a("#photo-list, .js-photo-list").on("click",".make-key-photo-link",function(){a("#photo-list .key-photo").removeClass("key-photo");var c=a(this).closest("li").addClass("key-photo");g.key_photo_id=c.data("photo-id");a.post("?module=album&action=keyPhoto",{album_id:g.id,photo_id:g.key_photo_id})})}k||(k="thumbs");a("#template-photo-"+k).length?(a.photos.list_template="template-photo-"+k,a.photos.renderPhotoList(),a.photos.setTitle(a("#photo-list-name").text()),a.photos.menu.init("list"),
a.photos.selectPhotoListView(k),a("#js-photos-view-toggle").waToggle({change:function(c,f,m){c=a(f).attr("data-action");c!==k&&(k=c.replace(/-view$/,""),a.photos.list_template="template-photo-"+k,a.photos.renderPhotoList(),a.photos.selectPhotoListView(k))}}),a("#photo-list .js-description div, .js-description-editable").on("click",function(){a(this);a(this).height();var c=$_("add description");a(this).inlineEditable({inputType:"textarea",makeReadableBy:["esc"],updateBy:["ctrl+enter"],placeholder:c,
placeholderClass:"gray",minSize:{height:40},html:!1,allowEmpty:!0,beforeMakeEditable:function(f){var m=a(this),q=m.parent().find(".full-description:first").html(),p=m.css("font-size"),t=m.css("line-height");f.css({"font-size":p,"line-height":t,"max-width":"100%"});m.html(q);q=Math.max(m.parents("li:first").find("img").width(),m.width());f.width(q);q=this.id+"-button";p=a("#"+q);p.length||(f.after('<input class="button smallest" type="button" id="'+q+'" value="'+$_("Save")+'"> <em class="hint" id="'+
this.id+'-hint">Ctrl+Enter</em>'),a("#"+q).on("click",function(){m.trigger("readable")}));a("#"+this.id+"-hint").show();p.show()},afterBackReadable:function(f,m){var q=a("#"+(this.id+"-button")),p=a(this);f=a(f).val();var t=p.parents("li:first").find(".p-image").attr("data-href");t=/(\d+)[\/]*$/.exec(t);var u=null;q.hide();a("#"+this.id+"-hint").hide();f?p.parent().find(".js-full-description:first").text(f).html():p.parent().find(".js-full-description:first").html("");t&&m.changed&&(u=t[1],a.photos.saveField({id:u,
type:"photo",name:"description",value:f,fn:function(){}}))},hold:function(){return!this.hasClass("editable")}}).trigger("editable")}),h=a("#photo-list-name"),h.hasClass("editable")&&h.inlineEditable({minSize:{width:350},maxSize:{width:600},size:{height:30},afterBackReadable:function(c,f){if(!f.changed)return!1;c=a(c).val();(f=a.photos.getAlbum())&&a.photos.saveField({id:f.id,type:"album",name:"name",value:c,fn:function(m){"ok"==m.status&&(m=m.data.album,a("#album-list li[rel="+m.id+"] > a > .album-name").html(m.name),
a("#p-upload-step2 select[name=album_id] option[value="+m.id+"]").html(m.name),a.photos.setTitle(m.not_escaped_name))}})},hold:function(){return!this.hasClass("editable")}}),h=a("#photo-album-note"),h.hasClass("editable")&&h.inlineEditable({placeholder:"("+$_("subtitle")+")",placeholderClass:"gray",minSize:{width:150},maxSize:{width:250},size:{height:22},afterBackReadable:function(c,f){if(!f.changed)return!1;c=a(c).val();(f=a.photos.getAlbum())&&a.photos.saveField({id:f.id,type:"album",name:"note",
value:c})},hold:function(){return!this.hasClass("editable")}}),a(".js-toolbar-dropdown-button").on("recount",function(){var c=a("#photo-list > li.selected").length,f=a(this).find(".js-count");0<c?f.text(c).show():f.hide()}),a("#p-album-settings").click(function(){var c=a.photos.getAlbum(),f=c?c.id:0;c=a("#album-settings-dialog-acceptor");c.length||(c=a("<div id='album-settings-dialog-acceptor'></div>"),a("body").append(c));c.load("?module=dialog&action=albumSettings&id="+f,function(){a.waDialog({html:a("#album-settings-dialog"),
onOpen:function(m,q){var p=m.find("form");p.find(".js-privacy-settings-link").on("click",function(){a(window).resize()});p.on("submit",function(t){t.preventDefault();m.trigger("change_loading_status",!0);a.post(p.attr("action"),p.serializeArray(),function(u){if("ok"==u.status){var x=function(H){a.post("?module=album&action=savePhotosAccess",H,function(){H.offset+=C;H.offset<=B?x(H):(m.trigger("change_loading_status",!1),location.reload())})},B=u.data.total_count,y=u.data.status,A=u.data.groups,C=
u.data.count;u=C;C<B?x({id:f,status:y,groups:A,count:C,offset:u}):(m.trigger("change_loading_status",!1),location.reload())}else if("fail"==u.status)for(y in m.trigger("change_loading_status",!1),u=u.errors,u)u.hasOwnProperty(y)&&m.find("input[name="+y+"]").addClass("error").parent().find(".errormsg").text(u[y])},"json")})}})});return!1}),a("#photo-list").find(".p-description textarea, .p-photo-details textarea, .p-photo-details input").on("select",function(){return!1}),a.photos.hotkey_manager.set("rate"),
a.photos.hash!=a.photos.photo_stream_cache.hash&&a.photos.scrollTop(),a("#content").trigger("photos_list_load"),a("#photo-list").find("li.highlighted").length?a(".i-product-review-widget-wrappper").show():a(".i-product-review-widget-wrappper").hide()):(a("#content").empty(),a.wa.setHash("#/"))},loadPhoto:function(g){if(a.photos.photo_stream_cache.hash!==a.photos.hash)a.photos.loadNewPhoto(g);else{var k=a.photos.photo_stream_cache.getById(g);if(!k||0<k.stack_count)if(g=a.photos.photo_stack_cache.getById(g)){this.setTitle(g.name);
a.photos.loadPhotoInStack(g);return}k&&(a.photos.setTitle(k.name),a.photos.loadPhotoCompletly(k))}},loadPhotoInStack:function h(k){a.photos.abortPrevLoading();a.photos.hooks_manager.trigger("beforeLoadPhoto",k);a.photos.photo_stack_cache.setCurrent(k);var b=a.photos._chooseProperThumb(k),c=a("#photo");c.smallSize=k.width<this.containerWidth&&k.height<this.containerHeight;c.proper_thumb={url:b.url+(k.edit_datetime?"?"+Date.parseISO(k.edit_datetime):""),url2x:b.url2x+(k.edit_datetime?"?"+Date.parseISO(k.edit_datetime):
"")};replaceImg(c,b.url+(k.edit_datetime?"?"+Date.parseISO(k.edit_datetime):""),null);k.thumb_big.size.width<k.width||k.thumb_big.size.height<k.height?c.addClass("contain"):c.removeClass("contain");c.on("load",function(){a(this).addClass("fade-in");a(this).on("animationend",function(){a(this).removeClass("fade-in")})});a.photos.setNextPhotoLink();k=a.post("?module=photo&action=load",{id:k.id,in_stack:1},function(f){f=f.data;var m=f.photo;m=a.photos.photo_stack_cache.updateById(m.id,m);f.photo=m;a.photos.updateViewChildPhoto(f);
a.photos.hooks_manager.trigger("afterLoadPhoto",{first:f.photo_stream.photos[0].id===m.id,last:f.photo_stream.photos[f.photo_stream.photos.length-1].id===m.id});delete h.xhr},"json");h.xhr=k},updateViewChildPhoto:function(k){var h=k.author,b=k.albums,c=k.exif,f=k.photo;a.photos.renderPhotoImg(f);a("#photo-author").html(tmpl("template-photo-author",{photo:f,author:h}));a.photos.updatePhotoOriginalBlock(f);c.length&&(a("#photo-exif").html(tmpl("template-photo-exif",{exif:c})),a.photos.renderMap(c.GPSLatitude,
c.GPSLongitude,f.name));a("#photo-albums").html(tmpl("template-photo-albums",{albums:b}));a.photos.initPhotoContentControlWidget({frontend_link_template:k.frontend_link_template,photo:f});a.photos.updatePhotoName(f.name,f.edit_rights);a.photos.initPhotoStackWidgetActiveItem(f.index)},loadNewPhoto:function b(h){a.photos.initClearance();a.photos.widget.loupe.init();b.xhr_map=b.xhr_map||{};b.xhr_map[h]&&b.xhr_map[h].abort();b.xhr_map[h]=a.post("?module=photo&action=load",{id:h,hash:a.photos.hash},function(c){b.xhr_map[h]=
null;c=c.data;var f=c.photo;a.photos.renderViewPhoto(c);var m=a.photos.photo_stream_cache.getNext(f);m&&a.photos.preloadPhoto(m);(f=a.photos.photo_stream_cache.getPrev(f))&&a.photos.preloadPhotoPrev(f);c.album&&a.photos.setAlbum(c.album);a.photos.updateViewPhoto(c,!1);a.photos.hooks_manager.trigger("afterLoadPhoto",{first:c.photo_stream.photos[0].id===h,last:c.photo_stream.photos[c.photo_stream.photos.length-1].id===h})},"json")},renderViewPhoto:function(h){var b=h.photo,c=h.author,f=h.exif,m=h.stack,
q=h.albums,p=h.album,t=h.hooks,u=h.frontend_link_template;h=h.photo_stream;var x=h.in_collection;a.photos.photo_stream_cache.set(h.photos);var B=!1;if(p&&!x)if(p.type!=Album.TYPE_STATIC||m)B=!0;else{a.photos.goToHash("album/"+p.id+"/");return}a.photos.setTitle(b.name_not_escaped);a("#content").html(tmpl("template-p-block"));a.photos.renderPhotoBlock({photo:b,hash:a.photos.hash,author:c,exif:f,albums:q,hooks:t,frontend_link_template:u});a.photos.initPhotoToolbar({photo:b,stack:m,hash:a.photos.hash});
a.photos.initPhotoWidgets({photo:b,stack:m,exif:f,photo_stream:h,hash:a.photos.hash});a.photos.anchor?(a.photos.goToAnchor(a.photos.anchor),a.photos.anchor=""):a.photos.scrollTop();a("#p-warning-not-in-album").hide();B?(a("#p-warning-not-in-album").show(),a.photos.setNextPhotoLink(a.photos.photo_stream_cache.getCurrent())):a.photos.setNextPhotoLink()},loadPhotoCompletly:function(h){a.photos.photo_stream_cache.setCurrent(h);a.photos.updatePhotoStreamWidget({shift:h.id,fn:function(){a.photos._loadPhotoCompletly(h)}})},
_loadPhotoCompletly:function c(b){a.photos.abortPrevLoading();a.photos.hooks_manager.trigger("beforeLoadPhoto",b);a("#p-warning-not-in-album").hide();a.photos.setNextPhotoLink();a.photos.updatePhotoName(b.name);a.photos.updatePhotoDescription(b.description);a.photos.updatePhotoRate(b.rate);a("#photo-frontend-url").html(b.url);a("#stack-stream").hide();a("#photo-hook-bottom").html("");var f=a.photos.isPhotoPreloaded(b),m=a.photos.isPrevPhotoPreloaded(b);if(f||m)a.photos.renderPhotoImg(b,f,m);else{m=
a.photos._chooseProperThumb(b);var q=a("#photo");q.smallSize=b.width<this.containerWidth&&b.height<this.containerHeight;q.proper_thumb={url:m.url+(b.edit_datetime?"?"+Date.parseISO(b.edit_datetime):""),url2x:m.url2x+(b.edit_datetime?"?"+Date.parseISO(b.edit_datetime):"")};replaceImg(q,m.url+(b.edit_datetime?"?"+Date.parseISO(b.edit_datetime):""),function(){b.thumb_big.size.width<b.width||b.thumb_big.size.height<b.height?q.addClass("contain"):q.removeClass("contain");var p=a.photos.photo_stack_cache.getPrev(b),
t=a.photos.photo_stack_cache.getNext(b);if(p||t)q.on("load",function(){a(this).addClass("fade-in");a(this).on("animationend",function(){a(this).removeClass("fade-in")})})})}a.photos.updatePhotoTags(b.tags);(m=a.photos.photo_stream_cache.getNext())&&a.photos.preloadPhoto(m);(m=a.photos.photo_stream_cache.getPrev())&&a.photos.preloadPhotoPrev(m);m=a.post("?module=photo&action=load",{id:b.id,hash:a.photos.hash},function(p){if("ok"==p.status){p=p.data;var t=p.album,u=p.photo,x=p.photo_stream.in_collection,
B=!1;if(t&&!x){if(t.type==Album.TYPE_STATIC){a.photos.goToHash("album/"+t.id+"/");return}B=!0}B?(a("#p-warning-not-in-album").show(),a.photos.setNextPhotoLink(a.photos.photo_stream_cache.getCurrent())):a.photos.setNextPhotoLink();u=a.photos.photo_stream_cache.updateById(u.id,u);p.photo=u;a.photos.updateViewPhoto(p,f);a.photos.hooks_manager.trigger("afterLoadPhoto",{first:p.photo_stream.photos[0].id===u.id,last:p.photo_stream.photos[p.photo_stream.photos.length-1].id===u.id});delete c.xhr}},"json");
c.xhr=m},updateViewPhoto:function(b,c){var f=b.author,m=b.albums,q=b.exif,p=b.frontend_link_template,t=b.hooks,u=b.stack;b=b.photo;c||a.photos.renderPhotoImg(b);a.photos.updateViewPhotoMenu(0!=b.parent_id||0<b.stack_count,b.edit_rights);a.photos.updatePhotoName(b.name,b.edit_rights);a.photos.updatePhotoDescription(b.description,b.edit_rights);a.photos.updatePhotoRate(b.rate,b.edit_rights);a.photos.updatePhotoTags(b.tags);a("#photo-author").html(tmpl("template-photo-author",{photo:b,author:f}));a.photos.updatePhotoOriginalBlock(b);
a("#photo-exif").html(tmpl("template-photo-exif",{exif:q}));a.photos.renderMap(q.GPSLatitude,q.GPSLongitude,b.name);a("#photo-albums").html(tmpl("template-photo-albums",{albums:m}));a.photos.initPhotoContentControlWidget({frontend_link_template:p,photo:b});u?(a("#stack-stream").html(tmpl("template-photo-stack",{stack:u,photo_id:b.id,hash:a.photos.hash})).show(),a.photos.photo_stack_cache.set(u),a.photos.initPhotoStackWidget()):a.photos.photo_stack_cache.clear();c="";for(var x in t.backend_photo)t.backend_photo[x].bottom&&
(c+=t.backend_photo[x].bottom);a("#photo-hook-bottom").html(c);c="";for(x in t.backend_photo)t.backend_photo[x].after_rate&&(c+=t.backend_photo[x].after_rate);c&&(a("#photo-rate").nextAll().remove(),a("#photo-rate").after(c));a.photos.anchor&&(a.photos.goToAnchor(a.photos.anchor),a.photos.anchor="")},renderPhotoImg:function(b,c,f){var m=a.photos._chooseProperThumb(b),q=a("#photo");q.smallSize=b.width<this.containerWidth&&b.height<this.containerHeight;q.proper_thumb={url:m.url+(b.edit_datetime?"?"+
Date.parseISO(b.edit_datetime):""),url2x:m.url2x+(b.edit_datetime?"?"+Date.parseISO(b.edit_datetime):"")};replaceImg(q,m.url+(b.edit_datetime?"?"+Date.parseISO(b.edit_datetime):""),function(){b.thumb_big.size.width<b.width||b.thumb_big.size.height<b.height?q.addClass("contain"):q.removeClass("contain");if(c||f)q.on("load",function(){a(this).addClass("fade-in");a(this).on("animationend",function(){a(this).removeClass("fade-in")})});a.photos.hooks_manager.trigger("afterRenderImg",this,b,m)})},updateViewPhotoMenu:function(b,
c){b?a.photos.menu.enable("photo","#photo-organize-menu","unstack"):a.photos.menu.disable("photo","#photo-organize-menu","unstack");c?(a.photos.menu.enable("photo","#photo-organize-menu"),a.photos.menu.enable("photo","#edit-menu")):(a.photos.menu.disable("photo","#photo-organize-menu"),a.photos.menu.disable("photo","#edit-menu"))},preloadPhoto:function(b){var c=a("#preload-photo");c.attr("data-photo-id","");c.smallSize=b.width<this.containerWidth&&b.height<this.containerHeight;replaceImg(c,b.thumb_big.url,
function(){c.attr("data-photo-id",b.id)})},preloadPhotoPrev:function(b){var c=a("#preload-photo-prev");c.attr("data-photo-id","");c.smallSize=b.width<this.containerWidth&&b.height<this.containerHeight;replaceImg(c,b.thumb_big.url,function(){c.attr("data-photo-id",b.id)})},isPhotoPreloaded:function(b){return a("#preload-photo").attr("data-photo-id")==b.id},isPrevPhotoPreloaded:function(b){return a("#preload-photo-prev").attr("data-photo-id")==b.id},abortPrevLoading:function(){"object"===typeof a.photos._loadPhotoCompletly.xhr&&
"function"===typeof a.photos._loadPhotoCompletly.xhr.abort&&(a.photos._loadPhotoCompletly.xhr.abort(),a.photos.hooks_manager.trigger("onAbortPrevLoading"));"object"===typeof a.photos.loadPhotoInStack.xhr&&"function"===typeof a.photos.loadPhotoInStack.xhr.abort&&(a.photos.loadPhotoInStack.xhr.abort(),a.photos.hooks_manager.trigger("onAbortPrevLoading"))},updateThumbRate:function(b,c){b=b.find(".p-details .p-rate");(c=Math.round(2*c)/2)?(b.find("svg").removeClass("fa-star-half text-yellow").addClass("text-light-gray").each(function(f){f+=
1;f>c?.5==f-c&&a(this).addClass("fa-star-half").removeClass("text-light-gray").addClass("text-yellow"):a(this).removeClass("fa-star-half").removeClass("text-light-gray").addClass("text-yellow");a(this).attr("data-rate-value",f)}),b.show()):b.hide()},showManageAccessDialog:function(b,c){var f=a("#manage-access-dialog-acceptor"),m="?module=dialog&action=manageAccess";f.length||(f=a("<div id='manage-access-dialog-acceptor'></div>"),a("body").append(f));if(b)if(a.isArray(b))for(var q=0,p=b.length;q<p;++q){var t=
b[q];m+="&"+t.name+"="+t.value}else m+="&"+b;f.load(m,function(){a.waDialog({$wrapper:a("#manage-access-dialog"),onOpen:function(u,x){var B=u.find("form");B.find(".js-privacy-settings-link").on("click",function(){a(window).resize()});B.on("submit",function(y){y.preventDefault();c(u,x)})}})})},initPhotoNameWidget:function(b){b="undefined"===typeof b?!1:b;a("#photo-name").inlineEditable({placeholder:a("#photo-name").text()?null:$_("Edit title..."),placeholderClass:"gray",html:!1,afterBackReadable:function(c,
f){f.changed&&(c=a(c).val(),c.length&&a.photos.saveField({id:a.photos.getPhotoId(),type:"photo",name:"name",value:c.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;"),fn:function(m){a("#photo-name").inlineEditable("setOption",{placeholder:null});"ok"==m.status&&a.photos.setTitle(m.data.value)}}))},minSize:{width:350},maxSize:{width:600},size:{height:30},hold:function(){return!this.hasClass("editable")}});a.photos.updatePhotoName(b)},initPhotoDescriptionWidget:function(b){b=
"undefined"===typeof b?!1:b;a("#photo-description").inlineEditable({placeholder:$_("add description"),placeholderClass:"gray",makeReadableBy:["esc"],updateBy:["ctrl+enter"],html:!1,allowEmpty:!0,beforeMakeEditable:function(c){var f=a("#photo-description-save");if(!f.length){var m=a(this);c.after('<input type="button" id="photo-description-save" class="button smallest" value="'+$_("Save")+'"> <em class="hint" id="'+this.id+'-hint">Ctrl+Enter</em>');f=a("#photo-description-save");f.click(function(){m.trigger("readable")})}a("#"+
this.id+"-hint").show();f.show().prev("br").show()},afterBackReadable:function(c,f){a("#photo-description-save").hide().prev("br").hide();a("#"+this.id+"-hint").hide();if(!f.changed)return!1;a(c).val();a.photos.saveField({id:a.photos.photo_stream_cache.getCurrent().id,type:"photo",name:"description",value:a(c).val().replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;"),fn:function(){}})},minSize:{height:50,width:600},size:{width:a("#photo").width()},inputType:"textarea",
editLink:"#photo-description-edit-link",hold:function(){return!this.hasClass("editable")}});a.photos.updatePhotoDescription(b)},initPhotoRateWidget:function(b){b="undefined"===typeof b?!1:b;a("#photo-rate").rateWidget({onUpdate:function(c){a.photos.saveField(a.photos.photo_stream_cache.getCurrent().id,"rate",c,function(f){"ok"==f.status&&f.data.count&&a("#rated-count").text(0<f.data.count?f.data.count:"")})},hold:function(){return this.hasClass("hold")}});a.photos.updatePhotoRate(b)},initPhotoStackWidget:function(b){"object"===
typeof b&&b&&a("#stack-stream").html(tmpl("template-photo-stack",b)).show();b=a("#stack-stream li.dr:first a").attr("href");(b=/(\d+)[\/]*$/.exec(b))&&(parent_id=b[1]);a("#stack-stream").data("parent_id",parent_id);a("#stack-stream").sortable({distance:5,helper:"clone",items:"li.dr",opacity:.75,tolerance:"pointer",onEnd:function(c){var f=a(c.item);c=parseInt(f.attr("data-photo-id"));f=f.next();var m=null;f.length&&(m=parseInt(f.attr("data-photo-id")));a.post("?module=stack&action=photoMove",{id:c,
before_id:m},function(q){if("ok"===q.status&&q.data.stack){a.photos.photo_stack_cache.set(q.data.stack).setCurrent(q.data.stack[0]);q=a.photos.photo_stream_cache.getById(parent_id);var p=a.photos.photo_stack_cache.getAll()[0];a.photos.photo_stream_cache.replace(q,p)}},"json")}});if(a("#stack-stream").data("inited"))return!1;a("#stack-stream").data("inited",!0)},initPhotoStackWidgetActiveItem:function(b){a(document).find("#stack-stream li.dr").removeClass("selected").siblings("li:nth-child("+(b+1)+
")").addClass("selected")},initPhotoTagsWidget:function(b){var c=a("#photo-tags"),f=$_("add a tag");"undefined"!==typeof b&&("object"===typeof b&&b&&(b=a.photos.joinObject(b,",")),c.importTags(b));c.data("current_value",c.val());b=a("#photos-photo-popular-tags");b.data("inited")||b.off("click.photos","a").on("click.photos","a",function(){var q=a(this).text(),p=a("#photo-tags");p.removeTag(q);p.addTag(q)}).data("inited",!0);var m=function(){c.data("current_value")!==c.val()&&(c.data("current_value",
c.val()),a("#photo-save-tags-status").html('<p class="state-success"><i class="fas fa-check-circle custom-mr-4"></i>'+$_("Saving")+"</p>").fadeIn("slow"),a.photos.assignTags({photo_id:a.photos.getPhotoId(),tags:c.val(),fn:function(){a("#photo-save-tags-status").html('<p class="state-success"><i class="fas fa-check-circle custom-mr-4"></i>'+$_("Saved")+"</p>").fadeOut("slow")},onDeniedExist:function(){alert($_("You don't have sufficient access rights"))}}))};try{c.tagsInput({autocomplete_url:"?module=tag&action=list",
width:"100%",defaultText:f,onChange:function(){},onAddTag:function(){m()},onRemoveTag:function(){m()}})}catch(q){}},initPhotoContentControlWidget:function(b){"object"===typeof b&&b?(a("#photo-content-control").html(tmpl("template-photo-content-control",b)),edit_rights=b.photo.edit_rights):edit_rights=b;edit_rights="undefined"===typeof edit_rights?!1:edit_rights;var c=a("#photo-frontend-url"),f=c.parents("li:first").find("i.new-window"),m=a("#photo-frontend-link").nextAll("span.slash:first");c.length&&
c.inlineEditable({inputType:"input",editLink:"#photo-frontend-url-edit-link",editOnItself:!1,minSize:{width:100},beforeMakeEditable:function(q){var p=a(this),t=p.text().replace(/\/$/,"");p.text(t);m.show();f.hide();q.removeClass("error");a("#photo-content-control").find(".errormsg").text("").hide()},beforeBackReadable:function(q,p){function t(){u.text(x);m.hide();f.show();a(q).removeClass("state-error");a("#photo-content-control").find(".errormsg").text("").hide()}var u=a(this),x=u.text()+"/",B=a.photos.getPhotoId(),
y=a(q).val();if(p.changed)return a.photos.saveField(B,"url",y,function(A){if("ok"==A.status){t();c.trigger("readable",!0);A=a("#photo-frontend-link");var C=A.text().trim()+"/";A.attr("href",C)}else"fail"==A.status&&(a(q).addClass("state-error"),a("#photo-content-control").find(".errormsg").text(A.errors.url).show())}),!1;t()},hold:function(){return this.hasClass("hold")}});a.photos.updatePhotoFrontendUrl(edit_rights)},renderMap:function(b,c,f){var m=this.options.map_options||{},q=function(){},p=a("#photo-map");
b&&c?(q="google"===m.type?function(){window.initPhotosGoogleMap=function(){if(window.google){p.show();var u=new google.maps.LatLng(b,c),x={zoom:11,center:u,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,zoomControlOptions:{position:google.maps.ControlPosition.TOP_LEFT,style:google.maps.ZoomControlStyle.SMALL}};x=new google.maps.Map(a("#photo-map").get(0),x);new google.maps.Marker({position:u,map:x,title:f})}else p.hide()};if(window.google)initPhotosGoogleMap();else{var t="https://maps.googleapis.com/maps/api/js?sensor=false&key=:KEY&lang=:LOCALE&callback=initPhotosGoogleMap".replace(":KEY",
m.key||"").replace(":LOCALE",m.locale||"");a.getScript(t)}}:"yandex"===m.type?function(){var t=function(){window.ymaps?ymaps.ready(function(){p.show();var x=[b,c],B=new ymaps.Map("photo-map",{center:x,zoom:11,controls:["zoomControl","fullscreenControl"]});B.setCenter(x);B.geoObjects.add(new ymaps.Placemark(x,{balloonContent:""}))}):p.hide()};if(window.ymaps)t();else{var u="https://api-maps.yandex.ru/2.1/?lang="+(m.locale||"ru_RU");m.key&&(u+="&apikey="+m.key);a.getScript(u,t)}}:function(){p.hide()},
q()):p.hide()},joinObject:function(b,c){var f="",m=0;c=c||"";for(var q in b)b.hasOwnProperty(q)&&(0<m++&&(f+=c),f+=b[q]);return f},initPhotoStreamWidget:function(b){var c=b.photos;c=[null].concat(c,[null]);a("#photo-stream").html(tmpl("template-photo-stream",{photos:c,current_photo:b.current_photo||null,hash:a.photos.hash}));var f=!1,m=!1;a("#photo-stream ul.photostream:first").photoStreamSlider({backwardLink:"#photo-stream .p-rewind",forwardLink:"#photo-stream .p-ff",photoStream:"ul",duration:400,
onForward:function p(){if(!f){var t=this,u=t.find("ul").find("li:not(.dummy)"),x=u.filter(".visible");u=u.filter(":last");15>x.filter(":last").nextAll().length&&"object"!=typeof p.xhr&&(x=u.attr("data-photo-id"),p.xhr=a.post("?module=photo&action=loadList",{id:x,direction:1,hash:a.photos.hash},function(B){if("ok"==B.status){B=B.data.photos;if(0<B.length)a.photos.photo_stream_cache.append(B);else{f=!0;return}B.push(null);t.trigger("append",tmpl("template-photo-stream-list",{photos:B}))}delete p.xhr},
"json"))}},onBackward:function t(){if(!m){var u=this,x=u.find("ul").find("li:not(.dummy)"),B=x.filter(".visible");x=x.filter(":first");15>B.filter(":first").prevAll().length&&"object"!=typeof t.xhr&&(B=x.attr("data-photo-id"),t.xhr=a.post("?module=photo&action=loadList",{id:B,direction:-1,hash:a.photos.hash},function(y){if("ok"==y.status){y=y.data.photos;if(0<y.length)a.photos.photo_stream_cache.prepend(y);else{m=!0;return}y.unshift(null);u.trigger("prepend",tmpl("template-photo-stream-list",{photos:y}))}delete t.xhr},
"json"))}}})},updatePhotoStreamWidget:function(b){var c=a("#photo-stream ul.photostream:first");if(b.current_photo){var f=c.find("li.selected"),m=b.current_photo;f.attr("data-photo-id",m.id);f.find("a").attr("href","#/photo/"+m.id);f.find("img").attr("src",m.thumb_crop.url)}b.shift&&(c.find("li.selected").removeClass("selected"),c.trigger("home",[b.fn||function(){},!a.photos.shift_next]),a.photos.shift_next=!1)},updatePhotoName:function(b,c){if("boolean"===typeof b||"undefined"===typeof b)c=b,b=null;
var f=a("#photo-name");null!==b&&f.html(b);c?f.addClass("editable"):f.removeClass("editable")},updatePhotoDescription:function(b,c){if("boolean"===typeof b||"undefined"===typeof b)c=b,b=a("#photo-description").html();var f=a("#photo-description"),m=$_("add description");c?(f.addClass("editable"),c=m,a("#photo-description-edit-link").show()):(c=null,b=b!==m?b:"",f.removeClass("editable"),a("#photo-description-edit-link").hide());f.inlineEditable("setOption",{placeholder:c}).html(b).trigger("placeholder",
!!c)},updatePhotoRate:function(b,c){if("boolean"===typeof b||"undefined"===typeof b)c=b,b=null;var f=a("#photo-rate");null!==b&&f.rateWidget("setOption","rate",b);c?f.removeClass("hold").show():(f.addClass("hold"),(b=f.rateWidget("getOption","rate"))||f.hide())},updatePhotoTags:function(b){var c=a(".js-photos-tags");c.data("current_value",c.val());"undefined"!==typeof b&&("object"===typeof b&&b&&(b=a.photos.joinObject(b,",")),c.importTags(b))},updatePhotoFrontendUrl:function(b){var c=a("#photo-frontend-url");
b?(c.removeClass("hold"),a("#photo-frontend-url-edit-link").show()):(c.addClass("hold"),a("#photo-frontend-url-edit-link").hide())},updatePhotoOriginalBlock:function(b){a("#photo-original").html(tmpl("template-photo-original",{photo:b}))},initPhotoToolbar:function(b){var c=a("#p-toolbar");c.html(tmpl("template-photo-toolbar",b)).addClass("rendered");c.closest("#wa-header").addClass("has-toolbar");a.photos.menu.init("photo");a(".js-toolbar-close").on("click",function(){a(this).closest("#wa-header").removeClass("has-toolbar").find("#p-toolbar").remove()});
a(document).on("keyup",function(f){if(27===(f.which||f.keyCode||0)){f=a("#wa-header").find("#p-toolbar");var m=a(".dialog-opened").length;f.length&&!m&&(f=a(".js-toolbar-close"),m=f.attr("href"),f.trigger("click"),a.wa.setHash(m))}});a.photos.menu.init("photo");a.photos.updateViewPhotoMenu(a.isArray(b.stack)&&b.stack.length,b.photo.edit_rights);a(".js-p-toolbar-dropdown").waDropdown({hover:!0,update_title:!1,items:".menu > li > a"})},renderPhotoBlock:function(b){var c=b.photo,f=a.photos._chooseProperThumb(c);
b.smallSize=c.width<this.containerWidth&&c.height<this.containerHeight;a("#p-block").html(tmpl("template-photo",b)).addClass("rendered");a("#p-info-area").html(tmpl("template-info-area",b)).addClass("rendered");a("#p-toolbar").prependTo(a("#wa-header-content-area"));var m=a("#photo");m.smallSize=b.smallSize;m.proper_thumb={url:f.url+(c.edit_datetime?"?"+Date.parseISO(c.edit_datetime):""),url2x:f.url2x+(c.edit_datetime?"?"+Date.parseISO(c.edit_datetime):"")};replaceImg(m,f.url+(c.edit_datetime?"?"+
Date.parseISO(c.edit_datetime):""),function(){c.thumb_big.size.width<c.width||c.thumb_big.size.height<c.height?m.addClass("contain"):m.removeClass("contain");a.photos.hooks_manager.trigger("afterRenderImg",this,c,f)})},initPhotoWidgets:function(b){var c=b.photo,f=b.exif,m=b.stack;b=b.photo_stream;var q=a.photos.hash;a.photos.initPhotoNameWidget(c.edit_rights);a.photos.initPhotoDescriptionWidget(c.edit_rights);a.photos.initPhotoRateWidget(c.edit_rights);a.photos.initPhotoTagsWidget(c.tags);a.photos.initPhotoContentControlWidget(c.edit_rights);
a.photos.hotkey_manager.set();a.photos.renderMap(f.GPSLatitude,f.GPSLongitude,c.name);a.isArray(m)&&m.length&&(a.photos.photo_stack_cache.set(m).setCurrentById(c.id),a.photos.initPhotoStackWidget({stack:m,photo_id:c.id,hash:a.photos.hash}));c=a.photos.photo_stream_cache;c.hash=q;c.set(b.photos).setCurrentById(b.current_photo_id);a.photos.initPhotoStreamWidget({photos:b.photos,current_photo:c.getCurrent()});a("#p-block .p-one-photo > .p-image-nav .p-image-nav-item").on("click",function(){if(this.classList.contains("p-rewind")){var p=
a.photos.photo_stream_cache.getPrev();p&&(a.photos.goToHash(a.photos.getHashByPhotoId(p.id),!1),a.photos.shift_next=!0)}else if(p=a.photos.photo_stream_cache.getNext())a.photos.goToHash(a.photos.getHashByPhotoId(p.id),!1),a.photos.shift_next=!0})},_chooseProperThumb:function(b){return b.thumb_big},setNextPhotoLink:function(b){var c=a("#photo").parents("a:first");(b=b?b:a.photos.photo_stream_cache.getNext())?(c.attr("title",$_("Next \u2192")),c.attr("href","#"+a.photos.hash+"/photo/"+b.id+"/")):(c.attr("title",
""),c.attr("href","javascript:void(0);"))},setTitle:function(b){b&&(document.title=b+a.photos.options.title_suffix)},ignore_scrolltop:!1,scrollTop:function(){a.photos.ignore_scrolltop?a.photos.ignore_scrolltop=!1:a(document).scrollTop(0)},load:function(b,c,f,m){var q=a("#content");"function"==typeof c&&(m=f||null);m&&(q.empty().append(m),q=q.find(":last-child"));"function"==typeof c?q.load(b,c):q.load(b,c,f)},setCover:function(b){(void 0===b?0:b)?a("#full-cover").show():a("#cover").show()},unsetCover:function(b){(void 0===
b?0:b)?a("#full-cover").hide():a("#cover").hide()},saveField:function(b,c,f,m){var q="photo";1==arguments.length&&(q=a.extend({type:q,fn:function(){}},b),b=q.id,c=q.name,f=q.value,m=q.fn,q=q.type);if(!~["photo","album"].indexOf(q))throw"Unknown type";a.isArray(b)||(b=[{name:"id[]",value:parseInt(b)}]);var p=[].concat(b,{name:"name",value:c},{name:"value",value:f});a.post("?module="+q+"&action=saveField",p,function(t){if("ok"==t.status){var u={};u[c]=f;t.data.parent_id&&(b=t.data.parent_id);a.photos._updateStreamCache(b,
u);"function"==typeof m&&m(t)}else"fail"==t.status&&"function"==typeof m&&m(t)},"json")},saveFields:function(b,c,f){a.post("?module=photo&action=saveFields",{data:b},function(m){if("ok"==m.status)for(var q in m.data.update){var p=m.data.update[q].id;a.isArray(p)||(p=[p]);var t=m.data.update[q].data;q=0;for(var u=p.length;q<u;++q)a.photos.photo_stream_cache.updateById(p[q],t)}},"json")},_updateStreamCache:function(b,c){a.isArray(b)||(b=[{value:b}]);for(var f=0,m=b.length;f<m;++f)a.photos.photo_stream_cache.updateById(b[f].value,
c)},restoreOriginal:function(b){if("restore-original"===b.id&&confirm($_("This will reset all changes you applied to the image after upload and will restore the original image. Are you sure?"))){a.photos.setCover(!0);var c=a.waLoading(),f=a("body");c.show();c.animate(1E4,95,!1);f.addClass("is-locked");a.post("?module=photo&action=restore",{id:a.photos.getPhotoId()},function(m){"ok"==m.status&&(m=m.data.photo,m=0==m.parent_id?a.photos.photo_stream_cache.updateById(id,m):a.photos.photo_stack_cache.updateById(id,
m),a.photos.updatePhotoOriginalBlock(m),a.photos.updatePhotoImgs(m,function(){a.photos.unsetCover(!0)}),c.done(),f.removeClass("is-locked"))},"json").error(function(m){a.photos.showServerError(m.responseText);c.abort();f.removeClass("is-locked")})}},rotate:function(b,c,f){f=f||function(){};var m=a.waLoading(),q=a("body");m.show();m.animate(1E4,95,!1);q.addClass("is-locked");a.post("?module=photo&action=rotate",{id:b,direction:c},function(p){"ok"===p.status&&(p=p.data.photo,p=0==p.parent_id?a.photos.photo_stream_cache.updateById(b,
p):a.photos.photo_stack_cache.updateById(b,p),a.photos.updatePhotoOriginalBlock(p),a.photos.updatePhotoImgs(p,f),m.done(),q.removeClass("is-locked"))},"json").error(function(p){a.photos.showServerError(p.responseText);"function"==typeof f&&f();m.abort();q.removeClass("is-locked")})},updatePhotoImgs:function(b,c){var f=a.photos._chooseProperThumb(b),m=b.edit_datetime?"?"+Date.parseISO(b.edit_datetime):"",q=a("#photo");q.smallSize=b.width<this.containerWidth&&b.height<this.containerHeight;q.proper_thumb=
{url:f.url+m,url2x:f.url2x+m};replaceImg(q,f.url+m,function(){a("#photo-stream .selected img, #stack-stream .selected img").each(function(){var p=a(this);p.hasClass("thumb")?p.attr("src",b.thumb.url+m):void 0!==b.thumb_crop&&p.attr("src",b.thumb_crop.url+m)});"function"==typeof c&&c();a.photos.hooks_manager.trigger("afterRenderImg",this,b,f)})},deletePhotos:function(b,c){a.post("?module=photo&action=resolution",a.isArray(b)?b:{photo_id:b},function(f){if("ok"==f.status){var m=f.data.photo_id;f=[];
for(var q=[],p=0,t=m.length;p<t;++p)f.push({name:"photo_id[]",value:m[p]});a.photos.massPost({photo_id:f,url:"?module=photo&action=delete",dataType:"json",data:{photos_length:a.isArray(b)?b.length:1},success:function(u,x){if("ok"==u.status){q=q.concat(u.data.denied_photo_id);u=0;for(var B=q.length;u<B;++u)x.push({name:"denied_photo_id[]",value:q[u]})}},fullSuccess:function(u){if("ok"==u.status)if(a.isArray(b)){u.data.alert_msg&&alert(u.data.alert_msg);var x={};a.each(m,function(A,C){x[C]=C});u.data.denied_photo_id&&
u.data.denied_photo_id.length&&a.each(u.data.denied_photo_id,function(A,C){delete x[C]});x=a.map(x,function(A,C){a.photos.photo_stream_cache.deleteById(m[A]);return C});a("#photo-list > li.selected").trigger("select",!1);x.length?a.photos.makeDeleteAnimation(x,function(){c&&c(u)}):c&&c(u)}else{q.length&&alert($_("You don't have sufficient access rights"));if(u.data.parent_id){var B=a.photos.getHashByPhotoId(u.data.parent_id);a.photos.photo_stack_cache.deleteById(m)}else{var y=a.photos.photo_stream_cache;
B=(B=y.getNext(b))?a.photos.getHashByPhotoId(B.id):y.hash;y.deleteById(m)}a.wa.setHash(B);c&&c(u)}else c&&c(u)}})}},"json")},deleteAllAlbums:function(b,c,f){if(!b.length)return f&&f();var m=b.shift();a.photos.deleteAlbum(m,c,function(){a.photos.deleteAllAlbums(b,c,f)})},deleteAlbum:function(b,c,f){c?a.photos._deleteAlbumWithPhotos(b,f):a.post("?module=album&action=delete",{album_id:b},function(m){"ok"==m.status&&(a.photos.onDeleteAlbum(b),a.photos.goToHash(""),"function"==typeof f&&f())},"json")},
_deleteAlbumWithPhotos:function(b,c){a.post("?module=photo&action=resolution",{album_id:b},function(f){if("ok"==f.status){f=f.data.photo_id;for(var m=[],q=0,p=f.length;q<p;++q)m.push({name:"photo_id[]",value:f[q]});m.length?a.photos.massPost({url:"?module=photo&action=delete",photo_id:m,dataType:"json",fullSuccess:function(t){"ok"==t.status?a.photos.deleteAlbum(b,0,c):console&&console.log("Error while delete album")}}):a.photos.deleteAlbum(b,0,c)}},"json")},serializeData:function(b,c){if("object"===
typeof b&&!a.isArray(b)&&"undefined"===typeof c){var f=[];for(c in b)b.hasOwnProperty(c)&&f.push({name:c,value:b[c]});return f}a.isArray(b)||(b=[b]);f=0;for(var m=b.length,q=b[0];f<m;q=b[++f])"object"!=typeof q&&(q={name:c,value:q}),b[f]=q;return b},saveAccess:function(b){function c(t){for(var u=[],x=[],B=[],y=0,A=t.length;y<A;++y)u.push({name:"photo_id[]",value:t[y]});a.photos.massPost({photo_id:u,url:"?module=photo&action=manageAccessSave",dataType:"json",data:m,success:function(C,H){if("ok"==C.status){x=
x.concat(C.data.denied_photo_id);for(var M=0,E=x.length;M<E;++M)H.push({name:"denied_photo_id[]",value:x[M]});B=C.data.allowed_photo_id;C=0;for(M=B.length;C<M;++C)H.push({name:"allowed_photo_id[]",value:B[C]})}},fullSuccess:function(C){"ok"==C.status&&C.data.alert_msg&&p(C.data.alert_msg);"function"===typeof q&&q(C,B)}})}var f=b.photo_id||[],m=b.data||[],q=b.fn,p=b.onDeniedExist||function(t){alert(t)};b="boolean"===typeof b.resolution?b.resolution:!0;"object"!==typeof m||a.isArray(m)||(m=a.photos.serializeData(m));
m.push({name:"photos_length",value:f.length});b?a.post("?module=photo&action=resolution",a.isArray(f)?f:{photo_id:f},function(t){"ok"==t.status&&c(t.data.photo_id)},"json"):c(a.isArray(f)?f:[f])},addToAlbums:function(b){var c=b.photo_id||[],f=b.album_id||[],m=void 0==b.copy?1:b.copy,q=b.fn,p=b.onDeniedExist||function(t){alert(t)};c=a.photos.serializeData(c,"photo_id[]");f=a.photos.serializeData(f,"album_id[]");b=c.concat(f);b.push({name:"copy",value:+m});a.post("?module=photo&action=addToAlbums",
b,function(t){if("ok"==t.status){for(var u=[].concat(t.data.albums||[],t.data.old_albums||[]),x=0,B=u.length;x<B;++x){var y=u[x];a("#album-list li[rel="+y.id+"]").find(".count:first").text(y.count).end().find(".count-new:first").text(0<y.count_new?"+"+y.count_new:"")}t.data.alert_msg&&p(t.data.alert_msg)}"function"==typeof q&&q(t)},"json")},assignTags:function(b){var c=b.photo_id||[],f=b.tags||[],m=b.delete_tags||[],q=b.fn,p=b.onDeniedExist||function(t){alert(t)};b=[];b=a.isArray(c)?c:b.concat([{name:"photo_id[]",
value:c},{name:"one_photo",value:1}]);a.isArray(f)&&f.length?b=b.concat(f):(b.push({name:"tags",value:f}),m.length&&(b=b.concat(m)));a.post("?module=photo&action=assignTags",b,function(t){if("ok"==t.status){var u=t.data.cloud,x=a("#tag-cloud-block");a.isArray(u)&&!u.length||!u?x.hide():(a("#tag-cloud").html(tmpl("template-tag-cloud",{cloud:u})),x.show());u=t.data.tags||{};for(var B in u)u.hasOwnProperty(B)&&(x=u[B],a.photos._updateStreamCache(B,{tags:x}));a("#album-create-dialog").remove();t.data.alert_msg&&
p(t.data.alert_msg)}"function"==typeof q&&q(t)},"json")},makeStack:function(b,c){var f=b.shift();a.post("?module=photo&action=resolution",b,function(m){if("ok"==m.status){m=m.data.photo_id;for(var q=[],p=[],t=0,u=m.length;t<u;++t)m[t]!=f.value&&q.push({name:"photo_id[]",value:m[t]});a.photos.massPost({photo_id:q,data:{parent_id:f.value,photos_length:b.length},url:"?module=stack&action=make",dataType:"json",success:function(x,B){if("ok"==x.status&&"ok"==x.status){p=p.concat(x.data.denied_photo_ids);
x=0;for(var y=p.length;x<y;++x)B.push({name:"denied_photo_id[]",value:p[x]})}},fullSuccess:function(x){if("ok"==x.status){x.data.alert_msg&&alert(x.data.alert_msg);for(var B=0,y=b.length;B<y;++B)a.photos.photo_stream_cache.deleteById(b[B].value);a.photos.photo_stream_cache.updateById(x.data.parent_id,x.data.photo);a("#photo-list > li.selected").trigger("select",!1);a.photos.makeStackAnimation([f].concat(b))}}})}},"json")},makeStackAnimation:function(b,c){var f=b[0].value,m=a('li[data-photo-id="'+
f+'"]'),q=m.offset(),p=a(window);(q.top<p.scrollTop()||q.top>p.scrollTop()+p.height())&&a("html, body").animate({scrollTop:q.top},300);p=[];for(var t=1;t<b.length;t++){var u=b[t].value,x=a('li[data-photo-id="'+u+'"]'),B=x.offset();B=x.clone().css({"z-index":10,position:"absolute",top:B.top,left:B.left}).insertAfter(x);x.css({opacity:0});p.push(x.hide(300).promise());a.photos.photo_stream_cache.deleteById(u);p.push(B.animate({top:q.top,left:q.left},300).promise().done(function(){a(this).remove()}))}a.when.apply(a,
p).done(function(){var y=m.hasClass("last");m.replaceWith(tmpl(a.photos.list_template,{photos:[a.photos.photo_stream_cache.getById(f)],hash:a.photos.hash,last_login_time:a.photos.options.last_login_time,options:{}}));y||a('li[data-photo-id="'+f+'"]').removeClass("last");a('li[data-photo-id="'+f+'"]').addClass("highlighted");"function"===typeof c&&c()})},makeDeleteAnimation:function(b,c){var f={};a.each(b,function(q,p){f[p]=!0});var m=a("#photo-list").children().filter(function(){return!!f[a(this).data("photo-id")]}).animate({width:0},
function(){m.remove();c&&c()})},highlightSidebarItem:function(){var b=decodeURIComponent(a.photos.hash),c=a("#js-app-sidebar"),f=c.find('a[href="#'+(b||"/")+'"]');c.find("li.selected").removeClass("selected");f.length||(f=c.find('a[href="#'+(b+"/"||"/")+'"]'));f.length||(f=c.find('a[href^="#'+(b||"/")+'"]'));f.length&&f.parents("li:first").addClass("selected")},toggleFullScreen:function(){a.storage.get("photos/maximize_photo")?a("#wa-app").addClass("p-full-screen"):a("#wa-app").removeClass("p-full-screen")},
hotkey_manager:function(){function b(p){var t=p.target.type;p=p.keyCode;var u=a(".dialog-opened").length;if(!(b.hold||"text"==t||"textarea"==t||37!=p&&39!=p||u)){if(39==p){if(t=a.photos.photo_stream_cache.getNext())a.photos.goToHash(a.photos.getHashByPhotoId(t.id),!1),a.photos.shift_next=!0;b.hold=!0}if(37==p){if(t=a.photos.photo_stream_cache.getPrev())a.photos.goToHash(a.photos.getHashByPhotoId(t.id),!1),a.photos.shift_next=!0;b.hold=!0}}}function c(p){b.hold=!1}function f(p){switch(p){case 48:case 96:p=
0;break;case 49:case 97:p=1;break;case 50:case 98:p=2;break;case 51:case 99:p=3;break;case 52:case 100:p=4;break;case 53:case 101:p=5;break;default:p=null}return p}function m(p){var t=p.target.type;if(!m.hold&&"text"!=t&&"textarea"!=t){var u=f(p.keyCode);"number"===typeof u&&(m.hold=!0,a("#photo").length?(p=a.photos.photo_stream_cache.getCurrent(),p.edit_rights&&a.photos.saveField(p.id,"rate",u,function(x){"ok"==x.status&&x.data.count&&(a("#rated-count").text(0<x.data.count?x.data.count:""),a("#photo-rate").rateWidget("setOption",
"rate",u))})):(p=a("input[name^=photo_id]").map(function(){return this.checked?{name:"id[]",value:this.value}:null}).toArray(),p.length&&a.photos.saveField({id:p,name:"rate",value:u,fn:function(x){if("ok"==x.status){var B=x.data.allowed_photo_id&&!a.isArray(x.data.allowed_photo_id)?x.data.allowed_photo_id:{};a("#photo-list > li.selected").each(function(){var y=a(this);B[y.attr("data-photo-id")]&&a.photos.updateThumbRate(y,u)}).find("input:first").trigger("select",!1);x.data.count&&a("#rated-count").text(0<
x.data.count?x.data.count:"");x.data.alert_msg&&alert(x.data.alert_msg)}}})))}}function q(){m.hold=!1}return{set:function(p){"undefined"===typeof p?a(document).bind("keydown",b).bind("keyup",c).bind("keydown",m).bind("keyup",q):"rate"===p&&a(document).bind("keydown",m).bind("keyup",q)},unset:function(){a(document).unbind("keydown",b).unbind("keyup",c).unbind("keyup",m).unbind("keyup",q)}}}(),getHashByPhotoId:function(b){return a.photos.hash+"/photo/"+b},setLazyLoad:function(){var b=null;a(window).lazyLoad({container:"#photo-list",
load:function(){b=b||a("#photo-list > li").length;a(window).lazyLoad("sleep");a(".lazyloading-wrapper .lazyloading-progress").show();a(".lazyloading-wrapper .lazyloading-link").hide();a.post("?module=photo&action=loadList",{offset:b,hash:a.photos.hash},function(c){if(c.data.hash==a.photos.hash){var f=a("#photo-list");if(c.data.photos.length){var m=a.photos.photo_stream_cache.length();a.photos.photo_stream_cache.append(c.data.photos);f.find("li.last").removeClass("last");a.photos.renderPhotoListChunk(f,
m,{string:c.data.string},function(){!a.photos.total_count||a.photos.total_count>a.photos.photo_stream_cache.length()?a(window).lazyLoad("wake"):(a(".lazyloading-wrapper .lazyloading-progress").hide(),a(".lazyloading-wrapper .lazyloading-link").hide(),a(window).lazyLoad("stop"))});b+=c.data.photos.length}else a(".lazyloading-wrapper .lazyloading-progress").hide(),a(".lazyloading-wrapper .lazyloading-link").hide(),a(window).lazyLoad("stop")}},"json")}});a(".lazyloading-wrapper a.lazyloading-link").off("click.lazyloading").on("click.lazyloading",
function(){a(window).lazyLoad("force");return!1})},unsetLazyLoad:function(){a(window).lazyLoad&&a(window).lazyLoad("stop");a(".lazyloading-wrapper a.lazyloading-link").off("click.lazyloading")},getAlbum:function(){return this.album=this.album||null},setAlbum:function(b){this.album=b},unsetAlbum:function(){this.album=null},getPhotoId:function(){var b=/photo\/(\d+)[\/]*$/.exec(location.href);return b?parseInt(b[1]):null},isCurrentPhotoStack:function(){var b=this.getPhotoId();return b?(b=this.photo_stream_cache.getById(b))&&
0<b.stack_count:!1},goToHash:function(b,c){c="undefined"===typeof c?!0:c;b=b.replace(/^\/*/,"").replace(/\/*\s*$/,"");location.hash.replace(/^[^#]*#\/*/,"").replace(/\/*\s*$/,"")==b&&c?(a.photos.ignore_scrolltop=!0,a.photos.dispatch()):location.hash=b?"/"+b+"/":"#/"},goToAnchor:function(b){b=a("a[name="+b+"]");b.length&&a(document).scrollTop(b.position().top)},photo_stream_cache:new PhotoStream,onCreateAlbum:function(b,c){var f=tmpl("template-album-list-item",b),m=a("#album-list");if(c){var q=m.find("li[rel="+
c+"]");var p=q.find("ul:first");p.length||(q.append('<ul class="menu"></ul>'),p=q.find("ul:first"),q.find(".count:first").after('<i class="icon16 darr overhanging collapse-handler" id="album-'+c+'-handler"></i>'));p.prepend(f)}else p=m.find("ul:first"),p.length||(m.find(".p-empty-album-list").hide(),m.prepend('<ul class="menu"><li class="drag-newposition"></li></ul>').find("ul:first")),m.find("ul:first").prepend(f);m.find(".new-item").removeClass("new-item").mouseover();b.type||(f=a("#p-upload-step2 select[name=album_id]"),
c?(c=f.find("option[value="+c+"]"),f=c.text().replace(/[^-]/g,"")+"-",c.after('<option value="'+b.id+'">'+f+" "+b.name+"</option>")):f.find("optgroup").prepend('<option value="'+b.id+'">'+b.name+"</option>"))},onDeleteAlbum:function(b){var c=a("#album-list"),f=c.find("li[rel="+b+"]"),m=f.find("ul:first"),q=f.parents("ul:first");f.hide();if(m.length){f.prev(".drag-newposition:first").remove();f.next(".drag-newposition:first").remove();var p=m.children("li");p.hide().insertAfter(f);m.remove();f.remove();
p.show()}else f.next(".drag-newposition:first").remove().end().remove();q.length&&!q.find("li:not(.drag-newposition)").length&&(f=q.parent("li"),f.length&&f.find("i.collapse-handler").remove(),q.remove());c.find("ul:first").length||c.find(".p-empty-album-list").show();a("#p-upload-step2 select[name=album_id]").find("option[value="+b+"]").remove()},fixRightToolbar:function(){a.photos.fixRightToolbar._handler=function c(){var f=a("#p-toolbar");f.length&&(f.hasClass("rendered")?f.removeClass("p-fixed"):
(c.top||(c.top=f.children(":first").position().top),a(this).scrollTop()>c.top?f.addClass("p-fixed"):f.removeClass("p-fixed")))};a.photos.fixRightToolbar._handler.call(document);a(document).bind("scroll",a.photos.fixRightToolbar._handler)},photo_stack_cache:new PhotoStream,isSelectedAnyPhoto:function(){return!!a("#photo-list > li.selected:first").length},getRatingHtml:function(b,c,f){b=Math.round(2*b)/2;if(!b&&!f)return"";c="";for(f=1;5>=f;f+=1)c+='<i class="fas fa-star',c=f>b?.5==f-b?c+"-half":c+
" text-light-gray":c+" text-yellow",c+='" data-rate-value="'+f+'"></i>';return c},uploadDialog:function(){a.get("?module=upload").done(function(b){a.waDialog({html:b,onOpen:function(c,f){a.photos.onUploadDialog(c,f)}})})},dialogClearSteps:function(){var b=a(this);b.find("#p-upload-step2").hide();b.find("#p-upload-step2-buttons").hide();b.find("#p-upload-step3").hide();b.find("#p-upload-step3-buttons").hide();b.find("#p-upload-step1").show();b.find("#p-upload-step1-buttons").show()},onUploadDialog:function(b,
c){b.find(".files").empty();var f=a.storage.get("photos/hash"),m=b.find("#p-upload-step2 select[name=album_id]");f&&~f.indexOf("album")?(f=parseInt(f.replace(/\/?album\//,"")),f=m.find("optgroup option[value="+f+"]"),f.length?f.attr("selected",!0):m.find("option:first").attr("selected",!0)):m.find("option:first").attr("selected",!0);b.find("form").on("submit",function(q){q.preventDefault();a(this).find("#p-start-upload-button").click()});a(document).on("fileuploadsend fileuploaddone",function(){c.resize()})},
massPost:function(b){function c(B){t?(u?(m=u.splice(0,f),b.data=q.concat(m)):b.data=q,t-=f,t=0<t?t:0,a.ajax(b)):"function"==typeof b.fullSuccess&&b.fullSuccess(B)}var f=b.chunk_count||25,m,q=[];if(a.isArray(b.data))q=q.concat(b.data);else if("object"==typeof b.data)for(var p in b.data)q.push({name:p,value:b.data[p]});b.type="post";var t=parseInt(b.count)||0,u=b.photo_id;if(b.photo_id){u=b.photo_id;if(a.isArray(u))u=[].concat(u);else{q.push({name:"photo_id",value:u});b.data=q;b.success=b.fullSuccess;
a.ajax(b);return}t=u.length}if("function"==typeof b.success){var x=b.success;b.success=function(B){x(B,q);c(B)}}else b.success=c;c()},confirmDialog:function(b){var c=a("#confirm-dialog");c.length||(c=a('<div id="confirm-dialog"></div>'),a("body").append(c));b.url&&c.load(b.url,function(){var f=a.extend({},b);delete f.url;var m=a(this),q=f.onOpen,p=f.onSubmit,t=f.attr||null;f.onOpen=function(u,x){if(t)for(var B in t)t.hasOwnProperty(B)&&u.attr(B,t[B]);u.find("input[type=submit]").focus();"function"===
typeof q&&q(u,x);if("function"===typeof p)u.find("form").on("submit",function(y){y.preventDefault();p(u,x)})};delete f.onSubmit;f.$wrapper=m.find("div:first");a.waDialog(f)})},showServerError:function(b){b?(console&&console.log("Server error occurred:\n"+b),alert(b)):console&&console.log("Server error occurred")},initAlbumThumbsDragAndDrop:function(b,c){b.sortable({delay:200,delayOnTouchOnly:!0,animation:150,forceFallback:!0,ghostClass:"album-list-ghost",chosenClass:"album-list-chosen",dragClass:"album-list-drag",
onEnd:function(f){f=a(f.item);var m=f.find("[onclick]"),q=m.attr("onclick");m.attr("onclick","javascript:void(0);");setTimeout(function(){return m.attr("onclick",q)},500);a.post("?module=album&action=move",{id:f.data("album-id"),before_id:f.next().data("album-id")||0,parent_id:c})}})},initPhotoThumbsDragAndDrop:function(b,c){b.sortable({delay:200,delayOnTouchOnly:!0,animation:150,forceFallback:!0,ghostClass:"photo-list-ghost",chosenClass:"photo-list-chosen",dragClass:"photo-list-drag",onEnd:function(f){f=
a(f.item);var m=[],q=f.next().data("photo-id")||0,p=f.find("[onclick]"),t=p.attr("onclick");p.attr("onclick","javascript:void(0);");setTimeout(function(){return p.attr("onclick",t)},500);m.push(f.data("photo-id"));a.post("?module=album&action=photoMove",{photo_id:m,album_id:c,before_id:q},function(u){"ok"==u.status&&a.photos.photo_stream_cache.move(m,q)},"json")}})},hooks_manager:{handlers:{},bind:function(b,c,f){if(1==arguments.length&&arguments[0]&&"object"===typeof arguments[0]){var m=arguments[0];
for(b in m)m.hasOwnProperty(b)&&this.bind(b,m[b])}else return f=f||(""+Math.random()).slice(2),this.handlers[b]=this.handlers[b]||{},this.handlers[b][f]=c,c.handler_name=f},unbind:function(b,c){var f=c;"undefined"===typeof c?this.handlers[b]={}:("function"===typeof c&&(f=c.handler_name),"function"===typeof this.handlers[b][f]&&delete this.handlers[b][f])},trigger:function(b){var c=this.handlers[b];if(c&&"object"===typeof c){var f=Array.prototype.slice.call(arguments,1),m;for(m in c)c.hasOwnProperty(m)&&
"function"===typeof c[m]&&c[m].apply(null,f)}}}}})(jQuery);
$(function(){$(".dialog").off().on("change_loading_status",function(a,e){e=e||!1;a=$(this).find("input[type=submit]");e?a.attr("disabled",!0).after('<i class="fas fa-spin fa-spinner loading"></i>'):a.attr("disabled",!1).next("i").remove()});(function(){var a=!1;$(document).on("selectstart","#photo-list",function(){return!a});$(document).keydown(function(e){16==e.keyCode&&(a=!0)}).keyup(function(e){16==e.keyCode&&(a=!1)})})();$(document).on("select","#photo-list > li",function(a,e,g){g=void 0!==g?
g:!0;(void 0!==e?e:1)?$(this).addClass("selected").find("input:first").attr("checked",!0).prop("checked",!0):(a=$("#selector-menu").find('[data-action="select-photos"]'),a.data("checked")&&a.data("checked",!1).find(".unchecked").show().end().find(".checked").hide(),$(this).removeClass("selected").find("input:first").attr("checked",!1).prop("checked",!1));g&&$(".js-toolbar-dropdown-button").trigger("recount")});(function(){function a(k,h,b){if(k&&h&&k[0]&&h[0]&&!k.is(h[0])){var c=!1;h.parent().children().each(function(f,
m){if(c){if(k.is(m)||h.is(m))return!1;f=$(m).find(".p-details input:checkbox");f.prop("checked")!=b&&f.prop("checked",b).change()}else if(k.is(m)||h.is(m))c=!0})}}var e=null,g=null;$("#content").on("click","#photo-list > li .p-details input:checkbox, #photo-list > li .p-details label, #photo-list > li .p-details .wa-checkbox",function(k){var h=$(this).closest("li"),b=h.find(".p-details input:checkbox");if(b.is(k.target))var c=b.prop("checked");else c=!b.prop("checked"),b.prop("checked",c).change();
c?(k.shiftKey&&e&&a(e,h,!0),e=h,g=null):(k.shiftKey&&g&&a(g,h,!1),e=null,g=h);h=$(".js-toolbar-dropdown");k=$(".js-toolbar-dropdown-button").find(".js-count");h=h.parent();b=$('#photo-list :checkbox[name="photo_id[]"]:checked').length;h.toggleClass("is-fixed",!!b);b?k.text(b).show():k.empty().hide()})})();$("#content").off($.photos.namespace+"-photo-list-select-checkbox").on("change"+$.photos.namespace+"-photo-list-select-checkbox",':checkbox[name="photo_id[]"]',function(){this.checked?$(this).closest("li").addClass("selected"):
$(this).closest("li").removeClass("selected");$(".js-toolbar-dropdown-button").trigger("recount")});$.photos.hooks_manager.bind("afterLoadPhoto",function(a){$("#p-block .p-one-photo > .p-image-nav .p-rewind").show();$("#p-block .p-one-photo > .p-image-nav .p-ff").show();a.first&&$("#p-block .p-one-photo > .p-image-nav .p-rewind").hide();a.last&&$("#p-block .p-one-photo > .p-image-nav .p-ff").hide()});$.photos_dragndrop.init()});
function ToolbarMenu(a,e){var g=null;return{init:function(){g=$(a);g.length&&g.activeMenu(e);return this},enable:function(k){k?g.activeMenu("enable",k):(g.parents("section:first").show(),g.activeMenu("fire"));return this},disable:function(k){k?g.activeMenu("disable",k):g.parents("section:first").hide();return this},setAction:function(k,h){e[k]=h;g&&g.activeMenu("setOption",k,h);return this},getAction:function(k){return e[k]},is:function(k){return g?g.is(k):$(a).is(k)}}};(function(a){a.photos.menu.register("list","#share-menu",{embedAction:function(){var e=a("#embed-photo-list-dialog"),g=a.storage.get("photos/embed_size"),k=a("#photo-list > li.selected").map(function(){var f=a(this).attr("data-photo-id"),m=a.photos.photo_stream_cache.getById(f);0>=m.status&&(f+=":"+m.hash);return f}).toArray().join(","),h=a.photos.getAlbum(),b=a.photos.hash,c={photo_ids:k,hash:b,size:g};h&&0>=h.status&&(b=b.replace(/\/*$/,"")+":"+h.hash+"/",c.hash=b);h="?module=dialog&action=embedPhotoList&photo_ids="+
k+"&hash="+b;g&&(h+="&size="+g);e.length||(e=a('<div id="embed-photo-list-dialog"></div>'),a("body").append(e));e.load(h,function(){a.waDialog({$wrapper:e.find("div:first"),onOpen:function(f,m){function q(y){var A=q.data,C=!1,H;for(H in A)if(A.hasOwnProperty(H)&&A[H]!==y[H]){C=!0;break}q.data=a.extend({},y);C&&(f.find(".dialog-header").find(".loading").parent().show(),a.post("?module=photo&action=embedList",y,function(M){if("ok"==M.status){var E=M.data.context;f.find("input[name=link]").val(E.link);
f.find("a.link").attr("href",E.link);f.find("textarea[name=urls]").val(E.urls);x.val(E.html);u.val(E.html_with_descriptions);f.find("textarea[name=smarty_code]").val(E.smarty_code);f.find("h1 span:first").text("("+E.count+")");E.all_public?f.find(".exclamation-message").hide():f.find(".exclamation-message").show();E.domains=E.domains||{};B.children().each(function(){var K=a(this),R=K.attr("value");K.data("frontend-url",(E.domains[R]||{}).frontend_url||"")});p();t()}f.find(".dialog-header").find(".loading").parent().hide()},
"json"))}function p(){a.each(["textarea[name=urls]","#embed-photo-list-html","#embed-photo-list-html-with-descriptions"],function(y,A){y=a(A);y.data("context_data",y.val())})}function t(){if(!B.length)return!1;a.each(["textarea[name=urls]","#embed-photo-list-html","#embed-photo-list-html-with-descriptions"],function(A,C){A=a(C);A.val(A.data("context_data").split(B.data("original-domain")).join(B.val()))});var y=B.children(":selected");y.data("frontend-url")?(f.find("input[name=link]").val(y.data("frontend-url")).closest(".field").slideDown(),
f.find("a.link").attr("href",y.data("frontend-url"))):f.find("input[name=link]").closest(".field").slideUp()}m=f.find("select[name=size]");var u=a("#embed-photo-list-html-with-descriptions"),x=a("#embed-photo-list-html");g&&m.val(g);m.change(function(){var y=a(this).val();c.size=y;q(c);a.storage.set("photos/embed_size",y)});f.find("input[name=description]").on("click",function(){this.checked?(u.show().attr("disabled",!1),x.hide().attr("disabled",!0)):(x.show().attr("disabled",!1),u.hide().attr("disabled",
!0))});f.find("input[name=link], textarea[name=urls], textarea[name=html], textarea[name=smarty_code]").on("click",function(){var y=a(this);y.getSelection().length||y.select()});f.find("input[name=link]").focus().select();f.find(".switcher").activeMenu({selectedPhotosAction:function(y){c.size=f.find("select[name=size]").val();c.photo_ids=k;q(c)},allListPhotosAction:function(y){c.size=f.find("select[name=size]").val();c.photo_ids="";q(c)}}).find("li").click(function(){a(this).parent().find(".selected").removeClass("selected").end().addClass("selected")});
q.data=q.data||a.extend({},c);var B=f.find("select[name=domain]");B.length&&(p(),t(),B.change(t))}})});return!1},beforeAnyAction:function(e){if(!a.photos.isSelectedAnyPhoto()&&"blog-post"!=e&&"embed"!=e)return alert($_("Please select at least one photo")),!1},blogPostAction:function(){var e=a("#blog-post-form"),g=[].concat($jscomp.arrayFromIterable(document.querySelectorAll("#photo-list > li.selected"))).map(function(f){return f.getAttribute("data-photo-id")});if(g.length){for(var k=[0,0],h=0;h<g.length;h++){var b=
a.photos.photo_stream_cache.getById(g[h]);b||(b=a.photos.photo_stack_cache.getById(g[h]));b&&(b.hash&&(g[h]+=":"+b.hash),++k[b.status])}h=a.photos.getAlbum();b=a.photos.hash;var c={photo_ids:g.join(","),hash:b,size:obligatory_size};h&&0>=h.status&&(b=b.replace(/\/*$/,"")+":"+h.hash+"/",c.hash=b);c.hash=null;a("#photo-blog-dialog :submit").attr("disabled",!0);a.post("?module=photo&action=embedList",c,function(f){"ok"==f.status&&(f=f.data.context,e.find('[name="title"]:input').val(a("#photo-list-name").text()),
e.find('[name="text"]:input').val(blog_smarty_enabled?f.smarty_code:f.html_with_descriptions),k[0]?a("#photo-blog-dialog :submit").attr("disabled",!1):e.submit())},"json");k[0]&&(h=a("#photo-blog-dialog").clone(),a.waDialog({$wrapper:h,onOpen:function(f){var m=f.find('[type="submit"]');f=f.find("p");var q=[k[0],g.length];f.html(f.html().replace(/(%d)/g,function(){return q.shift()}));m.on("click",function(p){p.preventDefault();e.submit()})}}));return!1}alert($_("Please select at least one photo"))},
onFire:function(){a(".js-toolbar-dropdown-button").trigger("recount")}});a.photos.menu.register("list","#organize-menu",{addToAlbumAction:function(){var e=a("#choose-albums");e.length&&e.parent().remove();a("<div></div>").appendTo("body").load("?module=dialog&action=albums",function(){a.waDialog({$wrapper:a("#choose-albums"),onOpen:function(g,k){g.find("h3:first span:first").text("("+a("#photo-list > li.selected").length+")");var h=g.find('[type="submit"]'),b=g.find("form");h.on("click",function(c){c.preventDefault();
c=a("input[name^=photo_id]").serializeArray();var f=b.serializeArray();if(!f.length)return alert($_("Please select at least one album")),!1;if(!c.length)return k.close(),!1;g.trigger("change_loading_status",!0);a.photos.addToAlbums({photo_id:c,album_id:f,copy:1,fn:function(){a("#photo-list > li.selected").trigger("select",!1);g.trigger("change_loading_status",!1);k.close()}})})}})})},assignTagsAction:function(){var e=$_("add a tag"),g=a("#photo-list-tags-dialog"),k=g.clone(),h;a.waDialog({$wrapper:k,
onOpen:function(b,c){var f=b.find("#photos-list-tags"),m=[],q={},p=a.photos.photo_stream_cache.getAll(),t=b.find("#photos-tags-remove-list"),u=b.find("#photo-tags-remove"),x=b.find("form"),B=a("input[name^=photo_id]:checked"),y=b.find("#photos-popular-tags");h=g.detach();b.find(".tagsinput").length||(a.fn.tagsInput.bind(f),f.tagsInput({autocomplete_url:"?module=tag&action=list",height:200,width:"100%",defaultText:e}));f.importTags("");b.find(".js-selected-counter").text("("+B.length+")");B.each(function(){m.push(a(this).val())});
for(var A={},C=0,H=a.photos.photo_stream_cache.length();C<H;A={$jscomp$loop$prop$p$25:A.$jscomp$loop$prop$p$25},C++)if(A.$jscomp$loop$prop$p$25=p[C],m.some(function(R){return function(V){return V==R.$jscomp$loop$prop$p$25.id}}(A))){var M=A.$jscomp$loop$prop$p$25.tags;if(!a.isEmptyObject(M))if(a.isEmptyObject(q))q=M;else for(var E in M)M.hasOwnProperty(E)&&(q[E]=M[E])}t.empty();if(jQuery.isEmptyObject(q))u.hide();else{u.show();for(var K in q)t.append(a("<label></label>").text(q[K]).prepend('<input name="delete_tags[]" value="'+
K+'" type="checkbox"> ')).append("<br>")}y.off("click.photos","a").on("click.photos","a",function(){var R=a(this).text();f.removeTag(R);f.addTag(R)});q=b.find("#photos-list-tags_tag");q.length&&q.val()!=e&&(p=jQuery.Event("keypress",{which:13}),q.trigger(p));x.on("submit",function(R){R.preventDefault();R=B.serializeArray();var V=f.val(),ja=t.find("input[name^=delete_tags]:checked").serializeArray();if(!V.length&&!ja.length)return alert($_("Please select at least one tag")),!1;if(!R.length)return c.close(),
!1;b.trigger("change_loading_status",!0);a.photos.assignTags({photo_id:R,tags:V,delete_tags:ja,fn:function(X){if("ok"==X.status){X=X.data.tags;var ea=a("#photo-list > li.selected"),qa;for(qa in X)if(X.hasOwnProperty(qa)){var ra=tmpl("template-photo-list-photo-tags",{tags:X[qa]});ea.filter("[data-photo-id="+qa+"]:first").find(".tags").replaceWith(ra)}ea.trigger("select",!1);b.trigger("change_loading_status",!1);c.close()}}})})},onClose:function(){a("body").append(h)}})},deleteFromAlbumAction:function(){var e=
a("input[name^=photo_id]").serializeArray();if(e.length){var g=a.photos.getAlbum().id;a.post("?module=photo&action=deleteFromAlbum&id="+g,e,function(){a.photos.dispatch()},"json")}},deletePhotosAction:function(){var e=a("input[name^=photo_id]").serializeArray();e.length&&a.photos.confirmDialog({url:"?module=dialog&action=confirmDeletePhotos&cnt="+e.length,onSubmit:function(g,k){g.trigger("change_loading_status",!0);a.photos.deletePhotos(e,function(){a.photos.unsetCover();g.trigger("change_loading_status",
!1);a("#photo-list > li.selected").trigger("select",!1);k.close()});return!1}})},setRateAction:function(){a.photos.confirmDialog({url:"?module=dialog&action=rates",attr:{id:"set-rate"},onOpen:function(e,g){e.find(".p-rate-photo-counter").text("("+a("input[name^=photo_id]:checked").length+")");var k=e.find("#photos-rate");k.rateWidget({withClearAction:!1,onUpdate:function(){var h=k.rateWidget("getOption","rate"),b=a("input[name^=photo_id]").map(function(){return this.checked?{name:"id[]",value:this.value}:
null}).toArray();if(!b.length)return g.close(),!1;a.photos.saveField({id:b,name:"rate",value:h,fn:function(c){if("ok"==c.status){c=c.data;var f=c.allowed_photo_id&&!a.isArray(c.allowed_photo_id)?c.allowed_photo_id:{};a("#photo-list > li.selected").each(function(){var m=a(this);f[m.attr("data-photo-id")]&&a.photos.updateThumbRate(m,h)}).find("input:first").trigger("select",!1);c.count&&a("#rated-count").text(0<c.count?c.count:"");c.alert_msg&&alert(c.alert_msg);g.close()}}});return!1}})}})},makeStackAction:function(){var e=
a("input[name^=photo_id]").serializeArray();if(2>e.length)return alert($_("Please select at least two photos")),!1;a.photos.makeStack(e);return!1},manageAccessAction:function(){var e=a("input[name^=photo_id]").serializeArray();a.photos.showManageAccessDialog(e,function(g,k){var h=g.serializeArray(),b=g.find("input[name=status]:checked").val();e.length||k.close();g.trigger("change_loading_status",!0);var c=a("#photo-list > li.selected");a.photos.saveAccess({photo_id:e,data:h,fn:function(f,m){f=0;for(var q=
m.length;f<q;++f){var p=c.filter("[data-photo-id="+m[f]+"]:first").find(".p-image-corner.top.left");p.find(".fa-lock").remove();0>=b&&p.append('<i class="fas fa-lock p-private-photo" title="'+$_("Private photo")+'"></i>')}a.photos._updateStreamCache(m,{status:b});c.trigger("select",!1);g.trigger("change_loading_status",!1);k.close()}});return!1});return!1},beforeAnyAction:function(e){if("make-stack"!=e&&!a.photos.isSelectedAnyPhoto())return alert($_("Please select at least one photo")),!1},onFire:function(){a(".js-toolbar-dropdown-button").trigger("recount")}});
a.photos.menu.register("list","#save-menu",{saveDescriptionAction:function(){var e={},g,k,h;a("#photo-list.p-descriptions :text,#photo-list.p-descriptions textarea").each(function(){if(this.defaultValue!=this.value&&(g=a(this).attr("name").match(/^photo\[(\d+)\]\[(\w+)\]$/))){k=g[1];h=g[2];var c=a.photos.photo_stream_cache.getById(k);c&&this.value==c[h]||(e[k]||(e[k]={id:k}),e[k][h]=this.value)}});a.photos.saveFields(e);a("#photo-list.p-descriptions :text.highlighted,#photo-list.p-descriptions textarea.highlighted").each(function(){a(this).removeClass("highlighted")});
var b=a(".js-toolbar-dropdown-button > .js-count");b.length&&(b.text(0),a("#save-menu-block input.button").removeClass("yellow"),b.hide());return!1},hideNameAction:function(e,g){var k=e.find(":checkbox"),h=k.prop("checked");e=a("#photo-list > li");"INPUT"!=g.target.tagName&&(h=!h);h?e.find(':text[name$="[name]"]').hide():e.find(':text[name$="[name]"]').show();e.find('textarea[name$="[description]"]').css("height",h?"+=46":"-=46").toggleClass("js-small",!h).toggleClass("js-big",!!h);setTimeout(function(){k.prop("checked",
h)},50);a.storage.set("photos/list/hide_name",h)},onFire:function(){var e=a(".js-toolbar-dropdown-button > .js-count");e.length&&(e.text("0"),a("#save-menu-block input.button").removeClass("yellow"),e.hide())},onInit:function(e){e.find('[data-action="hide-name"] :checkbox').prop("checked",a.storage.get("photos/list/hide_name",!1));e=function(){var g=[],k;a("#photo-list.p-descriptions :text,#photo-list.p-descriptions textarea").each(function(){if(this.defaultValue!=this.value&&(k=a(this).attr("name").match(/^photo\[(\d+)\]\[(\w+)\]$/))){var c=
k[1];if(0>g.indexOf(c)){var f=a.photos.photo_stream_cache.getById(c);f&&this.value==f[k[2]]?a(this).hasClass("highlighted")&&a(this).removeClass("highlighted"):(a(this).addClass("highlighted"),g.push(c))}}else a(this).hasClass("highlighted")&&a(this).removeClass("highlighted")});var h=a(".js-toolbar-dropdown-button > .js-count"),b=g.length;h.length&&h.text(b);b?(a("#save-menu-block input.button").addClass("yellow"),h.show()):(a("#save-menu-block input.button").removeClass("yellow"),h.hide())};a("#p-content").on("change.photos-save-menu",
"#photo-list.p-descriptions :text, #photo-list.p-descriptions textarea",e);a("#p-content").on("keyup.photos-save-menu","#photo-list.p-descriptions :text, #photo-list.p-descriptions textarea",e)}});a.photos.menu.register("list","#selector-menu",{selectPhotosAction:function(e){var g=a(".js-toolbar-dropdown-button > .js-count");if(a.photos.total_count)e.data("checked")?(e.data("checked",!1),e.find(".unchecked").show().end().find(".checked").hide(),g.text("").hide()):(e.data("checked",!0),e.find(".checked").show().end().find(".unchecked").hide(),
g.text(a.photos.total_count).show()),a("#photo-list > li").trigger("select",[!!e.data("checked"),!1]);else{var k=a('<div class="alert-fixed-box"><span class="alert warning">'+e[0].dataset.errorMsg+"</span></div>");a("body").append(k);setTimeout(function(){k.remove()},2E3)}}});a("#p-sidebar a, #wa-header a, #js-photos-view-toggle button, #photo-list div.p-image a").on("click",function(e){if(a("#save-menu-block").is(":visible")&&a("#save-menu-block input.button").hasClass("yellow")&&!confirm($_("Unsaved changes will be lost if you leave this page now. Are you sure?")))return e.preventDefault(),
!1})})(jQuery);(function(a){a.photos.menu.register("photo","#photo-organize-menu",{addToAlbumAction:function(){a.photos.confirmDialog({url:"?module=dialog&action=albums&id="+a.photos.getPhotoId(),onOpen:function(e,g){g.$block.find("form").on("submit",function(k){k.preventDefault();var h=a.photos.photo_stream_cache.getCurrent().id;a.photos.addToAlbums({photo_id:h,album_id:d.find("form").serializeArray(),copy:0,fn:function(b){if("ok"===b.status){var c=b.data.old_albums||[],f=a.photos.getAlbum();b=b.data.albums;if(f)for(var m=
0,q=c.length;m<q;++m)if(f.id==c[m].id){b.length?a.photos.goToHash("/album/"+b[0].id+"/photo/"+h):a.photos.goToHash("/photo/"+h);g.close();return}a("#photo-albums").html(tmpl("template-photo-albums",{albums:b}))}}});g.close()})}})},deletePhotoAction:function(){a.photos.confirmDialog({url:"?module=dialog&action=confirmDeletePhoto&id="+a.photos.getPhotoId(),onOpen:function(e,g){g.$block.find("form").on("submit",function(k){k.preventDefault();a.photos.setCover();a.photos.deletePhotos(a.photos.getPhotoId(),
function(){a.photos.unsetCover()});g.close()})}})},unstackAction:function(){a.photos.confirmDialog({url:"?module=dialog&action=confirmUnstack&cnt="+a.photos.photo_stack_cache.length(),onOpen:function(e,g){g.$block.find("form").on("submit",function(k){k.preventDefault();k=a.photos.photo_stream_cache.getCurrent().id;a.post("?module=stack&action=unmake&id="+k,{},function(h){a.photos.goToHash(a.photos.hash)},"json");g.close()})}})},manageAccessAction:function(){var e=a.photos.photo_stream_cache.getCurrent().id;
a.photos.showManageAccessDialog("photo_id="+e,function(g,k){g=g.find("form").serializeArray();g.push({name:"one_photo",value:1});a.photos.saveAccess({photo_id:a.photos.photo_stream_cache.getCurrent().id,data:g,fn:function(h){var b=h.data.photo,c=h.data.stack;if(b)b=a.photos.photo_stream_cache.updateById(b.id,b),a.photos.initPhotoContentControlWidget({frontend_link_template:h.data.frontend_link_template,photo:b}),a.photos.updatePhotoImgs(b);else if(c&&a.isArray(c)&&c.length){b=a.photos.photo_stack_cache;
for(var f=b.getCurrent(),m=0,q=c.length;m<q;++m)b.updateById(c[m].id,c[m]);a.photos.initPhotoContentControlWidget({frontend_link_template:h.data.frontend_link_template,photo:f});a.photos.updatePhotoImgs(f)}k.close()},onDeniedExist:function(){alert($_("You don't have sufficient access rights"))}});return!1});return!1}});a.photos.menu.register("photo","#edit-menu",{beforeAnyAction:function(){a.photos.setCover(!0)},rotateLeftAction:function(){a.photos.rotate(a.photos.getPhotoId(),"left",function(){a.photos.unsetCover(!0)})},
rotateRightAction:function(){a.photos.rotate(a.photos.getPhotoId(),"right",function(){a.photos.unsetCover(!0)})},onInit:function(){}});a.photos.menu.register("photo","#share-menu",{embedAction:function(){var e=a("#embed-photo-dialog-wrapper"),g=a.photos.getPhotoId(),k=a.photos.hash,h=a.storage.get("photos/embed_size");g="?module=dialog&action=embedPhoto&photo_id="+g+"&hash="+k;h&&(g+="&size="+h);e.length||(e=a('<div id="embed-photo-dialog-wrapper"></div>'),a("body").append(e));e.load(g,function(){a.waDialog({$wrapper:a("#embed-photo-dialog"),
onOpen:function(b){function c(){q.length&&a.each(["textarea[name=html]","input[name=url]"],function(p,t){p=a(t);p.data("context_data",p.val())})}function f(){if(!q.length)return!1;a.each(["textarea[name=html]","input[name=url]"],function(t,u){t=a(u);t.val(t.data("context_data").split(q.data("original-domain")).join(q.val()))});var p=q.children(":selected");p.data("frontend-url")?(b.find("input[name=link]").val(p.data("frontend-url")).closest(".field").slideDown(),b.find("a.link").attr("href",p.data("frontend-url"))):
b.find("input[name=link]").closest(".field").slideUp()}var m=b.find("select[name=size]");m.val(h);m.change(function(){var p=a(this).val(),t=b.data("contexts")[p];b.find("textarea[name=html]").val(t.html);b.find("input[name=url]").val(t.url);a.storage.set("photos/embed_size",p);c();f()});var q=b.find("select[name=domain]");q.length&&(c(),f(),q.change(f));b.find("input[name=url], textarea[name=html], input[name=link]").on("click",function(){a(this).getSelection().length||a(this).select()});b.find("input[name=link]").focus().select()}})});
return!1},blogPostAction:function(){var e=a("#blog-post-form"),g=a.photos.getPhotoId(),k=a.photos.photo_stream_cache.getById(g);k||(k=a.photos.photo_stack_cache.getById(g));k&&(g=k.id,k.hash&&(g+=":"+k.hash),g={photo_ids:g,hash:null,size:obligatory_size},a("#photo-blog-dialog :submit").attr("disabled",!0),a.post("?module=photo&action=embedList",g,function(h){"ok"==h.status&&(h=h.data.context,e.find('[name="title"]:input').val(k.name),h=h.html_with_descriptions,e.find('[name="text"]:input').val(h.replace(/^<p>(.*)<\/p>$/mi,
"$1")),parseInt(k.status)?e.submit():a("#photo-blog-dialog :submit").attr("disabled",!1))},"json"),parseInt(k.status)||a("#photo-blog-dialog").waDialog({onLoad:function(){a("#photo-blog-dialog :submit").attr("disabled",!0);var h=a("#photo-blog-dialog p"),b=[1,1];h.html(h.html().replace(/(%d)/g,function(){return b.shift()}))},onSubmit:function(){e.submit();return!1}}));return!1}})})(jQuery);$.photos=$.photos||{};$.photos.widget=$.photos.widget||{};
$.photos.widget.loupe={options:{animate:!0,debug:!1},css:{init:{width:null,"max-width":null,height:null,transform:"translate3d(0, 0, 0)"}},drag:!1,loaded:!1,photo_data:null,thumb_data:null,container:null,helper:null,link:null,offset:{},status:"thumb",image_container_width:0,image_container_height:0,init:function(a){var e=this;this.options=$.extend(this.options,a||{});e.trace("init");$.photos.hooks_manager.bind("afterRenderImg",function(g,k,h){e.trace("afterRenderImg");e.prepare(g,k,h)});$.photos.hooks_manager.bind("beforeLoadPhoto",
function(){e.trace("beforeLoadPhoto");e.stop()});$.photos.hooks_manager.bind("onAbortPrevLoading",function(){e.trace("onAbortPrevLoading");e.stop()})},trace:function(a){console&&this.options.debug&&console.log(a)},prepare:function(a,e,g){var k=this;$(".p-one-photo a.next").off("click.loupe").on("click.loupe",function(h){return k.clickNextHandler.apply(k,[this,h])});this.trace("prepare, status="+this.status);this.photo_data=e;this.container=a;this.thumb_data={height:g.size.height,width:g.size.width,
src:g.url};a=k.container.closest(".p-one-photo");k.image_container_width=a.width();k.image_container_height=a.height();"thumb"!==this.status&&this.stop();this.loaded=!1;this.reset()},reset:function(){var a=this;this.trace("reset, status="+this.status);this.link=$("#photo-loupe-link");$("div.photo-loupe-wrapper").length&&(this.container.css({"max-width":"",transform:""}),this.container.unwrap());this.status="thumb";this.link.addClass("hidden");var e,g;(null==(e=this.thumb_data)?void 0:e.width)<this.photo_data.width||
(null==(g=this.thumb_data)?void 0:g.height)<this.photo_data.height?(this.link.removeClass("hidden"),this.options.animate=this.thumb_data.height&&this.thumb_data.width):this.link.addClass("hidden");this.link.unbind(".loupe").bind("click.loupe",function(k){return a.clickHandler.apply(a,[this,k])})},clickHandler:function(){this.trace("clickHandler, status="+this.status);switch(this.status){case "loading":this.container.stop();case "maximized":this.status="unloading";this.link.find(".minimize").hide();
this.link.find(".maximize").show();this.decrease();break;case "thumb":this.status="loading",this.loader=$('<div class="spinner"></div>'),this.loader.css({position:"absolute",top:"50%",left:"50%",width:"200px",height:"200px",transform:"translate(-50%, -50%)"}),this.loader.insertBefore(this.container),$(this.container).hide(),this.link.find(".minimize").hide(),this.link.find(".maximize").hide(),this.enlarge()}return!1},clickNextHandler:function(a,e){(a="thumb"==this.status?!0:!1)||e.preventDefault();
this.trace("clickNextHandler "+a);return a},interaction:function(a,e,g){g=g.parents("body");switch(e.type){case "touchend":case "mouseup":this.drag&&(e.preventDefault(),this.drag=!1,g.unbind(".loupe-move"));break;case "touchstart":case "mousedown":this.clickNextHandler(a,e);if(this.drag)break;var k=this;this.drag=!0;"touchstart"===e.type?(this.offset.mouseX=e.touches[0].pageX,this.offset.mouseY=e.touches[0].pageY):(this.offset.mouseX=e.pageX,this.offset.mouseY=e.pageY);g.bind("mouseover.loupe-move mousemove.loupe-move touchmove.loupe-move",
function(h){return k.watch.apply(k,[this,h])});break;case "touchleave":case "mouseleave":this.drag&&(e.preventDefault(),this.drag=!1,g.unbind(".loupe-move"))}},enlarge:function(){var a=this,e=this;this.drag=!1;this.trace("enlarge, status="+this.status);$("#photo").closest(".p-image").addClass("p-image-maximized");this.offset=this.container.offset();this.offset.x=e.image_container_width>this.photo_data.width?"0":Math.round((e.image_container_width-this.photo_data.width)/2);this.offset.y=e.image_container_height>
this.photo_data.height?"0":Math.round((e.image_container_height-this.photo_data.height)/2);this.container.wrap('<div class="photo-loupe-wrapper"/>');$(".photo-loupe-wrapper").css({height:e.image_container_height,width:e.image_container_width});this.container.css({"max-width":this.photo_data.width+"px",transform:"translate3d(0, 0, 0)"});this.options.animate?this.container.animate({"max-width":this.photo_data.width+"px",transform:"translate3d("+this.offset.x+"px, "+this.offset.y+"px, 0)"},function(){return e.enlargeComplete.apply(e,
[this])}):(this.container.css({"max-width":this.photo_data.width+"px",transform:"translate3d("+this.offset.x+"px, "+this.offset.y+"px, 0)"}),this.enlargeComplete());this.link.find(".minimize").show();this.bind(this.container);if(!this.helper){var g=$("#photo-loupe");this.helper=g.length?g.first():$('<img id="photo-loupe"/>');this.helper.load(function(k){e.loaded=!0})}(function(k){return new Promise(function(h,b){var c=new Image;c.addEventListener("load",function(){h(c)});c.addEventListener("error",
b);c.src=k})})("?module=photo&action=download&photo_id="+this.photo_data.id+"&attach="+(this.photo_data.edit_datetime||this.photo_data.upload_datetime)).then(function(k){$(a.helper).addClass("fade-in");$(a.helper).on("animationend",function(){e.loader.remove()});a.helper.attr("src",k.src)}).catch(function(k){return console.error(k)})},enlargeComplete:function(){if(this.loaded)this.trace("enlargeComplete, status="+this.status),this.helper.css({"max-width":this.photo_data.width+"px",transform:"translate3d("+
this.offset.x+"px, "+this.offset.y+"px, 0)"}).show(),this.container.before(this.helper).hide(),this.container.unbind(".loupe .loupe-move"),this.bind(this.helper),this.container.css({"max-width":"",transform:""}),this.link.find(".minimize").show(),this.status="maximized",$(".p-image-nav").hide();else{var a=this;setTimeout(function(){return a.enlargeComplete.apply(a,[this])},50)}},bind:function(a){this.trace("bind, status="+this.status);var e=this;a.bind("mousedown.loupe touchstart.loupe",function(g){return e.interaction.apply(e,
[this,g,a])});$(document).bind("mouseup.loupe touchend.loupe",function(g){return e.interaction.apply(e,[this,g,a])})},stop:function(){this.trace("stop at status="+this.status);var a=this.status;this.status="stop";switch(a){case "loading":this.container.stop();this.decrease(!0);break;case "maximized":this.decrease(!0);break;case "unloading":this.helper&&this.helper.stop(),this.decreaseComplete(!0)}this.container&&this.container.find("*").unbind(".loupe .loupe-move");$(document).unbind(".loupe .loupe-move");
a=$("div.photo-loupe-wrapper");$("#photo-loupe-link img:visible").hide();a.length&&this.container.unwrap();this.helper&&(this.helper.remove(),this.helper=null);this.status="thumb"},decrease:function(a){var e=this;this.trace("decrease, status="+this.status);this.loaded=!1;var g={transform:"translate3d(0, 0, 0)"};a||!this.options.animate?(this.helper.css(g),e.decreaseComplete()):this.helper.animate(g,function(){e.decreaseComplete()});return!1},decreaseComplete:function(a){this.trace("decreaseComplete, status="+
this.status);$("#photo").closest(".p-image").removeClass("p-image-maximized");this.link.find(".minimize").hide();this.link.find(".maximize").show();this.helper.hide();this.container.css(this.css.init).show();this.loader.remove();$(".p-image-nav").show();a||this.reset()},watch:function(a,e){this.drag&&("touchmove"===e.type?(this.offset.x=Math.min(0,Math.max(this.image_container_width-this.photo_data.width,Math.round(this.offset.x-this.offset.mouseX+e.touches[0].pageX))),this.offset.y=Math.min(0,Math.max(this.image_container_height-
this.photo_data.height,Math.round(this.offset.y-this.offset.mouseY+e.touches[0].pageY)))):(this.offset.x=Math.min(0,Math.max(this.image_container_width-this.photo_data.width,Math.round(this.offset.x-this.offset.mouseX+e.pageX))),this.offset.y=Math.min(0,Math.max(this.image_container_height-this.photo_data.height,Math.round(this.offset.y-this.offset.mouseY+e.pageY)))),"touchmove"===e.type?(this.offset.mouseX=e.touches[0].pageX,this.offset.mouseY=e.touches[0].pageY):(this.offset.mouseX=e.pageX,this.offset.mouseY=
e.pageY),("loading"==this.status?this.container:this.helper).css({transform:"translate3d("+this.offset.x+"px, "+this.offset.y+"px, 0)"}))}};(function(){jQuery.each({getSelection:function(){var a=this.jquery?this[0]:this;return("selectionStart"in a&&function(){var e=a.selectionEnd-a.selectionStart;return{start:a.selectionStart,end:a.selectionEnd,length:e,text:a.value.substr(a.selectionStart,e)}}||document.selection&&function(){a.focus();var e=document.selection.createRange();if(null===e)return{start:0,end:a.value.length,length:0};var g=a.createTextRange(),k=g.duplicate();g.moveToBookmark(e.getBookmark());k.setEndPoint("EndToStart",g);
return{start:k.text.length,end:k.text.length+e.text.length,length:e.text.length,text:e.text}}||function(){return null})()},replaceSelection:function(a){var e="function"==typeof this.id?this.get(0):this,g=a||"";return("selectionStart"in e&&function(){e.value=e.value.substr(0,e.selectionStart)+g+e.value.substr(e.selectionEnd,e.value.length);return this}||document.selection&&function(){e.focus();document.selection.createRange().text=g;return this}||function(){e.value+=g;return jQuery(e)})()}},function(a){jQuery.fn[a]=
this})})();!function(a){var e=[],g=[];a.fn.doAutosize=function(h){var b=a(this).data("minwidth"),c=a(this).data("maxwidth"),f="",m=a(this),q=a("#"+a(this).data("tester_id"));f!==(f=m.val())&&(f=f.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;"),q.html(f),q=q.width(),h=q+h.comfortZone>=b?q+h.comfortZone:b,(m.width()>h&&h>=b||h>b&&c>h)&&m.width(h))};a.fn.resetAutosize=function(h){var b=a(this).data("minwidth")||h.minInputWidth||a(this).width();h=a(this).data("maxwidth")||h.maxInputWidth||
a(this).closest(".tagsinput").width()-h.inputPadding;var c=a(this),f=a("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:c.css("fontSize"),fontFamily:c.css("fontFamily"),fontWeight:c.css("fontWeight"),letterSpacing:c.css("letterSpacing"),whiteSpace:"nowrap"}),m=a(this).attr("id")+"_autosize_tester";0< !a("#"+m).length&&(f.attr("id",m),f.appendTo("body"));c.data("minwidth",b);c.data("maxwidth",h);c.data("tester_id",m);c.css("width",b)};a.fn.addTag=function(h,b){return b=
jQuery.extend({focus:!1,callback:!0},b),this.each(function(){var c=a(this).attr("id"),f=a(this).val().split(e[c]);if(""==f[0]&&(f=[]),h=jQuery.trim(h),b.unique){var m=a(this).tagExist(h);1==m&&a("#"+c+"_tag").addClass("not_valid")}else m=!1;if(""!=h&&1!=m){if(a("<span>").addClass("tag").append(a("<span>").text(h).append("&nbsp;&nbsp;"),a("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return a("#"+c).removeTag(escape(h))})).insertBefore("#"+c+"_addTag"),f.push(h),a("#"+c+"_tag").val(""),
b.focus?a("#"+c+"_tag").focus():a("#"+c+"_tag").blur(),a.fn.tagsInput.updateTagsField(this,f),b.callback&&g[c]&&g[c].onAddTag)m=g[c].onAddTag,m.call(this,h);if(g[c]&&g[c].onChange){var q=f.length;m=g[c].onChange;m.call(this,a(this),f[q-1])}}}),!1};a.fn.removeTag=function(h){return h=unescape(h),this.each(function(){var b=a(this).attr("id"),c=a(this).val().split(e[b]);a("#"+b+"_tagsinput .tag").remove();str="";for(i=0;i<c.length;i++)c[i]!=h&&(str=str+e[b]+c[i]);(a.fn.tagsInput.importTags(this,str),
g[b]&&g[b].onRemoveTag)&&g[b].onRemoveTag.call(this,h)}),!1};a.fn.tagExist=function(h){var b=a(this).attr("id");b=a(this).val().split(e[b]);return 0<=jQuery.inArray(h,b)};a.fn.importTags=function(h){var b=a(this).attr("id");a("#"+b+"_tagsinput .tag").remove();a.fn.tagsInput.importTags(this,h)};a.fn.tagsInput=function(h){var b=jQuery.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,
placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},h),c=0;return this.each(function(){if("undefined"==typeof a(this).attr("data-tagsinput-init")){a(this).attr("data-tagsinput-init",!0);b.hide&&a(this).hide();var f=a(this).attr("id");f&&!e[a(this).attr("id")]||(f=a(this).attr("id","tags"+(new Date).getTime()+c++).attr("id"));var m=jQuery.extend({pid:f,real_input:"#"+f,holder:"#"+f+"_tagsinput",input_wrapper:"#"+f+"_addTag",fake_input:"#"+f+"_tag"},b);e[f]=m.delimiter;(b.onAddTag||
b.onRemoveTag||b.onChange)&&(g[f]=[],g[f].onAddTag=b.onAddTag,g[f].onRemoveTag=b.onRemoveTag,g[f].onChange=b.onChange);var q='<div id="'+f+'_tagsinput" class="tagsinput"><div id="'+f+'_addTag">';if(b.interactive&&(q=q+'<input id="'+f+'_tag" value="" data-default="'+b.defaultText+'" />'),q+='</div><div class="tags_clear"></div></div>',a(q).insertAfter(this),a(m.holder).css("width",b.width),a(m.holder).css("min-height",b.height),a(m.holder).css("height",b.height),""!=a(m.real_input).val()&&a.fn.tagsInput.importTags(a(m.real_input),
a(m.real_input).val()),b.interactive){if(a(m.fake_input).val(a(m.fake_input).attr("data-default")),a(m.fake_input).css("color",b.placeholderColor),a(m.fake_input).resetAutosize(b),a(m.holder).bind("click",m,function(p){a(p.data.fake_input).focus()}),a(m.fake_input).bind("focus",m,function(p){a(p.data.fake_input).val()==a(p.data.fake_input).attr("data-default")&&a(p.data.fake_input).val("");a(p.data.fake_input).css("color","#000000")}),void 0!=b.autocomplete_url){autocomplete_options={source:b.autocomplete_url};
for(attrname in b.autocomplete)autocomplete_options[attrname]=b.autocomplete[attrname];void 0!==jQuery.Autocompleter?(a(m.fake_input).autocomplete(b.autocomplete_url,b.autocomplete),a(m.fake_input).bind("result",m,function(p,t,u){t&&a("#"+f).addTag(t[0]+"",{focus:!0,unique:b.unique})})):void 0!==jQuery.ui.autocomplete&&(a(m.fake_input).autocomplete(autocomplete_options),a(m.fake_input).bind("autocompleteselect",m,function(p,t){return a(p.data.real_input).addTag(t.item.value,{focus:!0,unique:b.unique}),
!1}))}else a(m.fake_input).bind("blur",m,function(p){var t=a(this).attr("data-default");return""!=a(p.data.fake_input).val()&&a(p.data.fake_input).val()!=t?p.data.minChars<=a(p.data.fake_input).val().length&&(!p.data.maxChars||p.data.maxChars>=a(p.data.fake_input).val().length)&&a(p.data.real_input).addTag(a(p.data.fake_input).val(),{focus:!0,unique:b.unique}):(a(p.data.fake_input).val(a(p.data.fake_input).attr("data-default")),a(p.data.fake_input).css("color",b.placeholderColor)),!1});a(m.fake_input).bind("keypress",
m,function(p){return k(p)?(p.preventDefault(),p.data.minChars<=a(p.data.fake_input).val().length&&(!p.data.maxChars||p.data.maxChars>=a(p.data.fake_input).val().length)&&a(p.data.real_input).addTag(a(p.data.fake_input).val(),{focus:!0,unique:b.unique}),a(p.data.fake_input).resetAutosize(b),!1):void(p.data.autosize&&a(p.data.fake_input).doAutosize(b))});m.removeWithBackspace&&a(m.fake_input).bind("keydown",function(p){if(8==p.keyCode&&""==a(this).val()){p.preventDefault();p=a(this).closest(".tagsinput").find(".tag:last").text();
var t=a(this).attr("id").replace(/_tag$/,"");p=p.replace(/[\s]+x$/,"");a("#"+t).removeTag(escape(p));a(this).trigger("focus")}});a(m.fake_input).blur();m.unique&&a(m.fake_input).keydown(function(p){(8==p.keyCode||String.fromCharCode(p.which).match(/\w+|[\u00e1\u00e9\u00ed\u00f3\u00fa\u00c1\u00c9\u00cd\u00d3\u00da\u00f1\u00d1,/]+/))&&a(this).removeClass("not_valid")})}}}),this};a.fn.tagsInput.updateTagsField=function(h,b){var c=a(h).attr("id");a(h).val(b.join(e[c]))};a.fn.tagsInput.importTags=function(h,
b){a(h).val("");var c=a(h).attr("id");b=b.split(e[c]);for(i=0;i<b.length;i++)a(h).addTag(b[i],{focus:!1,callback:!1});g[c]&&g[c].onChange&&g[c].onChange.call(h,h,b[i])};var k=function(h){var b=!1;return 13==h.which?!0:("string"==typeof h.data.delimiter?h.which==h.data.delimiter.charCodeAt(0)&&(b=!0):a.each(h.data.delimiter,function(c,f){h.which==f.charCodeAt(0)&&(b=!0)}),b)}}(jQuery);
//# sourceMappingURL=photos-jquery.min.js.map
