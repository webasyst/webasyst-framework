"use strict";class SiteEditorInsideIframe{api;$wrapper;delayed_save;constructor(e){this.$wrapper=e.$wrapper,this.api=window.top.registerEditorIframe(this),this.delayed_save={},this.dropdown_open=!0,this.watchClicks()}watchClicks(){const e=this;let t=!1,a=!1;e.$wrapper.on("close_dropdown",(function(t,a){e.dropdown_open&&e.$wrapper.find(".dropdown.is-opened").each((function(e,t){t===a.target||$.contains(t,a.target)||$(t).waDropdown("dropdown").toggleMenu(!1)}))})),e.$wrapper.on("keydown",(function(r){if("Enter"===r.key){if($(r.target).hasClass("site-block-list"))return;document.execCommand("insertLineBreak"),r.preventDefault()}if(27==r.keyCode){var o=$.Event("keydown",{keyCode:r.keyCode});parent.$("body").trigger(o)}r.altKey&&!t&&(e.$wrapper.addClass("alt-down"),t=!0),r.shiftKey&&!a&&(e.$wrapper.addClass("shift-down"),a=!0)})),e.$wrapper.on("keyup",(function(r){t&&(t=!1,e.$wrapper.removeClass("alt-down")),a&&(a=!1,e.$wrapper.removeClass("shift-down"))})),$(window).on("blur",(function(r){t&&(t=!1,e.$wrapper.removeClass("alt-down")),a&&(a=!1,e.$wrapper.removeClass("shift-down"))})),e.$wrapper.on("paste",(function(e){e.preventDefault();var t=e.originalEvent.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,t)}))}openAddBlockDialog(e){const t=this;return $.Deferred((a=>{t.api.openAddBlockDialog(e,(e=>{a.resolve(e)}),(()=>{a.reject()}))})).promise()}saveBlockData(e,t,a){void 0===a&&(a=400),this.api.saveBlockData(e,t,{notify_block_settings_form:!0,mode:"update",delay:a})}updateBlockData(e,t,a){this.api.block_storage.setData(e,t,a);this.$wrapper.find('[data-block-id="'+e+'"]').trigger("block_data_updated",[e,t])}updateBlockFile(e,t,a){this.api.block_storage.setFile(e,t,a);this.$wrapper.find('[data-block-id="'+e+'"]').trigger("block_file_updated",[e,t,a])}updateBlockSettingsFormConfig(e,t){this.api.block_storage.setFormConfig(e,t)}setSelectedBlock(e,t,a,r=!1){if(this.$wrapper.trigger("close_dropdown",{target:a}),this.api.selected_block_id!=e){try{this.api.setSelectedBlock(e,r)}catch(e){console.log("unable to set selected block",e)}return $("#wa-app").find(".selected-block").removeClass("selected-block"),t.is(".seq-child")&&t.addClass("selected-block"),!0}return!1}static sanitizeHTML(e){if(!e)return e;return(e=>e.replace(/<iframe[^>]*src\s*=\s*"(.*?)"[^>]*>/g,((e,t)=>t.match(/^https?:/)?e+t:e.replace(t,""))))(e.replace(/<script[^>]*>.*?<\/script>/gis,""))}}