jQuery.fn.waDialog=function(a){var a=jQuery.extend({loading_header:"",title:"",esc:!0,buttons:null,url:null,url_reload:!0,"class":null,content:null,width:0,height:0,"min-width":0,"min-height":0,offsetTop:null,offsetLeft:null,disableButtonsOnSubmit:!1,onLoad:null,onCancel:null,onSubmit:null},a||{}),b=$(this),c=b.attr("id");c&&!b.hasClass("dialog")&&(b.removeAttr("id"),$("#"+c).length&&(a.url?(b=$("#"+c),a.url_reload||(a.url=null)):$("#"+c).remove()));var e=a["class"]||a.className?a["class"]||a.className:
b.attr("class")||"";if(b.hasClass("dialog"))a.content&&(b.find(".dialog-content-indent").html(a.content),a.title&&b.find(".dialog-content-indent").prepend("<h1>"+a.title+"</h1>")),a.buttons&&b.find(".dialog-buttons-gradient").empty().append(a.buttons);else{var f=$(this),b=$("<div "+(c?'id = "'+c+'"':"")+' class="dialog '+e+'" style="display: none"><div class="dialog-background"></div><div class="dialog-window"></div></div>').appendTo("body");if(f.find(".dialog-content").length||f.find(".dialog-buttons").length){if($(".dialog-window",
b).append(f.show()),c=f.find(".dialog-content"),c.length&&(e=$('<div class="dialog-content-indent"></div>'),c.contents().appendTo(e),c.append(e)),c=f.find(".dialog-buttons"),c.length)e=$('<div class="dialog-buttons-gradient"></div>'),c.contents().appendTo(e),c.append(e)}else $(".dialog-window",b).append((a.onSubmit?'<form method="post" action="">':"")+'<div class="dialog-content"><div class="dialog-content-indent"></div></div><div class="dialog-buttons"><div class="dialog-buttons-gradient"></div></div>'+
(a.onSubmit?"</form>":"")),b.find(".dialog-content-indent").append(f.show());a.buttons&&b.find(".dialog-buttons-gradient").empty().append(a.buttons);a.url?b.find(".dialog-content-indent").append("<h1>"+(a.loading_header||"")+'<i class="icon16 loading"></i></h1>'):a.content&&b.find(".dialog-content-indent").append(a.content);a.title&&b.find(".dialog-content-indent").prepend("<h1>"+a.title+"</h1>")}b.find(".dialog-background").length||b.prepend('<div class="dialog-background"> </div>');b.unbind("close").bind("close",
function(){a.onClose&&a.onClose.call($(this));$(this).hide()});f=["width","height","min-width","min-height"];for(c=0;c<f.length;c++)a[f[c]]&&(("height"==f[c]&&"300px">a[f[c]]||"width"==f[c]&&"400px">a[f[c]])&&b.find("div.dialog-window").css("min-"+f[c],a[f[c]]),b.find("div.dialog-window").css(f[c],a[f[c]]));a.disableButtonsOnSubmit&&b.find("input[type=submit]").removeAttr("disabled");b.parent().length||b.appendTo("body");b.show();a.url?jQuery.get(a.url,function(f){var c=$(f);if(c.find(".dialog-content").length||
c.find(".dialog-buttons").length){c.find(".dialog-content").length&&b.find(".dialog-content-indent").empty().append(c.find(".dialog-content").contents());c.find(".dialog-buttons").length&&b.find(".dialog-buttons-gradient").empty().append(c.find(".dialog-buttons").contents())}else b.find(".dialog-content-indent").html(f);b.trigger("wa-resize");a.onLoad&&a.onLoad.call(b.get(0))}):a.onLoad&&a.onLoad.call(b.get(0));b.find(".dialog-buttons").delegate(".cancel","click",function(c){c.stopPropagation();c.preventDefault();
a.onCancel&&a.onCancel.call(b.get(0));b.trigger("close");return false});a.onSubmit&&b.find("form").unbind("submit").submit(function(){a.disableButtonsOnSubmit&&b.find("input[type=submit]").attr("disabled","disabled");return a.onSubmit.apply(this,[b])});b.unbind("wa-resize").bind("wa-resize",function(){var b=jQuery(this).find(".dialog-window"),c=b.width(),f=b.height();jQuery("body").css("min-height",f+"px");var e=jQuery(window).width(),k=jQuery(window).height()-60,c=(e-c)/2/e,f=(k-f-60)/2/k;f<0&&(f=
0);c<0&&(c=0);b.css({left:a.offsetLeft||Math.round(c*100)+"%",top:a.offsetTop||Math.round(f*100)+"%"})}).trigger("wa-resize");a.esc&&b.unbind("esc").bind("esc",function(){b.trigger("close")});return b};jQuery(window).resize(function(){jQuery(".dialog:visible").trigger("wa-resize")});jQuery(document).keyup(function(a){27==a.keyCode&&jQuery(".dialog:visible").trigger("esc")});/*
 GNU Affero General Public License - {@link http://www.gnu.org/licenses/agpl.html}
 @example Visit {@link http://jquery.com/plugins/project/jquery_history_bal} for more information.


 I would like to take this space to thank the following projects, blogs, articles and people:
 - jQuery {@link http://jquery.com/}
 - jQuery UI History - Klaus Hartl {@link http://www.stilbuero.de/jquery/ui_history/}
 - Really Simple History - Brian Dillard and Brad Neuberg {@link http://code.google.com/p/reallysimplehistory/}
 - jQuery History Plugin - Taku Sano (Mikage Sawatari) {@link http://www.mikage.to/jquery/jquery_history.html}
 - jQuery History Remote Plugin - Klaus Hartl {@link http://stilbuero.de/jquery/history/}
 - Content With Style: Fixing the back button and enabling bookmarking for ajax apps - Mike Stenhouse {@link http://www.contentwithstyle.co.uk/Articles/38/fixing-the-back-button-and-enabling-bookmarking-for-ajax-apps}
 - Bookmarks and Back Buttons {@link http://ajax.howtosetup.info/options-and-efficiencies/bookmarks-and-back-buttons/}
 - Ajax: How to handle bookmarks and back buttons - Brad Neuberg {@link http://dev.aol.com/ajax-handling-bookmarks-and-back-button}



 CHANGELOG

 v1.0.1-final, July 11, 2009
 - Restructured a little bit
 - Documented
 - Cleaned go/request

 v1.0.0-final, June 19, 2009
 - Been stable for over a year now, pushing live.

 v0.1.0-dev, July 24, 2008
 - Initial Release

*/
(function(a){"undefined"===typeof console&&(console="undefined"!==typeof window.console?window.console:{});console.log=console.log||function(){};console.debug=console.debug||console.log;console.warn=console.warn||console.log;console.error=console.error||function(){for(var a=[],c=0;c<arguments.length;c++)a.push(arguments[c]);alert(a.join("\n"))};console.trace=console.trace||console.log;console.group=console.group||console.log;console.groupEnd=console.groupEnd||console.log;console.profile=console.profile||
console.log;console.profileEnd=console.profileEnd||console.log;a.History={options:{debug:!1},state:"",$window:null,$iframe:null,handlers:{generic:[],specific:{}},format:function(a){return a=a.replace(/^.+?#/g,"").replace(/^#?\/?|\/?$/g,"")},getState:function(){return a.History.state},setState:function(b){var c=a.History,b=c.format(b);c.state=b;return c.state},getHash:function(){var b=parent&&!a.browser.msie?parent.window.location.hash:window.location.hash||location.hash;return b=a.History.format(b)},
setHash:function(b){b=a.History.format(b);b=b.replace(/^\/?|\/?(\?)|\/?$/g,"/$1");"undefined"===typeof window.location.hash&&(location.hash=b);a.browser.msie&&8>parseInt(a.browser.version,10)&&(a.History.$iframe.contentWindow.document.open(),a.History.$iframe.contentWindow.document.close())},go:function(b){var c=a.History,b=c.format(b);c.getHash()!==b?c.setHash(b):(c.setState(b),c.trigger());return!0},hashchange:function(b){var c=a.History;c.options.debug&&console.debug("History.hashchange",this,
arguments);var e=c.getHash(),f=c.getState();if(!c.$iframe&&f===e||c.$iframe&&c.hash===c.$iframe.contentWindow.document.location.hash||f===e)return!1;c.setState(e);c.trigger();return!0},bind:function(b,c){var e=a.History;c?("undefined"===typeof e.handlers.specific[b]&&(e.handlers.specific[b]=[]),e.handlers.specific[b].push(c)):e.handlers.generic.push(b);return!0},trigger:function(b){var c=a.History;"undefined"===typeof b&&(b=c.getState());var e,f,d,g;if("undefined"!==typeof c.handlers.specific[b]){g=
c.handlers.specific[b];e=0;for(f=g.length;e<f;++e)d=g[e],d(b)}g=c.handlers.generic;e=0;for(f=g.length;e<f;++e)d=g[e],d(b);return!0},construct:function(){var b=a.History;a(document).ready(function(){b.domReady()});return!0},configure:function(b){var c=a.History;c.options=a.extend(c.options,b);return!0},domReadied:!1,domReady:function(){var b=a.History;if(!b.domRedied)return b.domRedied=!0,b.$window=a(window),b.$window.bind("hashchange",this.hashchange),setTimeout(b.hashchangeLoader,200),!0},hashchangeLoader:function(){var b=
a.History;if(a.browser.msie&&8<=parseInt(a.browser.version))(c=b.getHash())&&b.$window.trigger("hashchange");else{if(a.browser.msie){b.$iframe=a('<iframe id="jquery-history-iframe" style="display: none;"></$iframe>').prependTo(document.body)[0];b.$iframe.contentWindow.document.open();b.$iframe.contentWindow.document.close();var c=b.getHash();c&&(b.$iframe.contentWindow.document.location.hash=c);c=function(){var a=b.format(b.$iframe.contentWindow.document.location.hash);b.getState()!==a&&b.setHash(b.$iframe.contentWindow.document.location.hash);
a=b.getHash();b.getState()!==a&&b.go(a)}}else c=function(){var a=b.getHash();b.getState()!==a&&b.go(a)};a.browser.msie&&8>parseInt(a.browser.version)?setInterval(c,1500):setInterval(c,200)}return!0}};a.History.construct()})(jQuery);$.wa=$.ui?$.extend(!0,$.wa,$.ui):{};
$.wa=$.extend(!0,$.wa,{data:{},get:function(a,b){return a==void 0?this.data:this.data[name]||b||null},set:function(a){if(a==void 0)return this.data;typeof a=="object"?$.extend(this.data,a):this.data[a]=value;return this.data},encodeHTML:function(a){return a&&(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},decodeHTML:function(a){return a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")},setHash:function(a){!(a instanceof String)&&a.toString&&(a=a.toString());
a=a.replace(/\/\//g,"/");a=a.replace(/^.*#/,"");$.browser&&$.browser.safari?parent?parent.window.location=parent.window.location.href.replace(/#.*/,"")+"#"+a:location=location.href.replace(/#.*/,"")+"#"+a:parent&&(!$.browser||!$.browser.msie)?parent.window.location.hash=a:location.hash=a;return true},back:function(a){history.length>2?typeof a=="number"&&parseInt(a)==a?history.go(-a):history.go(-1):$.browser.msie&&history.length>0?history.back():a&&this.setHash(a);return false},toggleHashParam:function(a){location.hash.search(a)==
-1?this.addToHash(a):this.removeFromHash(a)},addToHash:function(a){var b=location.hash;b.search(a)==-1&&(b=b+("/"+a+"/"));this.setHash(b)},removeFromHash:function(a){var b=location.hash;b.search(a)>-1&&(b=b.replace(a,""));this.setHash(b)},setTitle:function(a){document.title=a},array_search:function(a,b,c){var c=!!c,e;for(e in b)if(c&&b[e]===a||!c&&b[e]==a)return e;return false},dialogCreate:function(a,b){b=$.extend({content:'<h1>Loading... <i class="icon16 loading"></i></h1>',buttons:null,url:null,
post:null,small:false,onload:null,oncancel:null},b);b.content=$(b.content);b.buttons=b.buttons?$(b.buttons):$('<input type="submit" class="button gray" value="'+$_("Cancel")+'">').click(function(){b.oncancel&&b.oncancel.call(c[0]);$.wa.dialogHide()});var c=$("#"+a);c.size()<=0&&(c=$('<div class="dialog" id="'+a+'" style="display: none"><div class="dialog-background"></div><div class="dialog-window"><div class="dialog-content"><div class="dialog-content-indent"></div></div><div class="dialog-buttons"><div class="dialog-buttons-gradient"></div></div></div></div>').appendTo("body"));
c.find(".dialog-buttons-gradient").empty().append(b.buttons);c.find(".dialog-content-indent").empty().append(b.content);c.show();b.small?c.addClass("small"):c.removeClass("small");if(b.url){var e=function(a){c.find(".dialog-content-indent").html(a);$.wa.waCenterDialog(c);b.onload&&b.onload.call(c[0])};b.post?$.post(b.url,b.post,e):$.get(b.url,e)}this.waCenterDialog(c);var f=function(a){if(c.is(":visible"))if(a&&a.keyCode==27){b.oncancel&&typeof b.oncancel=="function"&&b.oncancel.call(c[0]);$.wa.dialogHide()}else $(document).one("keyup",
f)};f();$(document).one("hashchange",$.wa.dialogHide);return c},waCenterDialog:function(a){var a=$(a),a=a.find(".dialog-window"),b=a.outerWidth(true),c=a.outerHeight(true),e=$(window).width(),f=$(window).height(),c=(f-c)/2/f;a.css({left:Math.round((e-b)/2/e*100)+"%",top:Math.round(c*100)+"%"})},dialogHide:function(){$(".dialog").hide();return false},dropdownsClose:function(){var a=$(".dropdown:not(.disabled)");a.addClass("disabled");setTimeout(function(){a.removeClass("disabled")},600)},dropdownsCloseEnable:function(){$(document).on("click",
".dropdown:not(.disabled)",this.dropdownsClickHandler)},dropdownsCloseDisable:function(){$(document).off("click",".dropdown:not(.disabled)",this.dropdownsClickHandler)},dropdownsClickHandler:function(){var a=$(this);if(!a.hasClass("no-click-close")){a.addClass("disabled");setTimeout(function(){a.removeClass("disabled")},600)}},defaultInputValue:function(a,b,c){a instanceof jQuery||(a=$(a));var e=function(){var f=a.val();if(!f||f==b){a.val(b);a.addClass(c)}};e();a.blur(e);a.focus(function(){if(a.hasClass(c)){a.removeClass(c);
a.val("")}})},util:{formatFileSize:function(a){var b=-1;do{a=a/1024;b++}while(a>99);return Math.max(a,0.01).toFixed(2)+(b>=0?" "+$_(["kB","MB","GB","TB","PB","EB"][b]):"")}}});
$(document).ajaxError(function(a,b){if(200!==b.status&&b.responseText){if(!$.wa.errorHandler||$.wa.errorHandler(b))-1!=b.responseText.indexOf("Exception")?$.wa.dialogCreate("ajax-error",{content:"<div>"+b.responseText+"</div>"}):(document.open("text/html"),document.write(b.responseText),document.close(),$(window).one("hashchange",function(){window.location.reload()}))}else b.getResponseHeader("wa-session-expired")?window.location.reload():"undefined"!==typeof b.responseText&&-1!=b.responseText.indexOf("Exception")&&
$.wa.dialogCreate("ajax-error",{content:"<div>"+b.responseText+"</div>"})});$.ajaxSetup({cache:!1});$(document).ajaxSend(function(a,b,c){"POST"==c.type&&((a=(a=document.cookie.match(/(?:^|; )_csrf=([^;]*)/))?decodeURIComponent(a[1]):"",null===c.data&&(c.data=""),"string"==typeof c.data)?-1==c.data.indexOf("_csrf=")&&(c.data+=(0<c.data.length?"&":"")+"_csrf="+a,b.setRequestHeader("Content-type","application/x-www-form-urlencoded")):"object"==typeof c.data&&(c.data._csrf=a))});
Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c=this.length,e=Number(b)||0,e=0>e?Math.ceil(e):Math.floor(e);for(0>e&&(e+=c);e<c;e++)if(e in this&&this[e]===a)return e;return-1});$.wa.locale=$.wa.locale||{};
$_=function(a,b){if(b){if(!$.wa.locale[b]){console&&console.log("Localization failed: "+b);return b}if(typeof $.wa.locale[b]=="string")return $.wa.locale[b];var c=a%10;return Math.floor(a/10)%10==1||c>4||c==0?$.wa.locale[b][2]:c==1?$.wa.locale[b][0]:$.wa.locale[b][1]}if($.wa.locale[a])return typeof $.wa.locale[a]=="string"?$.wa.locale[a]:$.wa.locale[a][0];console&&console.log("Localization failed: "+a);return a};jQuery.JSON={useHasOwn:{}.hasOwnProperty?!0:!1,pad:function(a){return 10>a?"0"+a:a},m:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},encodeString:function(a){return/["\\\x00-\x1f]/.test(a)?'"'+a.replace(/([\x00-\x1f\\"])/g,function(a,c){var e=jQuery.JSON.m[c];if(e)return e;e=c.charCodeAt();return"\\u00"+Math.floor(e/16).toString(16)+(e%16).toString(16)})+'"':'"'+a+'"'},encodeArray:function(a){var b=["["],c,e,f=a.length,d;for(e=0;e<f;e+=1)switch(d=a[e],typeof d){case "undefined":case "function":case "unknown":break;
default:c&&b.push(","),b.push(null===d?"null":this.encode(d)),c=!0}b.push("]");return b.join("")},encodeDate:function(a){return'"'+a.getFullYear()+"-"+pad(a.getMonth()+1)+"-"+pad(a.getDate())+"T"+pad(a.getHours())+":"+pad(a.getMinutes())+":"+pad(a.getSeconds())+'"'},encode:function(a){if("undefined"==typeof a||null===a)return"null";if(a instanceof Array)return this.encodeArray(a);if(a instanceof Date)return this.encodeDate(a);if("string"==typeof a)return this.encodeString(a);if("number"==typeof a)return isFinite(a)?
String(a):"null";if("boolean"==typeof a)return String(a);var b=["{"],c,e,f;for(e in a)if(!this.useHasOwn||a.hasOwnProperty(e))switch(f=a[e],typeof f){case "undefined":case "function":case "unknown":break;default:c&&b.push(","),b.push(this.encode(e),":",null===f?"null":this.encode(f)),c=!0}b.push("}");return b.join("")},decode:function(a){return eval("("+a+")")}};(function(a,b){a.store=function(b,e){var f=this;if("string"==typeof b)if(a.store.drivers[b])this.driver=a.store.drivers[b];else throw Error("Unknown driver "+b);else if("object"==typeof b){if(!a.isFunction(b.init)||!a.isFunction(b.get)||!a.isFunction(b.set)||!a.isFunction(b.del)||!a.isFunction(b.flush))throw Error("The specified driver does not fulfill the API requirements");this.driver=b}else a.each(a.store.drivers,function(){if(!a.isFunction(this.available)||!this.available())return!0;f.driver=
this;return!1===f.driver.init()?(f.driver=null,!0):!1});e||(e=a.store.serializers);this.serializers={};a.each(e,function(b){if(!a.isFunction(this.init))return true;f.serializers[b]=this;f.serializers[b].init(f.encoders,f.decoders)})};a.extend(a.store.prototype,{get:function(a){a=this.driver.get(a);return this.driver.encodes?a:this.unserialize(a)},set:function(a,b){this.driver.set(a,this.driver.encodes?b:this.serialize(b))},del:function(a){this.driver.del(a)},flush:function(){this.driver.flush()},
driver:b,encoders:[],decoders:[],serialize:function(b){var e=this;a.each(this.encoders,function(){var a=e.serializers[this+""];if(!a||!a.encode)return!0;try{b=a.encode(b)}catch(d){}});return b},unserialize:function(b){var e=this;if(!b)return b;a.each(this.decoders,function(){var a=e.serializers[this+""];if(!a||!a.decode)return!0;b=a.decode(b)});return b}});a.store.drivers={localStorage:{ident:"$.store.drivers.localStorage",scope:"browser",available:function(){try{return!!window.localStorage}catch(a){return!1}},
init:a.noop,get:function(a){return window.localStorage.getItem(a)},set:function(a,b){window.localStorage.setItem(a,b)},del:function(a){window.localStorage.removeItem(a)},flush:function(){window.localStorage.clear()}},userData:{ident:"$.store.drivers.userData",element:null,nodeName:"userdatadriver",scope:"browser",initialized:!1,available:function(){try{return!(!document.documentElement||!document.documentElement.addBehavior)}catch(a){return!1}},init:function(){if(!this.initialized)try{this.element=
document.createElement(this.nodeName),document.documentElement.insertBefore(this.element,document.getElementsByTagName("title")[0]),this.element.addBehavior("#default#userData"),this.initialized=!0}catch(a){return!1}},get:function(a){this.element.load(this.nodeName);return this.element.getAttribute(a)},set:function(a,b){this.element.setAttribute(a,b);this.element.save(this.nodeName)},del:function(a){this.element.removeAttribute(a);this.element.save(this.nodeName)},flush:function(){this.element.expires=
(new Date).toUTCString();this.element.save(this.nodeName)}},windowName:{ident:"$.store.drivers.windowName",scope:"window",cache:{},encodes:!0,available:function(){return!0},init:function(){this.load()},save:function(){window.name=a.store.serializers.json.encode(this.cache)},load:function(){try{this.cache=a.store.serializers.json.decode(window.name+""),"object"!=typeof this.cache&&(this.cache={})}catch(b){this.cache={},window.name="{}"}},get:function(a){return this.cache[a]},set:function(a,b){this.cache[a]=
b;this.save()},del:function(a){try{delete this.cache[a]}catch(e){this.cache[a]=b}this.save()},flush:function(){window.name="{}"}}};a.store.serializers={json:{ident:"$.store.serializers.json",init:function(a,b){a.push("json");b.push("json")},encode:"object"==typeof JSON?JSON.stringify:a.JSON.stringify,decode:"object"==typeof JSON?JSON.parse:a.JSON.parse},xml:{ident:"$.store.serializers.xml",init:function(a,b){a.unshift("xml");b.push("xml")},isXML:function(a){return(a=(a?a.ownerDocument||a:0).documentElement)?
"html"!==a.nodeName.toLowerCase():!1},encode:function(a){if(!a||a._serialized||!this.isXML(a))return a;var b={_serialized:this.ident,value:a};try{return b.value=(new XMLSerializer).serializeToString(a),b}catch(f){try{return b.value=a.xml,b}catch(d){}}return a},decode:function(a){if(!a||!a._serialized||a._serialized!=this.ident)return a;var e="DOMParser"in window&&(new DOMParser).parseFromString;!e&&window.ActiveXObject&&(e=function(a){var b=new ActiveXObject("Microsoft.XMLDOM");b.async="false";b.loadXML(a);
return b});if(!e)return b;a.value=e.call("DOMParser"in window&&new DOMParser||window,a.value,"text/xml");return this.isXML(a.value)?a.value:b}}}})(jQuery);(function(a){a.ui=a.ui||{};var b=/left|center|right/,c=/top|center|bottom/,e={},f=a.fn.position,d=a.fn.offset;a.fn.position=function(d){if(!d||!d.of)return f.apply(this,arguments);var d=a.extend({},d),g=a(d.of),j=g[0],k=(d.collision||"flip").split(" "),o=d.offset?d.offset.split(" "):[0,0],h,l,m;return 9===j.nodeType?(h=g.width(),l=g.height(),m={top:0,left:0}):j.setTimeout?(h=g.width(),l=g.height(),m={top:g.scrollTop(),left:g.scrollLeft()}):j.preventDefault?(d.at="left top",h=l=0,m={top:d.of.pageY,
left:d.of.pageX}):(h=g.outerWidth(),l=g.outerHeight(),m=g.offset()),a.each(["my","at"],function(){var a=(d[this]||"").split(" ");1===a.length&&(a=b.test(a[0])?a.concat(["center"]):c.test(a[0])?["center"].concat(a):["center","center"]);a[0]=b.test(a[0])?a[0]:"center";a[1]=c.test(a[1])?a[1]:"center";d[this]=a}),1===k.length&&(k[1]=k[0]),o[0]=parseInt(o[0],10)||0,1===o.length&&(o[1]=o[0]),o[1]=parseInt(o[1],10)||0,"right"===d.at[0]?m.left+=h:"center"===d.at[0]&&(m.left+=h/2),"bottom"===d.at[1]?m.top+=
l:"center"===d.at[1]&&(m.top+=l/2),m.left+=o[0],m.top+=o[1],this.each(function(){var b=a(this),f=b.outerWidth(),c=b.outerHeight(),g=parseInt(a.curCSS(this,"marginLeft",!0))||0,j=parseInt(a.curCSS(this,"marginTop",!0))||0,q=f+g+(parseInt(a.curCSS(this,"marginRight",!0))||0),r=c+j+(parseInt(a.curCSS(this,"marginBottom",!0))||0),n=a.extend({},m),s;"right"===d.my[0]?n.left-=f:"center"===d.my[0]&&(n.left-=f/2);"bottom"===d.my[1]?n.top-=c:"center"===d.my[1]&&(n.top-=c/2);e.fractions||(n.left=Math.round(n.left),
n.top=Math.round(n.top));s={left:n.left-g,top:n.top-j};a.each(["left","top"],function(b,e){a.ui.position[k[b]]&&a.ui.position[k[b]][e](n,{targetWidth:h,targetHeight:l,elemWidth:f,elemHeight:c,collisionPosition:s,collisionWidth:q,collisionHeight:r,offset:o,my:d.my,at:d.at})});a.fn.bgiframe&&b.bgiframe();b.offset(a.extend(n,{using:d.using}))})};a.ui.position={fit:{left:function(b,f){var d=a(window),d=f.collisionPosition.left+f.collisionWidth-d.width()-d.scrollLeft();b.left=0<d?b.left-d:Math.max(b.left-
f.collisionPosition.left,b.left)},top:function(b,f){var d=a(window),d=f.collisionPosition.top+f.collisionHeight-d.height()-d.scrollTop();b.top=0<d?b.top-d:Math.max(b.top-f.collisionPosition.top,b.top)}},flip:{left:function(b,f){if("center"!==f.at[0]){var d=a(window),d=f.collisionPosition.left+f.collisionWidth-d.width()-d.scrollLeft(),c="left"===f.my[0]?-f.elemWidth:"right"===f.my[0]?f.elemWidth:0,e="left"===f.at[0]?f.targetWidth:-f.targetWidth,g=-2*f.offset[0];b.left+=0>f.collisionPosition.left?c+
e+g:0<d?c+e+g:0}},top:function(b,f){if("center"!==f.at[1]){var d=a(window),d=f.collisionPosition.top+f.collisionHeight-d.height()-d.scrollTop(),c="top"===f.my[1]?-f.elemHeight:"bottom"===f.my[1]?f.elemHeight:0,e="top"===f.at[1]?f.targetHeight:-f.targetHeight,g=-2*f.offset[1];b.top+=0>f.collisionPosition.top?c+e+g:0<d?c+e+g:0}}}};a.offset.setOffset||(a.offset.setOffset=function(b,f){/static/.test(a.curCSS(b,"position"))&&(b.style.position="relative");var d=a(b),c=d.offset(),e=parseInt(a.curCSS(b,"top",
!0),10)||0,g=parseInt(a.curCSS(b,"left",!0),10)||0,c={top:f.top-c.top+e,left:f.left-c.left+g};"using"in f?f.using.call(b,c):d.css(c)},a.fn.offset=function(b){var f=this[0];return!f||!f.ownerDocument?null:b?a.isFunction(b)?this.each(function(f){a(this).offset(b.call(this,f,a(this).offset()))}):this.each(function(){a.offset.setOffset(this,b)}):d.call(this)});a.curCSS||(a.curCSS=a.css);var g=document.getElementsByTagName("body")[0],j=document.createElement("div"),h,k;h=document.createElement(g?"div":
"body");k={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};g&&a.extend(k,{position:"absolute",left:"-1000px",top:"-1000px"});for(var l in k)h.style[l]=k[l];h.appendChild(j);k=g||document.documentElement;k.insertBefore(h,k.firstChild);j.style.cssText="position: absolute; left: 10.7432222px; top: 10.432325px; height: 30px; width: 201px;";j=a(j).offset(function(a,b){return b}).offset();h.innerHTML="";k.removeChild(h);g=j.top+j.left+(g?2E3:0);e.fractions=21<g&&22>g})(jQuery);(function(a,b){var c={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},e={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};a.widget("ui.dialog",{options:{autoOpen:!0,buttons:{},closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:!1,maxWidth:!1,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",collision:"fit",using:function(b){var d=a(this).css(b).offset().top;0>d&&a(this).css("top",b.top-d)}},resizable:!0,
show:null,stack:!0,title:"",width:300,zIndex:1E3},_create:function(){this.originalTitle=this.element.attr("title");"string"!==typeof this.originalTitle&&(this.originalTitle="");this.options.title=this.options.title||this.originalTitle;var b=this,d=b.options,c=d.title||"&#160;",e=a.ui.dialog.getTitleId(b.element),h=(b.uiDialog=a("<div></div>")).appendTo(document.body).hide().addClass("ui-dialog ui-widget ui-widget-content ui-corner-all "+d.dialogClass).css({zIndex:d.zIndex}).attr("tabIndex",-1).css("outline",
0).keydown(function(c){if(d.closeOnEscape&&c.keyCode&&c.keyCode===a.ui.keyCode.ESCAPE){b.close(c);c.preventDefault()}}).attr({role:"dialog","aria-labelledby":e}).mousedown(function(a){b.moveToTop(false,a)});b.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(h);var k=(b.uiDialogTitlebar=a("<div></div>")).addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(h),l=a('<a href="#"></a>').addClass("ui-dialog-titlebar-close ui-corner-all").attr("role",
"button").hover(function(){l.addClass("ui-state-hover")},function(){l.removeClass("ui-state-hover")}).focus(function(){l.addClass("ui-state-focus")}).blur(function(){l.removeClass("ui-state-focus")}).click(function(a){b.close(a);return false}).appendTo(k);(b.uiDialogTitlebarCloseText=a("<span></span>")).addClass("ui-icon ui-icon-closethick").text(d.closeText).appendTo(l);a("<span></span>").addClass("ui-dialog-title").attr("id",e).html(c).prependTo(k);a.isFunction(d.beforeclose)&&!a.isFunction(d.beforeClose)&&
(d.beforeClose=d.beforeclose);k.find("*").add(k).disableSelection();d.draggable&&a.fn.draggable&&b._makeDraggable();d.resizable&&a.fn.resizable&&b._makeResizable();b._createButtons(d.buttons);b._isOpen=!1;a.fn.bgiframe&&h.bgiframe()},_init:function(){this.options.autoOpen&&this.open()},destroy:function(){this.overlay&&this.overlay.destroy();this.uiDialog.hide();this.element.unbind(".dialog").removeData("dialog").removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body");this.uiDialog.remove();
this.originalTitle&&this.element.attr("title",this.originalTitle);return this},widget:function(){return this.uiDialog},close:function(b){var d=this,c,e;if(!1!==d._trigger("beforeClose",b))return d.overlay&&d.overlay.destroy(),d.uiDialog.unbind("keypress.ui-dialog"),d._isOpen=!1,d.options.hide?d.uiDialog.hide(d.options.hide,function(){d._trigger("close",b)}):(d.uiDialog.hide(),d._trigger("close",b)),a.ui.dialog.overlay.resize(),d.options.modal&&(c=0,a(".ui-dialog").each(function(){if(this!==d.uiDialog[0]){e=
a(this).css("z-index");isNaN(e)||(c=Math.max(c,e))}}),a.ui.dialog.maxZ=c),d},isOpen:function(){return this._isOpen},moveToTop:function(b,d){var c=this.options;if(c.modal&&!b||!c.stack&&!c.modal)return this._trigger("focus",d);c.zIndex>a.ui.dialog.maxZ&&(a.ui.dialog.maxZ=c.zIndex);this.overlay&&(a.ui.dialog.maxZ+=1,this.overlay.$el.css("z-index",a.ui.dialog.overlay.maxZ=a.ui.dialog.maxZ));b={scrollTop:this.element.attr("scrollTop"),scrollLeft:this.element.attr("scrollLeft")};a.ui.dialog.maxZ+=1;this.uiDialog.css("z-index",
a.ui.dialog.maxZ);this.element.attr(b);this._trigger("focus",d);return this},open:function(){if(!this._isOpen){var b=this.options,d=this.uiDialog;this.overlay=b.modal?new a.ui.dialog.overlay(this):null;this._size();this._position(b.position);d.show(b.show);this.moveToTop(!0);b.modal&&d.bind("keypress.ui-dialog",function(b){if(b.keyCode===a.ui.keyCode.TAB){var f=a(":tabbable",this),d=f.filter(":first"),f=f.filter(":last");if(b.target===f[0]&&!b.shiftKey)return d.focus(1),!1;if(b.target===d[0]&&b.shiftKey)return f.focus(1),
!1}});a(this.element.find(":tabbable").get().concat(d.find(".ui-dialog-buttonpane :tabbable").get().concat(d.get()))).eq(0).focus();this._isOpen=!0;this._trigger("open");return this}},_createButtons:function(b){var d=this,c=!1,e=a("<div></div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),h=a("<div></div>").addClass("ui-dialog-buttonset").appendTo(e);d.uiDialog.find(".ui-dialog-buttonpane").remove();"object"===typeof b&&null!==b&&a.each(b,function(){return!(c=!0)});c&&(a.each(b,
function(b,f){f=a.isFunction(f)?{click:f,text:b}:f;b=a('<button type="button"></button>').attr(f,!0).unbind("click").click(function(){f.click.apply(d.element[0],arguments)}).appendTo(h);a.fn.button&&b.button()}),e.appendTo(d.uiDialog))},_makeDraggable:function(){function b(a){return{position:a.position,offset:a.offset}}var d=this,c=d.options,e=a(document),h;d.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(e,
j){h="auto"===c.height?"auto":a(this).height();a(this).height(a(this).height()).addClass("ui-dialog-dragging");d._trigger("dragStart",e,b(j))},drag:function(a,c){d._trigger("drag",a,b(c))},stop:function(k,l){c.position=[l.position.left-e.scrollLeft(),l.position.top-e.scrollTop()];a(this).removeClass("ui-dialog-dragging").height(h);d._trigger("dragStop",k,b(l));a.ui.dialog.overlay.resize()}})},_makeResizable:function(f){function d(a){return{originalPosition:a.originalPosition,originalSize:a.originalSize,
position:a.position,size:a.size}}var f=f===b?this.options.resizable:f,c=this,e=c.options,h=c.uiDialog.css("position"),f="string"===typeof f?f:"n,e,s,w,se,sw,ne,nw";c.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:c.element,maxWidth:e.maxWidth,maxHeight:e.maxHeight,minWidth:e.minWidth,minHeight:c._minHeight(),handles:f,start:function(b,f){a(this).addClass("ui-dialog-resizing");c._trigger("resizeStart",b,d(f))},resize:function(a,b){c._trigger("resize",a,d(b))},stop:function(b,
f){a(this).removeClass("ui-dialog-resizing");e.height=a(this).height();e.width=a(this).width();c._trigger("resizeStop",b,d(f));a.ui.dialog.overlay.resize()}}).css("position",h).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var a=this.options;return"auto"===a.height?a.minHeight:Math.min(a.minHeight,a.height)},_position:function(b){var d=[],c=[0,0],e;if(b){if("string"===typeof b||"object"===typeof b&&"0"in b)d=b.split?b.split(" "):[b[0],b[1]],1===d.length&&
(d[1]=d[0]),a.each(["left","top"],function(a,b){+d[a]===d[a]&&(c[a]=d[a],d[a]=b)}),b={my:d.join(" "),at:d.join(" "),offset:c.join(" ")};b=a.extend({},a.ui.dialog.prototype.options.position,b)}else b=a.ui.dialog.prototype.options.position;(e=this.uiDialog.is(":visible"))||this.uiDialog.show();this.uiDialog.css({top:0,left:0}).position(a.extend({of:window},b));e||this.uiDialog.hide()},_setOptions:function(b){var d=this,g={},j=!1;a.each(b,function(a,b){d._setOption(a,b);a in c&&(j=!0);a in e&&(g[a]=
b)});j&&this._size();this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option",g)},_setOption:function(b,d){var c=this.uiDialog;switch(b){case "beforeclose":b="beforeClose";break;case "buttons":this._createButtons(d);break;case "closeText":this.uiDialogTitlebarCloseText.text(""+d);break;case "dialogClass":c.removeClass(this.options.dialogClass).addClass("ui-dialog ui-widget ui-widget-content ui-corner-all "+d);break;case "disabled":d?c.addClass("ui-dialog-disabled"):c.removeClass("ui-dialog-disabled");
break;case "draggable":var e=c.is(":data(draggable)");e&&!d&&c.draggable("destroy");!e&&d&&this._makeDraggable();break;case "position":this._position(d);break;case "resizable":(e=c.is(":data(resizable)"))&&!d&&c.resizable("destroy");e&&"string"===typeof d&&c.resizable("option","handles",d);!e&&!1!==d&&this._makeResizable(d);break;case "title":a(".ui-dialog-title",this.uiDialogTitlebar).html(""+(d||"&#160;"))}a.Widget.prototype._setOption.apply(this,arguments)},_size:function(){var b=this.options,
d,c,e=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0});b.minWidth>b.width&&(b.width=b.minWidth);d=this.uiDialog.css({height:"auto",width:b.width}).height();c=Math.max(0,b.minHeight-d);"auto"===b.height?a.support.minHeight?this.element.css({minHeight:c,height:"auto"}):(this.uiDialog.show(),b=this.element.css("height","auto").height(),e||this.uiDialog.hide(),this.element.height(Math.max(b,c))):this.element.height(Math.max(b.height-d,0));this.uiDialog.is(":data(resizable)")&&
this.uiDialog.resizable("option","minHeight",this._minHeight())}});a.extend(a.ui.dialog,{version:"1.8.9",uuid:0,maxZ:0,getTitleId:function(a){a=a.attr("id");a||(a=this.uuid+=1);return"ui-dialog-title-"+a},overlay:function(b){this.$el=a.ui.dialog.overlay.create(b)}});a.extend(a.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:a.map("focus mousedown mouseup keydown keypress click".split(" "),function(a){return a+".dialog-overlay"}).join(" "),create:function(b){0===this.instances.length&&
(setTimeout(function(){a.ui.dialog.overlay.instances.length&&a(document).bind(a.ui.dialog.overlay.events,function(b){if(a(b.target).zIndex()<a.ui.dialog.overlay.maxZ)return!1})},1),a(document).bind("keydown.dialog-overlay",function(d){b.options.closeOnEscape&&(d.keyCode&&d.keyCode===a.ui.keyCode.ESCAPE)&&(b.close(d),d.preventDefault())}),a(window).bind("resize.dialog-overlay",a.ui.dialog.overlay.resize));var d=(this.oldInstances.pop()||a("<div></div>").addClass("ui-widget-overlay")).appendTo(document.body).css({width:this.width(),
height:this.height()});a.fn.bgiframe&&d.bgiframe();this.instances.push(d);return d},destroy:function(b){var d=a.inArray(b,this.instances);-1!=d&&this.oldInstances.push(this.instances.splice(d,1)[0]);0===this.instances.length&&a([document,window]).unbind(".dialog-overlay");b.remove();var c=0;a.each(this.instances,function(){c=Math.max(c,this.css("z-index"))});this.maxZ=c},height:function(){var b,d;return a.browser.msie&&7>a.browser.version?(b=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),
d=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight),b<d?a(window).height()+"px":b+"px"):a(document).height()+"px"},width:function(){var b,d;return a.browser.msie&&7>a.browser.version?(b=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth),d=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth),b<d?a(window).width()+"px":b+"px"):a(document).width()+"px"},resize:function(){var b=a([]);a.each(a.ui.dialog.overlay.instances,function(){b=b.add(this)});
b.css({width:0,height:0}).css({width:a.ui.dialog.overlay.width(),height:a.ui.dialog.overlay.height()})}});a.extend(a.ui.dialog.overlay.prototype,{destroy:function(){a.ui.dialog.overlay.destroy(this.$el)}})})(jQuery);(function(a){var b=0,c=0;a.widget("ui.tabs",{options:{add:null,ajaxOptions:null,cache:!1,cookie:null,collapsible:!1,disable:null,disabled:[],enable:null,event:"click",fx:null,idPrefix:"ui-tabs-",load:null,panelTemplate:"<div></div>",remove:null,select:null,show:null,spinner:"<em>Loading&#8230;</em>",tabTemplate:'<li><a href="#{href}"><span>#{label}</span></a></li>'},_create:function(){this._tabify(!0)},_setOption:function(a,b){"selected"==a?this.options.collapsible&&b==this.options.selected||this.select(b):
(this.options[a]=b,this._tabify())},_tabId:function(a){return a.title&&a.title.replace(/\s/g,"_").replace(/[^A-Za-z0-9\-_:\.]/g,"")||this.options.idPrefix+ ++b},_sanitizeSelector:function(a){return a.replace(/:/g,"\\:")},_cookie:function(){var b=this.cookie||(this.cookie=this.options.cookie.name||"ui-tabs-"+ ++c);return a.cookie.apply(null,[b].concat(a.makeArray(arguments)))},_ui:function(a,b){return{tab:a,panel:b,index:this.anchors.index(a)}},_cleanup:function(){this.lis.filter(".ui-state-processing").removeClass("ui-state-processing").find("span:data(label.tabs)").each(function(){var b=
a(this);b.html(b.data("label.tabs")).removeData("label.tabs")})},_tabify:function(b){function c(b,d){b.css({display:""});!a.support.opacity&&d.opacity&&b[0].style.removeAttribute("filter")}this.list=this.element.find("ol,ul").eq(0);this.lis=a("li:has(a[href])",this.list);this.anchors=this.lis.map(function(){return a("a",this)[0]});this.panels=a([]);var d=this,g=this.options,j=/^#.+/;this.anchors.each(function(b,c){var e=a(c).attr("href"),f=e.split("#")[0],h;if(f&&(f===location.toString().split("#")[0]||
(h=a("base")[0])&&f===h.href))e=c.hash,c.href=e;j.test(e)?d.panels=d.panels.add(d._sanitizeSelector(e)):"#"!=e?(a.data(c,"href.tabs",e),a.data(c,"load.tabs",e.replace(/#.*$/,"")),e=d._tabId(c),c.href="#"+e,c=a("#"+e),c.length||(c=a(g.panelTemplate).attr("id",e).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").insertAfter(d.panels[b-1]||d.list),c.data("destroy.tabs",!0)),d.panels=d.panels.add(c)):g.disabled.push(b)});b?(this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all"),
this.list.addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"),this.lis.addClass("ui-state-default ui-corner-top"),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom"),void 0===g.selected?(location.hash&&this.anchors.each(function(a,b){if(b.hash==location.hash)return g.selected=a,!1}),"number"!=typeof g.selected&&g.cookie&&(g.selected=parseInt(d._cookie(),10)),"number"!=typeof g.selected&&this.lis.filter(".ui-tabs-selected").length&&(g.selected=
this.lis.index(this.lis.filter(".ui-tabs-selected"))),g.selected=g.selected||(this.lis.length?0:-1)):null===g.selected&&(g.selected=-1),g.selected=0<=g.selected&&this.anchors[g.selected]||0>g.selected?g.selected:0,g.disabled=a.unique(g.disabled.concat(a.map(this.lis.filter(".ui-state-disabled"),function(a){return d.lis.index(a)}))).sort(),-1!=a.inArray(g.selected,g.disabled)&&g.disabled.splice(a.inArray(g.selected,g.disabled),1),this.panels.addClass("ui-tabs-hide"),this.lis.removeClass("ui-tabs-selected ui-state-active"),
0<=g.selected&&this.anchors.length&&(this.panels.eq(g.selected).removeClass("ui-tabs-hide"),this.lis.eq(g.selected).addClass("ui-tabs-selected ui-state-active"),d.element.queue("tabs",function(){d._trigger("show",null,d._ui(d.anchors[g.selected],d.panels[g.selected]))}),this.load(g.selected)),a(window).bind("unload",function(){d.lis.add(d.anchors).unbind(".tabs");d.lis=d.anchors=d.panels=null})):g.selected=this.lis.index(this.lis.filter(".ui-tabs-selected"));this.element[g.collapsible?"addClass":
"removeClass"]("ui-tabs-collapsible");g.cookie&&this._cookie(g.selected,g.cookie);for(var b=0,h;h=this.lis[b];b++)a(h)[-1!=a.inArray(b,g.disabled)&&!a(h).hasClass("ui-tabs-selected")?"addClass":"removeClass"]("ui-state-disabled");!1===g.cache&&this.anchors.removeData("cache.tabs");this.lis.add(this.anchors).unbind(".tabs");if("mouseover"!=g.event){var k=function(a,b){b.is(":not(.ui-state-disabled)")&&b.addClass("ui-state-"+a)};this.lis.bind("mouseover.tabs",function(){k("hover",a(this))});this.lis.bind("mouseout.tabs",
function(){a(this).removeClass("ui-state-hover")});this.anchors.bind("focus.tabs",function(){k("focus",a(this).closest("li"))});this.anchors.bind("blur.tabs",function(){a(this).closest("li").removeClass("ui-state-focus")})}var l,p;g.fx&&(a.isArray(g.fx)?(l=g.fx[0],p=g.fx[1]):l=p=g.fx);var q=p?function(b,e){a(b).closest("li").addClass("ui-tabs-selected ui-state-active");e.hide().removeClass("ui-tabs-hide").animate(p,p.duration||"normal",function(){c(e,p);d._trigger("show",null,d._ui(b,e[0]))})}:function(b,
c){a(b).closest("li").addClass("ui-tabs-selected ui-state-active");c.removeClass("ui-tabs-hide");d._trigger("show",null,d._ui(b,c[0]))},r=l?function(a,b){b.animate(l,l.duration||"normal",function(){d.lis.removeClass("ui-tabs-selected ui-state-active");b.addClass("ui-tabs-hide");c(b,l);d.element.dequeue("tabs")})}:function(a,b){d.lis.removeClass("ui-tabs-selected ui-state-active");b.addClass("ui-tabs-hide");d.element.dequeue("tabs")};this.anchors.bind(g.event+".tabs",function(){var b=this,c=a(this).closest("li"),
e=d.panels.filter(":not(.ui-tabs-hide)"),f=a(d._sanitizeSelector(this.hash));if(c.hasClass("ui-tabs-selected")&&!g.collapsible||c.hasClass("ui-state-disabled")||c.hasClass("ui-state-processing")||d._trigger("select",null,d._ui(this,f[0]))===false){this.blur();return false}g.selected=d.anchors.index(this);d.abort();if(g.collapsible){if(c.hasClass("ui-tabs-selected")){g.selected=-1;g.cookie&&d._cookie(g.selected,g.cookie);d.element.queue("tabs",function(){r(b,e)}).dequeue("tabs");this.blur();return false}if(!e.length){g.cookie&&
d._cookie(g.selected,g.cookie);d.element.queue("tabs",function(){q(b,f)});d.load(d.anchors.index(this));this.blur();return false}}g.cookie&&d._cookie(g.selected,g.cookie);if(f.length){e.length&&d.element.queue("tabs",function(){r(b,e)});d.element.queue("tabs",function(){q(b,f)});d.load(d.anchors.index(this))}else throw"jQuery UI Tabs: Mismatching fragment identifier.";a.browser.msie&&this.blur()});this.anchors.bind("click.tabs",function(){return false})},destroy:function(){var b=this.options;this.abort();
this.element.unbind(".tabs").removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible").removeData("tabs");this.list.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");this.anchors.each(function(){var b=a.data(this,"href.tabs");b&&(this.href=b);var c=a(this).unbind(".tabs");a.each(["href","load","cache"],function(a,b){c.removeData(b+".tabs")})});this.lis.unbind(".tabs").add(this.panels).each(function(){a.data(this,"destroy.tabs")?
a(this).remove():a(this).removeClass("ui-state-default ui-corner-top ui-tabs-selected ui-state-active ui-state-hover ui-state-focus ui-state-disabled ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide")});b.cookie&&this._cookie(null,b.cookie);return this},add:function(b,c,d){void 0===d&&(d=this.anchors.length);var g=this,j=this.options,c=a(j.tabTemplate.replace(/#\{href\}/g,b).replace(/#\{label\}/g,c)),b=!b.indexOf("#")?b.replace("#",""):this._tabId(a("a",c)[0]);c.addClass("ui-state-default ui-corner-top").data("destroy.tabs",
!0);var h=a("#"+b);h.length||(h=a(j.panelTemplate).attr("id",b).data("destroy.tabs",!0));h.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide");d>=this.lis.length?(c.appendTo(this.list),h.appendTo(this.list[0].parentNode)):(c.insertBefore(this.lis[d]),h.insertBefore(this.panels[d]));j.disabled=a.map(j.disabled,function(a){return a>=d?++a:a});this._tabify();1==this.anchors.length&&(j.selected=0,c.addClass("ui-tabs-selected ui-state-active"),h.removeClass("ui-tabs-hide"),this.element.queue("tabs",
function(){g._trigger("show",null,g._ui(g.anchors[0],g.panels[0]))}),this.load(0));this._trigger("add",null,this._ui(this.anchors[d],this.panels[d]));return this},remove:function(b){var c=this.options,d=this.lis.eq(b).remove(),g=this.panels.eq(b).remove();d.hasClass("ui-tabs-selected")&&1<this.anchors.length&&this.select(b+(b+1<this.anchors.length?1:-1));c.disabled=a.map(a.grep(c.disabled,function(a){return a!=b}),function(a){return a>=b?--a:a});this._tabify();this._trigger("remove",null,this._ui(d.find("a")[0],
g[0]));return this},enable:function(b){var c=this.options;if(-1!=a.inArray(b,c.disabled))return this.lis.eq(b).removeClass("ui-state-disabled"),c.disabled=a.grep(c.disabled,function(a){return a!=b}),this._trigger("enable",null,this._ui(this.anchors[b],this.panels[b])),this},disable:function(a){var b=this.options;a!=b.selected&&(this.lis.eq(a).addClass("ui-state-disabled"),b.disabled.push(a),b.disabled.sort(),this._trigger("disable",null,this._ui(this.anchors[a],this.panels[a])));return this},select:function(a){"string"==
typeof a?a=this.anchors.index(this.anchors.filter("[href$="+a+"]")):null===a&&(a=-1);-1==a&&this.options.collapsible&&(a=this.options.selected);this.anchors.eq(a).trigger(this.options.event+".tabs");return this},load:function(b){var c=this,d=this.options,g=this.anchors.eq(b)[0],j=a.data(g,"load.tabs");this.abort();if(!j||0!==this.element.queue("tabs").length&&a.data(g,"cache.tabs"))this.element.dequeue("tabs");else{this.lis.eq(b).addClass("ui-state-processing");if(d.spinner){var h=a("span",g);h.data("label.tabs",
h.html()).html(d.spinner)}this.xhr=a.ajax(a.extend({},d.ajaxOptions,{url:j,success:function(h,j){a(c._sanitizeSelector(g.hash)).html(h);c._cleanup();d.cache&&a.data(g,"cache.tabs",!0);c._trigger("load",null,c._ui(c.anchors[b],c.panels[b]));try{d.ajaxOptions.success(h,j)}catch(p){}},error:function(a,h){c._cleanup();c._trigger("load",null,c._ui(c.anchors[b],c.panels[b]));try{d.ajaxOptions.error(a,h,b,g)}catch(j){}}}));c.element.dequeue("tabs");return this}},abort:function(){this.element.queue([]);this.panels.stop(!1,
!0);this.element.queue("tabs",this.element.queue("tabs").splice(-2,2));this.xhr&&(this.xhr.abort(),delete this.xhr);this._cleanup();return this},url:function(a,b){this.anchors.eq(a).removeData("cache.tabs").data("load.tabs",b);return this},length:function(){return this.anchors.length}});a.extend(a.ui.tabs,{version:"1.8.2"});a.extend(a.ui.tabs.prototype,{rotation:null,rotate:function(a,b){var c=this,g=this.options,j=c._rotate||(c._rotate=function(b){clearTimeout(c.rotation);c.rotation=setTimeout(function(){var a=
g.selected;c.select(++a<c.anchors.length?a:0)},a);b&&b.stopPropagation()}),b=c._unrotate||(c._unrotate=!b?function(a){a.clientX&&c.rotate(null)}:function(){t=g.selected;j()});a?(this.element.bind("tabsshow",j),this.anchors.bind(g.event+".tabs",b),j()):(clearTimeout(c.rotation),this.element.unbind("tabsshow",j),this.anchors.unbind(g.event+".tabs",b),delete this._rotate,delete this._unrotate);return this}})})(jQuery);(function(a){a.storage=new a.store;a.wa.errorHandler=function(b){a.storage.del("site/"+a.wa.site.domain+"/hash");return 404==b.status?(a.wa.setHash("#/"),!1):!0};a.wa.site={options:[],domain:0,helper:"",init:function(b){"undefined"!=typeof a.History&&a.History.bind(function(){a.wa.site.dispatch()});this.domain=b.domain;this.options=b;b=window.location.hash;"#/"===b||!b?(b=a.storage.get("site/"+this.domain+"/hash"))&&null!=b?a.wa.setHash("#/"+b):this.dispatch():a.wa.setHash(b)},setHelper:function(b){if(!0===
b)return!1;b?(this.helper=b,a("#s-save-panel div.s-dropdown").show()):(this.helper="",a("#s-save-panel div.s-dropdown").hide())},dispatch:function(b){void 0==b&&(b=window.location.hash);if(b=b.replace(/^[^#]*#\/*/,""))if(b=b.split("/"),b[0]){for(var c="",e=b.length,f=0;f<b.length;f++){var d=b[f];if(2>f)if(0===f)c=d;else{if("files"==c){this.filesAction(b.slice(f).join("/"));return}if(parseInt(d,10)!=d&&-1==d.indexOf("="))c+=d.substr(0,1).toUpperCase()+d.substr(1);else{e=f;break}}else{e=f;break}}e=
b.slice(e);this[c+"Action"]?(this[c+"Action"].apply(this,e),a.storage.set("site/"+this.domain+"/hash",b.join("/"))):console&&console.log("Invalid action name:",c+"Action")}else this.defaultAction();else this.defaultAction()},defaultAction:function(){var b=a("div.s-sidebar ul.s-links a:first").attr("href");a.wa.setHash(b)},pagesAction:function(b){a("#wa-page-container").length?waLoadPage(b):(a("#s-save-panel input").replaceWith('<input id="wa-page-button" type="button" class="button green" value="'+
$_("Save")+'">'),a("#s-content").load("?module=pages","domain_id="+this.domain+(b?"&id="+b:""),function(){a.wa.site.savePanel(!0,"s-page-editor");a.wa.site.active(a("#s-link-pages"));a("#wa-page-button").click(function(){a("#wa-page-form").submit()})}))},newsiteAction:function(b){b=this.parseParams(b);a("#domain-name").val(b.domain||"");a("#addsite-dialog span.error").empty().hide();a("#addsite-dialog").waDialog({onSubmit:function(){var b=a(this);a.post(b.attr("action"),b.serialize(),function(b){"ok"==
b.status?location.href="?domain_id="+b.data.id+"#/settings/":"fail"==b.status&&a("#addsite-dialog span.error").html(b.errors).show()},"json");return!1}});a("#s-content .triple-padded .loading").length&&this.defaultAction()},designAction:function(b){a("#wa-design-container").length?(waDesignLoad(void 0===b?"":b),a.wa.site.savePanel(b&&(-1!=b.indexOf("action=edit")||-1!=b.indexOf("file="))),a("#wa-design-button").removeClass("yellow").addClass("green")):(this.parseParams(b),a("#s-save-panel input").replaceWith('<input id="wa-design-button" type="button" class="button green" value="'+
$_("Save")+'">'),a("#s-content").load("?module=design","domain_id="+this.domain,function(){a.wa.site.savePanel(b&&(-1!=b.indexOf("action=edit")||-1!=b.indexOf("file=")));a.wa.site.active(a("#s-link-design"));a("#wa-design-button").click(function(){a("#wa-design-form").submit()});waDesignLoad(void 0===b?"":b)}))},themesAction:function(){this.savePanel(!1);a("#wa-design-container").length?waDesignLoad():a("#s-content").load("?module=design","domain_id="+this.domain,function(){a.wa.site.active(a("#s-link-design"));
waDesignLoad()})},designAddAction:function(a){this.designAction(a+"&file=")},filesPage:function(a){a||(a=location.hash);a=a.split("/");if((a=a[a.length-1])&&"?"==a.substr(0,1))if(a=a.substr(1).split("="),"page"==a[0])return a[1];return 1},filesAction:function(b,c){this.savePanel(!1);var e=1;if(!0===b)var f=c||this.filesPath();else f=Array.prototype.join.call(arguments,"/"),b=!1;if(f&&-1!=f.indexOf("?")&&"/"!=f.substr(-1)){var d=f.substr(f.indexOf("?")+1),f=f.substr(0,f.indexOf("?")),d=d.split("=");
"page"==d[0]&&(e=d[1])}var g=function(){a.wa.site.active(a("#s-link-files"));a("#s-files-tree li.selected").removeClass("selected");if(f){a("a.s-baseurl").removeClass("selected");a("#s-folder-actions-li").show();var b=a("#s-files-tree a[href='#/files/"+f+"']");b.parent().addClass("selected");for(b=b.parent();b.length;){var c=b.find("> i.overhanging");c.hasClass("rarr")&&c.click();b=b.parent("ul").parent("li")}}else a("#s-folder-actions-li").hide(),a("a.s-baseurl").addClass("selected");a.wa.site.filesList(f,
e);a("#s-upload-path").val(f||"");a("#s-current-path").html("/"+(f||""));a("#s-files-count").html("0");a("#s-files-grid input.all").removeAttr("checked")};a("#s-files-tree").length&&!b?g():a("#s-content").load("?module=files","domain_id="+this.domain,function(){a("#s-files-tree i.overhanging").click(function(){var b=a(this);b.hasClass("rarr")?b.removeClass("rarr").addClass("darr").parent().children("ul").show():b.removeClass("darr").addClass("rarr").parent().children("ul").hide()});!0===b&&c?a.wa.setHash("#/files/"+
c):g()})},filesList:function(b,c){b||(b=this.filesPath());c||(c=this.filesPage());var e="http://"+this.options.domain_url+"/wa-data/public/site/"+a.wa.site.filesPath();a.post("?module=files&action=list&page="+c,{path:b},function(f){a("#s-files-grid tr.s-file").remove();a("div.s-pagination").empty();for(var d=0;d<f.data.files.length;d++){var g=f.data.files[d],g='<tr class="s-file"><td class="min-width"><input type="checkbox" value="'+g.file+'" /></td><td><ul class="menu-h dropdown clickable"><li><a href="'+
e+g.file+'"><i class="icon16 '+g.type+'"></i> '+g.file+' <i class="icon10 darr no-overhanging s-file-actions"></i></a></li></ul></td><td>'+g.datetime+'</td><td><span class="float-right">'+a.wa.site.getFileSize(g.size)+"</span></td></tr>";a("#s-files-grid").append(g)}if(1<f.data.pages){g='<ul class="menu-h">';for(d=1;d<=f.data.pages;d++)g+="<li"+(d==c?' class="selected"':"")+'><a href="#/files/'+b+"?page="+d+'">'+d+"</a></li>";a("div.s-pagination").html(g+"</ul>").show()}},"json")},getFileSize:function(a){return 1024>
a?a+" B":1048576>a?Math.round(a/1024)+" KB":1073741824>a?Math.round(a/1048576)+" MB":Math.round(a/1073741824)+" GB"},checkFileType:function(a){return"image"==a||"text"==a||"script-css"==a||"script-js"==a},getFileMenu:function(b){var c=this.options.domain_url+"/wa-data/public/site/"+a.wa.site.filesPath()+b,e=a('<ul class="menu-v width-icons" style="display:block"></ul>');".php"!=b.substr(-4)&&(".phtml"!=b.substr(-6)&&"."!=b.substr(0,1))&&e.append('<li><i class="icon16 globe"></i>'+$_("File URL")+': <a href="http://'+
c+'" target="_blank" class="bold">'+c+'<i class="icon10 new-window"></i></a></li>');".php"!=b.substr(-4)&&".phtml"!=b.substr(-6)&&e.append('<li><a href="?module=files&action=download&path='+a.wa.site.filesPath()+"&file="+b+'"><i class="icon16 download"></i>'+$_("Download")+"</a></li>");e.append(a("<li></li>").append('<a href="#"><i class="icon16 edit"></i>'+$_("Rename")+"</a>").click(function(){a("#s-rename-dialog").waDialog({disableButtonsOnSubmit:!0,onLoad:function(){a("#s-name").val(b).focus().select();
a(this).find("span").html(a.wa.site.filesPath(!0))},onSubmit:function(){var c=a("#s-name").val();a.post("?module=files&action=rename",{path:a.wa.site.filesPath(),name:c,file:b},function(b){"ok"==b.status?(a.wa.site.filesList(),a("#s-rename-dialog").hide()):"fail"==b.status&&(alert(b.errors),a("#s-rename-dialog input[type=submit]").removeAttr("disabled"))},"json");return!1}});return!1}));e.append(a("<li></li>").append('<a href="#"><i class="icon16 move"></i>'+$_("Move to folder")+"</a>").click(function(){a("#s-move-dialog select").html(a.wa.site.filesPathOptions(a("#s-files-tree > ul.s-folderlist"),
""));a("#s-move-dialog-files").html('<input type="hidden" name="file" value="'+b+'" />');a("#s-move-dialog input[name=path]").val(a.wa.site.filesPath());a("#s-move-dialog h1 span").empty();a("#s-move-dialog").waDialog({disableButtonsOnSubmit:!0,onSubmit:function(){a.post("?module=files&action=move",a("#s-move-dialog form").serialize(),function(b){"ok"==b.status?(a("#s-move-dialog").hide(),a.wa.site.filesList()):"fail"==b.status&&(alert(b.errors),a("#s-move-dialog input[type=submit]").removeAttr("disabled"))},
"json");return!1}});return!1}));e.append(a("<li></li>").append('<a href="#"><i class="icon16 delete"></i>'+$_("Delete")+"</a>").click(function(){a("#s-delete-dialog").waDialog({content:"<h1>"+$_("Delete file")+"</h1><p>"+$_("File")+" <b>"+b+"</b> "+$_("will be deleted without the ability to recover.")+"</p>",disableButtonsOnSubmit:!0,onSubmit:function(){a.post("?module=files&action=delete",{path:a.wa.site.filesPath(),file:b},function(b){"ok"==b.status?(a.wa.site.filesList(),a("#s-delete-dialog").hide()):
"fail"==b.status&&(alert(b.errors),a("#s-delete-dialog input[type=submit]").removeAttr("disabled"))},"json")}});return!1}));return e},settingsAction:function(){this.savePanel(!1);a("#s-content").load("?module=settings&domain_id="+this.domain,function(){a.wa.site.active(a("#s-link-settings"))})},settingsRoutingAction:function(){this.settingsAction("routing")},blocksAction:function(b){a("#s-save-panel input").replaceWith('<input id="s-editor-save-button" type="button" class="button green" value="'+
$_("Save")+'">');a("#s-content").load("?module=blocks",b,function(){waEditorAceInit({id:"content",save_button:"s-editor-save-button"});a("#s-editor-save-button").click(function(){a("#site-form").submit()});a.wa.site.savePanel(!0);a.wa.site.setHelper("app=");a.wa.site.active(a("#s-link-blocks"))})},blocksAddAction:function(){this.blocksAction("id=")},active:function(b){a(".sidebar a.selected").removeClass("selected");a("ul.s-links li.selected").removeClass("selected");b&&b.length&&b.addClass("selected")},
routingAction:function(b){this.savePanel(!1);a("#s-content").load("?module=routing","domain_id="+this.domain,function(){a.wa.site.active(a("#s-link-routing"));a("tr#route-"+b+" .s-route-settings").click()})},personalSettingsAction:function(b){var c=this.domain;this.savePanel(!1);var e=function(){a("#s-personal-content").html('<i class="icon16 loading"></i>').load("?module=personal&action=settings&hash="+(b||""),"domain_id="+c,function(){a("ul.s-personal-structure li.selected").removeClass("selected")})};
a("#s-personal-content").length?e():this.personalAction(e)},personalAppAction:function(b){var c=this.domain;this.savePanel(!1);var e=function(){a("#s-personal-content").html('<i class="icon16 loading"></i>').load("?module=personal&action=app&app_id="+b,"domain_id="+c,function(){a("ul.s-personal-structure li.selected").removeClass("selected");a("#s-personal-app-"+b).addClass("selected");a("#s-app-frontend-link").html(a("#s-personal-app-"+b).data("link")).attr("href",a("#s-personal-app-"+b).data("link"))})};
a("#s-personal-content").length?e():this.personalAction(e)},personalProfileAction:function(){var b=this.domain;this.savePanel(!1);var c=function(){a("#s-personal-content").html('<i class="icon16 loading"></i>').load("?module=personal&action=profile","domain_id="+b,function(){a("ul.s-personal-structure li.selected").removeClass("selected");a("#s-personal-profile-link").addClass("selected")})};a("#s-personal-content").length?c():this.personalAction(c)},personalAction:function(b){this.savePanel(!1);
a("#s-content").load("?module=personal","domain_id="+this.domain,function(){a.wa.site.active(a("#s-link-personal"));b?b():a("#s-personal-settings-link").data("enabled")?a.wa.setHash(a("ul.s-personal-structure a:first").attr("href")):a.wa.setHash("#/personal/settings/")})},parseParams:function(a){if(!a)return{};var a=a.split("&"),c={};for(i=0;i<a.length;i++){var e=a[i].split("=");c[e[0]]=1<e.length?e[1]:""}return c},savePanel:function(b,c){b?(a("#s-save-panel").show(),a("#s-save-panel input").removeClass("yellow").addClass("green"),
a("#wa-editor-status").empty(),c?a("#s-save-panel .s-bottom-fixed-bar-content-offset").addClass(c):a("#s-save-panel .s-bottom-fixed-bar-content-offset").attr("class","s-bottom-fixed-bar-content-offset")):a("#s-save-panel").hide()},getTreeHTML:function(a,c,e){for(var e=e||"",c="<ul"+(c?"":' style="display:none"')+' class="menu-v with-icons'+(c?" "+c:"")+'">',f="",d=0;d<a.length;d++)f="string"==typeof a[d]?a[d]:a[d].id,c+="<li>","string"!=typeof a[d]&&(c+='<i class="icon16 rarr overhanging"></i>'),
c+='<a href="#/files/'+e+f+'/"><i class="icon16 folder"></i><b>'+f+"</b></a>","string"!=typeof a[d]&&(c+=this.getTreeHTML(a[d].childs,!1,e+f+"/")),c+="</li>";return c+"</ul>"},filesPath:function(b){b=b?"wa-data/public/site/":"";return a("#s-files-tree li.selected").length?b+a("#s-files-tree li.selected a").attr("href").substr(8):b},filesPathOptions:function(b,c,e){var c=c||"",f="";""==c&&(f='<option value="">wa-data/public/site</a>',c="&nbsp;&nbsp;&nbsp;");e=e||!1;b.children("li").each(function(){var b=
e&&a(this).find("> ul > li.selected").length||!e&&a(this).hasClass("selected")?true:false,g=a(this).children("a");f=f+("<option "+(b?'selected="selected"':"")+' value="'+g.attr("href").substr(8)+'">'+c+g.children("b").html()+"</option>");if(a(this).children("ul").length&&(!e||!a(this).hasClass("selected")))f=f+a.wa.site.filesPathOptions(a(this).children("ul"),c+"&nbsp;&nbsp;&nbsp;",e)});return f}}})(jQuery);
$(function(){$(".s-add-new-site").live("click",function(){$.wa.site.newsiteAction();return!1});$("#s-helper-link").click(function(){if($("#s-helper").is(":visible"))return $("#s-helper").hide(),!1;$("#s-helper").load("?module=helper",$.wa.site.helper,function(){$(this).show();var a=function(b){if("s-helper"==$(b.target).attr("id")||$(b.target).parents("#s-helper").length)$(document).one("click",a);else $("#s-helper").hide()};$(document).one("click",a)});return!1});$("#s-helper div.fields a.inline-link").live("click",
function(){var a=$(this).find("i");a.children("b").length&&(a=a.children("b"));$("#wa-page-content").length?$("#wa-page-content").waEditor("insert",a.text()):wa_editor.insert(a.text());return!1});$("#wa-app > div.s-sidebar a, #wa-header a").live("click",function(){if($("#s-save-panel").is(":visible")&&$("#s-save-panel input:button").hasClass("yellow"))return confirm($_("Unsaved changes will be lost if you leave this page now. Are you sure?"))})});
