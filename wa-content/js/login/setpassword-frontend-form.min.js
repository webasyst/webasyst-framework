var WaLoginAbstractForm=function(t){var r=function(){},e=r;e.className="WaLoginAbstractForm",e.def=function(t,r){for(var e=0,o=arguments.length;e<o;e++)if(void 0!==arguments[e])return arguments[e]};var o=e.def;return e.inherit=function(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t},e.prototype.init=function(t){var r=this;r.initVars(t),r.initSubmit(),r.initErrorsAutoCleaner(),r.showErrors(r.errors),r.setFocus(),r.initCaptcha()},e.prototype.initVars=function(r){var a=this;r=r||{},a.$wrapper=o(a.$wrapper,r.$wrapper,t()),a.$form||(a.$form=a.$wrapper.find(".js-wa-form-item"),a.$form.length||(a.$form=a.$wrapper.find("form")),a.$form.length||(a.$form=t())),a.namespace=o(a.namespace,r.namespace,""),a.$templates=o(a.$templates,r.$templates,{}),a.$templates=t.extend({error_msg:t('<em class="wa-error-msg"></em>'),info_msg:t('<div class="wa-info-msg"></div>')},a.$templates),a.classes=o(a.classes,r.classes,{}),a.classes=t.extend({error_input:"wa-error",error_msg:"wa-error-msg",uncaught_errors:"wa-uncaught-errors",messages:"wa-info-messages",messages_wrapper:"wa-info-messages-wrapper",message_msg:"wa-info-msg",field:"field"},a.classes),a.errors=o(a.errors,r.errors,{}),a.is_errors=!t.isEmptyObject(a.errors),a.locale=o(a.locale,r.locale,{}),a.js_validate=o(a.js_validate,r.js_validate,!0),a.is_json_mode=o(a.is_json_mode,r.is_json_mode),a.className=o(a.className,e.className),a.$captcha=o(a.$captcha,a.$wrapper.find(".wa-captcha-field")),a.need_redirects=void 0===r.need_redirects||!!r.need_redirects,a.env="",a.form_type=""},e.prototype.getFormItem=function(){return this.$form},e.prototype.getFormAction=function(){var t=this;return t.$form.is("form")?t.$form.attr("action"):t.$form.data("action")},e.prototype.getSerializedFormData=function(){var t=this,r=t.getFormItem();return r.is("form")?r.serializeArray():(r.find("[data-turn-off=1]").find(":input").attr("disabled",!0),r.find(":input:not(:disabled)").serializeArray())},e.prototype.beforeSubmit=function(){var t=this,r=t.getFormItem(),e=function(){var t=document.cookie.match(new RegExp("(?:^|; )_csrf=([^;]*)"));return t&&t[1]?decodeURIComponent(t[1]):""};r.find('[name="_csrf"]').val(e)},e.prototype.setFocus=function(){},e.prototype.triggerEvent=function(t){var r=this,e={env:r.env,form_type:r.form_type,form_wrapper_id:r.$wrapper.attr("id")},o=Array.prototype.slice.call(arguments),o=o.slice(1);r.$wrapper.trigger(t,o.concat([e]))},e.prototype.initCaptcha=function(){var r=this;r.$wrapper.find(".wa-captcha-field").length?t(window).one("wa_recaptcha_loaded wa_captcha_loaded",function(){r.triggerEvent("wa_auth_form_loaded"),r.triggerEvent("wa_auth_form_change_view")}):r.triggerEvent("wa_auth_form_loaded")},e.prototype.turnOffBlock=function(r){var e=this;r.data("turnOff",1).attr("data-turn-off",1).hide(),r.find(":input").attr("disabled",!0),r.find("[type=button],:submit").each(function(){var r=t(this),o=t('<div class="wa-js-old-button-place"></div>'),a=t('<div class="wa-js-new-button-place"></div>');r.after(o),o.data("button",r),a.hide(),e.getFormItem().append(a),a.html(r)}),e.triggerEvent("wa_auth_form_change_view")},e.prototype.turnOnBlock=function(r){var e=this;r.find(".wa-js-old-button-place").each(function(){var r=t(this),e=r.data("button"),o=e.parent();r.after(e),r.remove(),o.remove()}),r.data("turnOff","").attr("data-turn-off","").show(),r.find(":input").attr("disabled",!1),e.triggerEvent("wa_auth_form_change_view")},e.prototype.isJsonMode=function(){return this.is_json_mode},e.prototype.formatInfoMessage=function(r,e,o){e=void 0===e||e;var a=this,n=a.$templates.info_msg,i=n.clone();return void 0!==o&&i.data("name",o).attr("data-name",o),e?i.text(t.trim(""+r)):i.html(t.trim(""+r))},e.prototype.getInfoMessages=function(t){var r=this,e=r.$wrapper,o="."+r.classes.message_msg;return t&&(o+='[data-name="'+t+'"]'),e.find(o)},e.prototype.clearInfoMessages=function(t){var r=this;r.getInfoMessages(t).remove(),r.triggerEvent("wa_auth_form_change_view")},e.prototype.showInfoMessages=function(r){var e=this,o=e.$wrapper,a=o.find("."+e.classes.messages);t.each(r||{},function(r,o){var n=e.getFormInput(r);"string"==typeof o&&(o=[o]);var i=[];t.each(o||[],function(t,o){var a=e.formatInfoMessage(o,!1,r);a.data("code",t).attr("data-code",t),i.push(a)}),n.length?n.after(i):a.show().append(i)}),e.triggerEvent("wa_auth_form_change_view")},e.prototype.clearErrors=function(){var t=this;if(t.is_errors){var r=t.$wrapper;r.find("."+t.classes.error_input).removeClass(t.classes.error_input),r.find("."+t.classes.error_msg).not("[data-not-clear=1]").remove(),r.find("."+t.classes.uncaught_errors).find("."+t.classes.error_msg).length<=0&&r.find("."+t.classes.uncaught_errors).hide(),t.is_errors=!1,t.triggerEvent("wa_auth_form_change_view")}},e.prototype.getErrorTemplate=function(t,r,e){return this.$templates.error_msg},e.prototype.escape=function(r){var e=t("<div>");return e.text(t.trim(""+r)),r=e.text(),e.remove(),r},e.prototype.prepareErrorText=function(t,r,e){return this.escape(r)},e.prototype.prepareErrorItem=function(t,r,e){var o=this,a=o.getErrorTemplate(t,r,e).clone(),n=a.clone();return n.data("name",t).data("code",e).attr("data-name",t).attr("data-code",e),n.html(o.prepareErrorText(t,r,e)),n},e.prototype.showInputError=function(t,r){var e=this,o=e.getFormInput(t);return!!o.length&&(o.parent().append(r),o.addClass(e.classes.error_input),!0)},e.prototype.getFormInput=function(t){var r=this,e=r.getFormItem(),o=r.buildFormInputName(t);return e.find('[name="'+o+'"]')},e.prototype.buildFormInputName=function(t){var r=this,e=r.namespace;return e?e+"["+t+"]":t},e.prototype.getFormField=function(t){var r=this;return r.$wrapper.find("."+r.classes.field+'[data-field-id="'+t+'"]')},e.prototype.getInfoMessageItem=function(t,r){var e=this,o=e.$wrapper,a=o.find("."+e.classes.message_msg+'[data-name="'+t+'"]');return void 0!==r?a.filter('[data-code="'+r+'"]'):a},e.prototype.getErrorItem=function(t,r){var e=this,o=e.$wrapper,a=o.find("."+e.classes.error_msg+'[data-name="'+t+'"]');return void 0!==r?a.filter('[data-code="'+r+'"]'):a},e.prototype.showUncaughtErrors=function(t,r,e){var o=this,a=o.$wrapper,n=a.find("."+o.classes.uncaught_errors);return!!n.length&&(n.show(),e&&n.html(""),n.show().append(r),!0)},e.prototype.afterShowErrors=function(){},e.prototype.showErrors=function(r){var e=this;t.each(r||{},function(r,o){"string"==typeof o&&(o=[o]);var a=e.prepareErrorItems(r,o),n=e.showInputError(r,a);n||(n=e.showUncaughtErrors(r,a,!0)),!n&&console&&console.error&&t.each(a,function(){var r="Uncaught validate error: "+t(this).text();console.error(r)})}),e.is_errors=!0,e.afterShowErrors(),e.triggerEvent("wa_auth_form_change_view")},e.prototype.initSubmit=function(){var r=this,e=r.getFormItem(),o=null,a=function(t){var e=r.onSubmit(t);e&&(o&&o.abort(),o=e)};e.is("form")?e.submit(function(t){a(t)}):(e.on("click",":submit,button",function(r){var e=t(this);e.is(":disabled")||e.data("ignore")||(r.preventDefault(),a(r))}),e.on("keydown","input",function(t){13==t.keyCode&&(t.preventDefault(),e.find(":submit,button").not(":disabled").filter(":first").trigger("click"))}))},e.prototype.validate=function(){return{}},e.prototype.initErrorsAutoCleaner=function(){var r=this,e=r.getFormItem(),o={},a=r.buildFormInputName("captcha"),n=":text:not([name="+a+"]),:password";e.find(n).each(function(){var r=t(this),e=r.attr("name"),a=r.val();o[e]={val:t.trim(a||""),timer:null}}),e.on("keydown",n,function(e){if(13!=e.keyCode){var a=t(this),n=a.attr("name"),i=o[n]||{},s=t.trim(i.val||""),c=i.timer||null;c&&clearTimeout(c),i.timer=setTimeout(function(){var e=t.trim(a.val()||"");e!==s&&r.clearErrors(),i.val=e},300)}}),e.on("change",":input",function(){var e=t(this),a=e.attr("name"),n=o[a]||{},i=t.trim(n.val||""),s=t.trim(e.val()||"");s!==i&&r.clearErrors(),n.val=s})},e.prototype.onDoneSubmitHandlers=function(){var t=this;return{errors:function(r,e){return t.showErrors(r),!0},redirect:function(t){return t=t||"",-1!==t.indexOf("#")&&t===window.location.href?window.location.reload():window.location.href=t,!0},messages:function(r){return t.showInfoMessages(r),!0},rest:function(t){return!0}}},e.prototype.onDoneSubmit=function(r){var e=this,o=e.onDoneSubmitHandlers(),a=r&&"ok"===r.status,n=r&&r.data||{},i=n.messages||{},s=r&&r.errors||{};if(a||!(o.errors&&o.errors(s,r))){if(e.isRedirectResponse(r)){var c=e.getRedirectUrl(r);if(o.redirect&&o.redirect(c,r))return}!t.isEmptyObject(i)&&(o.messages&&o.messages(i,r))||o.rest&&o.rest(r)}},e.prototype.submit=function(r){r=r||{};var e=this;if(e.beforeSubmit(),e.clearErrors(),e.js_validate){var o=e.validate();if(!t.isEmptyObject(o))return void e.showErrors(o)}var a=e.getFormItem(),n=r.$button||a.find(":submit"),i=r.$loading||a.find(".wa-loading"),s=r.url||e.getFormAction(),c=e.getSerializedFormData();return i.show(),n.attr("disabled",!0),e.jsonPost(s,c).done(function(t){e.isRedirectResponse(t)||(n.attr("disabled",!1),i.hide()),e.onDoneSubmit(t)}).fail(function(){n.attr("disabled",!1)})},e.prototype.onSubmit=function(t){var r=this;if(r.isJsonMode())return t.preventDefault(),r.submit()},e.prototype.mixinVarsInData=function(r,e){return t.isPlainObject(e)?e=t.extend(e,r):t.isArray(e)?t.each(r,function(t,r){e.push({name:t,value:r})}):e&&t.each(r,function(t,r){e+="&"+t+"="+r}),e},e.prototype.beforeJsonPost=function(t,r){var e=this,o={wa_json_mode:1,need_redirects:e.need_redirects?1:0};return r=e.mixinVarsInData(o,r)},e.prototype.isRedirectResponse=function(t){return null!==this.getRedirectUrl(t)},e.prototype.getRedirectUrl=function(t){var r=t&&"ok"===t.status&&t.data&&t.data.redirect_url;return"string"==typeof r?r:null},e.prototype.jsonPost=function(r,e){var o=this;return e=o.beforeJsonPost(r,e),t.post(r,e,"json").always(function(r){o.isRedirectResponse(r)||t(".wa-captcha-refresh").trigger("click")})},e.prototype.beforeErrorTimerStart=function(t,r,e){},e.prototype.afterErrorTimerFinish=function(t,r,e){},e.prototype.prepareTimeoutErrorItem=function(t,r,e){var o=this,a=o.prepareErrorItem("timeout",t);return e=e||{},o.beforeErrorTimerStart(t,r,e),a.data("notClear",1).attr("data-not-clear",1),o.runTimeoutMessage(a,{timeout:r,onFinish:function(){a.remove(),o.afterErrorTimerFinish(t,r,e)}}),a},e.prototype.prepareErrorItems=function(r,e){var o=this,a=[];if("timeout"===r){var n=e.message,i=e.timeout,s=o.prepareTimeoutErrorItem(n,i,{error_namespace:r});a=[s]}else t.each(e||[],function(t,e){var n;n="timeout"===t?o.prepareTimeoutErrorItem(e.message,e.timeout,{error_namespace:r,error_code:t}):o.prepareErrorItem(r,e,t),a.push(n)});return a},e.prototype.runTimeoutMessage=function(r,e){var o=this,a=e.timeout,n=t.trim(r.html()),i=e.onFinish;if(a=parseInt(a,10),a=!isNaN(a)&&a>0?a:60,i="function"==typeof i?i:null,n.match(/\d+:\d/)){o.triggerEvent("wa_auth_form_change_view");var s=setInterval(function(){if((a-=1)<=0)return clearInterval(s),r.remove(),void(i&&i());var t=r.html(),e=parseInt(a/60,10),o=a%60,n=e<=9?"0"+e:e,c=o<=9?"0"+o:o;t=t.replace(/\d+:\d+/,n+":"+c),r.html(t)},1e3)}},e}(jQuery),WaLoginAbstractSetPasswordForm=function(t){var r=WaLoginAbstractSetPasswordForm=function(){};r.className="WaLoginAbstractSetPasswordForm";var e=WaLoginAbstractForm,o=WaLoginAbstractForm.def;return WaLoginAbstractForm.inherit(r,e),r.prototype.initVars=function(t){var a=this;a.className=o(a.className,r.className),e.prototype.initVars.call(a,t),a.form_type="setpassword"},r.prototype.validate=function(){var r=this,e=r.getSerializedFormData(),o={};t.each(e,function(e,a){var n=a.name,i=t.trim(a.value||"");return n!==r.buildFormInputName("login")||i?n!==r.buildFormInputName("password")||i?n!==r.buildFormInputName("captcha")||i?void 0:void(o.captcha=[r.locale.captcha_required||r.locale.required||""]):void(o.password=[r.locale.password_required||r.locale.required||""]):void(o.login=[r.locale.login_required||r.locale.required||""])});var a=r.getFormInput("password"),n=r.getFormInput("password_confirm");return t.trim(a.val()||"")!==t.trim(n.val()||"")&&(o.password_confirm=[r.locale.not_match||""]),o},r}(jQuery),WaFrontendSetPassword=function(t){var r=function(t){this.init(t)},e=r;e.className="WaFrontendSetPassword";var o=WaLoginAbstractSetPasswordForm;return WaLoginAbstractForm.inherit(e,o),e.prototype.initVars=function(t){var r=this;r.className=e.className,o.prototype.initVars.call(r,t),r.initHash(t.hash),r.env="frontend"},e.prototype.initHash=function(t){var r=this;if(r.hash=t||"",!r.hash){var e=location.href,o=/key=([^&]+)/.exec(e)[1];r.hash=o||"",r.hash||(o=/hash=([^&]+)/.exec(e)[1],r.hash=o||"")}},e.prototype.beforeJsonPost=function(t,r){var e=this;return r=o.prototype.beforeJsonPost.call(e,t,r),r=e.mixinVarsInData({hash:e.hash},r)},e.prototype.onDoneSubmitHandlers=function(){var t=this,r=o.prototype.onDoneSubmitHandlers.call(t);return r.rest=function(r){!0===r.data.set_password&&(t.triggerEvent("wa_auth_reset_password"),t.triggerEvent("wa_auth_contact_logged",r.data.contact||{})),!0===r.data.generated_password_sent&&t.triggerEvent("wa_auth_resent_password")},r},e}(jQuery);
//# sourceMappingURL=setpassword-frontend-form.min.js.map
